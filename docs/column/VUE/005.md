---
title: æ¨¡å—åŒ–å¦™ç”¨ï¼ç”¨vue3å®ç°ä¸€ä¸ªé¼ æ ‡è¿½è¸ªå™¨å’Œå¼‚æ­¥åŠ è½½ç»„ä»¶
author: å‘¨ä¸€
date: '2021-12-12'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - vue.js
sidebar: 'auto'
---

![æ¨¡å—åŒ–å¦™ç”¨](https://img-blog.csdnimg.cn/20210621082248510.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

@[toc](ç”¨vue3å®ç°ä¸€ä¸ªé¼ æ ‡è¿½è¸ªå™¨å’Œå¼‚æ­¥åŠ è½½ç»„ä»¶)
å‘¨ä¸€æœ€è¿‘å­¦å®Œ `vue3` æ–°ç‰¹æ€§ï¼Œå°±æƒ³ç€ç”¨ `vue3` æ¥æ£é¼“ç‚¹æ–°çš„å°å·¥å…·ã€‚çªç„¶æƒ³åˆ°ä»¥å‰è‡ªå·±é‡åˆ°çš„ä¸€ä¸ªé—®é¢˜ï¼Œæƒ³è¦è·å–å½“å‰é¼ æ ‡ç‚¹å‡»çš„ä½ç½®ï¼Œä½†æ˜¯ä»¥å‰æ˜¯ç›´æ¥ç”¨åŸç”Ÿ `js` å†™çš„ï¼Œä½“éªŒæ„Ÿå°±æ²¡æœ‰é‚£ä¹ˆå¥½äº†ï¼Œäºæ˜¯ä¹ï¼Œä»Šå¤©å°±ç”¨ `vue3` æ¥å¼€å§‹æˆ‘çš„å°å·¥å…·ä¹‹æ—…å•¦ï¼

åœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œå°†å¸¦é¢†å¤§å®¶åˆå§‹åŒ–ä¸€ä¸ª `vue3` é¡¹ç›®ï¼Œå¹¶ä¸”ç”¨ `vue3` å®ç°ä¸€ä¸ª**é¼ æ ‡è¿½è¸ªå™¨**å’Œ**å¼‚æ­¥åŠ è½½ç»„ä»¶**ã€‚

ğŸ¬ğŸ¬ğŸ¬

# ä¸€ã€ğŸ–±ï¸ é¼ æ ‡è¿½è¸ªå™¨

## 1ã€åŠŸèƒ½å®ç°

æˆ‘ä»¬å…ˆåœ¨ `vue3` é¡¹ç›®ä¸‹å»ºç«‹ä¸€ä¸ª `ts` æ–‡ä»¶ï¼Œè¿™ä¸ª `ts` æ–‡ä»¶ç”¨æ¥å®ç°**é¼ æ ‡è¿½è¸ªå™¨**çš„åŠŸèƒ½ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```ts
//å¼•å…¥éœ€è¦ä½¿ç”¨çš„Composition API
import { ref, onMounted, onUnmounted } from 'vue';
//å®ç°é¼ æ ‡è¿½è¸ªå™¨åŠŸèƒ½
function useMousePosition() {
  //åˆå§‹åŒ–xè½´å’Œyè½´çš„å€¼
  const x = ref(0);
  const y = ref(0);

  //è·å–é¼ æ ‡ç‚¹å‡»åxè½´å’Œyè½´çš„å€¼
  const updateMouse = (e: MouseEvent) => {
    x.value = e.pageX;
    y.value = e.pageY;
  };

  //é¼ æ ‡ç‚¹å‡»æ—¶æ‰§è¡ŒupdateMouseå‡½æ•°
  onMounted(() => {
    document.addEventListener('click', updateMouse);
  });

  //é¼ æ ‡ç‚¹å‡»ç»“æŸåå¯¹å½“å‰ç‚¹å‡»äº‹ä»¶æ‰§è¡Œé”€æ¯æ“ä½œ
  onUnmounted(() => {
    document.removeEventListener('click', updateMouse);
  });

  //è¿”å›xå’Œyçš„å€¼
  return { x, y };
}

//å¯¼å‡ºå‡½æ•°
export default useMousePosition;
```

## 2ã€ç»™é™æ€é¡µé¢ç»‘å®šåŠŸèƒ½

æˆ‘ä»¬åœ¨ `vue3` é¡¹ç›®ä¸‹å»ºç«‹ä¸€ä¸ª `.vue` æ–‡ä»¶ï¼Œæ¥åŠ è½½**é™æ€ç»„ä»¶å†…å®¹**ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div id="app">
    <h1>é¼ æ ‡è¿½è¸ªå™¨</h1>
    <h1>X:{{x}},Y:{{y}}</h1>
  </div>
</template>

<script lang="ts">
  //å¼•å…¥å‡½æ•°
  import useMousePosition from './useMousePosition';

  export default {
    name: 'App',
    setup() {
      //å¼•ç”¨å‡½æ•°ä¸­è¿”å›çš„å€¼
      const { x, y } = useMousePosition();

      //è¿”å›å€¼
      return {
        x,
        y,
      };
    },
  };
</script>

<style>
  #app {
    font-family: Avenir, Helvetica, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-align: center;
    color: #2c3e50;
    margin-top: 60px;
  }
</style>
```

**æœ€ç»ˆæˆ‘ä»¬æ¥çœ‹ä¸‹æ˜¾ç¤ºæ•ˆæœï¼š**

![é¼ æ ‡è¿½è¸ªå™¨](https://img-blog.csdnimg.cn/20210618165448131.gif#pic_center)

çœ‹å®Œæ•ˆæœï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹ä»£ç ã€‚å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œ `vue3` ä¸­çš„ä»£ç æŠ½ç¦»ï¼Œä½¿å¾—åŠŸèƒ½å®ç°å˜å¾—éå¸¸æ–¹ä¾¿ã€‚æˆ‘ä»¬é€šè¿‡åœ¨ç»„ä»¶å¤–éƒ¨å†å®šä¹‰ä¸€ä¸ª `ts` æ–‡ä»¶ï¼Œæ¥å®ç°å…·ä½“çš„åŠŸèƒ½ï¼Œè€Œä¸å†å°†å…·ä½“çš„åŠŸèƒ½æ”¾åœ¨ç»„ä»¶å†…éƒ¨æ¥å®ç°ã€‚

è¿™æ ·ä»æŸç§å±‚é¢ä¸Šæ¥è®²ï¼Œä»£ç çš„**å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§**éƒ½çµæ´»äº†è®¸å¤šã€‚

# äºŒã€âš™ï¸ å¼‚æ­¥åŠ è½½ç»„ä»¶

çœ‹å®Œé¼ æ ‡è¿½è¸ªå™¨ï¼Œæˆ‘ä»¬å†æ¥å®ç°ä¸€ä¸ªå¼‚æ­¥åŠ è½½ç»„ä»¶ã€‚

åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œç»å¸¸éœ€è¦ç”¨åˆ°å¼‚æ­¥åŠ è½½ç»„ä»¶ï¼Œè€Œå¼‚æ­¥åŠ è½½æœ€å¸¸è§çš„éœ€æ±‚å°±æ˜¯**åŠ è½½ loading çš„çŠ¶æ€**ã€‚

åŠ è½½ `loading` çš„çŠ¶æ€å…¶å®å°±æ˜¯å½“æˆ‘ä»¬åˆšå¼€å§‹**åŠ è½½é¡µé¢**æ—¶ï¼Œå¦‚æœå¼‚æ­¥è¯·æ±‚çš„å†…å®¹è¿˜æ²¡æœ‰æ˜¾ç¤ºï¼Œé‚£å°±å…ˆæ˜¾ç¤ºä¸€ä¸ª `loading` æ•ˆæœè®©ç”¨æˆ·å…ˆç­‰ç­‰ï¼Œç­‰åˆ°å¼‚æ­¥è¯·æ±‚çš„å†…å®¹åŠ è½½å‡ºæ¥äº†ï¼Œå°±å¯ä»¥æ˜¾ç¤ºå…·ä½“çš„æ•ˆæœã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚

## 1ã€åŠŸèƒ½å®ç°

æˆ‘ä»¬å…ˆåœ¨ `vue3` é¡¹ç›®ä¸‹å»ºç«‹ä¸€ä¸ª `ts` æ–‡ä»¶ï¼Œè¿™ä¸ª `ts` æ–‡ä»¶ç”¨æ¥å®ç°**åŠ è½½å¼‚æ­¥ç»„ä»¶**çš„åŠŸèƒ½ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { ref } from 'vue';
import axios from 'axios';

function useURLLoader(url: string) {
  const result = ref(null);
  const loading = ref(true);
  const loaded = ref(false);
  const error = ref(null);

  axios
    .get(url)
    .then((rawData) => {
      loading.value = false;
      loaded.value = true;
      result.value = rawData.data;
    })
    .catch((e) => {
      error.value = e;
      loading.value = false;
    });

  return {
    result,
    loading,
    loaded,
    error,
  };
}

export default useURLLoader;
```

å®ç°å®ŒåŠŸèƒ½ä»¥åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ç»™é™æ€é¡µé¢ç»‘å®šè¯¥å¼‚æ­¥åŠŸèƒ½ã€‚

## 2ã€ç»™é™æ€é¡µé¢ç»‘å®šåŠŸèƒ½

è¿™é‡Œå…ˆç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªåœ¨çº¿å…è´¹ APIï¼Œç½‘å€ä¸º[https://dog.ceo/dog-api/](https://dog.ceo/dog-api/)ã€‚è¿™ä¸ª API æ˜¯ä¸€ä¸ªç‹—ç‹— APIï¼Œå¯ä»¥å®æ—¶è·å–å›¾ç‰‡æ•°æ®ã€‚å…·ä½“ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š

![ç‹—ç‹—API](https://img-blog.csdnimg.cn/20210618165503254.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

---

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ `vue3` é¡¹ç›®ä¸‹å»ºç«‹ä¸€ä¸ª `.vue` æ–‡ä»¶ï¼Œæ¥åŠ è½½**é™æ€ç»„ä»¶å†…å®¹**ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div id="app">
    <h1>å¼‚æ­¥åŠ è½½ç»„ä»¶</h1>
    <button v-if="loading">Loadingâ€¦â€¦</button>
    <img v-if="loaded" :src="result.message" />
  </div>
</template>

<script lang="ts">
  import useURLLoader from './useUrlLoader';

  export default {
    name: 'App',
    setup() {
      const { result, loading, loaded, error } = useURLLoader(
        'https://dog.ceo/api/breeds/image/random'
      );

      return {
        result,
        loading,
        loaded,
        error,
      };
    },
  };
</script>

<style>
  #app {
    font-family: Avenir, Helvetica, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-align: center;
    color: #2c3e50;
    margin-top: 60px;
  }
</style>
```

**æœ€ç»ˆæˆ‘ä»¬æ¥çœ‹ä¸‹æ˜¾ç¤ºæ•ˆæœï¼š**

![å¼‚æ­¥åŠ è½½ç»„ä»¶](https://img-blog.csdnimg.cn/20210618165515772.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬åˆ·æ–°æ—¶ï¼Œå¼‚æ­¥è¯·æ±‚çš„æ•°æ®è¿˜æ²¡æœ‰åŠ è½½å‡ºæ¥ï¼Œæ‰€ä»¥ä¼šå…ˆæ˜¾ç¤º `Loading` ï¼Œç­‰åˆ°**æ•°æ®åŠ è½½å‡ºæ¥ä»¥å**ï¼Œå†æ˜¾ç¤ºå…·ä½“çš„æ•°æ®ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨çš„**å¼‚æ­¥åŠ è½½ç»„ä»¶**ã€‚

## 3ã€ç”¨æ³›å‹æ”¹é€ å¼‚æ­¥ç»„ä»¶åŠŸèƒ½

å¤§å®¶éƒ½çŸ¥é“ï¼Œ `vue2` å¯¹äº `typescript ` çš„æ”¯æŒæ˜¯éå¸¸æœ‰é™çš„ï¼Œå› æ­¤ï¼Œ `vue3` çš„æ”¹é€ å‡çº§åå¯¹ `ts` æœ‰äº†æå¤§çš„åŠ æŒã€‚

åœ¨ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ„Ÿå—åˆ°äº† `Composition API` çš„æ‰©å±•æ€§å’Œç»´æŠ¤æ€§ï¼Œä½†æ˜¯å‘¢ï¼Œä¸æ»¡è¶³äºç°çŠ¶ï¼Œæˆ‘ä»¬è¿˜æƒ³è¦å†ç»™å®ƒæ¥ä¸ª**ç±»å‹çš„åŠ æŒ**ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

ä¾æ®ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ç»§ç»­å‡çº§æ”¹é€ ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ› `result` å¯ä»¥é€šè¿‡æ³›å‹æ¥æ¨æ–­å‡ºç±»å‹ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°† `ts `æ–‡ä»¶çš„ä»£ç è¿›è¡Œä»¥ä¸‹æ”¹é€ ã€‚**ä»£ç å¦‚ä¸‹ï¼š**

```js
import { ref } from 'vue';
import axios from 'axios';

//æ³›å‹æ”¹é€ 
function useURLLoader<T>(url: string) {
  // resultçš„ä¸€å¼€å§‹æ˜¯æ²¡æœ‰èµ‹äºˆæ•°æ®ç±»å‹çš„ï¼Œå¾…resultèµ‹äºˆæ•°æ®åï¼Œå†å¯¹å…¶èµ‹äºˆæ•°æ®ç±»å‹
  const result = (ref < T) | (null > null);
  const loading = ref(true);
  const loaded = ref(false);
  const error = ref(null);

  axios
    .get(url)
    .then((rawData) => {
      loading.value = false;
      loaded.value = true;
      result.value = rawData.data;
    })
    .catch((e) => {
      error.value = e;
      loading.value = false;
    });

  return {
    result,
    loading,
    loaded,
    error,
  };
}

export default useURLLoader;
```

è¿™æ¬¡æˆ‘ä»¬æ¢ä¸€ä¸ª[çŒ«çŒ«çš„ API](https://api.thecatapi.com/v1/images/search?limit=1)ï¼Œæ¥å¯¹ `.vue` æ–‡ä»¶è¿›è¡Œæ”¹é€ ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
<template>
  <div id="app">
    <h1>å¼‚æ­¥åŠ è½½ç»„ä»¶</h1>
    <button v-if="loading">Loadingâ€¦â€¦</button>
    <img v-if="loaded" :src="result[0].url">
  </div>
</template>

<script lang="ts">
import { watch } from 'vue'
import useURLLoader from './useUrlLoader'

interface CatResult{
    id: string;
    url: string;
    width: string;
    height: string;
}

export default{
  name: 'App',
  setup(){

    const { result, loading, loaded, error } = useURLLoader<CatResult[]>('https://api.thecatapi.com/v1/images/search?limit=1')
   	watch(result, () => {
        if(result.value){
            console.log('value', result.value[0].url)
        }
    })

    return{
      result,
      loading,
      loaded,
      error
    }
  }
};
</script>

<style>
#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
</style>

```

**æœ€ç»ˆæµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![æ³›å‹æ”¹é€ å¼‚æ­¥åŠ è½½ç»„ä»¶](https://img-blog.csdnimg.cn/20210618165529714.gif#pic_center)

é€šè¿‡ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ**ç”¨æ³›å‹æ¥æ”¹é€ ç»„ä»¶**ï¼Œä¼šä½¿å¾—è¯¥ç»„ä»¶çš„**å¯æ‰©å±•æ€§æ›´å¼º**ã€‚ `ts` è¿™ä¹ˆå¥½çš„è¯­è¨€è°èƒ½ä¸çˆ±å‘¢å¯¹å§ï¼

# ä¸‰ã€ğŸ“š ç»“æŸè¯­

åˆ°è¿™é‡Œï¼Œå¯¹äº `vue3` å¼€å‘é¼ æ ‡è¿½è¸ªå™¨å’Œå¼‚æ­¥åŠ è½½ç»„ä»¶çš„è®²è§£å°±ç»“æŸå•¦ï¼åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†ç”¨ `vue3` çš„æ–°ç‰¹æ€§æ¥å®ç°é¼ æ ‡è¿½è¸ªå™¨å’Œå¼‚æ­¥åŠ è½½ç»„ä»¶ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨äº† ts ä¸­çš„æ³›å‹å’Œæ¥å£ï¼Œæ¥æ”¹é€ å¼‚æ­¥åŠ è½½ç»„ä»¶ï¼Œä½¿å…¶æ‰©å±•æ€§æ›´å¼ºã€‚

`vue3` æŒç»­å­¦ä¹ ï¼Œæ›´æ–°æ°¸ä¸åœæ­‡â€¦â€¦æˆ‘ä»¬ä¸‹æœŸè§ï¼ğŸ¥‚ ğŸ¥‚ ğŸ¥‚

> - å…³æ³¨å…¬ä¼—å· **æ˜ŸæœŸä¸€ç ”ç©¶å®¤** ï¼Œç¬¬ä¸€æ—¶é—´å…³æ³¨å­¦ä¹ å¹²è´§ï¼Œ**æ›´å¤šç²¾å½©ä¸“æ å¾…ä½ è§£é”**~
>
> - å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œè®°å¾—**ä¸€é”®ä¸‰è¿**å†èµ°å“¦~

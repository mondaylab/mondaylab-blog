---
title: Reduxä»å…¥é—¨åˆ°è¿›é˜¶ï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼
author: å‘¨ä¸€
date: '2021-10-26'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - React.js
sidebar: 'auto'
---

# ğŸŒ‚ åºè¨€

å¤§å®¶éƒ½çŸ¥é“ï¼Œ `react` æ˜¯**å•å‘æ•°æ®æµ**ï¼Œæ‰€ä»¥å®ƒä¼ é€’æ•°æ®ä¹Ÿè¾ƒä¸ºç®€å•ï¼Œçˆ¶å­ä¹‹é—´çš„å…³ç³»ä¹Ÿè¾ƒä¸ºæ˜ç¡®ã€‚ä½†æ˜¯å‘¢ï¼Œå¦‚æœæˆ‘ä»¬è¦åšæ›´å¤šå¤æ‚æ•°æ®çš„ä¼ é€’ï¼Œå•å•ä½¿ç”¨ `react` æ˜¯å®Œå…¨ä¸å¤Ÿçš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° `redux` æ¥åšæ›´ä¸ºå¤æ‚çš„æ•°æ®ä¼ é€’ã€‚

é‚£åœ¨ä¸‹é¢çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°†ä»å…¥é—¨åˆ°è¿›é˜¶ï¼Œè®²è§£ `redux` çš„å·¥ä½œæµç¨‹ã€‚

å®ï¼å¼€å§‹ `redux` ä¹‹æ—…å§~ğŸ‘

# â˜‚ï¸ ä¸€ã€åŸºç¡€çŸ¥è¯†

## 1ã€Redux æ¦‚å¿µç®€è¿°

å¯¹äº `react` æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªéè§†å›¾å±‚çš„è½»é‡çº§æ¡†æ¶ï¼Œå¦‚æœè¦ç”¨å®ƒæ¥ä¼ é€’æ•°æ®çš„è¯ï¼Œåˆ™è¦å…ˆçˆ¶ä¼ å­ï¼Œç„¶åå†æ…¢æ…¢åœ°ä¸€å±‚ä¸€å±‚å¾€ä¸Šä¼ é€’ã€‚

ä½†å¦‚æœç”¨ `redux` çš„è¯ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦**æŸä¸ªç»„ä»¶çš„æ•°æ®**ï¼Œé‚£è¿™ä¸ªç»„ä»¶çš„æ•°æ®åˆ™ä¼šé€šè¿‡ `redux` æ¥å­˜æ”¾åˆ° `store` ä¸­è¿›è¡Œç®¡ç†ã€‚ä¹‹åå‘¢ï¼Œé€šè¿‡ `store` ï¼Œå†æ¥å°†æ•°æ®ä¸€æ­¥æ­¥åœ°å¾€ä¸‹é¢çš„ç»„ä»¶è¿›è¡Œä¼ é€’ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è§† `Redux` ä¸º `Reducer` å’Œ `Flux` çš„ç»“åˆã€‚

## 2ã€Redux çš„å·¥ä½œæµç¨‹

`Redux` ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª**æ•°æ®å±‚**çš„æ¡†æ¶ï¼Œå®ƒæŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åœ¨äº† `store` ä¹‹ä¸­ã€‚**æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ å›¾ï¼š**

![Reduxçš„å·¥ä½œæµç¨‹](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270715450.png)

å¤§å®¶å¯ä»¥çœ‹åˆ°ä¸­é—´çš„ `store` ï¼Œå®ƒé‡Œé¢å°±å­˜æ”¾ç€**æ‰€æœ‰çš„æ•°æ®**ã€‚ç»§ç»­çœ‹ `store` å‘ä¸‹çš„ç®­å¤´ï¼Œç„¶åå‘¢ï¼Œæ¯ä¸ªç»„ä»¶éƒ½è¦å‘ `store` é‡Œé¢å»æ‹¿æ•°æ®ã€‚

æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æ¢³ç†æ•´å¼ å›¾ï¼Œ**å…·ä½“å¦‚ä¸‹ï¼š**

- â‘  æ•´å¼ å›¾ä¸Šæœ‰ä¸€ä¸ª `store` ï¼Œå®ƒå­˜æ”¾ç€æ‰€æœ‰çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯**å­˜å‚¨æ•°æ®çš„å…¬å…±åŒºåŸŸ**ï¼›
- â‘¡ æ¯ä¸ªç»„ä»¶ï¼Œéƒ½è¦ä» `store` é‡Œé¢æ‹¿æ•°æ®ï¼›
- â‘¢ å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæ¨¡æ‹Ÿæˆ‘ä»¬è¦åœ¨å›¾ä¹¦é¦†é‡Œé¢å€Ÿä¹¦ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠ `react Component` ç†è§£ä¸ºå€Ÿä¹¦äººï¼Œä¹‹åå‘¢ï¼Œå€Ÿä¹¦äººè¦å»æ‰¾å›¾ä¹¦é¦†ç®¡ç†å‘˜æ‰èƒ½å€Ÿåˆ°è¿™æœ¬ä¹¦ã€‚è€Œå€Ÿä¹¦è¿™ä¸ªè¿‡ç¨‹ä¸­æ•°æ®çš„ä¼ é€’ï¼Œå°±å¯ä»¥æŠŠå®ƒè§†ä¸ºæ˜¯ `Action Creators` ï¼Œå¯ä»¥ç†è§£ä¸º **â€œä½ æƒ³è¦å€Ÿä»€ä¹ˆä¹¦â€** è¿™å¥è¯ã€‚
- â‘£ `Action Creatures` å»åˆ° `store` ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æŠŠ `store` å½“åšæ˜¯**å›¾ä¹¦é¦†ç®¡ç†å‘˜**ï¼Œä½†æ˜¯ï¼Œå›¾ä¹¦é¦†ç®¡ç†å‘˜æ˜¯æ²¡æœ‰åŠæ³•è®°ä½æ‰€æœ‰å›¾ä¹¦çš„æ•°æ®æƒ…å†µçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒéƒ½éœ€è¦ä¸€ä¸ªè®°å½•æœ¬ï¼Œä½ æƒ³è¦å€Ÿä»€ä¹ˆæ ·çš„ä¹¦ï¼Œé‚£ä¹ˆå¥¹å°±å…ˆæŸ¥ä¸€ä¸‹ï¼›åˆæˆ–è€…ä½ æƒ³è¦è¿˜ä»€ä¹ˆä¹¦ï¼Œå¥¹ä¹Ÿè¦æŸ¥ä¸€ä¸‹ï¼Œéœ€è¦æ”¾å›ä»€ä¹ˆä½ç½®ä¸Šã€‚
- â‘¤ è¿™ä¸ªæ—¶å€™å°±éœ€è¦è·Ÿ `reducers` å»é€šä¿¡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ `reducers` è§†ä¸ºæ˜¯ä¸€ä¸ª**è®°å½•æœ¬**ï¼Œå›¾ä¹¦é¦†ç®¡ç†å‘˜ç”¨è¿™ä¸ª**è®°å½•æœ¬**æ¥è®°å½•éœ€è¦çš„æ•°æ®ã€‚ç®¡ç†å‘˜ `store` é€šè¿‡ `reducer` çŸ¥é“äº†åº”è¯¥ç»™å€Ÿä¹¦äºº `Components` ä»€ä¹ˆæ ·çš„æ•°æ®ã€‚

# ğŸƒ äºŒã€ä½¿ç”¨ Antd å®ç° TodoList é¡µé¢å¸ƒå±€

## 1ã€åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ Antd

æ‰“å¼€ `antdesign` çš„å®˜ç½‘ ğŸ‘‰[antd å®˜ç½‘ä¼ é€é—¨](https://ant.design/index-cn)ï¼Œæˆ‘ä»¬å…ˆæ¥åœ¨é¡¹ç›®ä¸­å¼•å…¥å®ƒã€‚**å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š**

ç¬¬ä¸€æ­¥ï¼Œå®‰è£… `antd` ã€‚**å‘½ä»¤å¦‚ä¸‹ï¼š**

```bash
npm install antd --save
```

ç¬¬äºŒæ­¥ï¼Œå¼•å…¥æ ·å¼ã€‚**ä»£ç å¦‚ä¸‹ï¼š**

```bash
import 'antd/dist/antd.css'; // or 'antd/dist/antd.less'
```

## 2ã€ä½¿ç”¨ Antd å®ç° TodoList çš„åŸºæœ¬å¸ƒå±€

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `src` æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå‘½åä¸º `TodoList.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css';
import { Input, Button, List } from 'antd';

const data = [
  'Racing car sprays burning fuel into crowd.',
  'Japanese princess to wed commoner.',
  'Australian walks 100km after outback crash.',
  'Man charged over missing wedding girl.',
  'Los Angeles battles huge wildfires.',
];

class TodoList extends Component {
  render() {
    return (
      <div style={{ marginTop: '10px', marginLeft: '10px' }}>
        <div>
          <Input placeholder='todo info' style={{ width: '300px' }} />
          <Button type='primary'>æäº¤</Button>
        </div>
        <List
          bordered
          dataSource={data}
          renderItem={(item) => <List.Item>{item}</List.Item>}
        />
      </div>
    );
  }
}

export default TodoList;
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœä¸ºï¼š**

![antdå¸ƒå±€todoList](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270715084.png)

## 3ã€åˆ›å»º redux ä¸­çš„ store

### ï¼ˆ1ï¼‰åˆ›å»º store

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ›å»ºé¡¹ç›®ä¸­çš„ `store` ã€‚é¦–å…ˆåœ¨é¡¹ç›®çš„ `src` æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå‘½åä¸º `store` ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ `store` æ–‡ä»¶å¤¹ä¸‹é¢ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå‘½åä¸º `index.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { createStore } from 'redux';
import reducer from './reducer';

const store = createStore(reducer);

export default store;
```

ç„¶åå‘¢ï¼Œç»§ç»­åœ¨ `store` æ–‡ä»¶å¤¹ä¸‹é¢åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼Œå‘½åä¸º `reducer.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const defaultStore = {
  inputValue: '',
  list: [],
};

export default (state = defaultStore, action) => {
  return state;
};
```

ç”±æ­¤ï¼Œæˆ‘ä»¬å°±åˆ›å»ºå®Œæˆäº†é¡¹ç›®ä¸­çš„ `store` ã€‚

### ï¼ˆ2ï¼‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ store

åˆ›å»ºå®Œ `store` ä¹‹åï¼Œæˆ‘ä»¬å…ˆåˆæ­¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ª `store` ï¼Œä»¥ä¾¿äºçœ‹çœ‹æ•ˆæœã€‚å…ˆæ¥æ·»åŠ  `store` ä¸­çš„æ•°æ®ï¼Œé¦–å…ˆæ”¹é€ åœ¨ `store` ä¸­çš„ `reducer.js` æ–‡ä»¶ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const defaultStore = {
  inputValue: '123',
  list: [1, 2],
};

export default (state = defaultStore, action) => {
  return state;
};
```

ä¹‹åæ”¹é€  `TodoList.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css';
import { Input, Button, List } from 'antd';
import store from './store';

class TodoList extends Component {
  constructor(props) {
    super(props);
    this.state = store.getState();
  }
  render() {
    return (
      <div style={{ marginTop: '10px', marginLeft: '10px' }}>
        <div>
          <Input
            placeholder={this.state.inputValue}
            style={{ width: '300px' }}
          />
          <Button type='primary'>æäº¤</Button>
        </div>
        <List
          bordered
          dataSource={this.state.list}
          renderItem={(item) => <List.Item>{item}</List.Item>}
        />
      </div>
    );
  }
}

export default TodoList;
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœä¸ºï¼š**

![todoListæ¥æ”¶æ¥è‡ªstoreçš„æ•°æ®](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270715380.png)

# ğŸ§µ ä¸‰ã€Action å’Œ Reducer çš„ç¼–å†™ - å¢æ·»åŠŸèƒ½

## 1ã€ä¸»ä½“é¡µé¢å†…å®¹æ”¹é€ 

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ `action` å’Œ `reducer` ï¼Œæ¥å¯¹è¿™ä¸ªç»„ä»¶çš„æ•°æ®è¿›è¡Œå‰åä¼ é€’ã€‚é¦–å…ˆï¼Œå…ˆæ¥æ”¹é€  `TodoList.js` æ–‡ä»¶ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css';
import { Input, Button, List } from 'antd';
import store from './store';

class TodoList extends Component {
  constructor(props) {
    super(props);
    this.state = store.getState();
    this.handleInputChange = this.handleInputChange.bind(this);
    this.handleStoreChange = this.handleStoreChange.bind(this);
    this.handleBtnClick = this.handleBtnClick.bind(this);
    store.subscribe(this.handleStoreChange);
  }
  render() {
    return (
      <div style={{ marginTop: '10px', marginLeft: '10px' }}>
        <div>
          <Input
            value={this.state.inputValue}
            placeholder='todo info'
            style={{ width: '300px', marginRight: '10px' }}
            onChange={this.handleInputChange}
          />
          <Button type='primary' onClick={this.handleBtnClick}>
            æäº¤
          </Button>
        </div>
        <List
          style={{ marginTop: '10px', width: '300px' }}
          bordered
          dataSource={this.state.list}
          renderItem={(item) => <List.Item>{item}</List.Item>}
        />
      </div>
    );
  }

  handleInputChange(e) {
    // åœ¨reactä¸­ï¼Œactionæ˜¯ä¸€ä¸ªå¯¹è±¡çš„å½¢å¼
    // typeæ—¨åœ¨å‘Šè¯‰reactè¯´ï¼Œä½ å¸®æˆ‘å»æ”¹å˜inputçš„å€¼ï¼Œè¿™ä¸ªå€¼æ˜¯ä¸‹é¢çš„valueï¼Œä¹Ÿå°±æ˜¯e.target.value
    const action = {
      type: 'change_input_value',
      value: e.target.value,
    };
    store.dispatch(action);
    // console.log(e.target.value)
  }

  handleStoreChange() {
    // å½“æ„ŸçŸ¥åˆ°storeçš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé‚£ä¹ˆå°±å»è°ƒç”¨store.getStateæ–¹æ³•ï¼Œä»storeé‡Œé¢å†é‡æ–°å–ä¸€æ¬¡æ•°æ®ï¼Œ
    // ç„¶åå»è°ƒç”¨setStateï¼Œæ›¿æ¢æ‰å½“å‰storeé‡Œé¢çš„æ•°æ®
    this.setState(store.getState());
  }

  handleBtnClick() {
    const action = {
      type: 'add_todo_item',
    };
    store.dispatch(action);
  }
}

export default TodoList;
```

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä»¥ä¸Šä»£ç ã€‚é¦–å…ˆï¼Œæ¯ä¸€ä¸ªåŠ¨ä½œåˆ†åˆ«ä¼šå…ˆå»ç»‘å®šå¯¹åº”çš„äº‹ä»¶ï¼Œä¹‹åå‘¢ï¼Œåœ¨äº‹ä»¶é‡Œé¢ï¼Œå»åˆ›é€  `action` ã€‚è€Œå¯¹äºåˆ›é€ çš„ `action` æ¥è¯´ï¼Œå®ƒæ—¨åœ¨å‘Šè¯‰ `react` ï¼Œè®© `react` å»å¸®å¿™ `action` å»æ”¹å˜æŸä¸ªå€¼ï¼Œè€Œè¿™ä¸ªå€¼å°±æ˜¯å®ƒç»‘å®šçš„ `value` ã€‚

æœ€åï¼Œ `action` è¦åšçš„äº‹æƒ…ç»“æŸäº†ï¼Œé‚£ä¹ˆå®ƒçš„æ•°æ®å°±éœ€è¦å»å­˜å‚¨åˆ° `store` é‡Œé¢ã€‚äºæ˜¯é€šè¿‡ `store.dispatch(action)` æ¥è¿›è¡Œå¤„ç†ï¼Œå°† `action` çš„æ•°æ®ä¼ é€’åˆ° `store` é‡Œé¢ã€‚

## 2ã€æ”¹å˜ action ä¸­çš„æ•°æ®

å¯¹äº `action` ä¸€å¼€å§‹çš„å€¼æ¥è¯´ï¼Œå®ƒæ˜¯å›ºå®šçš„ã€‚ä½†æœ‰æ—¶å€™æˆ‘ä»¬æ˜¯æƒ³è¦å»ä¿®æ”¹ action ä¸­çš„å€¼ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° `reducer` ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ”¹é€ ä¸‹ `reducer.js` æ–‡ä»¶ï¼Œè®© `input` æ¡†å¯ä»¥è‡ªç”±çš„è¾“å…¥å€¼ï¼ŒåŒæ—¶ï¼Œç‚¹å‡»**æäº¤æŒ‰é’®**ä¹‹åï¼Œè¿›è¡Œåˆ—è¡¨çš„å¢æ·»æ“ä½œã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const defaultStore = {
  inputValue: '123',
  list: [1, 2],
};

// reducer å¯ä»¥æ¥æ”¶stateï¼Œä½†æ˜¯ç»ä¸èƒ½ä¿®æ”¹state
const reducer = (state = defaultStore, action) => {
  if (action.type === 'change_input_value') {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  }
  if (action.type === 'add_todo_item') {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(newState.inputValue);
    newState.inputValue = '';
    console.log(newState);
    return newState;
  }
  return state;
};
export default reducer;
```

## 3ã€store æ•°æ®æ”¹é€ 

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ `store` æ–‡ä»¶å¤¹ä¸‹ `index.js` çš„å†…å®¹ã€‚æˆ‘ä»¬éœ€è¦å¯¹å…¶è¿›è¡Œç®€å•çš„æ”¹é€ ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { createStore } from 'redux';
import reducer from './reducer';

const store = createStore(
  reducer,
  window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
);

export default store;
```

é™¤äº† `reducer` ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦å°† `window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()` ç»™ä¼ é€’è¿›å»å¹¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![actionå’Œreducerä¼ é€’æ•°æ®](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270715038.gif)

# ğŸ§¶ å››ã€ä½¿ç”¨ Redux å®ç° TodoList çš„åˆ é™¤åŠŸèƒ½

## 1ã€å¯¹ç»„ä»¶è¿›è¡Œäº‹ä»¶ç»‘å®š

ä¸Šé¢æˆ‘ä»¬å®ç°äº†å¢æ·»åŠŸèƒ½ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­æ¥å®ç°**åˆ é™¤åŠŸèƒ½**ï¼Œå®ç°**æ¯ç‚¹å‡»æ¯ä¸€é¡¹æ—¶**ï¼Œèƒ½å¤Ÿåˆ é™¤**ç‚¹å‡»é¡¹**çš„æ•°æ®ã€‚å…ˆæ¥åœ¨ `TodoList.js` æ–‡ä»¶ä¸­ç»‘å®šå¯¹åº”çš„äº‹ä»¶ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css';
import { Input, Button, List } from 'antd';
import store from './store';

class TodoList extends Component {
  constructor(props) {
    // æ­¤å¤„çœç•¥ä¸Šè¿°å·²æœ‰ä»£ç 
  }
  render() {
    return (
      {/* æ­¤å¤„çœç•¥ä¸Šè¿°å·²æœ‰ä»£ç  */}
        <List
          style={{marginTop: '10px', width: '300px'}}
          bordered
          dataSource={this.state.list}
          renderItem={(item, index) => <List.Item onClick={this.handleItemDelete.bind(this, index)}>{item}</List.Item>}
        />
      </div>
    )
  }

  // æ­¤å¤„çœç•¥ä¸Šè¿°å·²æœ‰ä»£ç 

  handleItemDelete(index) {
    const action = {
      type: 'delete_todo_item',
      index
    }
    store.dispatch(action);
  }
}

export default TodoList;
```

## 2ã€åœ¨ reducer ä¸­è¿›è¡Œæ•°æ®é€šä¿¡

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨ `reducer.js` æ–‡ä»¶ä¸­ï¼Œå¯¹æ•°æ®è¿›è¡Œé€šä¿¡ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const defaultStore = {
  inputValue: '123',
  list: [1, 2],
};

// reducer å¯ä»¥æ¥æ”¶stateï¼Œä½†æ˜¯ç»ä¸èƒ½ä¿®æ”¹state
const reducer = (state = defaultStore, action) => {
  // æ­¤å¤„çœç•¥ä¸Šè¿°å·²æœ‰ä»£ç 

  if (action.type === 'delete_todo_item') {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.splice(action.index, 1);
    return newState;
  }
  return state;
};
export default reducer;
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![åˆ é™¤åŠŸèƒ½](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270716035.gif)

# ğŸ‘“ äº”ã€é€»è¾‘å½’çº³

## 1ã€ActionTypes çš„æ‹†åˆ†

åœ¨ä¸Šé¢çš„ `TodoList.js` ä¸­ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼šé¢‘ç¹åœ°å»æ“ä½œ `action` ã€‚åŒæ—¶ï¼Œå‡è®¾è¯´å…¶ä¸­çš„ `type` å¦‚æœæˆ‘ä»¬ç¨å¾®å†™é”™äº†ä¸€ä¸ªå­—æ¯ï¼Œé‚£æ’é”™çš„è¿‡ç¨‹æ€»æ˜¯ä¸å¥½å®šä½çš„ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬è¦æ¥åšçš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯ `ActionTypes` çš„æ‹†åˆ†ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ `store` æ–‡ä»¶å¤¹ä¸‹æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `actionTypes.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
export const CHANGE_INPUT_VALUE = 'change_input_value';
export const ADD_TODO_ITEM = 'add_todo_item';
export const DELETE_TODO_ITEM = 'delete_todo_item';
```

å…¶æ¬¡ï¼Œæ”¹é€  `TodoList.js` ä¸‹çš„å†…å®¹ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
} from './store/actionTypes';

class TodoList extends Component {
  handleInputChange(e) {
    const action = {
      type: CHANGE_INPUT_VALUE,
      value: e.target.value,
    };
    store.dispatch(action);
  }

  handleStoreChange() {
    this.setState(store.getState());
  }

  handleBtnClick() {
    const action = {
      type: ADD_TODO_ITEM,
    };
    store.dispatch(action);
  }

  handleItemDelete(index) {
    const action = {
      type: DELETE_TODO_ITEM,
      index,
    };
    store.dispatch(action);
  }
}

export default TodoList;
```

æœ€åï¼Œæ”¹é€  `reducer.js` æ–‡ä»¶ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
} from './actionTypes';

const defaultStore = {
  inputValue: '123',
  list: [1, 2],
};

const reducer = (state = defaultStore, action) => {
  if (action.type === CHANGE_INPUT_VALUE) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  }
  if (action.type === ADD_TODO_ITEM) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(newState.inputValue);
    newState.inputValue = '';
    console.log(newState);
    return newState;
  }
  if (action.type === DELETE_TODO_ITEM) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.splice(action.index, 1);
    return newState;
  }
  return state;
};
export default reducer;
```

é€šè¿‡å°† `change_input_value` ã€ `add_todo_item` å’Œ `delete_todo_item` è¿›è¡Œæ•´åˆï¼Œå°†å…¶æ•´åˆåˆ° `actionTypes.js` æ–‡ä»¶ä¸‹ï¼Œè¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬é‡åˆ°å­—æ¯å†™é”™çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¤Ÿæ›´å¥½çš„è¿›è¡Œæ’é”™ã€‚

## 2ã€ä½¿ç”¨ actionCreator ç»Ÿä¸€åˆ›å»º action

åœ¨ä¸Šé¢çš„ `TodoList.js` ä¸­ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºå‡ ä¸ªç»‘å®šçš„äº‹ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬æ€»æ˜¯è¦**é¢‘ç¹çš„å»åˆ›å»º `action`** ï¼Œé‡å¤æ€§åœ°æ“ä½œæ˜¯åœ¨ç¨‹åºä¸­æœ€å¿Œè®³çš„ä¸€ä¸ªäº‹æƒ…ã€‚å› æ­¤å‘¢ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ `actionCreator` ï¼Œæ¥å¯¹ `action` è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œä½¿å¾—é€»è¾‘æ›´åŠ åœ°ç»Ÿä¸€å®Œæ•´ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ `store` æ–‡ä»¶å¤¹ä¸‹æ–°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `actionCreators.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
} from './actionTypes';

export const getInputChangeAction = (value) => ({
  type: CHANGE_INPUT_VALUE,
  value: value,
});

export const getAddItemAction = (value) => ({
  type: ADD_TODO_ITEM,
});

export const getDeleteItemAction = (index) => ({
  type: DELETE_TODO_ITEM,
  index: index,
});
```

ç»§ç»­ï¼Œæˆ‘ä»¬æ¥æ”¹é€  `TodoList.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction,
} from './store/actionCreators';

class TodoList extends Component {
  handleInputChange(e) {
    const action = getInputChangeAction(e.target.value);
    store.dispatch(action);
  }

  handleBtnClick() {
    const action = getAddItemAction();
    store.dispatch(action);
  }

  handleItemDelete(index) {
    const action = getDeleteItemAction(index);
    store.dispatch(action);
  }
}

export default TodoList;
```

é€šè¿‡å°† `action` ä¸­çš„æ“ä½œç»Ÿä¸€æŠ½ç¦»åˆ° `actionCreators.js` å½“ä¸­ï¼Œä½¿å¾—æœ€ç»ˆçš„é€»è¾‘æ›´åŠ çš„ç»Ÿä¸€ã€‚

# ğŸ‘” å…­ã€Redux çš„ä¸€äº›æ€»ç»“

è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„ä¸€äº›çŸ¥è¯†ç‚¹è¿›è¡Œå½’çº³æ€»ç»“ï¼Œå…·ä½“å¦‚ä¸‹

## 1ã€Redux è®¾è®¡å’Œä½¿ç”¨çš„ä¸‰é¡¹åŸåˆ™

`Redux` çš„è®¾è®¡å’Œä½¿ç”¨**éµå¾ªä»¥ä¸‹ä¸‰å¤§åŸåˆ™ï¼š**

- `store` å¿…é¡»æ˜¯å”¯ä¸€çš„ ğŸ‘‰ å³æ•´ä¸ªåº”ç”¨ä¹‹ä¸­å¿…é¡»ä¸”åªèƒ½æœ‰ä¸€ä¸ª `store` ï¼›
- åªæœ‰ `store` èƒ½å¤Ÿæ”¹å˜è‡ªå·±çš„å†…å®¹ ğŸ‘‰ å³ `store` ä¸æ˜¯ `reducer` å»æ›´æ–°çš„ï¼Œè€Œæ˜¯ `store` åœ¨æ‹¿åˆ° `reducer` çš„æ•°æ®ä¹‹åï¼Œè‡ªå·±å¯¹è‡ªå·±çš„æ•°æ®è¿›è¡Œä¸€æ¬¡æ›´æ–°ï¼›å› æ­¤ï¼Œæˆ‘ä»¬å›åˆ°ä¸Šé¢çš„ `reducer.js` æ–‡ä»¶ï¼Œåœ¨ `react` ä¸­ï¼Œæ˜¯ä¸å…è®¸ `state.inputValue === æŸä¸ªå€¼` ä¹‹ç±»çš„äº‹æƒ…å‘ç”Ÿçš„å“¦ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½å¯¹å…¶ç›´æ¥è¿›è¡Œèµ‹å€¼ã€‚
- `Reducer` å¿…é¡»æ˜¯çº¯å‡½æ•° ğŸ‘‰ æ‰€è°“**çº¯å‡½æ•°**ï¼Œå³ç»™å®šå›ºå®šçš„è¾“å…¥ï¼Œå°±ä¸€å®šæœ‰å›ºå®šçš„è¾“å‡ºï¼Œè€Œä¸”ä¸ä¼šäº§ç”Ÿä»»ä½•çš„å‰¯ä½œç”¨ã€‚å›åˆ°æˆ‘ä»¬ä¸Šé¢çš„ `reducer.js` æ–‡ä»¶ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œ `state` æ˜¯å›ºå®šçš„ï¼Œ `action` ä¹Ÿæ˜¯å›ºå®šçš„ï¼Œé‚£ä¹ˆæœ€ç»ˆè¿”å›çš„ `newState` è‡ªç„¶ä¹Ÿå°±æ˜¯å›ºå®šçš„ã€‚

## 2ã€Redux çš„æ ¸å¿ƒ API

æˆ‘ä»¬å†æ¥å¤ä¹  `Redux` çš„å‡ ä¸ªæ ¸å¿ƒ `API` ã€‚**å…ˆçœ‹ä¸‹å›¾ï¼š**

![Reduxçš„æ ¸å¿ƒAPI](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270716802.png)

ç°åœ¨æ¥å›é¡¾ä¸‹è¿™å‡ ä¸ªæ ¸å¿ƒ `API` çš„ä½œç”¨ã€‚**å…·ä½“å¦‚ä¸‹ï¼š**

- createStore â€”â€” å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `store` ï¼›
- store.dispatch â€”â€” `dispatch` æ–¹æ³•å¸®åŠ©æˆ‘ä»¬æ´¾å‘ `action` ï¼ŒåŒæ—¶ï¼Œè¿™ä¸ª `action` ä¼šä¼ é€’ç»™ `store` ï¼›
- store.getState â€”â€” `getState ` æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è·å–åˆ°æ‰€æœ‰çš„æ•°æ®ï¼›
- store.subscribe â€”â€” `subscribe` å¸®åŠ©æˆ‘ä»¬è®¢é˜… `store` çš„æ”¹å˜ï¼Œåªè¦ `store` å‘ç”Ÿæ”¹å˜ï¼Œ`store.subscribe` æ¥æ”¶çš„å›è°ƒå‡½æ•°å°±ä¼šè¢«æ‰§è¡Œã€‚

# ğŸ‘ ä¸ƒã€è¿›é˜¶ç»„ä»¶çš„æ‹†åˆ†

## 1ã€UI ç»„ä»¶å’Œå®¹å™¨ç»„ä»¶çš„æ‹†åˆ†

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å·²ç»åŸºæœ¬å®Œæˆäº† `TodoList` çš„åŠŸèƒ½ã€‚ä½†æ˜¯å‘¢ï¼Œå¤§å®¶æœ‰æ²¡æœ‰å‘ç°ï¼Œåœ¨ `TodoList.js` æ–‡ä»¶ä¸­ï¼Œé¡µé¢çš„æ¸²æŸ“å’Œé¡µé¢çš„é€»è¾‘ç¼–å†™æ˜¯æ”¾åœ¨ä¸€èµ·çš„ã€‚

å¾€å¾€åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šç›´æ¥æŠŠ **`UI` ç»„ä»¶**å’Œ**å®¹å™¨ç»„ä»¶**ç»™æ‹†åˆ†å¼€æ¥ã€‚å…¶ä¸­ï¼Œ `UI` ç»„ä»¶ä¸“é—¨ç”¨äºè´Ÿè´£**é¡µé¢çš„æ¸²æŸ“**ï¼Œè€Œå®¹å™¨ç»„ä»¶ç”¨äºè´Ÿè´£**é¡µé¢çš„é€»è¾‘**ã€‚

ä¸‹é¢æˆ‘ä»¬æ¥å¯¹å…¶è¿›è¡Œæ‹†åˆ†ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ç°åœ¨ `src` æ–‡ä»¶å¤¹ä¸‹æ–°å¢ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `TodoListUI.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';
import 'antd/dist/antd.css';
import { Input, Button, List } from 'antd';

class TodoListUI extends Component {
  render() {
    return (
      <div style={{ marginTop: '10px', marginLeft: '10px' }}>
        <div>
          <Input
            value={this.props.inputValue}
            placeholder='todo info'
            style={{ width: '300px', marginRight: '10px' }}
            onChange={this.props.handleInputChange}
          />
          <Button type='primary' onClick={this.props.handleBtnClick}>
            æäº¤
          </Button>
        </div>
        <List
          style={{ marginTop: '10px', width: '300px' }}
          bordered
          dataSource={this.props.list}
          renderItem={(item, index) => (
            <List.Item
              onClick={() => {
                this.props.handleItemDelete(index);
              }}
            >
              {item}
            </List.Item>
          )}
        />
      </div>
    );
  }
}

export default TodoListUI;
```

ç»§ç»­ï¼Œæˆ‘ä»¬æ¥æ”¹é€  `TodoList.js` æ–‡ä»¶çš„å†…å®¹ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { Component } from 'react';

import store from './store';
import {
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction,
} from './store/actionCreators';
import TodoListUI from './TodoListUI';

class TodoList extends Component {
  constructor(props) {
    super(props);
    this.state = store.getState();
    this.handleInputChange = this.handleInputChange.bind(this);
    this.handleStoreChange = this.handleStoreChange.bind(this);
    this.handleBtnClick = this.handleBtnClick.bind(this);
    this.handleItemDelete = this.handleItemDelete.bind(this);
    store.subscribe(this.handleStoreChange);
  }
  render() {
    return (
      <TodoListUI
        inputValue={this.state.inputValue}
        list={this.state.list}
        handleInputChange={this.handleInputChange}
        handleBtnClick={this.handleBtnClick}
        handleItemDelete={this.handleItemDelete}
      />
    );
  }

  handleInputChange(e) {
    const action = getInputChangeAction(e.target.value);
    store.dispatch(action);
  }

  handleStoreChange() {
    this.setState(store.getState());
  }

  handleBtnClick() {
    const action = getAddItemAction();
    store.dispatch(action);
  }

  handleItemDelete(index) {
    const action = getDeleteItemAction(index);
    store.dispatch(action);
  }
}

export default TodoList;
```

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æŠŠé¡µé¢çš„å†…å®¹ç»™å•ç‹¬æŠ½ç¦»å‡ºæ¥æ”¾åˆ° `TodoListUI.js` æ–‡ä»¶å½“ä¸­ï¼Œè®©å®ƒåªåšæ¸²æŸ“è¿™ä¸€ä»¶äº‹æƒ…ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±æˆåŠŸçš„æŠŠ `UI` ç»„ä»¶å’Œé€»è¾‘ç»„ä»¶è¿›è¡Œæ‹†åˆ†ã€‚

## 2ã€æ— çŠ¶æ€ç»„ä»¶

æœ‰äº† `UI` ç»„ä»¶ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹å¦å¤–ä¸€ç§ç»„ä»¶ï¼Œ**æ— çŠ¶æ€ç»„ä»¶**ã€‚æ‰€è°“**æ— çŠ¶æ€ç»„ä»¶**ï¼Œå°±æ˜¯æ•´ä¸ªé¡µé¢**ä»€ä¹ˆé€»è¾‘éƒ½æ²¡æœ‰**ï¼Œåªæœ‰ä¸€ä¸ª `render` å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç§°ä¹‹ä¸ºæ˜¯ä¸€ä¸ªæ— çŠ¶æ€ç»„ä»¶ã€‚

é‚£æ— çŠ¶æ€ç»„ä»¶æ€ä¹ˆå®šä¹‰å‘¢ï¼Ÿï¼Ÿ

æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œ`props` ã€‚ `TodoListUI.js` æ–‡ä»¶çš„å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```js
import React from 'react';
import { Input, Button, List } from 'antd';

const TodoListUI = (props) => {
  return (
    <div style={{ marginTop: '10px', marginLeft: '10px' }}>
      <div>
        <Input
          value={props.inputValue}
          placeholder='todo info'
          style={{ width: '300px', marginRight: '10px' }}
          onChange={props.handleInputChange}
        />
        <Button type='primary' onClick={props.handleBtnClick}>
          æäº¤
        </Button>
      </div>
      <List
        style={{ marginTop: '10px', width: '300px' }}
        bordered
        dataSource={props.list}
        renderItem={(item, index) => (
          <List.Item
            onClick={() => {
              props.handleItemDelete(index);
            }}
          >
            {item}
          </List.Item>
        )}
      />
    </div>
  );
};

export default TodoListUI;
```

å½“ä¸€ä¸ªæ™®é€šå‡½æ•°åªæœ‰ `render` å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ä¸€ä¸ª**æ— çŠ¶æ€çš„ç»„ä»¶**æ¥æ›¿æ¢æ‰è¿™ä¸ªæ™®é€šçš„ç»„ä»¶ã€‚é‚£ä¸ºä»€ä¹ˆè¦åšè¿™æ ·å­çš„æ›¿æ¢å‘¢ï¼Ÿ

å¦‚æœæˆ‘ä»¬æ”¹é€ ä¸º**åªæœ‰ä¸€ä¸ªå‡½æ•°**çš„æ—¶å€™ï¼Œé‚£ä¹ˆç¨‹åºå°±åªéœ€è¦å»è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œä¹Ÿåªéœ€è¦åšè¿™ä¸€ä»¶äº‹æƒ…ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬ç”¨ `class` çš„è¯ï¼Œé‚£ä¹ˆå®ƒçš„ç±»èƒŒåæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡åˆæœ‰å¾ˆå¤šçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç­‰ç­‰ï¼Œè¿™å°±æ˜¾å¾—æ²¡æœ‰é‚£ä¹ˆçº¯ç²¹äº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰**æ— çŠ¶æ€ç»„ä»¶**è¿™æ ·çš„æ–¹å¼ï¼Œæ¥è®©ç»„ä»¶æ›´åŠ åœ°çº¯æ­£ã€‚

# ğŸ© å…«ã€Redux å‘èµ·å¼‚æ­¥è¯·æ±‚

## 1ã€Redux ä¸­å‘é€å¼‚æ­¥è¯·æ±‚æ•°æ®

å¾€å¾€åœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯éœ€è¦å»å’Œåç«¯è¯·æ±‚æ¥å£æ•°æ®å¹¶å‘é€ `AJAX` è¯·æ±‚ã€‚é‚£æƒ³è¦åœ¨ `react` ä¸­è¯·æ±‚åˆ°åç«¯æ¥å£æ•°æ®ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬åœ¨ `TodoList.js` ä¸‹é¢ï¼Œæ¥è¯·æ±‚æ•°æ®ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction,
  initListAction,
} from './store/actionCreators';

class TodoList extends Component {
  componentDidMount() {
    axios.get('./list.json').then((res) => {
      const data = res.data;
      const action = initListAction(data);
      store.dispatch(action);
    });
  }
}
```

æ¥ç€ï¼Œä¿®æ”¹ `actionTypes.js` ä»£ç ã€‚**å…·ä½“å¦‚ä¸‹ï¼š**

```js
export const CHANGE_INPUT_VALUE = 'change_input_value';
export const ADD_TODO_ITEM = 'add_todo_item';
export const DELETE_TODO_ITEM = 'delete_todo_item';
export const INIT_LIST_ACTION = 'init_list_action';
```

ç»§ç»­ï¼Œæˆ‘ä»¬åœ¨ `actionCreators.js` ä¸­å¯¹å°è£… `action` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
  INIT_LIST_ACTION,
} from './actionTypes';

export const getInputChangeAction = (value) => ({
  type: CHANGE_INPUT_VALUE,
  value: value,
});

export const getAddItemAction = (value) => ({
  type: ADD_TODO_ITEM,
});

export const getDeleteItemAction = (index) => ({
  type: DELETE_TODO_ITEM,
  index: index,
});

export const initListAction = (data) => ({
  type: INIT_LIST_ACTION,
  data: data,
});
```

æœ€åï¼Œä¿®æ”¹ `reducer.js` ä»£ç ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
  INIT_LIST_ACTION,
} from './actionTypes';

const defaultStore = {
  inputValue: '123',
  list: [1, 2, 3],
};

// reducer å¯ä»¥æ¥æ”¶stateï¼Œä½†æ˜¯ç»ä¸èƒ½ä¿®æ”¹state
const reducer = (state = defaultStore, action) => {
  if (action.type === CHANGE_INPUT_VALUE) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  }
  if (action.type === INIT_LIST_ACTION) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list = action.data;
    return newState;
  }
  if (action.type === ADD_TODO_ITEM) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(newState.inputValue);
    newState.inputValue = '';
    console.log(newState);
    return newState;
  }
  if (action.type === DELETE_TODO_ITEM) {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.splice(action.index, 1);
    return newState;
  }
  return state;
};
export default reducer;
```

ç”±æ­¤ï¼Œæˆ‘ä»¬å°±å®ç°äº†é€šè¿‡ `axios` çš„æ–¹å¼æ¥å‘å¸ƒ `AJAX` è¯·æ±‚ï¼Œè¯·è®©å…¶è·å–åˆ°æ•°æ®ã€‚

## 2ã€Redux-thunk ä¸­é—´ä»¶

### ï¼ˆ1ï¼‰è§£å†³ä»€ä¹ˆé—®é¢˜

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å¯¹æ¥å£çš„æ•°æ®å‘èµ·äº†è¯·æ±‚ã€‚ä¸Šé¢è¿™ç§æƒ…å†µæ˜¯å±äºæ¯”è¾ƒç®€å•çš„ä¾‹å­ï¼Œä½†æ˜¯å¾€å¾€åœ¨å®é™…åœºæ™¯ä¸­æˆ‘ä»¬é‡åˆ°çš„ï¼Œéƒ½æ˜¯æ¯”è¾ƒå¤æ‚çš„ä¾‹å­ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯ï¼Œå½“é‡åˆ°**å¼‚æ­¥è¯·æ±‚**æˆ–è€…æ˜¯**æœ‰ç€éå¸¸å¤æ‚é€»è¾‘**çš„æ—¶å€™ï¼ŒæŠŠå®ƒç§»å‡ºåˆ°å…¶ä»–æ–‡ä»¶ä¸‹è¿›è¡Œç®¡ç†ã€‚

é‚£è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° **`Redux-thunk` ä¸­é—´ä»¶**æ¥è¿›è¡Œé—®é¢˜è§£å†³ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹ **`Redux-thunk` ä¸­é—´ä»¶**å¦‚ä½•ä½¿ç”¨ï¼Ÿ

### ï¼ˆ2ï¼‰å¦‚ä½•ä½¿ç”¨

**ç¬¬ä¸€æ­¥ï¼š** å®‰è£… `redux-thunk` ã€‚**å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š**

```bash
npm i redux-thunk -D
```

**ç¬¬äºŒæ­¥ï¼š** å¼•å…¥ `redux-thunk` ã€‚å¾€å¾€æˆ‘ä»¬åœ¨å®é™…è°ƒè¯•ä¸­ï¼Œéƒ½ä¼šå—ç”¨ `redux-devtools` å»å¯¹é¡¹ç›®çš„ `store` è¿›è¡Œè°ƒè¯•ã€‚ä½†å¦‚æœæˆ‘ä»¬æ—¢è¦å¼•å…¥ `redux-devtools` ï¼Œåˆè¦å¼•å…¥ `redux-thunk` ä¸­é—´ä»¶ï¼Œè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿåœ¨ `store|index.js` æ–‡ä»¶ä¸­è¿›è¡Œå¤„ç†ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
// composeå‡½æ•°æ¥è‡ªäºreduxä¸­
import { createStore, applyMiddleware, compose } from 'redux';
import reducer from './reducer';
import thunk from 'redux-thunk';

const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
  ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})
  : compose;

const enhancer = composeEnhancers(applyMiddleware(thunk));

const store = createStore(reducer, enhancer);

export default store;
```

é€šè¿‡è¿™ç§å½¢å¼çš„ç¼–ç ï¼Œä½¿å¾—æˆ‘ä»¬çš„ `store` **æ—¢æ”¯æŒ** `windows` ä¸‹çš„ `devtools` ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»è°ƒè¯• `store` ï¼Œ**åˆå¯ä»¥**æˆåŠŸçš„å¼•å…¥ `redux-thunk` ã€‚

**ç¬¬ä¸‰æ­¥ï¼š** å°†å¼‚æ­¥é€»è¾‘è¿›è¡ŒæŠ½ç¦»ã€‚å…ˆæ¥ä¿®æ”¹ `TodoList.js` çš„ä»£ç ã€‚**å…·ä½“å¦‚ä¸‹ï¼š**

```js
import {
  getTodoList,
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction,
} from './store/actionCreators';

class TodoList extends Component {
  componentDidMount() {
    // è¿™é‡Œçš„actionæ˜¯ä¸€ä¸ªå‡½æ•°
    const action = getTodoList();
    // åªæœ‰ç”¨äº†thunkï¼Œactionæ‰èƒ½æ˜¯ç”¨å‡½æ•°çš„å½¢å¼å»è¿›è¡Œä¼ é€’
    store.dispatch(action);
  }
}
```

æ¥ç€ï¼Œä¿®æ”¹ `actionCreators.js` çš„ä»£ç ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
// getTodoList æ˜¯ä¸€ä¸ªå‡½æ•°
// ä»¥è¿™ç§å½¢å¼ç”Ÿæˆçš„å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥æ¥æ”¶dispatchæ–¹æ³•
export const getTodoList = () => {
  return (dispatch) => {
    axios.get('./list.json').then((res) => {
      const data = res.data;
      // è¿™é‡Œçš„ action æ˜¯ä¸€ä¸ªå¯¹è±¡
      const action = initListAction(data);
      dispatch(action);
    });
  };
};
```

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥è§£é‡Šä¸‹ä¸Šé¢è¿™ä¸¤æ®µä»£ç ï¼Œ**å…·ä½“å¦‚ä¸‹ï¼š**

é…ç½®å¥½ `redux-thunk` çš„ç¯å¢ƒä¹‹åï¼Œå®ƒä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ `action` é‡Œé¢ï¼Œå†™å¼‚æ­¥çš„ä»£ç äº†ï¼ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ

- ä»¥å‰æˆ‘ä»¬åœ¨åˆ›å»º `action` æ—¶ï¼Œåªèƒ½æ˜¯ä¸€ä¸ª**JS å¯¹è±¡**ï¼Œè€Œç°åœ¨ï¼Œå½“ä½¿ç”¨äº† `redux-thunk` ä¹‹åï¼Œå³ä½¿ `getTodoList()` è¿”å›çš„**ä¸æ˜¯**ä¸€ä¸ªå¯¹è±¡**è€Œæ˜¯**ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ `store.dispatch()` çš„æ–¹å¼ï¼ŒæŠŠå‡½æ•°å‘é€ç»™åˆ° `store` äº†ã€‚
- é‚£ä¸ºä»€ä¹ˆèƒ½å¤ŸæŠŠ**å‡½æ•°**ç»™å‘é€å‡ºå»å‘¢ï¼Ÿå°±æ˜¯å› ä¸ºç”¨äº† `redux-thunk` ã€‚

ç»§ç»­ï¼Œæˆ‘ä»¬è¦è°ˆè®º**å…·ä½“çš„å®ç°æ­¥éª¤ ğŸ‘‡ï¼š**

- é¦–å…ˆè®© `TodoList.js` ä¸­çš„ `store` ï¼Œå»æ‰§è¡Œ `action` å‡½æ•°ã€‚è€Œè¿™ä¸ª `action` å‡½æ•°ï¼Œæ¥è‡ªäº `actionCreators.js` ä¸­çš„ `getTodoList()` ã€‚
- å¯¹äº `getTodoList()` æ¥è¯´ï¼Œå®ƒè¦åšçš„äº‹æƒ…æ˜¯å»**è¯·æ±‚ json çš„æ•°æ®**å’Œ**è·å– json çš„æ•°æ®**ã€‚
- è€Œè·å–å¥½äº†æ•°æ®ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œè¦æ”¹å˜ `store` é‡Œé¢çš„æ•°æ®ï¼Œé‚£ä¹ˆè¦å…ˆå»åˆ›å»ºä¸€ä¸ª `action` ï¼Œè¿™ä¸ª `action` ç”¨æ¥æä¾›ç»™ `store.dispatch()` è¿›è¡Œè°ƒç”¨ã€‚ä½†æ˜¯å‘¢ï¼Œ `store.dispatch()` è¦æ€ä¹ˆå»è·å–å‘¢ï¼Ÿæˆ‘ä»¬æ‰€è¿”å›çš„é‚£ä¸ªå‡½æ•°ä¸­ï¼Œå°±ä¼šè‡ªåŠ¨åœ°æ¥æ”¶åˆ° `store.dispatch()` æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œåªè¦é€šè¿‡ `dispatch(action)` ï¼Œå°† `action` ç»™æ´¾å‘å‡ºå»å°±å¯ä»¥äº†ã€‚
- ä¹Ÿå°±æ˜¯è¯´ï¼Œ `redux-thunk` ä½¿å¾—æˆ‘ä»¬å»åˆ›å»º `action` æˆ–è€…æ”¯æŒ `action` æ—¶ï¼Œæ˜¯ä¸€ä¸ª**å‡½æ•°**çš„å½¢å¼ã€‚

### ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ redux-thunk ï¼Ÿ

çœ‹å®Œä¸Šé¢çš„è§£é‡Šä¹‹åï¼Œç›¸ä¿¡å¤§å®¶ä¹Ÿå°±çŸ¥é“ `redux-thunk` çš„å¥‡å¦™ä¹‹å¤„äº†ã€‚é‚£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ `redux-thunk` å‘¢ï¼ŸğŸ‘‡

å¦‚æœæŠŠå¼‚æ­¥å‡½æ•°æ”¾åœ¨**ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ**ä¸­æ¥ä½¿ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª**ç»„ä»¶çš„é€»è¾‘å°±ä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚**ï¼Œç»„ä»¶çš„å†…å®¹ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¤šã€‚å› æ­¤ï¼Œæˆ‘ä»¬é€šå¸¸å°±ä¼šæŠŠè¿™ç§å¤æ‚çš„å¼‚æ­¥é€»è¾‘ç»™**æ‹†åˆ†å‡ºå»è¿›è¡Œå•ç‹¬ç®¡ç†**ã€‚é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å°±å€ŸåŠ© `redux-thunk` ä¸­é—´ä»¶ï¼ŒæŠŠå¼‚æ­¥é€»è¾‘ç»™æ‹†åˆ†åˆ° `actionCreators.js` å»è¿›è¡Œå•ç‹¬ç®¡ç†ã€‚ç”±æ­¤ï¼Œä½¿å¾—ä»£ç æ›´åŠ è§„èŒƒå’Œç»Ÿä¸€ã€‚

### ï¼ˆ4ï¼‰ä»€ä¹ˆæ˜¯ Redux-thunk ä¸­é—´ä»¶ï¼Ÿ

åœ¨æœ‰äº†ä¸Šé¢å†…å®¹çš„é“ºå«ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿”å›åˆ°ä¸­é—´ä»¶çš„æºå¤´ï¼Œæ¥è°ˆè°ˆ `Redux-thunk` ä¸­é—´ä»¶çš„åŸç†ã€‚

æ‰€è°“**ä¸­é—´ä»¶**ï¼Œè‚¯å®šå°±æ˜¯è¯´æ˜¯è°å’Œè°çš„ä¸­é—´ã€‚**æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€å¼ å›¾ï¼š**

![Redux Data Flow](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270716403.png)

`Redux` ä¸­é—´ä»¶çš„è¿™ä¸ª**ä¸­é—´**ï¼ŒæŒ‡çš„æ˜¯ `action` å’Œ `store` ä¹‹é—´ã€‚

ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œåœ¨ `redux` ä¸­ï¼Œ `action` åªèƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±å› ä¸ºå®ƒæ˜¯å¯¹è±¡ï¼Œå› æ­¤ç›´æ¥æŠŠå®ƒæ´¾å‘ç»™ `store` ã€‚ç°åœ¨ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨äº† `redux-thunk` ä¹‹åï¼Œ `action` å°±å¯ä»¥æ˜¯å‡½æ•°äº†ã€‚é‚£ä¸ºä»€ä¹ˆå¯ä»¥æ˜¯å‡½æ•°å‘¢ï¼Ÿ

çœ‹ä¸Šé¢çš„å›¾ä¸­ä¸éš¾å‘ç°ï¼Œ `action` é€šè¿‡ `dispatch` çš„æ–¹æ³•ï¼Œå°†æ•°æ®é€’äº¤ç»™äº† `store` ã€‚ä¸” `action` å’Œ `store` ä¹‹é—´ï¼Œæ˜¯ä¸€ä¸ª `dispatch` æ–¹æ³•ï¼Œé‚£æˆ‘ä»¬è¯´çš„ä¸­é—´ä»¶ `middleware` ï¼Œå®é™…ä¸Šå°±æ˜¯**å¯¹ dispatch æ–¹æ³•çš„å°è£…å’Œå‡çº§**ã€‚

å¯¹äºæœ€åŸå§‹çš„ `dispatch` æ–¹æ³•æ¥è¯´ï¼Œå®ƒä¼šæ¥æ”¶åˆ°ä¸€ä¸ª **JS å¯¹è±¡**å¹¶å°†å…¶ä¼ é€’ç»™ `store` ã€‚

ä½†å¦‚æœæˆ‘ä»¬ä¼ é€’çš„æ˜¯ä¸€ä¸ª **å‡½æ•°** çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ª `dispatch` å°±å‡çº§äº†ã€‚ `dispatch` ä¸ä¼šç›´æ¥æŠŠå‡½æ•°ä¼ é€’ç»™ `store` ï¼Œå®ƒä¼šé€šè¿‡ `redux-thunk` ä¸­é—´ä»¶çš„æ–¹å¼ï¼Œå…ˆæ‰§è¡Œå¯¹åº”çš„å‡½æ•°ï¼Œç­‰æ‰§è¡Œåˆ°éœ€è¦è°ƒç”¨ `store` çš„æ—¶å€™ï¼Œå†å»è°ƒç”¨ `store` ã€‚

# ğŸ’¼ ä¹ã€Redux çš„å…¶ä»–ä¸­é—´ä»¶

## 1ã€Redux-logger

`redux` çš„ä¸­é—´ä»¶éå¸¸çš„å¤šï¼Œæ¯”å¦‚ `redux-logger` å¯ä»¥è®°å½• `action` æ¯ä¸€æ¬¡æ´¾å‘çš„æ—¥å¿—ã€‚é‚£å®ƒæ€ä¹ˆè®°å½•å‘¢ï¼Ÿ

å®ƒåœ¨æ¯ä¸€æ¬¡è°ƒç”¨ `action` çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ `dispatch` æ–¹æ³•æŠŠ `action` ä¼ é€’ç»™ `store` ï¼Œä¹‹åå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ `dispatch` åšä¸€ä¸ªå‡çº§ï¼Œè®© `dispatch` ä¸ä»…æŠŠ `action` ä¼ é€’ç»™ `store` ï¼Œè€Œä¸”åœ¨æ¯ä¸€æ¬¡ä¼ é€’ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜é€šè¿‡ `console.log` çš„æ–¹å¼å°†å…¶æ‰“å°å‡ºæ¥ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å†™äº†ä¸€ä¸ª `redux-logger` çš„ä¸­é—´ä»¶ï¼Œ å®ƒå¯ä»¥åœ¨æˆ‘ä»¬æ´¾å‘ `action` çš„æ—¶å€™ï¼ŒæŠŠ `action` æ‰“å°åœ¨æˆ‘ä»¬çš„**æ§åˆ¶å°**é‡Œé¢ã€‚

## 2ã€Redux-saga

### ï¼ˆ1ï¼‰Redux-saga æ˜¯ä»€ä¹ˆ

åœ¨ç°å¦‚ä»Šçš„é¡¹ç›®ä¸­ï¼Œç”¨çš„æ¯”è¾ƒç«çš„ä¸­é—´ä»¶ä¸ä»…æœ‰ `redux-thunk` ï¼Œ `redux-logger` ï¼Œè¿˜æœ‰ `reudx-saga` çš„ä½¿ç”¨èŒƒå›´ä¹Ÿéå¸¸çš„å¹¿ã€‚

`reudx-saga` ä¹Ÿæ˜¯è§£å†³ `react` ä¸­**å¼‚æ­¥é—®é¢˜**çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸åŒäº `redux-thunk` çš„æ˜¯ï¼Œ `redux-thunk` é‡‡ç”¨çš„æ˜¯æŠŠ**å¼‚æ­¥æ“ä½œ**æ”¾åˆ° `action` é‡Œé¢å»æ“ä½œã€‚è€Œ **redux-saga é‡‡ç”¨çš„è®¾è®¡æ€æƒ³æ˜¯**ï¼Œ<u>å•ç‹¬åœ°æŠŠå¼‚æ­¥é€»è¾‘æ‹†åˆ†å‡ºæ¥ï¼Œæ”¾åˆ°å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å»è¿›è¡Œç®¡ç†</u>ã€‚é‚£ `redux-saga` è¿™ä¸ªä¸­é—´ä»¶è¯¥å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ

### ï¼ˆ2ï¼‰Redux-saga å¦‚ä½•ä½¿ç”¨

æˆ‘ä»¬æŠŠä¸Šé¢çš„ `TodoList` ç»„ä»¶è¿›è¡Œå‡çº§æ”¹é€ ã€‚é¦–å…ˆæ˜¯ `store|index.js` æ–‡ä»¶ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { createStore, applyMiddleware, compose } from 'redux';
import reducer from './reducer';
import createSagaMiddleware from 'redux-saga';
import todoSagas from './sagas';

const sagaMiddleware = createSagaMiddleware();
const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__
  ? window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({})
  : compose;
const enhancer = composeEnhancers(sagaMiddleware(sagaMiddleware));

const store = createStore(reducer, enhancer);
sagaMiddleware.run(todoSagas);

export default store;
```

åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œä¸»è¦æ˜¯è¦æŠŠåŸºç¡€é…ç½®åšå¥½ã€‚é‚£è¿™é‡Œä¸»è¦æœ‰å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š

- å¼•å…¥ `createSagaMiddleware` ï¼›
- ä¹‹åæ˜¯ä½¿ç”¨ `const sagaMiddleware = createSagaMiddleware()` å°†å…¶è¿›è¡Œå¼•å…¥ï¼›
- ä½¿ç”¨ `apllyMiddleware` å»ä½¿ç”¨è¿™ä¸ªä¸­é—´ä»¶ï¼›
- ä½¿ç”¨å®Œä¸­é—´ä»¶ä¹‹åï¼Œæˆ‘ä»¬åˆåˆ›å»ºäº† `saga.js` ã€‚

---

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ `store` æ–‡ä»¶å¤¹ä¸‹åˆ›å»º `saga.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { takeEvery, put } from 'redux-saga/effects';
import { initListAction } from './actionCreators';
import { GET_INIT_LIST } from './actionTypes';
import axios from 'axios';

function getInitList() {
  try {
    const res = yield axios.get('./list.json');
    const action = initListAction(res.data);
    yield put(action);
  } catch (e) {
    console.log('list.jsonç½‘ç»œè¯·æ±‚å¤±è´¥');
  }
}

function* mySaga() {
  // é€šè¿‡takeEveryå»æ•è·åˆ°æ¯ä¸€æ¬¡æ´¾å‘ä¸‹æ¥çš„action
  yield takeEvery(GET_INIT_LIST, getInitList);
}

export default mySaga;
```

å¯¹äº `saga.js` æ¥è¯´ï¼Œæœ‰å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹æ˜¯ï¼š

- åœ¨ `saga.js` é‡Œé¢ï¼Œä¸€å®šè¦å¯¼å‡ºä¸€ä¸ª `generator` å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢ï¼Œæˆ‘ä»¬å†™äº†ä¸€äº›é€»è¾‘ã€‚é€»è¾‘æ˜¯ï¼Œå½“æˆ‘ä»¬æ¥æ”¶åˆ°çš„ `action` ç±»å‹æ˜¯ `GET_INIT_LIST` æ—¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šå»æ‰§è¡Œ `getInitList` è¿™ä¸ªæ–¹æ³•ã€‚
- `getInitList()` æ–¹æ³•æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå°†ä¼šå»å¸®æˆ‘ä»¬å–æ•°æ®ï¼Œå–å®Œæ•°æ®ä¹‹åï¼Œå†å°†è¿™ä¸ªæ•°æ®åˆ›å»ºå‡ºæ¥ä¸€ä¸ªæ–°çš„ `action` ï¼Œå¹¶å°†è¿™ä¸ª `action` é€šè¿‡ `yield put(action)` çš„æ–¹å¼ï¼Œæ´¾å‘ç»™ `store` ã€‚

---

ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ `actionTypes.js` ä¸­çš„å†…å®¹ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
// CHANGE_INPUT_VALUEã€ADD_TODO_ITEMã€DELETE_TODO_ITEMã€INIT_LIST_ACTION
export const GET_INIT_LIST = 'get_init_list';
```

---

æ¥ç€ï¼Œæˆ‘ä»¬æ¥åˆ° `TodoList.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import {
  getInputChangeAction,
  getAddItemAction,
  getDeleteItemAction,
  getInitList,
} from './store/actionCreators';

class TodoList extends Component {
  // æ­¤å¤„çœç•¥nå¤šå†…å®¹

  componentDidMount() {
    const action = getInitList();
    store.dispatch(action);
  }
}

export default TodoList;
```

æœ€åæ˜¯ `store|actionCreators.js` ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```js
import {
  GET_INIT_LIST,
  CHANGE_INPUT_VALUE,
  ADD_TODO_ITEM,
  DELETE_TODO_ITEM,
  INIT_LIST_ACTION,
} from './actionTypes';

// æ­¤å¤„çœç•¥nå¤šå†…å®¹

export const getInitList = () => ({
  type: GET_INIT_LIST,
});
```

åœ¨ `TodoList.js` ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª `action` ï¼Œå¹¶å°†è¿™ä¸ª `action` æ´¾å‘ç»™ `store` ã€‚

# ğŸ›µ åã€React-Redux

## 1ã€React-Redux æ˜¯ä»€ä¹ˆ

åœ¨å­¦ä¹ äº† `react` ä¹‹åï¼Œç´§æ¥ç€ï¼Œæˆ‘ä»¬å­¦ä¹ äº† `redux` ã€‚é‚£å¦‚æœæŠŠå®ƒä»¬ä¿©ç»“åˆèµ·æ¥ï¼Œ `react-redux` æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ª**ç¬¬ä¸‰æ–¹æ¨¡å—**ï¼Œå®ƒä½¿å¾—æˆ‘ä»¬åœ¨ `react` ä¸­æ›´åŠ æ–¹ä¾¿åœ°ä½¿ç”¨ `redux` ã€‚

## 2ã€React-Redux çš„ä½¿ç”¨

### ï¼ˆ1ï¼‰å®‰è£… React-Redux

åŒæ ·åœ°ï¼Œæˆ‘ä»¬ä»¥ `TodoList` ç»„ä»¶ä¸ºä¾‹ï¼Œæ¥çœ‹ä¸‹ `react-redux` çš„ä½¿ç”¨ã€‚é¦–å…ˆæ–°åˆ›å»ºä¸€ä¸ª `react` é¡¹ç›®ï¼ŒåŒæ—¶å®‰è£… `react-redux` ã€‚**å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š**

```js
npm install react-redux
```

### ï¼ˆ2ï¼‰é¡¹ç›®ç›®å½•

ä¸‹é¢å…ˆæ¥çœ‹é¡¹ç›®ç›®å½•ã€‚**å…·ä½“å¦‚ä¸‹å›¾ï¼š**

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270717869.png)

### ï¼ˆ3ï¼‰æ ¸å¿ƒå†…å®¹

**ç¬¬ä¸€æ­¥**ï¼Œå°† `TodoList` ç»„ä»¶æŒ‚è½½åˆ°é¡µé¢ä¸Šã€‚`src|index.js` æ–‡ä»¶ä¸‹çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
import React from 'react';
import ReactDOM from 'react-dom';
import TodoList from './TodoList';
import { Provider } from 'react-redux';
import store from './store';

const App = (
  // è¡¨ç¤ºProvideré‡Œé¢æ‰€æœ‰çš„ç»„ä»¶ï¼Œéƒ½æœ‰èƒ½åŠ›è·å–åˆ°store
  <Provider store={store}>
    <TodoList />
  </Provider>
);

ReactDOM.render(App, document.getElementById('root'));
```

`Provider` æ˜¯ `react` æä¾›çš„ç¬¬ä¸€ä¸ªæ ¸å¿ƒ `API` ï¼Œå®ƒæ—¨åœ¨è¡¨æ˜ï¼Œ `Provider` é‡Œé¢æ‰€æœ‰çš„ç»„ä»¶ï¼Œéƒ½æœ‰èƒ½åŠ›è·å–åˆ° `store` ã€‚

---

**ç¬¬äºŒæ­¥**ï¼Œç¼–å†™ `src|TodoList.js` çš„å†…å®¹ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React from 'react';
import { connect } from 'react-redux';

const TodoList = (props) => {
  const { inputValue, list, changeInputValue, handleClick, handleDelete } =
    props;
  return (
    <div>
      <div>
        <input value={inputValue} onChange={changeInputValue} />
        <button onClick={handleClick}>æäº¤</button>
      </div>
      <ul>
        {list.map((item, index) => {
          return (
            <li onClick={handleDelete} key={index}>
              {item}
            </li>
          );
        })}
      </ul>
    </div>
  );
};

const mapStateToProps = (state) => {
  return {
    inputValue: state.inputValue,
    list: state.list,
  };
};

// store, dispatch, props
const mapDispatchToProps = (dispatch) => {
  return {
    changeInputValue(e) {
      const action = {
        type: 'change_input_value',
        value: e.target.value,
      };
      // console.log(action.value)
      dispatch(action);
    },
    handleClick() {
      const action = {
        type: 'add_item',
      };
      dispatch(action);
    },
    handleDelete() {},
  };
};

// è®©æˆ‘ä»¬çš„TodoListå’Œstoreåšè¿æ¥
// TodoListæ˜¯ä¸€ä¸ªUIç»„ä»¶ï¼ŒconnectæŠŠè¿™ä¸ªUIç»„ä»¶å’Œå‰è¾¹çš„ä¸šåŠ¡é€»è¾‘ç›¸ç»“åˆï¼Œå¯ä»¥æŠŠå‰é¢æ‹¬å·çš„å†…å®¹ç§°ä¸ºæ˜¯å®¹å™¨ç»„ä»¶
export default connect(mapStateToProps, mapDispatchToProps)(TodoList);
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ `react-redux` ä¸­çš„ `connect` ã€‚

`connect` è¡¨ç¤ºçš„æ˜¯è¿æ¥ï¼Œé‚£ä¹ˆæ˜¯**è°å’Œè°åšè¿æ¥å‘¢**ï¼Ÿ `TodoList` å’Œ `store` åšè¿æ¥ã€‚å®ƒä»¬ä¿©åšè¿æ¥éœ€è¦ä¸€ä¸ª**æ˜ å°„å…³ç³»**ï¼Œè¿™ä¸ªæ˜ å°„å…³ç³»å°±åœ¨ `mapStateToProps` é‡Œé¢ã€‚

åœ¨ `mapStateToProps` ä¸­ï¼Œ `state` æŒ‡çš„æ˜¯ `store` é‡Œé¢çš„æ•°æ®ï¼Œé‚£ `store` é‡Œé¢çš„æ•°æ®ï¼Œå°±æŠŠå®ƒæ˜ å°„åˆ° `props` é‡Œé¢ï¼Œä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `this.props.xxx` çš„æ–¹å¼ï¼Œå»è·å–åˆ° `store` é‡Œé¢çš„æ•°æ®ã€‚

---

**ç¬¬ä¸‰æ­¥**ï¼Œåˆ›å»º `reducer` ã€‚åœ¨ `src|store|reducer.js` ä¸‹è¿›è¡Œç¼–å†™ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const defaultState = {
  inputValue: '',
  list: [],
};

export default (state = defaultState, action) => {
  if (action.type === 'change_input_value') {
    const newState = JSON.parse(JSON.stringify(state));
    newState.inputValue = action.value;
    return newState;
  }
  if (action.type === 'add_item') {
    const newState = JSON.parse(JSON.stringify(state));
    newState.list.push(newState.inputValue);
    newState.inputValue = '';
    return newState;
  }
  return state;
};
```

å°† `store` ä¸­çš„æ•°æ®ç»™æ”¾åˆ° `reducer` å½“ä¸­å»è¿›è¡Œè®°å½•ã€‚

---

**ç¬¬å››æ­¥**ï¼Œå°† `reducer` ä¼ ç»™ `store` ã€‚åœ¨ `src|store|index.js` ä¸‹è¿›è¡Œç¼–å†™ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { createStore } from 'redux';
import reducer from './reducer';

const store = createStore(reducer);

export default store;
```

æˆ‘ä»¬å°† `reducer` ä¸­å­˜æ”¾çš„å†…å®¹è¿›è¡Œæ·±æ‹·è´ï¼Œå¹¶æŠŠå®ƒä¼ å›ç»™ `store` ã€‚è¿™æ ·ï¼Œå°±å½¢æˆäº†ä¸€ä¸ªæ•°æ®ä¼ é€’çš„é—­ç¯ã€‚

---

æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æµè§ˆå™¨æ˜¾ç¤ºçš„æ•ˆæœï¼š

![React-Redux](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270717466.gif)

ç›¸æ¯”äºä½¿ç”¨ä¸­é—´ä»¶æ¥è¯´ï¼Œ `React-Redux` çš„ä½¿ç”¨æ›´åŠ åœ°**ç›´è§‚**å’Œ**ç®€æ´**ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¸ç®¡æ˜¯ `redux` ä¸­é—´ä»¶ï¼Œè¿˜æ˜¯ `react-redux` ï¼Œéƒ½å€¼å¾—æ‹¿æ¥åšçŠ¶æ€ç®¡ç†ã€‚

é‚£ä¹ˆè¦æ³¨æ„çš„æ˜¯ï¼Œ`redux` ä¸­é—´ä»¶å’Œ `react-redux` ä¹‹é—´ï¼Œå„è‡ªåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­**ä¸åŒçš„ç‚¹**ï¼ŒåŒºåˆ†å¥½å³å¯ã€‚è‡³äºåœ¨é¡¹ç›®ä¸­**ä½¿ç”¨å“ªä¸€ç§ç±»å‹**ï¼Œå°±**ä¾æ®å½“ä¸‹çš„é¡¹ç›®åœºæ™¯**å»å†³å®šå°±å¥½å•¦ï¼

# ğŸš¦ åä¸€ã€ç»“æŸè¯­

åœ¨ä¸Šé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº† `Redux` è®¾è®¡å’Œä½¿ç”¨çš„ä¸‰é¡¹åŸåˆ™ï¼ŒåŒæ—¶ï¼Œä¹Ÿè®²è§£äº† `Redux` ä¸­çš„ä¸€äº›æ ¸å¿ƒ `API` ã€‚é™¤æ­¤ä¹‹å¤–å‘¢ï¼Œæˆ‘ä»¬è¿˜å­¦ä¹ äº† `redux` çš„ä¸­é—´ä»¶ï¼Œ `redux-thunk` å’Œ `redux-saga` ã€‚åŒæ—¶ï¼Œè¿˜å­¦ä¹ äº†å¦å¤–ä¸€ä¸ªåšçŠ¶æ€ç®¡ç†çš„å†…å®¹ï¼Œ `react-redux` ã€‚

åˆ°è¿™é‡Œï¼Œå…³äº `redux` çš„å†…å®¹å°±ä»‹ç»å®Œæ¯•å•¦ï¼ä¸çŸ¥é“å¤§å®¶æ˜¯å¦å¯¹ `redux` åˆæœ‰äº†æ–°çš„äº†è§£å‘¢ï¼Ÿ

# ğŸ£ å½©è›‹ One More Thing

## ï¼ˆï¼šå¾€æœŸæ¨è

ğŸ‘‰[åˆæ¢ reactï¼Œç”¨ react å®ç°ä¸€ä¸ª todoList åŠŸèƒ½](https://juejin.cn/post/7018019363139616805)

ğŸ‘‰[react åªåœç•™åœ¨è¡¨å±‚ï¼Ÿäº”å¤§çŸ¥è¯†ç‚¹å¸¦ä½ æ¢³ç†è¿›é˜¶çŸ¥è¯†](https://juejin.cn/post/7020631362142994469)


---
title: ç»„ä»¶åº“å®æˆ˜ | æ•™ä½ å¦‚ä½•è®¾è®¡Webä¸–ç•Œä¸­çš„è¡¨å•éªŒè¯
author: å‘¨ä¸€
date: '2021-10-08'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - vue3+tsç»„ä»¶åº“å¼€å‘
sidebar: 'auto'
---

# ğŸ’¬ åºè¨€

åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆç»å¸¸å¼€å‘çš„åœºæ™¯ï¼Œé‚£å°±æ˜¯**ç™»å½•æ³¨å†Œ**ã€‚ç™»å½•æ³¨å†Œå®é™…ä¸Šæ¶‰åŠåˆ°çš„å†…å®¹æ˜¯**è¡¨å•éªŒè¯**ï¼Œå› æ­¤å‘¢ï¼Œè¡¨å•éªŒè¯ä¹Ÿæ˜¯ `web` ä¸–ç•Œä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ã€‚

é‚£æ¥ä¸‹é‡Œå°±æ¥äº†è§£ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­ï¼Œå¦‚ä½•æ›´è§„èŒƒåˆç†åœ°å»å¼€å‘ä¸€ä¸ª**è¡¨å•éªŒè¯**ï¼Œä½¿å…¶æ‰©å±•æ€§æ›´å¼ºï¼Œé€»è¾‘æ›´åŠ æ¸…æ™°ã€‚

ä¸€èµ·æ¥å­¦ä¹  â‘§~

# ğŸ—¯ï¸ ä¸€ã€éªŒè¯è¾“å…¥æ¡† ValidateInput

## 1. è®¾è®¡ç¨¿æŠ¢å…ˆçŸ¥

åœ¨äº†è§£å…·ä½“çš„å®ç°æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹**åŸå‹å›¾**ã€‚çœ‹æˆ‘ä»¬æƒ³è¦å®ç°çš„**è¡¨å•**æ˜¯æ€ä¹ˆæ ·çš„ã€‚**å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š**

![validateåŸå‹å›¾](https://img-blog.csdnimg.cn/de3940b7ccdc4bba8cc0fe20820ebe1c.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5pif5pyf5LiA56CU56m25a6k,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„è¡¨å•éªŒè¯å°±æ˜¯**ç™»å½•æ³¨å†Œæ“ä½œ**ã€‚å…¶ä¸­ï¼Œæ•´ä¸ªè¡¨å•åŒ…å«å››éƒ¨åˆ†ã€‚

ç¬¬ä¸€éƒ¨åˆ†æ˜¯**çº¢è‰²æ¡†æ¡†çš„å†…å®¹**ï¼Œçº¢è‰²æ¡†æ¡†æƒ³è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼Œå½“å…ƒç´ å¤±å»ç„¦ç‚¹æ—¶å€™å»è§¦å‘äº‹ä»¶ã€‚

ç¬¬äºŒéƒ¨åˆ†æ˜¯**éªŒè¯è§„åˆ™**ï¼Œæˆ‘ä»¬ä¸ç®¡æ˜¯åœ¨è¾“å…¥ç”¨æˆ·åè¿˜æ˜¯å¯†ç ï¼Œéƒ½éœ€è¦**æ ¡éªŒè§„åˆ™**æ¥è¿›è¡Œæ ¡éªŒï¼Œæ¯”å¦‚è¯´ä¸ä¸ºç©ºï¼Œé™åˆ¶è¾“å…¥é•¿åº¦ç­‰ç­‰å†…å®¹ã€‚

ç¬¬ä¸‰éƒ¨åˆ†æ˜¯**å½“éªŒè¯æ²¡æœ‰é€šè¿‡æ—¶**ï¼Œéœ€è¦å‡ºç°å…·ä½“çš„è­¦å‘Šã€‚

ç¬¬å››éƒ¨åˆ†å°±æ˜¯å½“æ‰€æœ‰å†…å®¹éƒ½è¾“å…¥å¹¶ä¸”è¦è¿›è¡Œ**æäº¤**æ—¶ï¼Œè¦å»éªŒè¯æ•´ä¸ª `Form` è¡¨å•ã€‚

## 2. ç®€å•çš„å®ç°

æˆ‘ä»¬å…ˆæ¥ç»™è¡¨å•è¿›è¡Œä¸€ä¸ªç®€å•çš„å®ç°ã€‚ç°åœ¨æˆ‘ä»¬åœ¨ `vue3` é¡¹ç›®ä¸­çš„ `App.vue` ä¸‹å¯¹æ•´ä¸ªè¡¨å•å…ˆè¿›è¡Œæ¸²æŸ“ï¼Œå¹¶ä¸”å¯¹é‚®ç®±çš„é€»è¾‘è¿›è¡Œç¼–å†™ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <form action="">
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">é‚®ç®±åœ°å€</label>
        <input
          type="email"
          class="form-control"
          id="exampleEmail1"
          v-model="emailRef.val"
          @blur="validateEmail"
        />
        <div class="form-text" v-if="emailRef.error">{{emailRef.message}}</div>
      </div>
      <div class="mb-3">
        <label for="exampleInputPassword1" class="form-label">å¯†ç </label>
        <input
          type="password"
          class="form-control"
          id="exampleInputPassword1"
        />
      </div>
    </form>
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, ref } from 'vue';
  import 'bootstrap/dist/css/bootstrap.min.css';
  import ColumnList, { ColumnProps } from './components/ColumnList.vue';
  import GlobalHeader, { UserProps } from './components/GlobalHeader.vue';
  const currentUser: UserProps = {
    isLogin: true,
    name: 'Monday',
  };
  // åˆ¤æ–­æ˜¯å¦æ˜¯é‚®ç®±çš„æ ¼å¼
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
  const testData: ColumnProps[] = [
    {
      id: 1,
      title: 'test1ä¸“æ ',
      description:
        'ä¼—æ‰€å‘¨çŸ¥ï¼Œ js æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œå¹¶ä¸”è§„èŒƒè¾ƒå°‘ã€‚è¿™å°±å¾ˆå®¹æ˜“å¯¼è‡´åœ¨é¡¹ç›®ä¸Šçº¿ä¹‹å‰æˆ‘ä»¬å¾ˆéš¾å‘ç°åˆ°å®ƒçš„é”™è¯¯ï¼Œç­‰åˆ°é¡¹ç›®ä¸€ä¸Šçº¿ï¼Œæµ‘ç„¶ä¸è§‰åœ°ï¼Œbugå°±UpUpäº†ã€‚äºæ˜¯ï¼Œåœ¨è¿‡å»çš„è¿™ä¸¤å¹´ï¼Œtsæ‚„æ‚„çš„å´›èµ·äº†ã€‚ æœ¬ä¸“æ å°†ä»‹ç»å…³äºtsçš„ä¸€äº›å­¦ä¹ è®°å½•ã€‚',
      // avatar: 'https://img0.baidu.com/it/u=3101694723,748884042&fm=26&fmt=auto&gp=0.jpg'
    },
    {
      id: 2,
      title: 'test2ä¸“æ ',
      description:
        'ä¼—æ‰€å‘¨çŸ¥ï¼Œ js æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œå¹¶ä¸”è§„èŒƒè¾ƒå°‘ã€‚è¿™å°±å¾ˆå®¹æ˜“å¯¼è‡´åœ¨é¡¹ç›®ä¸Šçº¿ä¹‹å‰æˆ‘ä»¬å¾ˆéš¾å‘ç°åˆ°å®ƒçš„é”™è¯¯ï¼Œç­‰åˆ°é¡¹ç›®ä¸€ä¸Šçº¿ï¼Œæµ‘ç„¶ä¸è§‰åœ°ï¼Œbugå°±UpUpäº†ã€‚äºæ˜¯ï¼Œåœ¨è¿‡å»çš„è¿™ä¸¤å¹´ï¼Œtsæ‚„æ‚„çš„å´›èµ·äº†ã€‚ æœ¬ä¸“æ å°†ä»‹ç»å…³äºtsçš„ä¸€äº›å­¦ä¹ è®°å½•ã€‚',
      avatar:
        'https://img0.baidu.com/it/u=3101694723,748884042&fm=26&fmt=auto&gp=0.jpg',
    },
  ];

  export default defineComponent({
    name: 'App',
    components: {
      GlobalHeader,
    },
    setup() {
      // é‚®ç®±éªŒè¯éƒ¨åˆ†æ•°æ®å†…å®¹
      const emailRef = reactive({
        val: '',
        error: false,
        message: '',
      });
      // éªŒè¯é‚®ç®±é€»è¾‘
      const validateEmail = () => {
        // .trim è¡¨ç¤ºå»æ‰ä¸¤è¾¹ç©ºæ ¼
        // å½“é‚®ç®±ä¸ºç©ºæ—¶
        if (emailRef.val.trim() === '') {
          emailRef.error = true;
          emailRef.message = 'can not be empty';
        }
        // å½“é‚®ç®±ä¸ä¸ºç©ºï¼Œä½†å®ƒä¸æ˜¯æœ‰æ•ˆçš„é‚®ç®±æ ¼å¼æ—¶
        else if (!emailReg.test(emailRef.val)) {
          emailRef.error = true;
          emailRef.message = 'should be valid email';
        }
      };
      return {
        list: testData,
        user: currentUser,
        emailRef,
        validateEmail,
      };
    },
  });
</script>
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å…·ä½“çš„æ˜¾ç¤ºæ•ˆæœï¼š

![é‚®ç®±éªŒè¯](https://img-blog.csdnimg.cn/1861e6ce85f84026be9b445830b901fd.gif#pic_center)

å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬ç¬¬ä¸€æ­¥å°±å®ç°å•¦ï¼é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±åº”è¯¥æ¥å†™ `password` çš„é€»è¾‘äº†å‘¢ï¼Ÿ

ä½†æ˜¯å•Šï¼Œå¦‚æœæŒ‰ç…§ä¸Šé¢è¿™ç§æ–¹å¼æ¥å†™çš„è¯ï¼Œæœ‰å°ä¼™ä¼´ä¼šä¸ä¼šè§‰å¾—å°±æœ‰ç‚¹é‡å¤æ“ä½œäº†å‘¢ã€‚ä¸€ä¸¤ä¸ªæ ¡éªŒè§„åˆ™è¿˜å¥½ï¼Œå¦‚æœæˆ‘ä»¬é‡åˆ°åå‡ äºŒåä¸ªå‘¢ï¼Ÿä¹Ÿä¸€æ ·æ¯ä¸€ä¸ªéƒ½è¿™ä¹ˆå†™å—ï¼Ÿ

ç­”æ¡ˆå½“ç„¶æ˜¯å¦å®šçš„ã€‚é‚£ä¹ˆä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±è¦å¯¹è¿™ä¸ªæ ¡éªŒè§„åˆ™ï¼Œæ¥è¿›è¡ŒæŠ½è±¡ã€‚

## 3. æŠ½è±¡éªŒè¯è§„åˆ™

ç»§ç»­ï¼Œæˆ‘ä»¬ç°åœ¨è¦æ¥**æŠ½è±¡å‡ºç”¨æˆ·åå’Œå¯†ç çš„æ ¡éªŒè§„åˆ™**ï¼Œè®©å…¶å¯æ‰©å±•æ€§æ›´å¼ºã€‚**å…·ä½“å½¢å¼å¦‚ä¸‹ï¼š**

```js
<validate-input :rules="" />

interface RuleProp {
    type: 'required' | 'email' | 'range' | ...;
    message: string;
}
export type RulesProp = RuleProp[]
```

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆæŠŠè¡¨å•ç»„ä»¶ç»™æŠ½ç¦»å‡ºæ¥ã€‚é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ `vue3` é¡¹ç›®ä¸‹çš„ `src|components` ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `ValidateInput.vue` ã€‚**å…¶å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="validate-input-container pb-3">
    <!-- æ‰‹åŠ¨å¤„ç†æ›´æ–°å’Œå‘é€äº‹ä»¶ -->
    <!-- ä½¿ç”¨å¯é€‰ classï¼Œç”¨äºåŠ¨æ€è®¡ç®—ç±»å -->
    <input
      type="text"
      class="form-control"
      :class="{'is-invalid': inputRef.error}"
      v-model="inputRef.val"
      @blur="validateInput"
    />
    <span v-if="inputRef.error" class="invalid-feedback"
      >{{inputRef.message}}</span
    >
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, PropType } from 'vue';
  // åˆ¤æ–­emailçš„æ­£åˆ™è¡¨è¾¾å¼
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
  // requiredè¡¨ç¤ºå¿…å¡«å€¼ï¼Œemailè¡¨ç¤ºç”µå­é‚®ä»¶çš„æ ¼å¼
  // messageç”¨æ¥å±•ç¤ºå½“å‡ºç°é—®é¢˜æ—¶æç¤ºçš„é”™è¯¯
  interface RuleProp {
    type: 'required' | 'email';
    message: string;
    validator?: () => boolean;
  }

  export type RulesProp = RuleProp[];
  export default defineComponent({
    name: 'ValidateInput',
    props: {
      // ç”¨PropTypeæ¥ç¡®å®šrulesçš„ç±»å‹ï¼Œæ˜ç¡®é‡Œé¢æ˜¯RulesProp
      // è¿™é‡Œçš„rulesæ•°æ®å°†è¢«çˆ¶ç»„ä»¶ App.vue ç»™è¿›è¡ŒåŠ¨æ€ç»‘å®š
      rules: Array as PropType<RulesProp>,
    },
    setup(props, context) {
      //   è¾“å…¥æ¡†çš„æ•°æ®
      const inputRef = reactive({
        val: '',
        error: false,
        message: '',
      });
      // éªŒè¯è¾“å…¥æ¡†
      const validateInput = () => {
        if (props.rules) {
          const allPassed = props.rules.every((rule) => {
            let passed = true;
            inputRef.message = rule.message;
            switch (rule.type) {
              case 'required':
                passed = inputRef.val.trim() !== '';
                break;
              case 'email':
                passed = emailReg.test(inputRef.val);
                break;
              default:
                break;
            }
            return passed;
          });
          inputRef.error = !allPassed;
        }
      };
      return {
        inputRef,
        validateInput,
      };
    },
  });
</script>

<style></style>
```

ä¹‹åæˆ‘ä»¬å°†å…¶åœ¨ `App.vue` ä¸‹è¿›è¡Œæ³¨å†Œã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <form action="">
      <div class="mb-3">
        <label class="form-label">é‚®ç®±åœ°å€</label>
        <validate-input :rules="emailRules"></validate-input>
      </div>
      <div class="mb-3">
        <label for="exampleInputEmail1" class="form-label">é‚®ç®±åœ°å€</label>
        <input
        type="email" class="form-control" id="exampleEmail1"
        v-model="emailRef.val"
        @blur="validateEmail">
        <div class="form-text" v-if="emailRef.error">{{emailRef.message}}</div>
      </div>
      <div class="mb-3">
        <label for="exampleInputPassword1" class="form-label">å¯†ç </label>
        <input type="password" class="form-control" id="exampleInputPassword1">
      </div>
    </form>
  </div>
</template>

<script lang="ts">
import { defineComponent, reactive, ref } from 'vue'
import 'bootstrap/dist/css/bootstrap.min.css'
import ValidateInput, { RulesProp } from './components/ValidateInput.vue'
import GlobalHeader, { UserProps } from './components/GlobalHeader.vue'
const currentUser: UserProps = {
  isLogin: true,
  name: 'Monday'
}
// åˆ¤æ–­æ˜¯å¦æ˜¯é‚®ç®±çš„æ ¼å¼
const emailReg = /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/

export default defineComponent({
  name: 'App',
  components: {
    GlobalHeader,
    ValidateInput
  },
  setup () {
    const emailRules: RulesProp = [
      { type: 'required', message: 'ç”µå­é‚®ç®±ä¸èƒ½ä¸ºç©º' },
      { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼' }
    ]
    const emailRef = reactive({
      val: '',
      error: false,
      message: ''
    })
    const validateEmail = () => {
      if (emailRef.val.trim() === '') {
        emailRef.error = true
        emailRef.message = 'can not be empty'
      } else if (!emailReg.test(emailRef.val)) {
        emailRef.error = true
        emailRef.message = 'should be valid email'
      }
    }
    return {
      user: currentUser,
      emailRef,
      validateEmail,
      emailRules
    }
  }
})
</script>
```

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨æ¥çœ‹ä¸‹å®ƒå¥½ä¸å¥½ç”¨ã€‚**å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š**

![æŠ½è±¡éªŒè¯è§„åˆ™](https://img-blog.csdnimg.cn/e8e02e6178d849718db20d9acec5a82d.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡æŠ½ç¦»åçš„éªŒè¯è§„åˆ™ï¼Œä¹Ÿæ­£ç¡®çš„æ˜¾ç¤ºäº†æœ€ç»ˆçš„éªŒè¯æ•ˆæœã€‚è¯¾åå‘¢ï¼Œå¤§å®¶å¯ä»¥ç»§ç»­å¯¹ `RuleProp` çš„ `type` è¿›è¡Œæ‰©å±•ï¼Œæ¯”å¦‚å¤šå¤šåŠ ä¸€ä¸ª `range` åŠŸèƒ½ç­‰ç­‰ã€‚

åˆ°äº†è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯¹éªŒè¯è§„åˆ™å·²ç»è¿›è¡Œäº†ç®€å•çš„æŠ½ç¦»ã€‚é‚£æ¥ä¸‹æ¥è¦åšçš„äº‹æƒ…å°±æ˜¯ï¼Œè®©çˆ¶ç»„ä»¶ `App.vue` å¯ä»¥è·å–åˆ°å­ç»„ä»¶ `ValidateInput.vue` ä¸­ `input` æ¡†çš„å€¼ï¼Œå¯¹å…¶è¿›è¡Œæ•°æ®ç»‘å®šã€‚

## 4. v-model

è¯´åˆ° `input` ï¼Œå¤§å®¶é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯ `v-model` ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ `vue2` å’Œ `vue3` åœ¨åŒå‘ç»‘å®šæ–¹é¢çš„åŒºåˆ«ï¼š

```html
<!-- vue2 åŸç”Ÿç»„ä»¶ -->
<input v-model="val" />
<input :value="val" @input="val = $event.target.value" />

<!-- vue2è‡ªå®šä¹‰ç»„ä»¶ -->
<my-component v-model="val" />
<my-component :value="val" @input="val = argument[0]" />

<!-- éåŒå¯»å¸¸çš„è¡¨å•å…ƒç´  -->
<input type="checkbox" checked="val" @change="" />

<!-- vue3 compile ä»¥åçš„ç»“æœ -->
<my-component v-model="foo" />
h(Comp, { modelValue: foo, 'onUpdate: modelValue': value => (foo = value) })
```

å¯¹äº `vue2` çš„åŒå‘ç»‘å®šæ¥è¯´ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æ§½ç‚¹ï¼š

- æ¯”è¾ƒç¹çï¼Œéœ€è¦æ–°å»ºä¸€ä¸ª `model` å±æ€§ï¼›
- ä¸ç®¡å¦‚ä½•ï¼Œéƒ½åªèƒ½æ”¯æŒä¸€ä¸ª `v-model` ï¼Œæ²¡åŠæ³•åŒå‘ç»‘å®šå¤šä¸ªå€¼ï¼›
- å†™æ³•æ¯”è¾ƒè®©äººéš¾ä»¥ç†è§£ã€‚

åŸºäºä»¥ä¸Š `vue2` çš„å‡ ä¸ªæ§½ç‚¹ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ `vue3` æ¥å¯¹è¿™ä¸ªç»„ä»¶çš„ `input` å€¼è¿›è¡Œç»‘å®šï¼Œæ‰‹åŠ¨å¯¹å…¶å¤„ç†æ›´æ–°å’Œäº‹ä»¶å‘é€ã€‚

é¦–å…ˆæˆ‘ä»¬åœ¨å­ç»„ä»¶ `ValidateInput.vue` ä¸­è¿›è¡Œå¤„ç†ï¼Œå¤„ç†æ•°æ®æ›´æ–°å’Œäº‹ä»¶å‘é€ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="validate-input-container pb-3">
    <input
      type="text"
      class="form-control"
      :class="{'is-invalid': inputRef.error}"
      :value="inputRef.val"
      @blur="validateInput"
      @input="updateValue"
    />
    <span v-if="inputRef.error" class="invalid-feedback"
      >{{inputRef.message}}</span
    >
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, PropType } from 'vue';
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
  interface RuleProp {
    type: 'required' | 'email';
    message: string;
    validator?: () => boolean;
  }

  export type RulesProp = RuleProp[];
  export default defineComponent({
    name: 'ValidateInput',
    props: {
      rules: Array as PropType<RulesProp>,
      // åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å±æ€§ modelValue
      modelValue: String,
    },
    setup(props, context) {
      // è¾“å…¥æ¡†çš„æ•°æ®
      const inputRef = reactive({
        val: props.modelValue || '',
        error: false,
        message: '',
      });
      // KeyboardEvent å³é”®ç›˜è¾“å…¥äº‹ä»¶
      const updateValue = (e: KeyboardEvent) => {
        const targetValue = (e.target as HTMLInputElement).value;
        inputRef.val = targetValue;
        // æ›´æ–°å€¼æ—¶éœ€è¦å‘é€äº‹ä»¶ update:modelValue
        context.emit('update:modelValue', targetValue);
      };
      const validateInput = () => {
        if (props.rules) {
          const allPassed = props.rules.every((rule) => {
            let passed = true;
            inputRef.message = rule.message;
            switch (rule.type) {
              case 'required':
                passed = inputRef.val.trim() !== '';
                break;
              case 'email':
                passed = emailReg.test(inputRef.val);
                break;
              default:
                break;
            }
            return passed;
          });
          inputRef.error = !allPassed;
        }
      };
      return {
        inputRef,
        validateInput,
        updateValue,
      };
    },
  });
</script>
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ `App.vue` ä¸­å¯¹å…¶è¿›è¡Œä½¿ç”¨ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <form action="">
      <div class="mb-3">
        <label class="form-label">é‚®ç®±åœ°å€</label>
        <!-- æ­¤å¤„åšä¿®æ”¹ -->
        <validate-input :rules="emailRules" v-model="emailVal"></validate-input>
        {{emailVal}}
      </div>
    </form>
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, ref } from 'vue';
  import 'bootstrap/dist/css/bootstrap.min.css';
  import ValidateInput, { RulesProp } from './components/ValidateInput.vue';
  import GlobalHeader, { UserProps } from './components/GlobalHeader.vue';
  const currentUser: UserProps = {
    isLogin: true,
    name: 'Monday',
  };
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;

  export default defineComponent({
    name: 'App',
    components: {
      GlobalHeader,
      ValidateInput,
    },
    setup() {
      // åˆ›å»ºemailValçš„å€¼
      const emailVal = ref('monday');
      const emailRules: RulesProp = [
        { type: 'required', message: 'ç”µå­é‚®ç®±ä¸èƒ½ä¸ºç©º' },
        { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼' },
      ];
      const emailRef = reactive({
        val: '',
        error: false,
        message: '',
      });
      const validateEmail = () => {
        if (emailRef.val.trim() === '') {
          emailRef.error = true;
          emailRef.message = 'can not be empty';
        } else if (!emailReg.test(emailRef.val)) {
          emailRef.error = true;
          emailRef.message = 'should be valid email';
        }
      };
      return {
        user: currentUser,
        emailRef,
        validateEmail,
        emailRules,
        emailVal,
      };
    },
  });
</script>
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æ•°æ®çš„å€¼æ˜¯å¦æˆåŠŸè¢«ç»‘å®šã€‚**å…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š**

![v-modelç»‘å®šå€¼](https://img-blog.csdnimg.cn/84c609408fb64c6f8d062833bff321fe.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å·²ç»ç›´æ¥çš„è¢«çˆ¶ç»„ä»¶ç»™è·å–åˆ°å¹¶ä¸”ä¹ŸæˆåŠŸçš„ç»‘å®šäº†ã€‚

## 5. ä½¿ç”¨$attrs æ”¯æŒé»˜è®¤å±æ€§

ä¸Šé¢æˆ‘ä»¬åŸºæœ¬ä¸Šå®Œæˆäº†æ•´ä¸ªç»„ä»¶çš„åŸºæœ¬åŠŸèƒ½ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬è¦æ¥ç»™å®ƒè®¾ç½®é»˜è®¤å±æ€§ï¼Œä¹Ÿå°±æ˜¯å¹³å¸¸æˆ‘ä»¬ä½¿ç”¨çš„ `placeholder` ã€‚å¦‚æœæˆ‘ä»¬ç›´æ¥åœ¨ `<validate-input />` ç»„ä»¶ä¸­ç»‘å®š `placeholder` ï¼Œé‚£ä¹ˆé»˜è®¤åœ°ï¼Œä¼šç›´æ¥ç»‘å®šåˆ°å®ƒçš„**çˆ¶ç»„ä»¶**ä¸Šé¢å»ã€‚å› æ­¤å‘¢ï¼Œæˆ‘ä»¬è¦ç¦æ­¢æ‰è¿™ç§è¡Œä¸ºï¼Œè®©ç»‘å®šåçš„ `placeholder` ç»™ç›¸åº”çš„æ”¾ç½®åœ¨ `input` å…ƒç´ ä¸Šã€‚

é‚£è¿™ä¸€å—å†…å®¹å‘¢ï¼Œæ¶‰åŠåˆ°çš„å°±æ˜¯ `vue3` çš„ `$attrs` ï¼Œ `$attrs` å¯ä»¥è®©ç»„ä»¶çš„æ ¹å…ƒç´ ä¸ç»§æ‰¿ `attribute` ï¼Œå¹¶ä¸”å¯ä»¥æ‰‹åŠ¨å†³å®šè¿™äº› `attribute` èµ‹äºˆç»™å“ªä¸ªå…ƒç´ ã€‚å…·ä½“å¯æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼š[ç¦ç”¨ Attribute ç»§æ‰¿](https://cn.vuejs.org/v2/guide/components-props.html#%E7%A6%81%E7%94%A8-Attribute-%E7%BB%A7%E6%89%BF)

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å®ç°è¿™ä¸€å—çš„åŠŸèƒ½ã€‚

é¦–å…ˆæ˜¯å­ç»„ä»¶ `ValidateInput.vue` ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="validate-input-container pb-3">
    <!-- æ‰‹åŠ¨å¤„ç†æ›´æ–°å’Œå‘é€äº‹ä»¶ -->
    <!-- ä½¿ç”¨å¯é€‰ classï¼Œç”¨äºåŠ¨æ€è®¡ç®—ç±»å -->
    <input
      class="form-control"
      :class="{'is-invalid': inputRef.error}"
      :value="inputRef.val"
      @blur="validateInput"
      @input="updateValue"
      v-bind="$attrs"
    />
    <span v-if="inputRef.error" class="invalid-feedback"
      >{{inputRef.message}}</span
    >
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, PropType } from 'vue';
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
  interface RuleProp {
    type: 'required' | 'email';
    message: string;
    validator?: () => boolean;
  }

  export type RulesProp = RuleProp[];
  export default defineComponent({
    name: 'ValidateInput',
    props: {
      rules: Array as PropType<RulesProp>,
      modelValue: String,
    },
    // å¦‚æœä¸å¸Œæœ›ç»„ä»¶çš„æ ¹å…ƒç´ ç»§æ‰¿attributeï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ç»„ä»¶çš„é€‰é¡¹ä¸­è®¾ç½®ä»¥ä¸‹å±æ€§
    inheritAttrs: false,
    setup(props, context) {
      // è¾“å…¥æ¡†çš„æ•°æ®
      const inputRef = reactive({
        val: props.modelValue || '',
        error: false,
        message: '',
      });

      // $attrsåŒ…è£¹ç€ä¼ é€’ç»™ç»„ä»¶çš„attributeçš„é”®å€¼å¯¹
      // console.log(context.attrs)

      // KeyboardEvent å³é”®ç›˜è¾“å…¥äº‹ä»¶
      const updateValue = (e: KeyboardEvent) => {
        const targetValue = (e.target as HTMLInputElement).value;
        inputRef.val = targetValue;
        context.emit('update:modelValue', targetValue);
      };
      // éªŒè¯è¾“å…¥æ¡†
      const validateInput = () => {
        if (props.rules) {
          const allPassed = props.rules.every((rule) => {
            let passed = true;
            inputRef.message = rule.message;
            switch (rule.type) {
              case 'required':
                passed = inputRef.val.trim() !== '';
                break;
              case 'email':
                passed = emailReg.test(inputRef.val);
                break;
              default:
                break;
            }
            return passed;
          });
          inputRef.error = !allPassed;
        }
      };
      return {
        inputRef,
        validateInput,
        updateValue,
      };
    },
  });
</script>
```

ä¹‹åæ˜¯çˆ¶ç»„ä»¶ `App.vue` ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <form action="">
      <div class="mb-3">
        <label class="form-label">é‚®ç®±åœ°å€</label>
        <!-- éœ€è¦è®©placeholderç»™æ·»åŠ åˆ°å­ç»„ä»¶çš„inputå…ƒç´ ä¸Šå»ï¼Œè€Œä¸æ˜¯æ·»åŠ åˆ°æ ¹å…ƒç´ ä¸Š -->
        <validate-input
          :rules="emailRules"
          v-model="emailVal"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
          type="text"
        />
      </div>
      <div class="mb-3">
        <label class="form-label">å¯†ç </label>
        <validate-input
          type="password"
          placeholder="è¯·è¾“å…¥å¯†ç "
          :rules="passwordRules"
          v-model="passwordVal"
        />
      </div>
    </form>
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, ref } from 'vue';
  import 'bootstrap/dist/css/bootstrap.min.css';
  import ValidateInput, { RulesProp } from './components/ValidateInput.vue';
  import GlobalHeader, { UserProps } from './components/GlobalHeader.vue';
  const currentUser: UserProps = {
    isLogin: true,
    name: 'Monday',
  };

  export default defineComponent({
    name: 'App',
    components: {
      GlobalHeader,
      ValidateInput,
    },
    setup() {
      const emailVal = ref('');
      const emailRules: RulesProp = [
        { type: 'required', message: 'ç”µå­é‚®ç®±ä¸èƒ½ä¸ºç©º' },
        { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼' },
      ];
      const passwordVal = ref('');
      const passwordRules: RulesProp = [
        { type: 'required', message: 'å¯†ç ä¸èƒ½ä¸ºç©º' },
      ];
      return {
        user: currentUser,
        emailRules,
        emailVal,
        passwordVal,
        passwordRules,
      };
    },
  });
</script>
```

ä»ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œé€šè¿‡ `inheritAttrs: false` å’Œ `$attrs` ï¼Œå®ç°äº†æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚

æˆ‘ä»¬ç°åœ¨æ¥çœ‹ä¸‹æµè§ˆå™¨çš„**æ˜¾ç¤ºç»“æœï¼š**

![ä½¿ç”¨$sttrsæ”¯æŒé»˜è®¤å±æ€§](https://img-blog.csdnimg.cn/dc0ad9b90bcb45bd9103a8cb49fbeade.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5pif5pyf5LiA56CU56m25a6k,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)

# ğŸ’­ äºŒã€éªŒè¯è¡¨å• ValidateForm

## 1. ç»„ä»¶éœ€æ±‚åˆ†æ

`ValidateInput` é™¤äº†åŸºæœ¬çš„åŠŸèƒ½å¤–ï¼Œè¿˜å¯ä»¥è¿›è¡ŒåŠŸèƒ½æ‰©æ•£ã€‚æ¯”å¦‚ï¼Œè‡ªå®šä¹‰æ ¡éªŒã€æ›´å¤šäº‹ä»¶ã€æ›´å¤šä¸åŒçš„éªŒè¯å…ƒç´ ã€‚

é‚£ä¹ˆä¸‹é¢ï¼Œæˆ‘ä»¬è¦æ¥è®¾è®¡æ•´ä¸ª**éªŒè¯è¡¨å•**ï¼Œä¹Ÿå°±æ˜¯ `ValidateForm` ç»„ä»¶ï¼Œå¹¶ä¸”å°† `ValidateInput` ç»™å¯¹åº”çš„ä½¿ç”¨åˆ°å…¶ä¸­ã€‚

æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹è¿™ä¸ª `ValidateForm` éƒ½æœ‰å“ªäº›å†…å®¹ã€‚**å…ˆçœ‹ä¸‹å›¾ï¼š**

![ValidateFormåˆ†æ](https://img-blog.csdnimg.cn/9b55811c721346588a9dca1a85287f40.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5pif5pyf5LiA56CU56m25a6k,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center)

å…ˆçœ‹**ç¬¬ä¸€éƒ¨åˆ†**ï¼Œæˆ‘ä»¬é¦–å…ˆæŠŠå‰é¢æˆ‘ä»¬å°è£…çš„ `ValidateInput` ç»™æ”¾è¿›å»ï¼Œè¿›è¡Œè¯­ä¹‰åŒ–åŒ…è£¹ã€‚

**ç¬¬äºŒéƒ¨åˆ†**ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æäº¤çš„æŒ‰é’®è¿›è¡Œè‡ªå®šä¹‰åŒ–ï¼Œæ¯”å¦‚æäº¤çš„æ–‡å­—æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæäº¤çš„æŒ‰é’®åˆæ˜¯æ€ä¹ˆæ ·çš„ã€‚

**ç¬¬ä¸‰éƒ¨åˆ†**ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ªç¡®å®šçš„äº‹ä»¶æ¥è§¦å‘æœ€åçš„ç»“æœï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åœ¨ `ValidateForm` ä¸­ï¼Œè·å–æœ€åçš„ç»“æœã€‚

**ç¬¬å››éƒ¨åˆ†**ï¼Œç®—æ˜¯ä¸€ä¸ªéšè—åŠŸèƒ½ï¼Œä¹Ÿæ˜¯è¿™ä¸ªç»„ä»¶çš„ä¸€ä¸ªéš¾ç‚¹ï¼Œå³è·å–æ¯ä¸ª `ValidateForm` åŒ…è£¹ä¸‹çš„ `ValidateInput` çš„éªŒè¯ç»“æœã€‚

okï¼Œåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ç®€å•çš„å¯¹ `ValidateForm` è¿›è¡Œä¸€ä¸ªåˆ†æï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°†ä¸€æ­¥æ­¥çš„æ¥å¯¹å…¶è¿›è¡Œä»£ç è®¾è®¡ã€‚

## 2. ä½¿ç”¨æ’æ§½ slot

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å…ˆå°†æäº¤æŒ‰é’®ï¼ŒåšæˆåŠ¨æ€çš„ã€‚ä¸€å¼€å§‹åˆå§‹åŒ–ä¸€ä¸ªå€¼ï¼Œä¹‹åå‘¢ï¼Œå¯ä»¥**åŠ¨æ€çš„æ”¹å˜æŒ‰é’®çš„æ–‡å­—å’Œäº‹ä»¶**ã€‚é‚£è¿™ä¸ªè¦ç”¨åˆ°çš„å°±æ˜¯ `vue` çš„ä¸­**å…·åæ’æ§½** ã€‚

æˆ‘ä»¬å…ˆåœ¨ `vue3` é¡¹ç›®ä¸‹çš„ `src|components` å®šä¹‰ä¸€ä¸ªå­ç»„ä»¶ï¼Œå‘½åä¸º `ValidateForm.vue` ã€‚ç°åœ¨æˆ‘ä»¬æ¥è®¾è®¡å®ƒï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <form class="validate-form-container">
    <slot name="default"></slot>
    <!-- @click.prevent ç”¨æ¥é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸º -->
    <!-- é˜»æ­¢è¡¨å•æäº¤ï¼Œä»…æ‰§è¡Œå‡½æ•°submitForm -->
    <div class="submit-area" @click.prevent="submitForm">
      <slot name="submit">
        <!-- ç»™æ’æ§½æ·»åŠ ä¸€ä¸ªé»˜è®¤æŒ‰é’® -->
        <button type="submit" class="btn btn-primary">æäº¤</button>
      </slot>
    </div>
  </form>
</template>

<script lang="ts">
  import { defineComponent, onUnmounted } from 'vue';

  export default defineComponent({
    name: 'ValidateForm',
    components: {},
    // åœ¨emitså­—æ®µé‡Œé¢ç¡®å®šæ‰€è¦å‘é€äº‹ä»¶çš„åç§°
    emits: ['form-submit'],
    setup(props, context) {
      const submitForm = () => {
        context.emit('form-submit', true);
      };
      return {
        submitForm,
      };
    },
  });
</script>
```

ç»§ç»­ï¼Œæˆ‘ä»¬åœ¨ `App.vue` ä¸­ä½¿ç”¨å­ç»„ä»¶ `ValidateForm.vue` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <validate-form @form-submit="onFormSubmit">
      <div class="mb-3">
        <label class="form-label">é‚®ç®±åœ°å€</label>
        <!-- éœ€è¦è®©placeholderå’Œclassç»™æ·»åŠ åˆ°inputå…ƒç´ ä¸Šå»ï¼Œè€Œä¸æ˜¯æ·»åŠ åˆ°æ ¹å…ƒç´ ä¸Š -->
        <validate-input
          :rules="emailRules"
          v-model="emailVal"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
          type="text"
        />
      </div>
      <div class="mb-3">
        <label class="form-label">å¯†ç </label>
        <validate-input
          type="password"
          placeholder="è¯·è¾“å…¥å¯†ç "
          :rules="passwordRules"
          v-model="passwordVal"
        />
      </div>
      <template #submit>
        <span class="btn btn-danger">Submit</span>
      </template>
    </validate-form>
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, ref } from 'vue';
  import 'bootstrap/dist/css/bootstrap.min.css';
  // import ColumnList, { ColumnProps } from './components/ColumnList.vue'
  import ValidateInput, { RulesProp } from './components/ValidateInput.vue';
  import ValidateForm from './components/ValidateForm.vue';
  import GlobalHeader, { UserProps } from './components/GlobalHeader.vue';
  const currentUser: UserProps = {
    isLogin: true,
    name: 'Monday',
  };

  export default defineComponent({
    name: 'App',
    components: {
      // ColumnList,
      GlobalHeader,
      ValidateInput,
      ValidateForm,
    },
    setup() {
      const emailVal = ref('');
      const emailRules: RulesProp = [
        { type: 'required', message: 'ç”µå­é‚®ç®±ä¸èƒ½ä¸ºç©º' },
        { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼' },
      ];
      const passwordVal = ref('');
      const passwordRules: RulesProp = [
        { type: 'required', message: 'å¯†ç ä¸èƒ½ä¸ºç©º' },
      ];
      // åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç›‘å¬ç»“æœ
      const onFormSubmit = (result: boolean) => {
        console.log('1234', result);
      };
      return {
        user: currentUser,
        emailRules,
        emailVal,
        passwordVal,
        passwordRules,
        onFormSubmit,
      };
    },
  });
</script>
```

å¯¹äºä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬æ¥åšä¸ªç®€å•çš„åˆ†æï¼š

- å­ç»„ä»¶é€šè¿‡ `emits` æ¥ç¡®å®šè¦å‘é€ç»™çˆ¶ç»„ä»¶çš„äº‹ä»¶åç§°ï¼Œä¹‹åå‘¢ï¼Œçˆ¶ç»„ä»¶é€šè¿‡ `@äº‹ä»¶åç§°` çš„æ–¹å¼æ¥è¿›è¡Œè°ƒç”¨ã€‚
- ä½¿ç”¨**å…·åæ’æ§½ slot**ï¼Œæ¥å¯¹æäº¤è¡¨å•éƒ¨åˆ†è¿›è¡ŒåŠ¨æ€æ§åˆ¶ã€‚å­ç»„ä»¶ä½¿ç”¨ `slot` è¿›è¡Œåˆå§‹åŒ–ï¼Œçˆ¶ç»„ä»¶ä½¿ç”¨ `template` è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ã€‚

## 3. çˆ¶å­ç»„ä»¶é€šè®¯

ä¸Šé¢æˆ‘ä»¬è§£å†³äº†ç¬¬ `1` ç‚¹ï¼Œç»„ä»¶éœ€æ±‚åˆ†æä¸­çš„å‰ä¸‰éƒ¨åˆ†ã€‚é‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ç¬¬å››ç‚¹ï¼Œå¦‚ä½•åœ¨ `ValidateForm` ä¸­å®Œæˆæ‰€æœ‰ `ValidateInput` çš„éªŒè¯ã€‚

æˆ‘ä»¬å…ˆæ¥å®Œå–„çˆ¶ç»„ä»¶ `ValidateForm.vue` çš„åŠŸèƒ½ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <form class="validate-form-container">
    <slot name="default"></slot>
    <!-- @click.prevent ç”¨æ¥é˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸º -->
    <!-- é˜»æ­¢è¡¨å•æäº¤ï¼Œä»…æ‰§è¡Œå‡½æ•°submitForm -->
    <div class="submit-area" @click.prevent="submitForm">
      <slot name="submit">
        <!-- ç»™æ’æ§½æ·»åŠ ä¸€ä¸ªé»˜è®¤æŒ‰é’® -->
        <button type="submit" class="btn btn-primary">æäº¤</button>
      </slot>
    </div>
  </form>
</template>

<script lang="ts">
  import { defineComponent, onUnmounted } from 'vue';
  // ä½¿ç”¨ mitt
  import mitt from 'mitt';
  type ValidateFunc = () => boolean;
  // åˆ›å»ºä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨
  export const emitter = mitt();

  export default defineComponent({
    name: 'ValidateForm',
    components: {},
    // åœ¨emitså­—æ®µé‡Œé¢ç¡®å®šæ‰€è¦å‘é€äº‹ä»¶çš„åç§°
    // æ³¨æ„ï¼šåªèƒ½ç”¨å…¨éƒ¨å°å†™æˆ–è€…é©¼å³°æ³•
    emits: ['formSubmit'],
    setup(props, context) {
      // ç”¨äºå­˜æ”¾ä¸€ç³»åˆ—çš„å‡½æ•°ï¼Œæ‰§è¡Œä»¥åå¯ä»¥æ˜¾ç¤ºé”™è¯¯çš„ä¿¡æ¯
      let funcArr: ValidateFunc[] = [];
      const submitForm = () => {
        const result = funcArr.map((func) => func()).every((result) => result);
        // å°†formSubmitæ—¶é—´è¿›è¡Œå‘é€
        context.emit('formSubmit', result);
      };
      // func å³éœ€è¦æ¥æ”¶é”™è¯¯ä¿¡æ¯
      const callback = (func?: ValidateFunc) => {
        if (func) {
          funcArr.push(func);
        }
      };
      // ç›‘å¬å™¨å°±åƒæ˜¯ä¸€ä¸ªæ”¶éŸ³æœºä¸€æ ·åœ¨ç­‰å¾…ä¿¡æ¯
      emitter.on('form-item-created', callback);
      onUnmounted(() => {
        emitter.off('form-item-created', callback);
        funcArr = [];
      });
      return {
        submitForm,
      };
    },
  });
</script>
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ `mitt` åº“åˆ›å»ºäº†ä¸€ä¸ªäº‹ä»¶ç›‘å¬å™¨ `emitter` ï¼Œä¾›ç»™å®ƒçš„å­ç»„ä»¶ `ValidateInput.vue` ä½¿ç”¨ã€‚åŒæ—¶ï¼Œåˆ›å»ºäº†ä¸€ä¸ª `formSubmit` äº‹ä»¶ï¼Œç”¨äºç»™å®ƒçš„çˆ¶ç»„ä»¶ `App.vue` ä½¿ç”¨ã€‚

æ¥ç€æˆ‘ä»¬æ¥å®Œå–„å­ç»„ä»¶ `ValidateInput.vue` çš„åŠŸèƒ½ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="validate-input-container pb-3">
    <!-- æ‰‹åŠ¨å¤„ç†æ›´æ–°å’Œå‘é€äº‹ä»¶ -->
    <!-- ä½¿ç”¨å¯é€‰ classï¼Œç”¨äºåŠ¨æ€è®¡ç®—ç±»å -->
    <input
      class="form-control"
      :class="{'is-invalid': inputRef.error}"
      :value="inputRef.val"
      @blur="validateInput"
      @input="updateValue"
      v-bind="$attrs"
    />
    <span v-if="inputRef.error" class="invalid-feedback"
      >{{inputRef.message}}</span
    >
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, PropType, onMounted } from 'vue';
  import { emitter } from './ValidateForm.vue';
  const emailReg =
    /^[a-zA-Z0-9.!#$%&â€™*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;
  interface RuleProp {
    type: 'required' | 'email';
    message: string;
    validator?: () => boolean;
  }

  export type RulesProp = RuleProp[];
  export default defineComponent({
    name: 'ValidateInput',
    props: {
      rules: Array as PropType<RulesProp>,
      modelValue: String,
    },
    inheritAttrs: false,
    setup(props, context) {
      const inputRef = reactive({
        val: props.modelValue || '',
        error: false,
        message: '',
      });
      const updateValue = (e: KeyboardEvent) => {
        const targetValue = (e.target as HTMLInputElement).value;
        inputRef.val = targetValue;
        context.emit('update:modelValue', targetValue);
      };
      // éªŒè¯è¾“å…¥æ¡†
      const validateInput = () => {
        if (props.rules) {
          const allPassed = props.rules.every((rule) => {
            let passed = true;
            inputRef.message = rule.message;
            switch (rule.type) {
              case 'required':
                passed = inputRef.val.trim() !== '';
                break;
              case 'email':
                passed = emailReg.test(inputRef.val);
                break;
              default:
                break;
            }
            return passed;
          });
          inputRef.error = !allPassed;
          return allPassed;
        }
        return true;
      };
      onMounted(() => {
        // // å°† input çš„å€¼å‘é€å‡ºå»ï¼Œå³å‘ç»™ç»™ ValidateForm ç»„ä»¶
        emitter.emit('form-item-created', validateInput);
      });
      return {
        inputRef,
        validateInput,
        updateValue,
      };
    },
  });
</script>
```

æœ‰äº† `emitter` ä¹‹åï¼Œ `ValidateInput` å°±åœ¨æ…¢æ…¢åœ°æŠŠå®ƒçš„æ¶ˆæ¯ä¼ å»ç»™å®ƒçš„è€çˆ¶äº²ï¼Œä¹Ÿå°±æ˜¯ `ValidateForm` ã€‚

æœ€åï¼Œæˆ‘ä»¬åœ¨ `App.vue` ä¸­è¿›è¡Œè°ƒç”¨ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <div class="container">
    <global-header :user="user"></global-header>
    <!-- å°† ValidateForm ä¸­çš„ formSubmit äº‹ä»¶ç»™ä¼ è¿‡æ¥åˆ°è¿™é‡Œä½¿ç”¨ -->
    <validate-form @formSubmit="onFormSubmit">
      <div class="mb-3">
        <label class="form-label">é‚®ç®±åœ°å€</label>
        <validate-input
          :rules="emailRules"
          v-model="emailVal"
          placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€"
          type="text"
          ref="inputRef"
        />
      </div>
      <div class="mb-3">
        <label class="form-label">å¯†ç </label>
        <validate-input
          type="password"
          placeholder="è¯·è¾“å…¥å¯†ç "
          :rules="passwordRules"
          v-model="passwordVal"
        />
      </div>
      <template #submit>
        <span class="btn btn-danger">Submit</span>
      </template>
    </validate-form>
  </div>
</template>

<script lang="ts">
  import { defineComponent, reactive, ref } from 'vue';
  import 'bootstrap/dist/css/bootstrap.min.css';
  import ValidateInput, { RulesProp } from './components/ValidateInput.vue';
  import ValidateForm from './components/ValidateForm.vue';
  import GlobalHeader, { UserProps } from './components/GlobalHeader.vue';
  const currentUser: UserProps = {
    isLogin: true,
    name: 'Monday',
  };

  export default defineComponent({
    name: 'App',
    components: {
      // ColumnList,
      GlobalHeader,
      ValidateInput,
      ValidateForm,
    },
    setup() {
      // ç”¨äºæ‹¿åˆ°ç»„ä»¶çš„å®ä¾‹
      const inputRef = ref<any>();
      const emailVal = ref('');
      const emailRules: RulesProp = [
        { type: 'required', message: 'ç”µå­é‚®ç®±ä¸èƒ½ä¸ºç©º' },
        { type: 'email', message: 'è¯·è¾“å…¥æ­£ç¡®çš„ç”µå­é‚®ç®±æ ¼å¼' },
      ];
      const passwordVal = ref('');
      const passwordRules: RulesProp = [
        { type: 'required', message: 'å¯†ç ä¸èƒ½ä¸ºç©º' },
      ];
      // åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥ç›‘å¬ç»“æœ
      const onFormSubmit = (result: boolean) => {
        console.log('result', result); // result true
      };
      return {
        user: currentUser,
        emailRules,
        emailVal,
        passwordVal,
        passwordRules,
        onFormSubmit,
        inputRef,
      };
    },
  });
</script>
```

è¿™éƒ¨åˆ†å‘¢ï¼Œæˆ‘ä»¬æˆåŠŸè°ƒç”¨äº† `formSubmit` äº‹ä»¶ï¼Œå¹¶å°†å…¶è¿›è¡Œç›‘å¬ã€‚

å¥½äº†ï¼Œåˆ°æ­¤ï¼Œæˆ‘ä»¬çš„è¡¨å•éªŒè¯ç»„ä»¶è®¾è®¡å°±å®Œæˆå•¦ï¼ä¸çŸ¥é“å¤§å®¶æ˜¯å¦å¯¹è¿™ç§è®¾è®¡æ€æƒ³æœ‰äº†ä¸€ä¸ªæ–°çš„è®¤è¯†å‘¢ï¼Ÿ

# ğŸ‘ï¸â€ğŸ—¨ï¸ å››ã€ç»“æŸè¯­

åœ¨ä¸Šé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°äº† `Web` ä¸–ç•Œä¸­çš„è¡¨å•å…ƒç´ ã€‚ä»éªŒè¯è¾“å…¥æ¡† `ValidateInut` çš„æŠ½è±¡éªŒè¯è§„åˆ™ï¼Œå¯¹ `v-model` è¿›è¡Œé‡æ–°è®¾è®¡ï¼Œä»¥åŠä½¿ç”¨ `$attrs` æ¥æ”¯æŒé»˜è®¤å±æ€§ã€‚å†åˆ° `ValidateForm` çš„ä½¿ç”¨å…·åæ’æ§½è®©æäº¤æŒ‰é’®é«˜åº¦è‡ªå®šä¹‰åŒ–ï¼Œå†åˆ°æœ€åçš„ `input` ä¹‹å‰çš„çˆ¶å­ç»„ä»¶é€šè®¯ã€‚

æ•´ä¸ªè¿‡ç¨‹ç»†æ°´é•¿æµï¼Œä½†ä¹Ÿæœ‰å¾ˆå¤šæ–°çš„è®¾è®¡æ€æƒ³å€¼å¾—æˆ‘ä»¬å»æ¥·æ¨¡å’Œå­¦ä¹ ~

åˆ°è¿™é‡Œï¼Œå…³äºæœ¬æ–‡çš„è®²è§£å°±ç»“æŸå•¦~

å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°æ‚¨çš„çš„è¯ä¸å¦¨ç‚¹èµæ”¯æŒä¸€ä¸‹å“Ÿ~~ğŸ˜›

# ğŸ’¯ å¾€æœŸæ¨è

ğŸ‘‰[å‰ç«¯åªæ˜¯åˆ‡å›¾ä»”ï¼Ÿæ¥å­¦å­¦ç»™å¼€å‘äººçœ‹çš„ UI è®¾è®¡](https://juejin.cn/post/7001989357980631076)

ğŸ‘‰[ç´§è·Ÿæœˆå½±å¤§ä½¬çš„æ­¥ä¼ï¼Œä¸€èµ·æ¥å­¦ä¹ å¦‚ä½•å†™å¥½ JSï¼ˆä¸Šï¼‰](https://juejin.cn/post/7007988121107169287)

ğŸ‘‰[ç´§è·Ÿæœˆå½±å¤§ä½¬çš„æ­¥ä¼ï¼Œä¸€èµ·æ¥å­¦ä¹ å¦‚ä½•å†™å¥½ JSï¼ˆä¸‹ï¼‰](https://juejin.cn/post/7008381454614790158)

ğŸ‘‰[ç»„ä»¶åº“å®æˆ˜ | ç”¨ vue3+ts å®ç°å…¨å±€ Header å’Œåˆ—è¡¨æ•°æ®æ¸²æŸ“ ColumnList](https://juejin.cn/post/6984268372930199583)

---
title: æ•²é»‘æ¿ï¼vue3é‡ç‚¹ï¼ä¸€æ–‡äº†è§£Composition APIæ–°ç‰¹æ€§ï¼šrefã€toRefã€toRefs
author: å‘¨ä¸€
date: '2021-06-23'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - vue.js
sidebar: 'auto'
---

# å‰è¨€

åœ¨[ä¸Šä¸€ç¯‡æ–‡ç« ](https://blog.csdn.net/weixin_44803753/article/details/117880811)ä¸­ï¼Œæˆ‘ä»¬åˆæ­¥äº†è§£äº† vue3 çš„æ–°ç‰¹æ€§ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬å°†å»¶ç»­**Composition API**çš„è¯é¢˜ï¼Œæ¥äº†è§£**Composition API**å¸¦æ¥çš„æ–°ç‰¹æ€§ï¼š `ref` ã€ `toRef` å’Œ `toRefs` ã€‚

ä¸‹é¢å¼€å§‹è¿›å…¥æœ¬æ–‡çš„è®²è§£ âœ¨

# ä¸€ã€ğŸ™ å¦‚ä½•ç†è§£ refã€toRef å’Œ toRefs

## 1ã€refã€toRef å’Œ toRefs æ˜¯ä»€ä¹ˆ

### ï¼ˆ1ï¼‰ref

#### 1ï¼‰ref æ˜¯ä»€ä¹ˆ

- `ref` å¯ä»¥ç”Ÿæˆ `å€¼ç±»å‹`ï¼ˆå³åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ çš„å“åº”å¼æ•°æ®ï¼›
- `ref` å¯ä»¥ç”¨äº**æ¨¡æ¿**å’Œ**reative**ï¼›
- `ref` é€šè¿‡ `.value` æ¥ä¿®æ”¹å€¼ï¼ˆä¸€å®šè¦è®°å¾—åŠ ä¸Š `.value` ï¼‰ï¼›
- `ref` ä¸ä»…å¯ä»¥ç”¨äº**å“åº”å¼**ï¼Œè¿˜å¯ä»¥ç”¨äºæ¨¡æ¿çš„ `DOM` å…ƒç´ ã€‚

#### 2ï¼‰ä¸¾ä¸ªä¾‹å­ ğŸŒ°

å‡è®¾æˆ‘ä»¬å®šä¹‰äº†ä¸¤ä¸ªå€¼ç±»å‹çš„æ•°æ®ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå®šæ—¶å™¨æ¥çœ‹å®ƒå“åº”å¼å‰åçš„æ•ˆæœã€‚**æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š**

```html
<template>
  <p>ref demo {{ageRef}} {{state.name}}</p>
</template>

<script>
  import { ref, reactive } from 'vue';

  export default {
    name: 'Ref',
    setup() {
      const ageRef = ref(18);
      const nameRef = ref('monday');

      const state = reactive({
        name: nameRef,
      });

      setTimeout(() => {
        console.log('ageRef', ageRef.value, 'nameRef', nameRef.value);
        ageRef.value = 20;
        nameRef.value = 'mondaylab';
        console.log('ageRef', ageRef.value, 'nameRef', nameRef.value);
      }, 1500);

      return {
        ageRef,
        state,
      };
    },
  };
</script>
```

**åˆ«çœ¨çœ¼ï¼Œæ¥çœ‹ä¸‹æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![ref](https://img-blog.csdnimg.cn/20210613164358527.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæ§åˆ¶å°å…ˆåæ‰“å°çš„é¡ºåºæ˜¯**å“åº”å¼å‰çš„æ•°æ®**å’Œ**å“åº”å¼åçš„æ•°æ®**ã€‚å› æ­¤ï¼Œé€šè¿‡ `ref` ï¼Œå¯ä»¥å®ç°**å€¼ç±»å‹çš„æ•°æ®å“åº”å¼**ã€‚

---

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ `ref` ä¸ä»…å¯ä»¥å®ç°å“åº”å¼ï¼Œè¿˜å¯ä»¥ç”¨äº**æ¨¡æ¿çš„ DOM å…ƒç´ **ã€‚**æˆ‘ä»¬ç”¨ä¸€æ®µä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š**

```html
<template>
  <p ref="elemRef">ä»Šå¤©æ˜¯å‘¨ä¸€</p>
</template>

<script>
  import { ref, onMounted } from 'vue';

  export default {
    name: 'RefTemplate',
    setup() {
      const elemRef = ref(null);

      onMounted(() => {
        console.log('ref template', elemRef.value.innerHTML, elemRef.value);
      });

      return {
        elemRef,
      };
    },
  };
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š**

![ref](https://img-blog.csdnimg.cn/20210613164409193.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

æˆ‘ä»¬é€šè¿‡åœ¨æ¨¡æ¿ä¸­ç»‘å®šä¸€ä¸ª `ref` ï¼Œä¹‹ååœ¨ç”Ÿå‘½å‘¨æœŸä¸­è°ƒç”¨ï¼Œæœ€åæµè§ˆå™¨æ˜¾ç¤ºå‡ºè¯¥ `DOM` å…ƒç´ ã€‚æ‰€ä»¥è¯´ï¼Œ `ref` ä¹Ÿå¯ä»¥ç”¨æ¥**æ¸²æŸ“æ¨¡æ¿ä¸­çš„ DOM å…ƒç´ **ã€‚

### ï¼ˆ2ï¼‰toRef æ˜¯ä»€ä¹ˆ

#### 1ï¼‰toRef æ˜¯ä»€ä¹ˆ

- `toRef` å¯ä»¥å“åº”å¯¹è±¡ `Object` ï¼Œå…¶é’ˆå¯¹çš„æ˜¯æŸä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼ˆ `reactive` å°è£…ï¼‰çš„å±æ€§`prop` ã€‚
- `toRef` å’Œå¯¹è±¡ `Object` ä¸¤è€…**ä¿æŒå¼•ç”¨å…³ç³»**ï¼Œå³ä¸€ä¸ªæ”¹å®Œå¦å¤–ä¸€ä¸ªä¹Ÿè·Ÿç€æ”¹ã€‚

- `toRef` å¦‚æœç”¨äºæ™®é€šå¯¹è±¡ï¼ˆéå“åº”å¼å¯¹è±¡ï¼‰ï¼Œäº§å‡ºçš„ç»“æœä¸å…·å¤‡å“åº”å¼ã€‚**å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š**

```js
//æ™®é€šå¯¹è±¡
const state = {
  age: 20,
  name: 'monday',
};
//å“åº”å¼å¯¹è±¡
const state = reactive({
  age: 20,
  name: 'monday',
});
```

#### 2ï¼‰ä¸¾ä¸ªä¾‹å­ ğŸŒ°

å¯¹äºä¸€ä¸ªæ™®é€šå¯¹è±¡æ¥è¯´ï¼Œå¦‚æœè¿™ä¸ªæ™®é€šå¯¹è±¡è¦å®ç°å“åº”å¼ï¼Œå°±ç”¨ `reactive` ã€‚ç”¨äº† `reactive` ä¹‹åï¼Œå®ƒå°±åœ¨å“åº”å¼å¯¹è±¡é‡Œé¢ã€‚é‚£ä¹ˆåœ¨ ä¸€ä¸ªå“åº”å¼å¯¹è±¡é‡Œé¢ï¼Œå¦‚æœå…¶ä¸­æœ‰**ä¸€ä¸ªå±æ€§**è¦æ‹¿å‡ºæ¥å•ç‹¬åšå“åº”å¼çš„è¯ï¼Œå°±ç”¨ `toRef` ã€‚æ¥ä¸¾ä¸ªä¾‹å­çœ‹ä¸€çœ‹ï¼š

```html
<template>
  <p>toRef demo - {{ageRef}} - {{state.name}} {{state.age}}</p>
</template>

<script>
  import { ref, toRef, reactive, computed } from 'vue';

  export default {
    name: 'ToRef',
    setup() {
      const state = reactive({
        age: 18,
        name: 'monday',
      });

      // // toRef å¦‚æœç”¨äºæ™®é€šå¯¹è±¡ï¼ˆéå“åº”å¼å¯¹è±¡ï¼‰ï¼Œäº§å‡ºçš„ç»“æœä¸å…·å¤‡å“åº”å¼
      // const state = {
      //     age: 18,
      //     name: 'monday'
      // }

      //å®ç°æŸä¸€ä¸ªå±æ€§çš„æ•°æ®å“åº”å¼
      const ageRef = toRef(state, 'age');

      setTimeout(() => {
        state.age = 20;
      }, 1500);

      setTimeout(() => {
        ageRef.value = 25; // .value ä¿®æ”¹å€¼
      }, 3000);

      return {
        state,
        ageRef,
      };
    },
  };
</script>
```

**æ­¤æ—¶æˆ‘ä»¬æ¥çœ‹ä¸‹æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![toRef](https://img-blog.csdnimg.cn/20210613164420584.gif#pic_center)

æˆ‘ä»¬é€šè¿‡ `reactive` æ¥åˆ›å»ºä¸€ä¸ª**å“åº”å¼å¯¹è±¡**ï¼Œä¹‹åå‘¢ï¼Œå¦‚æœåªå•ç‹¬è¦å¯¹å“åº”å¼å¯¹è±¡é‡Œé¢çš„**æŸä¸€ä¸ªå±æ€§**è¿›è¡Œå“åº”å¼ï¼Œé‚£ä¹ˆä½¿ç”¨`toRef` æ¥è§£å†³ã€‚ç”¨ `toRef(Object, prop)` çš„å½¢å¼æ¥ä¼ **å¯¹è±¡å**å’Œ**å…·ä½“çš„å±æ€§å**ï¼Œè¾¾åˆ°æŸä¸ªå±æ€§æ•°æ®å“åº”å¼çš„æ•ˆæœã€‚

### ï¼ˆ3ï¼‰toRefs æ˜¯ä»€ä¹ˆ

#### 1ï¼‰toRefs æ˜¯ä»€ä¹ˆ

- ä¸ `toRef` ä¸ä¸€æ ·çš„æ˜¯ï¼Œ `toRefs` æ˜¯é’ˆå¯¹æ•´ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç›®æ ‡åœ¨äºå°†å“åº”å¼å¯¹è±¡ï¼ˆ `reactive` å°è£…ï¼‰è½¬æ¢ä¸ºæ™®é€šå¯¹è±¡
- æ™®é€šå¯¹è±¡é‡Œçš„æ¯ä¸€ä¸ªå±æ€§ `prop` éƒ½å¯¹åº”ä¸€ä¸ª `ref`
- `toRefs` å’Œå¯¹è±¡ `Object` ä¸¤è€…**ä¿æŒå¼•ç”¨å…³ç³»**ï¼Œå³ä¸€ä¸ªæ”¹å®Œå¦å¤–ä¸€ä¸ªä¹Ÿè·Ÿç€æ”¹ã€‚

#### 2ï¼‰ä¸¾ä¸ªä¾‹å­ ğŸŒ°

å‡è®¾æˆ‘ä»¬è¦å°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡é‡Œé¢çš„æ‰€æœ‰å…ƒç´ å–å‡ºæ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå¤„ç†ã€‚**ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <p>toRefs demo {{state.age}} {{state.name}}</p>
</template>

<script>
  import { ref, toRef, toRefs, reactive } from 'vue';

  export default {
    name: 'ToRefs',
    setup() {
      const state = reactive({
        age: 20,
        name: 'monday',
      });

      return {
        state,
      };
    },
  };
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š**

![toRefs](https://img-blog.csdnimg.cn/20210613164432416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

ä½†æ˜¯è¿™æ ·å­å¥½åƒæœ‰ç‚¹ç•¥æ˜¾éº»çƒ¦ï¼Œå› ä¸ºåœ¨æ¨¡æ¿ç¼–è¯‘çš„æ—¶å€™ä¸€ç›´è¦ `state.` ï¼Œè¿™æ ·å¦‚æœé‡åˆ°è¦å–å¾ˆå¤šä¸ªå±æ€§çš„æ—¶å€™å°±æœ‰ç‚¹è‡ƒè‚¿äº†ã€‚

---

æ—¢ç„¶å¤ªè‡ƒè‚¿äº†ï¼Œé‚£æˆ‘ä»¬æ¢ä¸€ç§æ€è·¯ï¼ŒæŠŠ `state` è¿›è¡Œè§£æ„ã€‚**ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <p>toRefs demo {{age}} {{name}}</p>
</template>

<script>
  import { ref, toRef, toRefs, reactive } from 'vue';

  export default {
    name: 'ToRefs',
    setup() {
      const state = reactive({
        age: 20,
        name: 'monday',
      });

      return {
        ...state,
      };
    },
  };
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š**

![toRefs](https://img-blog.csdnimg.cn/20210613164441647.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œçœ‹èµ·æ¥æ¸…æ™°äº†å¾ˆå¤šã€‚ä½†æ˜¯å‘¢â€¦â€¦å¤©ä¸Šæ€»ä¸ä¼šæœ‰æ— ç¼˜æ— æ•…çš„é¦…é¥¼å‡ºç°ï¼Œå¾—åˆ°ä¸€äº›å¥½å¤„çš„åŒæ—¶æ€»è¦å¤±å»äº›åŸæœ¬æ‹¥æœ‰çš„ä¸œè¥¿ã€‚

---

å¯¹äºè§£æ„åçš„å¯¹è±¡æ¥è¯´ï¼Œå¦‚æœç›´æ¥è§£æ„ `reactive` ï¼Œé‚£ä¹ˆè§£æ„å‡ºæ¥çš„å¯¹è±¡ä¼šç›´æ¥å¤±å»å“åº”å¼ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥æ£€éªŒä¸‹æ•ˆæœï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <p>toRefs demo {{age}} {{name}}</p>
</template>

<script>
  import { ref, toRef, toRefs, reactive } from 'vue';

  export default {
    name: 'ToRefs',
    setup() {
      const state = reactive({
        age: 20,
        name: 'monday',
      });

      setTimeout(() => {
        state.age = 25;
      }, 1500);

      return {
        ...state,
      };
    },
  };
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š**

![toRefs](https://img-blog.csdnimg.cn/20210613164451278.gif#pic_center)

æˆ‘ä»¬ç­‰äº†å¥½å‡ ç§’ä¹‹åï¼Œå‘ç° `age` è¿Ÿè¿Ÿä¸å˜æˆ**25**ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è§£æ„ `reactive` çš„å¯¹è±¡æ—¶ï¼Œå“åº”å¼å°†ä¼šç›´æ¥å¤±å»ã€‚

---

æ‰€ä»¥ï¼Œå°±æ¥åˆ°äº†æˆ‘ä»¬çš„ `toRefs` ã€‚ `toRefs` åœ¨æŠŠå“åº”å¼å¯¹è±¡è½¬å˜ä¸ºæ™®é€šå¯¹è±¡åï¼Œä¸ä¼šä¸¢å¤±æ‰å“åº”å¼çš„åŠŸèƒ½ã€‚å…·ä½“æˆ‘ä»¬**ç”¨ä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š**

```html
<template>
  <p>toRefs demo {{age}} {{name}}</p>
</template>

<script>
  import { ref, toRef, toRefs, reactive } from 'vue';

  export default {
    name: 'ToRefs',
    setup() {
      const state = reactive({
        age: 18,
        name: 'monday',
      });

      const stateAsRefs = toRefs(state); // å°†å“åº”å¼å¯¹è±¡ï¼Œå˜æˆæ™®é€šå¯¹è±¡

      setTimeout(() => {
        console.log('age', state.age, 'name', state.name);
        (state.age = 20), (state.name = 'å‘¨ä¸€');
        console.log('age', state.age, 'name', state.name);
      }, 1500);

      return stateAsRefs;
    },
  };
</script>
```

**æ­¤æ—¶æˆ‘ä»¬è§‚å¯Ÿæµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![toRefs](https://img-blog.csdnimg.cn/20210613164500692.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œç”¨äº† `toRefs` ï¼Œæ™®é€šå¯¹è±¡çš„å€¼æˆåŠŸè¢«å–å‡ºæ¥äº†ï¼Œå¹¶ä¸”è¿˜**ä¸ä¼šä¸¢å¤±å“åº”å¼çš„åŠŸèƒ½**ï¼Œè¯¥æ”¹å˜çš„å€¼ä¸€ä¸ªä¹Ÿä¸å°‘ã€‚

### ï¼ˆ4ï¼‰åˆæˆå‡½æ•°è¿”å›å“åº”å¼å¯¹è±¡

äº†è§£äº†ä¸Šé¢ä¸‰ç§ç±»å‹çš„ä½¿ç”¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ç§åœºæ™¯ï¼š**åˆæˆå‡½æ•°å¦‚ä½•è¿”å›å“åº”å¼å¯¹è±¡**ã€‚**ä¸‹é¢é™„ä¸Šä»£ç ï¼š**

```js
function useFeatureX() {
  const state = reactive({
    x: 1,
    y: 2,
  });
  //é€»è¾‘è¿è¡ŒçŠ¶æ€ï¼Œâ€¦â€¦
  //è¿”å›æ—¶è½¬æ¢ä¸ºref
  return toRefs(state);
}
```

```js
export default {
  setup() {
    //å¯ä»¥åœ¨ä¸å¤±å»å“åº”æ€§çš„æƒ…å†µä¸‹ç ´åç»“æ„
    const { x, y } = useFeatureX();
    return {
      x,
      y,
    };
  },
};
```

åœ¨ç¬¬ä¸€æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ç”¨ `toRefs` å°† `state` å¯¹è±¡è¿›è¡Œè¿”å›ï¼Œä¹‹å**åœ¨ç»„ä»¶é‡Œé¢ç›´æ¥è°ƒç”¨å“åº”å¼å¯¹è±¡**ã€‚

é€šè¿‡è¿™æ ·æ–¹å¼ï¼Œè®©ä»£ç é€»è¾‘å˜å¾—æ›´åŠ æ¸…æ™°æ˜äº†ï¼Œå¤ç”¨æ€§æ›´å¼ºã€‚

## 2ã€æœ€ä½³ä½¿ç”¨æ–¹å¼

**é€šè¿‡ä¸Šé¢çš„æ¼”ç¤ºå¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ç‚¹ç»“è®ºï¼š**

- ç”¨ `reactive` åšå¯¹è±¡çš„**å“åº”å¼**ï¼Œç”¨ `ref` åš**å€¼ç±»å‹**çš„å“åº”å¼ã€‚
- `setup` ä¸­è¿”å› `toRefs(state)` ï¼Œæˆ–è€… `toRef(state, 'xxx')` ã€‚
- ä¸ºäº†é˜²æ­¢è¯¯ä¼šäº§ç”Ÿï¼Œ `ref` çš„å˜é‡å‘½åå°½é‡éƒ½ç”¨ `xxxRef` ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™ä¼šæ›´æ¸…æ¥šæ˜äº†ã€‚
- **åˆæˆå‡½æ•°**è¿”å›**å“åº”å¼å¯¹è±¡**æ—¶ï¼Œä½¿ç”¨ `toRefs`

## 3ã€æ·±å…¥ç†è§£

è®²å®Œ `ref` ã€ `toRef` å’Œ `toRefs` ï¼Œæˆ‘ä»¬å†æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼š**ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨å®ƒä»¬å‘¢ï¼Ÿå¯ä»¥ä¸ç”¨å—ï¼Ÿ**

### ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ç”¨ ref

- **å€¼ç±»å‹**ï¼ˆå³åŸºæœ¬æ•°æ®ç±»å‹ï¼‰æ— å¤„ä¸åœ¨ï¼Œå¦‚æœä¸ç”¨ `ref` è€Œç›´æ¥è¿”å›å€¼ç±»å‹ï¼Œ**ä¼šä¸¢å¤±å“åº”å¼**ã€‚
- æ¯”å¦‚åœ¨ **`setup`** ã€ **`computed`** ã€**åˆæˆå‡½æ•°**ç­‰å„ç§åœºæ™¯ä¸­ï¼Œéƒ½æœ‰å¯èƒ½è¿”å›**å€¼ç±»å‹**ã€‚
- `Vue` å¦‚æœä¸å®šä¹‰ `ref` ï¼Œç”¨æˆ·å°†è‡ªå·±åˆ¶é€  `ref` ï¼Œè¿™æ ·åè€Œä¼šæ›´åŠ æ··ä¹±ã€‚

### ï¼ˆ2ï¼‰ä¸ºä½• ref éœ€è¦.value å±æ€§

é€šè¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼Œ `ref` éœ€è¦é€šè¿‡ `.value` æ¥ä¿®æ”¹å€¼ã€‚è¿™çœ‹èµ·æ¥æ˜¯ä¸€ä¸ªå¾ˆéº»çƒ¦çš„æ“ä½œï¼Œæ€»æ˜¯é¢‘ç¹çš„ `.value` æ„Ÿè§‰ç‰¹åˆ«çç¢ã€‚é‚£ä¸ºä»€ä¹ˆä¸€å®šè¦ `.value` å‘¢ï¼Ÿæˆ‘ä»¬æ¥æ­å¼€å®ƒçš„é¢çº±ã€‚

- `ref` æ˜¯ä¸€ä¸ª**å¯¹è±¡**ï¼Œè¿™ä¸ªå¯¹è±¡ä¸ä¸¢å¤±å“åº”å¼ï¼Œä¸”è¿™ä¸ªå¯¹è±¡ç”¨ `value` æ¥å­˜å‚¨å€¼ã€‚
- å› æ­¤ï¼Œé€šè¿‡ `.value` å±æ€§çš„ `get` å’Œ `set` æ¥å®ç°å“åº”å¼ã€‚
- åªæœ‰å½“ç”¨äº **æ¨¡æ¿** å’Œ **reactive** æ—¶ï¼Œä¸éœ€è¦ `.value` æ¥å®ç°å“åº”å¼ï¼Œè€Œ**å…¶ä»–æƒ…å†µåˆ™éƒ½éœ€è¦**ã€‚

### ï¼ˆ3ï¼‰ä¸ºä»€ä¹ˆéœ€è¦ toRef å’Œ toRefs

ä¸ `ref` ä¸ä¸€æ ·çš„æ˜¯ï¼Œ `toRef` å’Œ `toRefs` è¿™ä¸¤ä¸ªå…„å¼Ÿï¼Œå®ƒä»¬**ä¸åˆ›é€ å“åº”å¼**ï¼Œè€Œæ˜¯**å»¶ç»­å“åº”å¼**ã€‚åˆ›é€ å“åº”å¼ä¸€èˆ¬ç”± `ref` æˆ–è€… `reactive` æ¥è§£å†³ï¼Œè€Œ `toRef` å’Œ `toRefs` åˆ™æ˜¯æŠŠå¯¹è±¡çš„æ•°æ®è¿›è¡Œåˆ†è§£å’Œæ‰©æ•£ï¼Œå…¶è¿™ä¸ªå¯¹è±¡é’ˆå¯¹çš„æ˜¯**å“åº”å¼å¯¹è±¡**è€Œ**éæ™®é€šå¯¹è±¡**ã€‚**æ€»ç»“èµ·æ¥æœ‰ä»¥ä¸‹ä¸‰ç‚¹ï¼š**

- **åˆè¡·ï¼š** åœ¨**ä¸ä¸¢å¤±å“åº”å¼**çš„æƒ…å†µä¸‹ï¼ŒæŠŠå¯¹è±¡æ•°æ®è¿›è¡Œ **åˆ†è§£æˆ–æ‰©æ•£**ã€‚
- **å‰æï¼š** é’ˆå¯¹çš„æ˜¯**å“åº”å¼å¯¹è±¡**ï¼ˆ `reactrive` å°è£…çš„ï¼‰è€Œ**éæ™®é€šå¯¹è±¡**ã€‚
- **æ³¨æ„ï¼š** **ä¸åˆ›é€ **å“åº”å¼ï¼Œè€Œæ˜¯**å»¶ç»­**å“åº”å¼ã€‚

# äºŒã€ğŸ™†â€â™€ï¸Composition API å®ç°é€»è¾‘å¤ç”¨

## 1ã€è§„åˆ™

**å…ˆæ¥äº†è§£å‡ æ¡è§„åˆ™ï¼š**

- `Composition API` æŒ‡**æŠ½ç¦»é€»è¾‘ä»£ç åˆ°ä¸€ä¸ªå‡½æ•°**ï¼›
- å‡½æ•°çš„å‘½åçº¦å®šä¸º `useXxxx` æ ¼å¼ï¼ˆReact hooks ä¹Ÿæ˜¯ï¼‰ï¼›
- åœ¨ `setup` ä¸­å¼•ç”¨ `useXxx` å‡½æ•°ã€‚

## 2ã€ä¸¾ä¸ªä¾‹å­ ğŸŒ°

å¼•ç”¨ä¸€ä¸ªéå¸¸ç»å…¸çš„ä¾‹å­ï¼š**è·å–é¼ æ ‡çš„å®šä½**ã€‚**æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ Composition API æ¥è¿›è¡Œå°è£…æ¼”ç¤ºï¼š**

å®šä¹‰ä¸€ä¸ª `js` æ–‡ä»¶ï¼Œåå­—ä¸º `useMousePosition` ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { reactive, ref, onMounted, onUnmounted } from 'vue';

function useMousePosition() {
  const x = ref(0);
  const y = ref(0);

  function update(e) {
    x.value = e.pageX;
    y.value = e.pageY;
  }

  onMounted(() => {
    console.log('useMousePosition mounted');
    window.addEventListener('mousemove', update);
  });

  onUnmounted(() => {
    console.log('useMousePosition unMounted');
    window.removeEventListener('mousemove', update);
  });

  return {
    x,
    y,
  };
}
```

å†å®šä¹‰ä¸€ä¸ª `.vue` æ–‡ä»¶ï¼Œå‘½åä¸º `index.vue` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<template>
  <p v-if="flag">mouse position {{x}} {{y}}</p>
  <button @click="changeFlagHandler">change flag</button>
</template>

<script>
  import { reactive } from 'vue'
  import useMousePosition from './useMousePosition'

  export default {
      name: 'MousePosition',
      return {
        flag: true
      },
      setup() {
          const { x, y } = useMousePosition()
          return {
              x,
              y
          }
      }ï¼Œ
       changeFlagHandler() {
        this.flag = !this.flag
      },
  }
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![mousePosition](https://img-blog.csdnimg.cn/20210613200712558.gif#pic_center)

äº†è§£å®Œ `ref` åï¼Œæˆ‘ä»¬æ¥å®ç°è¿™ä¸ªåŠŸèƒ½çœ‹èµ·æ¥ä¼šæ¸…æ™°å¾ˆå¤šã€‚æˆ‘ä»¬å…ˆé€šè¿‡ `ref` å¯¹ `x` å’Œ `y` åšå“åº”å¼æ“ä½œï¼Œä¹‹åé€šè¿‡ `.value` æ¥ä¿®æ”¹å€¼ï¼Œæœ€ç»ˆè¾¾åˆ°æ—¶åˆ»è·å–é¼ æ ‡å®šä½çš„æ•ˆæœã€‚åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬æ—¶åˆ»ä¿æŒç€é¼ æ ‡ç§»åŠ¨æ—¶ä¸æ–­æ”¹å˜å€¼ï¼Œè¿™æ ·å­æ˜¯**éå¸¸è€—è´¹æ€§èƒ½çš„**ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæŒ‰é’®ï¼Œæ¥éšæ—¶æ§åˆ¶å®ƒçš„å‡ºç°ä¸éšè—ã€‚

å¤§å®¶å¯ä»¥å‘ç°ï¼Œå½“éšè—çš„æ—¶å€™ï¼Œéšåä¼š**è§¦å‘ `onUnmounted` ç”Ÿå‘½å‘¨æœŸ**ï¼Œ**ç»„ä»¶å†…å®¹éšä¹‹è¢«é”€æ¯**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨çš„æ—¶å€™è°ƒç”¨ï¼Œä¸ä½¿ç”¨çš„æ—¶å€™åŠæ—¶é”€æ¯ï¼Œè¿™æ ·å­å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Š**æå‡æ€§èƒ½**ã€‚

# ä¸‰ã€ğŸ™…â€â™€ï¸ ç»“æŸè¯­

é€šè¿‡ä¸Šæ–‡çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œ `ref` ã€ `toRef` å’Œ `toRefs` æ˜¯ `vue3` ä¸­ `Composition API` çš„æ–°ç‰¹æ€§ï¼Œä¸” `vue3` ä¸€èˆ¬é€šè¿‡ `ref` ã€ `toRef` å’Œ `toRefs` æ¥**å®ç°æ•°æ®å“åº”å¼**ã€‚æœ‰äº†è¿™ä¸‰ä¸ªå†…å®¹ï¼Œå®ç°æ•°æ®å“åº”å¼çœ‹èµ·æ¥æ–¹ä¾¿è®¸å¤šï¼Œè€Œä¸å†åƒ `vue2` ä¸­é‚£ç§å¤„ç†èµ·æ¥å¾ˆå›°éš¾ã€‚

åˆ°è¿™é‡Œï¼Œå…³äº `ref` ã€ `toRef` å’Œ `toRefs` çš„å†…å®¹å°±è®²å®Œå•¦ï¼å¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼

å¦‚æœ‰ç–‘é—®æˆ–æ–‡ç« æœ‰è¯¯æ¬¢è¿è¯„è®ºåŒºæµè§ˆæˆ–ç§ä¿¡æˆ‘äº¤æµ~

> - å…³æ³¨å…¬ä¼—å· **æ˜ŸæœŸä¸€ç ”ç©¶å®¤** ï¼Œç¬¬ä¸€æ—¶é—´å…³æ³¨å­¦ä¹ å¹²è´§ï¼Œ**æ›´å¤šæœ‰è¶£çš„ä¸“æ å¾…ä½ è§£é”**~
> - å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œè®°å¾— **ä¸€é”®ä¸‰è¿** å†èµ°å“¦ï¼
> - æˆ‘ä»¬ä¸‹æœŸè§ï¼ğŸ¥‚ğŸ¥‚ğŸ¥‚

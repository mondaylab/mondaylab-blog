---
title: vue2çš„å“åº”å¼åŸç†å­¦â€œåºŸâ€äº†å—ï¼Ÿç»§ç»­è§‚æ‘©vue3å“åº”å¼åŸç†Proxy
author: å‘¨ä¸€
date: '2021-06-30'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - vue.jsåŸç†è§£æ
sidebar: 'auto'
---

# å‰è¨€

ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« è°ˆè®º `vue2.x` çš„**å“åº”å¼åŸç†**ï¼Œä½†å› ä¸º `vue3` ä¹Ÿæ¥äº†ï¼Œç´§è·Ÿç€ `vue3` çš„æ­¥ä¼ï¼Œå‘¨ä¸€å¼€å§‹å­¦èµ·äº† `vue3` çš„å“åº”å¼åŸç†ã€‚

å¤§å®¶åº”è¯¥éƒ½å¬è¿‡ï¼Œ `vue3` ç”¨ `proxy` æ¥è§£å†³å“åº”å¼åŸç†ï¼ŒåŒæ—¶å®ƒè§£å†³äº† `vue2` ä¸­ `Object.definePropery` å­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ã€‚

åœ¨ä¸‹é¢çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°†è®²è§£å…³äº `vue3` ç”¨ `proxy` å¦‚ä½•å®ç°å“åº”å¼ï¼Œä»¥åŠå¸¦æ¥çš„ä¸€äº›é—®é¢˜ã€‚ä¸€èµ·æ¥å­¦ä¹ å§ ğŸ’¯

# ä¸€ã€ğŸŸ© å›é¡¾ Object.defineProperty

è¿™é‡Œéœ€è¦å¤§å®¶å¯¹ `ObjectProperty` çš„çŸ¥è¯†ç‚¹æœ‰ä¸€ä¸ªé¢„å…ˆäº†è§£ï¼Œ[å¦‚æœ‰éœ€è¦äº†è§£å¯ç‚¹å‡»æ–‡ç« è¿›è¡ŒæŸ¥çœ‹~](https://blog.csdn.net/weixin_44803753/article/details/117535265)

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸‹ `Object.defineProperty` çš„**ç¼ºç‚¹ï¼š**

- æ·±åº¦ç›‘å¬æ—¶éœ€è¦**ä¸€æ¬¡æ€§**é€’å½’ï¼›
- æ— æ³•ç›‘å¬**æ–°å¢å±æ€§**/**åˆ é™¤å±æ€§**ï¼ˆéœ€è¦é…åˆ `Vue.set` æˆ– `Vue.delete` ä½¿ç”¨ï¼‰ï¼›
- æ— æ³•åŸç”Ÿ**ç›‘å¬æ•°ç»„**ï¼Œéœ€è¦ç‰¹æ®Šå¤„ç†ã€‚

å¸¦ç€ `Object.defineProperty` çš„è¿™å‡ ä¸ªç¼ºç‚¹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è¿›å…¥ `Proxy` çš„ä¸–ç•Œã€‚

# äºŒã€ğŸŸ¨Proxy åŸºæœ¬ä½¿ç”¨

ä¸‹é¢ç”¨ä¸€æ®µä»£ç æ¥æ¼”ç¤º `Proxy` çš„åŸºæœ¬ä½¿ç”¨ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
const data = {
  name: 'monday',
  age: 18,
};
//const data = ['a', 'b', 'c']

const proxyData = new Proxy(data, {
  get(target, key, receiver) {
    //åªå¤„ç†æœ¬èº«(éåŸå‹çš„)å±æ€§
    const ownKeys = Reflect.ownKeys(target);
    if (oenKeys.includes(key)) {
      console.log('get', key); //ç›‘å¬
    }
    const result = Reflect.get(target, key, receiver);
    return result; // è¿”å›ç»“æœ
  },
  set(target, key, val, receiver) {
    //é‡å¤çš„æ•°æ®ï¼Œä¸å¤„ç†
    if (val === target[key]) {
      return true;
    }

    const result = Reflect.set(target, key, val, receiver);
    console.log('set', key, val);
    //console.log('result', result) //true
    return result; // æ˜¯å¦è®¾ç½®æˆåŠŸ
  },
  deleteProperty(target, key) {
    const result = Reflect.deleteProperty(target, key);
    console.log('delete property', key);
    return result; // æ˜¯å¦åˆ é™¤æˆåŠŸ
  },
});
```

é€šè¿‡ä»¥ä¸Šä»£ç å¯å¾—ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰ä¸€ä¸ªå¯¹è±¡å­—é¢é‡çš„ `data` ï¼Œä¹‹ååœ¨ä½œä¸º `Proxy` å®ä¾‹åŒ–çš„å‚æ•°è¿›è¡Œä¼ é€’ã€‚ä¸” `proxyData` å®ç°äº† `get` ã€ `set` å’Œ `deleteProperty` çš„æ–¹æ³•ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œ**å¢åˆ æ”¹**æ“ä½œã€‚

# ä¸‰ã€ğŸŸ¦ å­¦ä¹  Proxy è¯­æ³•ï¼šReflect

æˆ‘ä»¬å†æ¥è®¤è¯† `Proxy` çš„ä¸€ä¸ªå¥½æœ‹å‹ï¼Œ**Reflect**ã€‚

`Reflect` å¯¹è±¡æœ‰ç€å’Œ `Proxy` ä¸€ä¸€å¯¹åº”çš„èƒ½åŠ›ï¼Œ**Reflect å¯¹è±¡**ä¸€å…±æœ‰ **13 ä¸ªé™æ€æ–¹æ³•**ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸æ‰€å¬åˆ°çš„ `proxy` æœ‰å¤šè¾¾**13 ç§æ‹¦æˆªè¡Œä¸º**ï¼Œè€Œ `Reflect` çš„è¿™ 13 ç§é™æ€æ–¹æ³•åŒ¹é…çš„å°±æ˜¯ `Proxy` çš„**13 ç§æ‹¦æˆªè¡Œä¸º** ã€‚

|                      é™æ€æ–¹æ³•åˆ—è¡¨                      |
| :----------------------------------------------------: |
|          Reflect.get(target, name, receiver)           |
|       Reflect.set(target, name, value, receiver)       |
|                 Reflect.has(obj, name)                 |
|           Reflect.deleteProperty(obj, name)            |
|            Reflect.construct(target, args)             |
|              Reflect.getPrototypeOf(obj)               |
|         Reflect.setPrototypeOf(obj, newProto)          |
|           Reflect.apply(func, thisArg, args)           |
| Reflect.defineProperty(target, propertyKey, attribute) |
| Reflect.getOwnPropertyDescriptor(target, propertyKey)  |
|              Reflect.isExtensible(target)              |
|           Reflect.preventExtensions(target)            |
|                Reflect.ownKeys(target)                 |

`Reflect` çš„å‡ºç°æ˜¯ä¸ºäº†æ›¿æ¢æ‰ `Object` ä¸Šçš„å·¥å…·å‡½æ•°ï¼Œè¿™é‡Œä¸åšå…·ä½“ä»‹ç»ï¼Œ[è¯¦æƒ…å¯æŸ¥çœ‹æ–‡æ¡£](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Reflect/Comparing_Reflect_and_Object_methods) ã€‚

# å››ã€ğŸŸ§Vue3 å¦‚ä½•ç”¨ Proxy å®ç°å“åº”å¼

## 1ã€å®ç°å“åº”å¼

ä¸‹é¢æ¥å®ç° Proxy çš„å“åº”å¼ã€‚**é™„ä¸Šä»£ç ï¼š**

```JS
// åˆ›å»ºå“åº”å¼
function reactive(target = {}) {
    if (typeof target !== 'object' || target == null) {
        // ä¸æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼Œåˆ™è¿”å›
        return target
    }

    // ä»£ç†é…ç½®
    const proxyConf = {
        get(target, key, receiver) {
            // åªå¤„ç†æœ¬èº«ï¼ˆéåŸå‹çš„ï¼‰å±æ€§
            const ownKeys = Reflect.ownKeys(target)
            if (ownKeys.includes(key)) {
                console.log('get', key) // ç›‘å¬
            }

            const result = Reflect.get(target, key, receiver)

            // æ·±åº¦ç›‘å¬
            return reactive(result)
        },
        set(target, key, val, receiver) {
            // é‡å¤çš„æ•°æ®ï¼Œä¸å¤„ç†
            if (val === target[key]) {
                return true
            }

            const ownKeys = Reflect.ownKeys(target)
            // åˆ¤æ–­æ˜¯å·²æœ‰å±æ€§è¿˜æ˜¯æ–°å¢å±æ€§
            if (ownKeys.includes(key)) {
                console.log('å·²æœ‰çš„ key', key)
            } else {
                console.log('æ–°å¢çš„ key', key)
            }

            const result = Reflect.set(target, key, val, receiver)
            console.log('set', key, val)
            // console.log('result', result) // true
            return result // æ˜¯å¦è®¾ç½®æˆåŠŸ
        },
        deleteProperty(target, key) {
            const result = Reflect.deleteProperty(target, key)
            console.log('delete property', key)
            // console.log('result', result) // true
            return result // æ˜¯å¦åˆ é™¤æˆåŠŸ
        }
    }

    // ç”Ÿæˆä»£ç†å¯¹è±¡
    const observed = new Proxy(target, proxyConf)
    return observed
}

// æµ‹è¯•æ•°æ®
const data = {
    name: 'monday',
    age: 18,
    info: {
        city: 'FuZhou',
        a: {
            b: {
                c: {
                    d: {
                        e: 100
                    }
                }
            }
        }
    }
}

const proxyData = reactive(data)

```

**æˆ‘ä»¬åœ¨æ§åˆ¶å°æ¥éªŒè¯æ•°æ®ï¼š**

![proxy](https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270737608.png)





ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç”¨ `proxy` æ¥å®ç°å“åº”å¼ï¼Œå¦‚æœé‡åˆ°éœ€è¦æ·±åº¦é€’å½’çš„æ•°ç»„æ—¶ï¼Œå®ƒä¸ä¼šåƒ `defineProperty` é‚£æ ·**æ·±åº¦é€’å½’**ï¼Œå®ƒä¼šåœ¨ä»€ä¹ˆæ—¶å€™ `get` ï¼Œä»€ä¹ˆæ—¶å€™å†æ·±åº¦é€’å½’ã€‚æœ¬è´¨ä¸Šæ¥è®²å°±æ˜¯ï¼Œä½ è·å–åˆ°å“ªä¸€å±‚ï¼Œé‚£ä¸€å±‚æ‰ä¼š**è§¦å‘å“åº”å¼**ã€‚**ä½ è·å–ä¸åˆ°çš„æ·±å±‚ï¼Œå®ƒå°±ä¸ä¼šè§¦å‘å“åº”å¼**ã€‚ä¸”ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œ `Proxy` åœ¨ä¿®æ”¹å±æ€§æ—¶ï¼Œå¦‚æœæ•°æ®æ˜¯**é‡å¤çš„**ï¼Œåˆ™ä¸è¿›è¡Œå¤„ç†ã€‚å¦‚æœæ•°æ®**ä¸é‡å¤**ï¼Œå†è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±æå¤§ç¨‹åº¦ä¸Š**æé«˜äº†è½¯ä»¶çš„æ€§èƒ½**ã€‚

## 2ã€Proxy æ€»ç»“

ç°åœ¨æ¥å¯¹ä¸Šè¿° Proxy çš„å†…å®¹**åšä¸€ä¸ªæ€»ç»“ï¼š**

### ï¼ˆ1ï¼‰æ·±åº¦ç›‘å¬ï¼Œæ€§èƒ½æ›´å¥½

`defineProperty` æ˜¯ä¸€æ¬¡æ€§é€’å½’å®Œæˆï¼›è€Œ `Proxy` æ˜¯ä»€ä¹ˆæ—¶å€™ `get` ï¼Œä»€ä¹ˆæ—¶å€™å†**æ·±åº¦é€’å½’**ã€‚

### ï¼ˆ2ï¼‰å¯ç›‘å¬ æ–°å¢/åˆ é™¤ å±æ€§

åœ¨ `vue2` ä¸­ï¼Œ `defineProperty` æ˜¯**æ— æ³•æ–°å¢/åˆ é™¤å±æ€§**çš„ï¼Œéœ€è¦é…åˆ `Vue.set` å’Œ `Vue.delete` æ¥ä½¿ç”¨ï¼Œè€Œåœ¨ `Vue3` ä¸­ï¼Œ `Proxy` **å¯ä»¥æ–°å¢å’Œåˆ é™¤å±æ€§**ï¼Œæ— éœ€è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚

### ï¼ˆ3ï¼‰å¯ç›‘å¬æ•°ç»„å˜åŒ–

åœ¨ `vue2` ä¸­ï¼Œç›‘å¬æ•°ç»„å˜åŒ–æ˜¯éœ€è¦è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œä¸”**åªèƒ½ä¸€æ¬¡æ€§æ·±åº¦é€’å½’å®Œæˆ**ã€‚è€Œåœ¨ `vue3` ä¸­ï¼Œå¯ä»¥**ç›‘å¬æ•°ç»„å˜åŒ–**ï¼Œå¹¶ä¸”æ˜¯**ä»€ä¹ˆæ—¶å€™ get ä»€ä¹ˆæ—¶å€™å†é€’å½’**ï¼Œè·å–ä¸åˆ°çš„æ·±å±‚ï¼Œä¸ä¼šè§¦å‘å“åº”å¼ã€‚

## 3ã€ä¸¤è€…å¯¹æ¯”

è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†æŠŠ `vue2` ä¸­çš„ `Object.defineProperty` å’Œ `vue3` ä¸­çš„ `Proxy` **åšä¸€ä¸ªå¯¹æ¯”ï¼š**

- `Proxy` èƒ½è‰¯å¥½çš„è§„é¿ `Object.defineProperty` çš„é—®é¢˜ï¼›
- `Proxy` æ— æ³•å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼ˆå¦‚ `IE11` ï¼‰ï¼Œä¸”æ— æ³• `polyfill` ã€‚

# äº”ã€ğŸŸª ç»“æŸè¯­

ä»æŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œ `vue3` çš„ `Proxy` ç¡®å®å¸¦æ¥äº†ä¸€äº›å¥½å¤„ï¼Œä½†åŒæ—¶ä¹Ÿå¸¦æ¥äº†ä¸€äº›é—®é¢˜ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œ `vue2` çš„ `Object.defineProperty` è¿˜ä¼šå­˜åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´ã€‚æ‰€ä»¥ï¼Œæ–°æŠ€æœ¯çš„ä½¿ç”¨æ€»ä¼šç»è¿‡ä¸€ä¸ªä»è¯•ç”¨é˜¶æ®µåˆ°ç¨³å®šé˜¶æ®µçš„è¿‡ç¨‹ã€‚

å…³äº vue3 çš„å“åº”å¼åŸç†è®²åˆ°è¿™é‡Œå°±ç»“æŸå•¦ï¼å¦‚æœ‰ç–‘é—®æ¬¢è¿æissue~


---
title: ä½¿ç”¨React hooksï¼Œäº›è®¸åˆå¤šäº†ä¸å°‘æ‘¸é±¼æ—¶é—´
author: å‘¨ä¸€
date: '2021-12-12'
sidebar: 'auto'
---

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/944986b95b9948468034123ef8472774.png#pic_center)

@[toc](ä¸€æ–‡è¯¦è§£react-hooks)

# ğŸ™ï¸ å‰è¨€

ç›¸ä¼ ï¼Œ `react 17` å‡ºäº†ä¸€ä¸ªå¾ˆå¼ºå¤§çš„åŠŸèƒ½ï¼Œ ä¹Ÿå°±æ˜¯ `react hooks` ã€‚å®é™…ä¸Šï¼Œ `react hooks` æœ‰ç‚¹ç±»ä¼¼ä¸ `vue3` çš„ `composition API` ï¼Œéƒ½æ˜¯ä¸ºäº†æå‡å¼€å‘æ•ˆç‡è€Œå‡ºç°ã€‚

é‚£ä¹ˆï¼Œåœ¨ä¸‹é¢çš„æ–‡ç« ä¸­ï¼Œå°†ä» `0åˆ°1` å¼€å§‹ï¼Œå¸¦å¤§å®¶äº†è§£ `react hooks` ï¼Œä»¥åŠä¸€äº›å¸¸ç”¨çš„ `API` ã€‚

åºŸè¯ä¸å¤šè¯´ï¼Œå¼€å§‹ `react-hook` ä¹‹æ—…å­~

# ä¸€ã€ğŸ“» æ¦‚è¿°

## 1ã€å…³äº React Hooks

- `React Hooks` æ˜¯ä¸€ä¸ªå¯é€‰åŠŸèƒ½ï¼Œé€šå¸¸ç”¨ `class` ç»„ä»¶ æ¥å’Œå®ƒåšæ¯”è¾ƒï¼›
- `100%` å‘åå…¼å®¹ï¼Œæ²¡æœ‰**ç ´åæ€§æ”¹åŠ¨**ï¼›
- ä¸ä¼šå–ä»£ `class` ç»„ä»¶ï¼Œå°šæ— è®¡åˆ’è¦ç§»é™¤ `class` ç»„ä»¶ã€‚

## 2ã€è®¤è¯† React Hooks

### ï¼ˆ1ï¼‰å›é¡¾ React å‡½æ•°å¼ç»„ä»¶

æˆ‘ä»¬å…ˆæ¥å›é¡¾ä¸‹ **class ç»„ä»¶** å’Œ **å‡½æ•°ç»„ä»¶**ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

**class ç»„ä»¶ï¼š**

```js
// classç»„ä»¶
class List extends React.Component {
  constructor() {
    super(props);
  }
  render() {
    const { List } = this.props;

    return (
      <ul>
        {list.map((item, index) => {
          return (
            <li key={item.id}>
              <span>{item.title}</span>
            </li>
          );
        })}
      </ul>
    );
  }
}
```

**å‡½æ•°ç»„ä»¶ï¼š**

```js
// å‡½æ•°ç»„ä»¶
function List(props) {
  const { list } = props;

  return (
    <ul>
      {list.map((item, index) => {
        return (
          <li key={item.id}>
            <span>{item.title}</span>
          </li>
        );
      })}
    </ul>
  );
}
```

### ï¼ˆ2ï¼‰å‡½æ•°ç»„ä»¶çš„ç‰¹ç‚¹

**å‡½æ•°ç»„ä»¶çš„ç‰¹ç‚¹æ˜¯ï¼š**

- æ²¡æœ‰ç»„ä»¶å®ä¾‹ï¼›
- æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸï¼›
- æ²¡æœ‰ `state` å’Œ `setState` ï¼Œåªèƒ½æ¥æ”¶ `props` ã€‚

### ï¼ˆ3ï¼‰class ç»„ä»¶çš„é—®é¢˜

ä¸Šé¢æˆ‘ä»¬è¯´åˆ°äº†å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œåªèƒ½æ¥æ”¶ `props` ï¼Œæ²¡æœ‰ä»»ä½•å…¶ä»–åŠŸèƒ½ã€‚è€Œ `class` ç»„ä»¶æ‹¥æœ‰ä»¥ä¸ŠåŠŸèƒ½ï¼Œä½†æ˜¯å‘¢ï¼Œ`class` ç»„ä»¶ä¼šå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

- å¤§å‹ç»„ä»¶å¾ˆéš¾æ‹†åˆ†å’Œé‡æ„ï¼Œå¾ˆéš¾æµ‹è¯•ï¼ˆå³ `class` ä¸æ˜“æ‹†åˆ†ï¼‰ï¼›
- ç›¸åŒä¸šåŠ¡é€»è¾‘ï¼Œåˆ†æ•£åˆ°å„ä¸ªæ–¹æ³•ä¸­ï¼Œé€»è¾‘æ··ä¹±ï¼›
- å¤ç”¨é€»è¾‘å˜å¾—å¤æ‚ï¼Œå¦‚ `Mixins` ã€ `HOC` ã€ `Render Props` ã€‚

å› æ­¤ï¼Œæœ‰äº†ä»¥ä¸Šé—®é¢˜çš„å‡ºç°ï¼Œä¹Ÿå°±æœ‰äº† `React Hooks` ã€‚

### ï¼ˆ4ï¼‰React ç»„ä»¶

- `React` ç»„ä»¶æ›´æ˜“äºç”¨**å‡½æ•°**æ¥è¡¨è¾¾ï¼š

- `React` æå€¡å‡½æ•°å¼ç¼–ç¨‹ï¼Œå³ `view=fn(props)` ï¼›
- å‡½æ•°æ›´**çµæ´»**ï¼Œæ›´æ˜“**æ‹†åˆ†**ï¼Œæ›´æ˜“**æµ‹è¯•**ï¼›
- ä½†**å‡½æ•°ç»„ä»¶**å¤ªç®€å•ï¼Œéœ€è¦å¢å¼ºèƒ½åŠ› â€”â€”å› æ­¤ï¼Œæœ‰äº† `React Hooks` ã€‚

# äºŒã€ğŸª• å‡ ç§ Hooks

## 1ã€State HookğŸ—ï¸

### ï¼ˆ1ï¼‰è®©å‡½æ•°ç»„ä»¶å®ç° state å’Œ setState

- é»˜è®¤å‡½æ•°ç»„ä»¶æ˜¯æ²¡æœ‰ `state` çš„ï¼›
- å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œæ‰§è¡Œå®Œå³é”€æ¯ï¼Œæ— æ³•å­˜å‚¨ `store` ï¼›
- éœ€è¦ `State Hook` ï¼Œå³æŠŠ `store` åŠŸèƒ½ "é’©" åˆ°çº¯å‡½æ•°ä¸­ã€‚

### ï¼ˆ2ï¼‰ä¸¾ä¾‹é˜è¿°

å‡è®¾æˆ‘ä»¬ç°åœ¨è¦é€šè¿‡ç‚¹å‡»æŒ‰é’®ï¼Œæ¥ä¿®æ”¹è®¾å®šçš„æŸä¸ªå€¼ã€‚ç°åœ¨æˆ‘ä»¬ç”¨ `hooks` ä¸­çš„ `useState` æ¥å¤„ç†ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState } from 'react';

function ClickCounter() {
  // æ•°ç»„çš„è§£æ„
  // useState å°±æ˜¯ä¸€ä¸ª Hook â€œé’©â€ï¼Œæœ€åŸºæœ¬çš„ä¸€ä¸ª Hook
  const [count, setCount] = useState(0); // ä¼ å…¥ä¸€ä¸ªåˆå§‹å€¼ï¼Œåˆå§‹å€¼å¯ä»¥æ˜¯æ•°å€¼/å­—ç¬¦ä¸²/æ•°ç»„/å¯¹è±¡ç­‰ç±»å‹

  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // const arr = useState(0)
  // const count = arr[0]
  // const setCount = arr[1]

  function clickHandler() {
    setCount(count + 1);
    setName(name + '2021');
  }

  return (
    <div>
      <p>
        ä½ ç‚¹å‡»äº† {count} æ¬¡ {name}
      </p>
      <button onClick={clickHandler}>ç‚¹å‡»</button>
    </div>
  );
}

export default ClickCounter;
```

æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

![useState](https://img-blog.csdnimg.cn/e740acee99d0458989d671fbb0ac4082.gif#pic_center)

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ `count` æ˜¯ä¸€ä¸ª `state` çš„å€¼ï¼Œ `setCount` æ˜¯ä¿®æ”¹ `state` çš„ä¸€ä¸ªå‡½æ•°ã€‚åŒç†ï¼Œ `name` ä¹Ÿæ˜¯ä¸€ä¸ª `state` çš„å€¼ï¼Œ `setName` æ˜¯ä¿®æ”¹ `name` å€¼å¾—ä¸€ä¸ªå‡½æ•°ã€‚

å¦‚æœä½¿ç”¨ `hooks` æ¥ä¿®æ”¹ `state` å€¼çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦ä»¥ `const [count, setCount] = useState(0)` è¿™ç§å½¢å¼å»è¿›è¡Œï¼Œä¾¿å¯ä¿®æ”¹æœ€åçš„å€¼ï¼Œè€Œä¸éœ€è¦åƒ `class` ç»„ä»¶é‚£ä¹ˆå¤æ‚çš„å»ä½¿ç”¨ã€‚

---

å¯¹äºä¸Šé¢è¿™ä¸ªåŠŸèƒ½æ¥è¯´ï¼Œå¦‚æœä½¿ç”¨ `class` ç»„ä»¶æ¥å®ç°çš„è¯ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React from 'react';

class ClickCounter extends React.Component {
  constructor() {
    super();

    // å®šä¹‰ state
    this.state = {
      count: 0,
      name: 'æ˜ŸæœŸä¸€ç ”ç©¶å®¤',
    };

    this.clickHandler = this.clickHandler.bind(this);
  }
  render() {
    return (
      <div>
        <p>
          ä½ ç‚¹å‡»äº† {this.state.count} æ¬¡ {this.state.name}
        </p>
        <button onClick={this.clickHandler}>ç‚¹å‡»</button>
      </div>
    );
  }
  clickHandler() {
    // ä¿®æ”¹ state
    this.setState({
      count: this.state.count + 1,
      name: this.state.name + '2021',
    });
  }
}

export default ClickCounter;
```

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä½¿ç”¨ `class` ç»„ä»¶æ¥è§£å†³çš„è¯ï¼Œé‚£ä¹ˆéœ€è¦å…ˆå®šä¹‰ `state` ï¼Œç„¶åå†å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå†ä½¿ç”¨ `setState` æ‰èƒ½å»ä¿®æ”¹å€¼ï¼Œè¿™æ ·ä¼¼ä¹è¿˜éº»çƒ¦äº†ç‚¹ã€‚

ç›¸ä¿¡åˆ°è¿™é‡Œï¼Œå¤§å®¶å·²ç»æ„Ÿå—åˆ° `hooks` çš„å¿«ä¹ä¹‹å¤„äº†ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥æ€»ç»“å…³äº `useState` çš„ä¸€äº›çŸ¥è¯†ç‚¹ã€‚

### ï¼ˆ3ï¼‰useState ä½¿ç”¨æ€»ç»“

- `useState(xxx)` ä¼ å…¥åˆå§‹å€¼ï¼Œè¿”å›æ•°ç»„ `[state, setState]` ï¼›
- é€šè¿‡ `state` è·å–å€¼ï¼›
- é€šè¿‡ `setState(xxx)` ä¿®æ”¹å€¼ã€‚

### ï¼ˆ4ï¼‰Hooks å‘½åè§„èŒƒ

- è§„å®šæ‰€æœ‰çš„ `Hooks` éƒ½è¦ä½¿ç”¨ `use` å¼€å¤´ï¼Œå¦‚ `useXxx` ï¼›
- è‡ªå®šä¹‰ `Hook` ä¹Ÿè¦ä»¥ `use` å¼€å¤´ï¼›
- é `Hooks` çš„åœ°æ–¹ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ `useXxx` å†™æ³•ï¼Œä¸ç„¶å®¹æ˜“é€ æˆè¯¯è§£ã€‚

## 2ã€Effect HookğŸ—ï¸

### ï¼ˆ1ï¼‰è®©å‡½æ•°ç»„ä»¶æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸ

- é»˜è®¤å‡½æ•°ç»„ä»¶**æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸ**ï¼›
- å‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ª**çº¯å‡½æ•°**ï¼Œæ‰§è¡Œå®Œå³é”€æ¯ï¼Œè‡ªå·±æ— æ³•å®ç°ç”Ÿå‘½å‘¨æœŸï¼›
- ä½¿ç”¨ `Effect Hook` æŠŠç”Ÿå‘½å‘¨æœŸ â€œé’©â€ åˆ°çº¯å‡½æ•°ä¸­ã€‚

### ï¼ˆ2ï¼‰ä¸¾ä¾‹é˜è¿°

åŒæ ·åœ°ï¼Œæˆ‘ä»¬ç”¨äº `useState` ç›¸åŒçš„ä¾‹å­ï¼Œæ¥ä½“éªŒä¸‹ `useEffect` ã€‚

æˆ‘ä»¬å…ˆåœ¨ `src|components` ä¸‹å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `LiftCycles.js` ã€‚ **å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState, useEffect } from 'react';

function LifeCycles() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // æ¨¡æ‹Ÿ class ç»„ä»¶çš„ DidMount å’Œ DidUpdate
  useEffect(() => {
    console.log('åœ¨æ­¤å‘é€ä¸€ä¸ª ajax è¯·æ±‚');
  });

  function clickHandler() {
    setCount(count + 1);
    setName(name + '2020');
  }

  return (
    <div>
      <p>
        ä½ ç‚¹å‡»äº† {count} æ¬¡ {name}
      </p>
      <button onClick={clickHandler}>ç‚¹å‡»</button>
    </div>
  );
}

export default LifeCycles;
```

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ `App.js` ä¸­æ³¨å†Œè¯¥ç»„ä»¶ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState } from 'react';
import LifeCycles from './components/LifeCycles'

function App() {
  const [flag, setFlag] = useState(true)

  return (
    <div
      {flag && <LifeCycles/>}
    </div>
  );
}

export default App;

```

æ­¤æ—¶ï¼Œ**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useEffectâ‘ ](https://img-blog.csdnimg.cn/fd64f75912774d10ba449f57a1e26298.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œ `useEffect` å¦‚æœåªä¼ å…¥ä¸€ä¸ªå‡½æ•°çš„è¯ï¼Œé‚£ä¹ˆå®ƒæ¨¡æ‹Ÿçš„æ˜¯ `DidMount` å’Œ `DidUpdate` è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„åŠŸèƒ½ã€‚æ¯å½“æˆ‘ä»¬ç‚¹å‡»ä¸€æ¬¡çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°±ä¼šæ‰“å°ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶åŠ è½½å’Œç»„ä»¶æ›´æ–°æ˜¯åœ¨ä¸€èµ·è¿›è¡Œçš„ã€‚

---

é‚£å¦‚æœæˆ‘ä»¬æƒ³è¦è®©ç»„ä»¶åŠ è½½å’Œç»„ä»¶æ›´æ–°åˆ†å¼€å®ç°å‘¢ï¼ŒåŒæ ·æœ‰åŠæ³•ã€‚æˆ‘ä»¬æ¥æ”¹é€ ä¸‹ `LiftCycles.js` çš„ä»£ç ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState, useEffect } from 'react';

function LifeCycles() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // æ¨¡æ‹Ÿ class ç»„ä»¶çš„ DidMount
  useEffect(() => {
    console.log('åŠ è½½å®Œäº†');
  }, []); // ç¬¬äºŒä¸ªå‚æ•°æ˜¯ [] ï¼ˆä¸ä¾èµ–äºä»»ä½• stateï¼‰

  // æ¨¡æ‹Ÿ class ç»„ä»¶çš„ DidUpdate
  useEffect(() => {
    console.log('æ›´æ–°äº†');
  }, [count, name]); // ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä¾èµ–çš„ state

  function clickHandler() {
    setCount(count + 1);
    setName(name + '2020');
  }

  return (
    <div>
      <p>
        ä½ ç‚¹å‡»äº† {count} æ¬¡ {name}
      </p>
      <button onClick={clickHandler}>ç‚¹å‡»</button>
    </div>
  );
}

export default LifeCycles;
```

æ­¤æ—¶æµè§ˆå™¨çš„**æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useEffectâ‘¡](https://img-blog.csdnimg.cn/6e5423f19b5147ab802be0e365f773fa.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œç¬¬ä¸€æ¬¡çš„æ—¶å€™åˆ†åˆ«åŠ è½½å’Œæ›´æ–°äº† `1` æ¬¡ã€‚ç­‰åˆ°æˆ‘ä»¬å»ç‚¹å‡»çš„æ—¶å€™ï¼Œå› ä¸ºå·²ç»åŠ è½½å®Œäº†ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™å°±æ˜¯æ›´æ–°äº†ã€‚

é‚£æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ï¼Œ `useEffect` åœ¨åŠ è½½å’Œæ›´æ–°çš„æ—¶å€™ï¼Œåˆ†åˆ«æ˜¯æ€ä¹ˆè¿›è¡Œå¤„ç†çš„ï¼Ÿ

çœ‹ä¸Šé¢çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ`useEffect` è¿˜å¯ä»¥æ¥æ”¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœç©ºå€¼ï¼Œé‚£ä¹ˆå®ƒä¸ä¾èµ–äºä»»ä½• `state` ï¼Œè¡¨ç¤º `componentDidMount` è¿™ä¸ªç”Ÿå‘½å‘¨æœŸã€‚ç›¸åï¼Œå¦‚æœç¬¬äºŒä¸ªå‚æ•°**æ²¡æœ‰ä¾èµ–å€¼**æˆ–è€…**æ¥æ”¶ä¾èµ–äº state çš„å€¼**è¿™ä¸¤ç§æƒ…å†µæ—¶ï¼Œé‚£ä¹ˆå®ƒæ¨¡æ‹Ÿ `componentDidUpdate` è¿™ä¸ªç”Ÿå‘½å‘¨æœŸã€‚

---

è¯´åˆ°è¿™é‡Œï¼Œå¯èƒ½æœ‰çš„å°ä¼™ä¼´è¿˜æƒ³é—®ï¼Œé‚£è·Ÿ**é”€æ¯**ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸï¼Œåˆæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­æ¥å¯¹ `LiftCycles.js` çš„ä»£ç è¿›è¡Œæ”¹é€ ã€‚**å…·ä½“å¦‚ä¸‹ï¼š**

```js
import React, { useState, useEffect } from 'react';

function LifeCycles() {
  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // æ¨¡æ‹Ÿ class ç»„ä»¶çš„ DidMount
  useEffect(() => {
    let timerId = window.setInterval(() => {
      console.log(Date.now());
    }, 1000);

    // è¿”å›ä¸€ä¸ªå‡½æ•°
    // æ¨¡æ‹Ÿ WillUnMount
    return () => {
      window.clearInterval(timerId);
    };
  }, []);

  function clickHandler() {
    setCount(count + 1);
    setName(name + '2020');
  }

  return (
    <div>
      <p>
        ä½ ç‚¹å‡»äº† {count} æ¬¡ {name}
      </p>
      <button onClick={clickHandler}>ç‚¹å‡»</button>
    </div>
  );
}

export default LifeCycles;
```

å¤§å®¶å¯ä»¥çœ‹ä»¥ä¸Šä»£ç ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ `return` ä¸€ä¸ªå‡½æ•°ï¼Œå»æ¨¡æ‹Ÿ `componentWillUnMount` è¿™ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œæ¥é”€æ¯æ¯ä¸€æ¬¡å®šæ—¶å™¨ä¸­æ‰§è¡Œçš„ä»»åŠ¡ã€‚

åˆ°è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶å¯¹ `useEffect` å·²ç»æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å¯¹ `useEffect` åšä¸ªå°ç»“ã€‚

### ï¼ˆ3ï¼‰useEffect ä½¿ç”¨æ€»ç»“

- æ¨¡æ‹Ÿ `componentDidMount - useEffect` ä¾èµ– `[]` ï¼›
- æ¨¡æ‹Ÿ `componentDidUpdate - useEffect` æ— ä¾èµ–ï¼Œæˆ–è€…ä¾èµ– `[a, b]` ï¼›
- æ¨¡æ‹Ÿ `componentWillUnMount - useEffect` ä¸­**è¿”å›ä¸€ä¸ªå‡½æ•°**ã€‚

### ï¼ˆ4ï¼‰useEffect è®©çº¯å‡½æ•°æœ‰äº†å‰¯ä½œç”¨

- é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰§è¡Œçº¯å‡½æ•°çš„æ—¶å€™ï¼Œåªéœ€è¦è¾“å…¥å‚æ•°å¹¶è¿”å›ç»“æœå³å¯ï¼Œæ˜¯æ²¡æœ‰ä»»ä½•å‰¯ä½œç”¨çš„ï¼›
- æ‰€è°“å‰¯ä½œç”¨ï¼Œå°±æ˜¯å¯¹å‡½æ•°ä¹‹å¤–é€ æˆå½±å“ï¼Œå¦‚**è®¾ç½®å…¨å±€å®šæ—¶ä»»åŠ¡**ï¼›
- è€Œç»„ä»¶éœ€è¦å‰¯ä½œç”¨ï¼Œæ‰€ä»¥éœ€è¦ `useEffect` â€œé’©â€ åˆ°çº¯å‡½æ•°ä¸­ï¼›
- å› æ­¤ï¼Œ `useEffect` è¿™ä¸ªå‰¯ä½œç”¨å¹¶ä¸æ˜¯ä¸€ä»¶åäº‹ã€‚

### ï¼ˆ5ï¼‰useEffect ä¸­è¿”å›å‡½æ•° fn

æœ‰ä¸€ç§å€¼å¾—æ³¨æ„çš„æƒ…å†µæ˜¯ï¼Œåœ¨ä¸Šé¢æˆ‘ä»¬é€šè¿‡è¿”å›ä¸€ä¸ªå‡½æ•°æ¥æ¨¡æ‹Ÿ `WillUnMount` ï¼Œä½†è¿™ä¸ªæ¨¡æ‹Ÿåçš„ç»“æœè¿˜**ä¸å®Œå…¨ç­‰äº** `WillUnMount` ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨ `src|components` ä¸‹å»ºç«‹ä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `FriendStatus.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState, useEffect } from 'react';

function FriendStatus({ friendId }) {
  const [status, setStatus] = useState(false);

  // DidMount å’Œ DidUpdate
  useEffect(() => {
    console.log(`å¼€å§‹ç›‘å¬ ${friendId} åœ¨çº¿çŠ¶æ€`);

    // ã€ç‰¹åˆ«æ³¨æ„ã€‘
    // æ­¤å¤„å¹¶ä¸å®Œå…¨ç­‰åŒäº WillUnMount
    // props å‘ç”Ÿå˜åŒ–ï¼Œå³æ›´æ–°ï¼Œä¹Ÿä¼šæ‰§è¡Œç»“æŸç›‘å¬
    // å‡†ç¡®çš„è¯´ï¼šè¿”å›çš„å‡½æ•°ï¼Œä¼šåœ¨ä¸‹ä¸€æ¬¡ effect æ‰§è¡Œä¹‹å‰ï¼Œè¢«æ‰§è¡Œ
    return () => {
      console.log(`ç»“æŸç›‘å¬ ${friendId} åœ¨çº¿çŠ¶æ€`);
    };
  });

  return (
    <div>
      å¥½å‹ {friendId} åœ¨çº¿çŠ¶æ€ï¼š{status.toString()}
    </div>
  );
}

export default FriendStatus;
```

`App.js` çš„ä»£ç å¦‚ä¸‹ï¼š

```js
import React, { useState } from 'react';
import FriendStatus from './components/FriendStatus';

function App() {
  const [flag, setFlag] = useState(true);
  const [id, setId] = useState(1);

  return (
    <div>
      <div>
        <button onClick={() => setFlag(false)}>flag = false</button>
        <button onClick={() => setId(id + 1)}>id++</button>
      </div>

      {flag && <FriendStatus friendId={id} />}
    </div>
  );
}

export default App;
```

æ­¤æ—¶ï¼Œ**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useEffectâ‘¢](https://img-blog.csdnimg.cn/28df613bb3c6432295c1d9cdb0f9ff18.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå½“å¼€å§‹ä¸‹ä¸€ä¸ªç›‘å¬æ—¶ï¼Œä¼šå…ˆç»“æŸæ‰ä¸Šä¸€ä¸ªç›‘å¬å†å¼€å§‹ä¸‹ä¸€ä¸ªã€‚æ­£å¦‚å›¾ä¸­æ‰€çœ‹åˆ°çš„ï¼Œä¸€å¼€å§‹æˆ‘ä»¬æ­£åœ¨ç›‘å¬ `id` ä¸º `1` çš„å¥½å‹ï¼Œé‚£å½“æˆ‘ä»¬æƒ³è¦ç‚¹å‡» `id++` æŒ‰é’®å»ç›‘å¬å¥½å‹ `2` æ—¶ï¼Œ`useEffect` ä¼šå…ˆå»ç»“æŸæ‰ `1` çš„çŠ¶æ€ï¼Œå†è®©å¥½å‹ `2` ä¸Šçº¿ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬è¦æ³¨æ„çš„ä¸€ä¸ªç‚¹æ˜¯ï¼Œæ‰§è¡Œç»“æŸç›‘å¬çš„è¿™ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œçš„æ˜¯ `DidUpdate` ç”Ÿå‘½å‘¨æœŸï¼Œè€Œä¸æ˜¯ `WillUnMount` ç”Ÿå‘½å‘¨æœŸã€‚**å‡½æ•°**åœ¨è¿™ä¸ªæ—¶å€™æ˜¯å±äº**æ›´æ–°çŠ¶æ€**è€Œä¸æ˜¯**é”€æ¯çŠ¶æ€**ã€‚

ä¾æ®ä»¥ä¸Šå†…å®¹ï¼Œæˆ‘ä»¬æ¥åšä¸ªå°ç»“ã€‚**å…·ä½“å¦‚ä¸‹ï¼š**

- å½“ `useEffect` ä¾èµ–äº `[]` çš„æ—¶å€™ï¼Œåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œ `return` çš„å‡½æ•° `fn` ï¼Œç­‰äº `WillUnMount` ç”Ÿå‘½å‘¨æœŸï¼›
- å½“ `useEffect` æ— ä¾èµ–æˆ–ä¾èµ–äº `[a, b]` çš„æ—¶å€™ï¼Œç»„ä»¶æ˜¯åœ¨æ›´æ–°æ—¶æ‰§è¡Œ `return` çš„å‡½æ•° `fn` ï¼›å³åœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œ `useEffect` ä¹‹å‰ï¼Œå°±ä¼šå…ˆæ‰§è¡Œ `fn` ï¼Œæ­¤æ—¶æ¨¡æ‹Ÿçš„æ˜¯ `DidUpdate` ç”Ÿå‘½å‘¨æœŸã€‚

## 3ã€å…¶ä»– HooksğŸ—ï¸

ä¸Šé¢æˆ‘ä»¬è®²äº†ä¸¤ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„ `hooks` â†’ `useState` å’Œ `useEffect` ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥äº†è§£å…¶ä»–å‡ ä¸ªæ¯”è¾ƒä¸å¸¸ç”¨çš„ `hooks` ã€‚

### ï¼ˆ1ï¼‰useRef

`Ref` æ˜¯ç”¨äºå¯¹ **å€¼çš„ä¿®æ”¹** å’Œ **DOM å…ƒç´ çš„è·å–** ã€‚**å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š**

```js
import React, { useRef, useEffect } from 'react';

function UseRef() {
  const btnRef = useRef(null); // åˆå§‹å€¼

  const numRef = useRef(0);
  numRef.current = 2;

  useEffect(() => {
    console.log(btnRef.current); // DOM èŠ‚ç‚¹
    console.log(numRef.current); // å¾—åˆ°å€¼
  }, []);

  return (
    <div>
      <button ref={btnRef}>click</button>
    </div>
  );
}

export default UseRef;
```

æ­¤æ—¶ï¼Œ**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœä¸ºï¼š**

![useRef](https://img-blog.csdnimg.cn/f9389c65be994a8e9e411ed679d7d75e.png#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå°† `btnRef` ç»‘å®šåˆ° `ref={btnRef}` ä¸Šï¼Œé‚£ä¹ˆ `btnRef.current` è·å–åˆ°çš„æ˜¯å½“å‰çš„ `DOM` èŠ‚ç‚¹ã€‚

å¦å¤–ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¤§å®¶å®šä½åˆ° `numRef` ï¼Œå¦‚æœæˆ‘ä»¬ç»™å…¶è¿›è¡Œèµ‹å€¼å¹¶ä¿®æ”¹ï¼Œé‚£ä¹ˆ `numRef.current` æœ€ç»ˆå¾—åˆ°çš„å€¼æ˜¯ä¿®æ”¹åçš„å€¼ã€‚

### ï¼ˆ2ï¼‰useContext

å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šæœ‰ä¸€äº›æ¯”è¾ƒé™æ€çš„å±æ€§éœ€è¦åšåˆ‡æ¢ï¼Œæ¯”å¦‚ï¼š**ä¸»é¢˜é¢œè‰²åˆ‡æ¢**ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° `context` ä¸Šä¸‹æ–‡æ¥å¤„ç†ã€‚é‚£åœ¨ `hook` ä¸­ï¼Œå°±æœ‰ `useContext` å¯ä»¥å¤„ç†è¿™ä»¶äº‹æƒ…ã€‚å…ˆæ¥çœ‹ä¸€æ®µ**æ¼”ç¤ºä»£ç ï¼š**

```js
import React, { useContext } from 'react';

// ä¸»é¢˜é¢œè‰²
const themes = {
  light: {
    foreground: '#000',
    background: '#eee',
  },
  dark: {
    foreground: '#fff',
    background: '#222',
  },
};

// åˆ›å»º Context
const ThemeContext = React.createContext(themes.light); // åˆå§‹å€¼

function ThemeButton() {
  const theme = useContext(ThemeContext);

  return (
    <button style={{ background: theme.background, color: theme.foreground }}>
      hello world
    </button>
  );
}

function Toolbar() {
  return (
    <div>
      <ThemeButton></ThemeButton>
    </div>
  );
}

function App() {
  return (
    <ThemeContext.Provider value={themes.dark}>
      <Toolbar></Toolbar>
    </ThemeContext.Provider>
  );
}

export default App;
```

æ­¤æ—¶æµè§ˆå™¨çš„**æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useContext](https://img-blog.csdnimg.cn/b16e2d089ee949d7b343235548a51bb8.png#pic_center)

ç°åœ¨å±äº**é»‘è‰²èƒŒæ™¯**çš„ä¸»é¢˜ã€‚å¦‚æœæˆ‘ä»¬è¦åˆ‡æ¢ä¸º**ç™½è‰²èƒŒæ™¯**çš„ä¸»é¢˜ï¼Œé‚£ä¹ˆåªéœ€è¦æŠŠæœ€åº•ä¸‹çš„ä»£ç  `value={themes.dark}` æ”¹ä¸º `value={themes.light}` å³å¯ã€‚

### ï¼ˆ3ï¼‰useReducer

åœ¨ `redux` ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ° `reducer` ï¼Œä½† `useReducer` è·Ÿ `redux` è¿˜æœ‰ä¸€ç‚¹åŒºåˆ«ã€‚ `useReducer` æ˜¯å¯¹å•ä¸ªç»„ä»¶è¿›è¡ŒçŠ¶æ€

**å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š**

```js
import React, { useReducer } from 'react';

const initialState = { count: 0 };

const reducer = (state, action) => {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 };
    case 'decrement':
      return { count: state.count - 1 };
    default:
      return state;
  }
};

function App() {
  // å¾ˆåƒ const [count, setCount] = useState(0)
  const [state, dispatch] = useReducer(reducer, initialState);

  return (
    <div>
      count: {state.count}
      <button onClick={() => dispatch({ type: 'increment' })}>increment</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>decrement</button>
    </div>
  );
}

export default App;
```

æ­¤æ—¶æµè§ˆå™¨çš„**æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useReducer](https://img-blog.csdnimg.cn/3bb32006d3ad47dc9b6e5642a3014ac2.gif#pic_center)

æˆ‘ä»¬å°†è¦æ”¹å˜çš„å€¼æ”¾åˆ° `reducer` å½“ä¸­ï¼Œä¹‹åå†å°† `reducer` ä¼ é€’ç»™ `useRouter` ã€‚æœ€åï¼Œé€šè¿‡ `dispatch` æ¥å¯¹å€¼è¿›è¡Œç»‘å®šã€‚

ä¸‹é¢æˆ‘ä»¬æ¥æ¢³ç†ä¸€ä¸‹ `useRuducer` å’Œ `redux` çš„åŒºåˆ«ï¼š

- `useReducer` æ˜¯ `useState` çš„ä»£æ›¿æ–¹æ¡ˆï¼Œç”¨äºå¤„ç† `state` çš„å¤æ‚å˜åŒ–ï¼›
- `useReducer` æ˜¯**å•ä¸ªç»„ä»¶çŠ¶æ€ç®¡ç†**ï¼Œç»„ä»¶é€šè®¯è¿˜éœ€è¦ `props` ï¼›
- `redux` æ˜¯å…¨å±€çš„**çŠ¶æ€ç®¡ç†**ï¼Œ**å¤šç»„ä»¶å…±äº«æ•°æ®**ã€‚

### ï¼ˆ4ï¼‰useMemo

`useMemo` æ˜¯ `hooks` ä¸­æ€§èƒ½ä¼˜åŒ–çš„ä¸€éƒ¨åˆ†ã€‚å½“æˆ‘ä»¬ä¸ä½¿ç”¨ `useMemo` æ—¶ï¼ŒçŠ¶æ€æ—¶è¿™æ ·çš„ã€‚**çœ‹ä»¥ä¸‹è¿™æ®µä»£ç ï¼š**

```js
import React, { useState } from 'react';

// å­ç»„ä»¶
function Child({ userInfo }) {
  console.log('Child render...', userInfo);

  return (
    <div>
      <p>
        This is Child {userInfo.name} {userInfo.age}
      </p>
    </div>
  );
}

// çˆ¶ç»„ä»¶
function App() {
  console.log('Parent render...');

  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  const userInfo = { name, age: 20 };

  return (
    <div>
      <p>
        count is {count}
        <button onClick={() => setCount(count + 1)}>click</button>
      </p>
      <Child userInfo={userInfo}></Child>
    </div>
  );
}

export default App;
```

æ­¤æ—¶ï¼Œæ§åˆ¶å°çš„**æ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š**

![useMemoâ‘ ](https://img-blog.csdnimg.cn/31ed3c2516584f2a970c008f6977fdd1.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¯æˆ‘ä»¬ç‚¹å‡»ä¸€æ¬¡ï¼Œä¸ç®¡ `state` çš„å€¼æ˜¯å¦æ›´æ–°æ—¶ï¼Œå­ç»„ä»¶ `Child` éƒ½ä¼šé‡æ–°æ‰“å°ä¸€æ¬¡ã€‚ è¿™å¯¹äºç¨‹åºæ¥è¯´ï¼Œæ˜¯æ¯”è¾ƒè€—è´¹æ€§èƒ½çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦ç”¨ `useMemo` æ¥é˜»æ­¢ `Child` äº‹ä»¶é¢‘ç¹æ‰“å°ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚**ä»£ç æ”¹é€ å¦‚ä¸‹ï¼š**

```js
import React, { useState, memo, useMemo } from 'react';

// å­ç»„ä»¶
// ç±»ä¼¼ class PureComponent ï¼Œå¯¹ props è¿›è¡Œæµ…å±‚æ¯”è¾ƒ
const Child = memo(({ userInfo }) => {
  console.log('Child render...', userInfo);

  return (
    <div>
      <p>
        This is Child {userInfo.name} {userInfo.age}
      </p>
    </div>
  );
});

// çˆ¶ç»„ä»¶
function App() {
  console.log('Parent render...');

  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // ç”¨ useMemo ç¼“å­˜æ•°æ®ï¼Œä¾èµ–äº [name]
  //  å½“nameæœ‰æ›´æ–°æ—¶ï¼Œ{ name, age: 18 } è¿™ä¸ªç¼“å­˜å°±ä¼šå¤±æ•ˆ
  const userInfo = useMemo(() => {
    return { name, age: 18 };
  }, [name]);

  return (
    <div>
      <p>
        count is {count}
        <button onClick={() => setCount(count + 1)}>click</button>
      </p>
      <Child userInfo={userInfo}></Child>
    </div>
  );
}

export default App;
```

æ­¤æ—¶ï¼Œæµè§ˆå™¨çš„**æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![useMemoâ‘¡](https://img-blog.csdnimg.cn/5bff530ab3374dc8823bf60966513aa7.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œ `Child` ç»„ä»¶é™¤äº†ç¬¬ä¸€æ¬¡æ›´æ–°æœ‰æ‰“å°ä¹‹å¤–ï¼Œä¹‹åçš„æ²¡æœ‰æ›´æ–°å°±ä¸ä¼šå†è¿›è¡Œæ‰“å°ã€‚é‚£å®ƒæ˜¯æ€ä¹ˆä½¿ç”¨çš„å‘¢ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬è¦ç”¨ `memo` æŠŠå­ç»„ä»¶ç»™åŒ…è£¹ä¸‹æ¥ï¼Œä¹‹åå‘¢ï¼Œé€šè¿‡ `useMemo` å»ç¼“å­˜æ•°æ®ï¼ŒåŒæ—¶è¿™ä¸ªæ•°æ®è¦ä¾èµ–äº `[name]` ï¼›å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸ä¾èµ–äº `[name]` ï¼Œå®ƒæ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥å¯¹ `useMemo` åšä¸ªæ€»ç»“ï¼Œ**å…·ä½“å¦‚ä¸‹ï¼š**

- `React` é»˜è®¤ä¼šæ›´æ–°**æ‰€æœ‰å­ç»„ä»¶**ï¼›
- `class` ç»„ä»¶ä½¿ç”¨ `shouldComponentUpdate` å’Œ `PureComponent` åšä¼˜åŒ–ï¼›
- `Hooks` ä¸­ä½¿ç”¨ `useMemo` åšä¼˜åŒ–ï¼Œä½†ä¼˜åŒ–åŸç†å’Œ `class` ç»„ä»¶æ˜¯ç›¸åŒçš„ã€‚

### ï¼ˆ5ï¼‰useCallback

ä¸Šé¢æˆ‘ä»¬è¯´åˆ°çš„æ˜¯ä½¿ç”¨ `useMemo` æ¥**ç¼“å­˜æ•°æ®**ï¼Œç°åœ¨æˆ‘ä»¬æ¥è®²ä¸‹ `useCallback` ã€‚ `useCallback` ä¸»è¦æ˜¯ç”¨æ¥**ç¼“å­˜å‡½æ•°**ã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨ä¸ä½¿ç”¨ `useCallback` ï¼Œæ¥è¿è¡Œ**ä¸‹é¢è¿™æ®µä»£ç ï¼š**

```js
import React, { useState, memo, useMemo, useCallback } from 'react';

// å­ç»„ä»¶ï¼Œmemo ç›¸å½“äº PureComponent
const Child = memo(({ userInfo, onChange }) => {
  console.log('Child render...', userInfo);

  return (
    <div>
      <p>
        This is Child {userInfo.name} {userInfo.age}
      </p>
      <input onChange={onChange}></input>
    </div>
  );
});

// çˆ¶ç»„ä»¶
function App() {
  console.log('Parent render...');

  const [count, setCount] = useState(0);
  const [name, setName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // ç”¨ useMemo ç¼“å­˜æ•°æ®
  const userInfo = useMemo(() => {
    return { name, age: 21 };
  }, [name]);

  function onChange(e) {
    console.log(e.target.value);
  }

  return (
    <div>
      <p>
        count is {count}
        <button onClick={() => setCount(count + 1)}>click</button>
      </p>
      <Child userInfo={userInfo} onChange={onChange}></Child>
    </div>
  );
}

export default App;
```

æ­¤æ—¶æµè§ˆå™¨çš„æ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š

![useCallbackâ‘ ](https://img-blog.csdnimg.cn/5708c417b4d84450af8ac7061671503b.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ `useCallback` ï¼Œé‚£ä¹ˆå…¶ä¼šä¸€ç›´å°†å­ç»„ä»¶æ‰“å°å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯ `onChange` äº‹ä»¶ä¼šä¸€ç›´è¿è½¬ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°† `onChange` äº‹ä»¶æ”¹é€ ä¸€ä¸‹ï¼Œ**å…·ä½“å¦‚ä¸‹ï¼š**

```js
// ç”¨ useCallback ç¼“å­˜å‡½æ•°
const onChange = useCallback((e) => {
  console.log(e.target.value);
}, []);
```

æ­¤æ—¶æˆ‘ä»¬æ¥çœ‹ä¸‹æµè§ˆå™¨è¿è¡Œçš„æ•ˆæœï¼š

![useCallbackâ‘¡](https://img-blog.csdnimg.cn/dad9d695249c44a28aea2856054596b1.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼ŒåŠ ä¸Š `useCallback` ä¹‹åï¼Œä¸” `Child` æ²¡æœ‰æ›´æ–°æ—¶ï¼Œä¹Ÿå°±ä¸ä¼šå†æ›´æ–°å•¦ï¼

æ¥ä¸‹æ¥æˆ‘ä»¬å¯¹ `useMemo` å’Œ `useCallback` åšä¸ªå°ç»“ï¼š

- `useMemo` ç¼“å­˜æ•°æ®ï¼›
- `useCallback` ç¼“å­˜å‡½æ•°ï¼›
- ä¸¤è€…éƒ½æ˜¯ `React Hooks` çš„å¸¸è§ä¼˜åŒ–ç­–ç•¥ã€‚

## 4ã€è‡ªå®šä¹‰ HookğŸ—ï¸

### ï¼ˆ1ï¼‰ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è‡ªå®šä¹‰ Hook

- ç”¨æ¥å°è£…**é€šç”¨çš„åŠŸèƒ½**ï¼›
- å¯ä»¥**å¼€å‘**å’Œ**ä½¿ç”¨**ç¬¬ä¸‰æ–¹ `Hooks` ï¼›
- è‡ªå®šä¹‰ `Hook` å¸¦æ¥äº†æ— é™çš„æ‰©å±•æ€§ï¼Œè§£è€¦ä»£ç ã€‚

### ï¼ˆ2ï¼‰ä¸¾ä¾‹é˜è¿°

å‡è®¾æˆ‘ä»¬ç°åœ¨æƒ³è¦å°è£…ä¸€ä¸ª `useAxios` ï¼Œé‚£æ€ä¹ˆå®ç°å‘¢ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆåœ¨é¡¹ç›®ä¸­å®‰è£… `axios` ï¼Œ**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```bash
npm i axios --save
```

æ¥ç€ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `src|customHooks` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `useAxios.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { useState, useEffect } from 'react';
import axios from 'axios';

// å°è£… axios å‘é€ç½‘ç»œè¯·æ±‚çš„è‡ªå®šä¹‰ Hook
function useAxios(url) {
  // loading æ¨¡æ‹Ÿå½“å‰æ˜¯å¦å†ç­‰å¾…ä¸­
  const [loading, setLoading] = useState(false);
  // è¯·æ±‚æˆåŠŸæ—¶è¿”å›çš„æ•°æ®
  const [data, setData] = useState();
  // è¯·æ±‚å¤±è´¥æ—¶è¿”å›çš„ä¸€äº›ä¿¡æ¯
  const [error, setError] = useState();

  useEffect(() => {
    // åˆ©ç”¨ axios å‘é€ç½‘ç»œè¯·æ±‚
    setLoading(true);
    axios
      .get(url) // å‘é€ä¸€ä¸ª get è¯·æ±‚
      .then((res) => setData(res))
      .catch((err) => setError(err))
      .finally(() => setLoading(false));
  }, [url]);

  return [loading, data, error];
}

export default useAxios;
```

ç»§ç»­ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `src|components` æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `CustomHookUsage.js` ã€‚è¿™ä¸ªç»„ä»¶ä¸»è¦ç”¨æ¥ä½¿ç”¨ä¸Šé¢æ‰€è‡ªå®šä¹‰çš„ `useAxios` è¿™ä¸ª `hook` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React from 'react';
import useAxios from '../customHooks/useAxios';

function App() {
  const url = 'http://localhost:3000/';
  // æ•°ç»„è§£æ„
  const [loading, data, error] = useAxios(url);

  if (loading) return <div>loading...</div>;

  return error ? (
    <div>{JSON.stringify(error)}</div>
  ) : (
    <div>{JSON.stringify(data)}</div>
  );
}

export default App;
```

æœ€åï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `App.js` ä¸­æ¥ä½¿ç”¨å®ƒã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState } from 'react';
import CustomHookUsage from './components/CustomHookUsage';

function App() {
  return <div>{<CustomHookUsage />}</div>;
}

export default App;
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š

![useAxios](https://img-blog.csdnimg.cn/4feacd5e0f274b3ea6040e32913f8d4d.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆæ˜¯åœ¨ç­‰å¾…çš„æ—¶å€™ï¼Œå®ƒä¼šå…ˆå‡ºç° `loading` ã€‚ä¹‹åå‘¢ï¼Œå¦‚æœåœ¨ç­‰å¾…ç»“æŸå¹¶è¯·æ±‚æˆåŠŸåï¼Œä¼šè¿”å› `data` ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œæ²¡æœ‰æ¼”ç¤º `error` çš„æƒ…å†µã€‚å¤§å®¶å¯ä»¥æŠŠ `url` ä¿®æ”¹ä¸ºä¸å­˜åœ¨çš„è¯·æ±‚åœ°å€ï¼Œå³å¯æµ‹è¯• `error` çš„æƒ…å†µã€‚

### ï¼ˆ3ï¼‰æ€»ç»“

çœ‹å®Œä¸Šé¢çš„æ¼”ç¤ºä»£ç ä»¥åï¼Œæˆ‘ä»¬æ¥åšä¸ªå°ç»“ï¼š

- è‡ªå®šä¹‰ `hook` æœ¬è´¨æ˜¯ä¸€ä¸ª**å‡½æ•°**ï¼Œä»¥ `use` å¼€å¤´ï¼›
- å†…éƒ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ `useState` ã€ `useEffect` æˆ–è€…å…¶ä»– `Hooks` ï¼›
- è‡ªå®šä¹‰è¿”å›ç»“æœï¼Œ**æ ¼å¼ä¸é™**ï¼›

è¿™é‡Œç»™å¤§å®¶æ¨èä¸¤ä¸ªç¬¬ä¸‰æ–¹è‡ªå®šä¹‰ `Hook` çš„åº“ï¼š

- [react-hooks](https://nikgraf.github.io/react-hooks/): https://nikgraf.github.io/react-hooks/
- [hooks](https://nikgraf.github.io/react-hooks/): https://github.com/umijs/hooks

## 5ã€Hooks çš„ä¸¤æ¡é‡è¦è§„åˆ™ ğŸ—ï¸

### ï¼ˆ1ï¼‰Hooks ä½¿ç”¨è§„èŒƒ

- `Hooks` åªèƒ½ç”¨äº `react` å‡½æ•°ç»„ä»¶å’Œè‡ªå®šä¹‰ `Hooks` ä¸­ï¼Œå…¶ä»–åœ°æ–¹éƒ½ä¸å¯ä»¥ã€‚æ¯”å¦‚ï¼šclass ç»„ä»¶ å’Œ æ™®é€šå‡½æ•°ï¼›

- åªèƒ½ç”¨äº**é¡¶å±‚ä»£ç **ï¼Œä¸èƒ½åœ¨**å¾ªç¯**ã€**åˆ¤æ–­**ä¸­ä½¿ç”¨ `Hooks` ï¼›

- `eslint` ä¸­çš„**æ’ä»¶ eslint-plugin-react-hooks** ï¼Œå¯ä»¥å¸®åˆ°ä½ ä½¿ç”¨ `react-hooks` ã€‚**å¦‚ä¸‹é…ç½®æ‰€ç¤ºï¼š**

  ```json
  // ESLint é…ç½®æ–‡ä»¶
  {
    "plugins": [
      // ...æ­¤å¤„çœç•¥ N è¡Œ...
      "react-hooks"
    ],
    "rules": {
      // ...æ­¤å¤„çœç•¥ N è¡Œ ...
      "react-hooks/rules-of-hooks": "error", // æ£€æŸ¥ Hook çš„è§„åˆ™
      "react-hooks/exhaustive-deps": "warn" // æ£€æŸ¥ effect çš„ä¾èµ–
    }
  }
  ```

### ï¼ˆ2ï¼‰Hooks è°ƒç”¨é¡ºåºå¿…é¡»ä¿æŒä¸€è‡´

åœ¨ `react-hooks` ä¸­ï¼Œè°ƒç”¨é¡ºåºæ˜¯å°¤ä¸ºéœ€è¦æ³¨æ„çš„ä¸€ä¸ªå…³é”®ç‚¹ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€æ®µä»£ç æ¥æ¼”ç¤ºï¼š

```js
import React, { useState, useEffect } from 'react';

function Teach({ couseName }) {
  // å‡½æ•°ç»„ä»¶ï¼Œçº¯å‡½æ•°ï¼Œæ‰§è¡Œå®Œå³é”€æ¯
  // æ‰€ä»¥ï¼Œæ— è®ºç»„ä»¶åˆå§‹åŒ–ï¼ˆrenderï¼‰è¿˜æ˜¯ç»„ä»¶æ›´æ–°ï¼ˆre-renderï¼‰
  // éƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ï¼Œè·å–æœ€æ–°çš„ç»„ä»¶
  // è¿™ä¸€ç‚¹å’Œ class ç»„ä»¶ä¸ä¸€æ ·

  // render: åˆå§‹åŒ– state çš„å€¼ 'å¼ ä¸‰'
  // re-render: è¯»å– state çš„å€¼ 'å¼ ä¸‰'
  const [studentName, setStudentName] = useState('å¼ ä¸‰');

  // if (couseName) {
  //     const [studentName, setStudentName] = useState('å¼ ä¸‰')
  // }

  // render: åˆå§‹åŒ– state çš„å€¼ 'åŒè¶Š'
  // re-render: è¯»å– state çš„å€¼ 'åŒè¶Š'
  const [teacherName, setTeacherName] = useState('æ˜ŸæœŸä¸€ç ”ç©¶å®¤');

  // if (couseName) {
  //     useEffect(() => {
  //         // æ¨¡æ‹Ÿå­¦ç”Ÿç­¾åˆ°
  //         localStorage.setItem('name', studentName)
  //     })
  // }

  // render: æ·»åŠ  effect å‡½æ•°
  // re-render: æ›¿æ¢ effect å‡½æ•°ï¼ˆå†…éƒ¨çš„å‡½æ•°ä¹Ÿä¼šé‡æ–°å®šä¹‰ï¼‰
  useEffect(() => {
    // æ¨¡æ‹Ÿå­¦ç”Ÿç­¾åˆ°
    localStorage.setItem('name', studentName);
  });

  // render: æ·»åŠ  effect å‡½æ•°
  // re-render: æ›¿æ¢ effect å‡½æ•°ï¼ˆå†…éƒ¨çš„å‡½æ•°ä¹Ÿä¼šé‡æ–°å®šä¹‰ï¼‰
  useEffect(() => {
    // æ¨¡æ‹Ÿå¼€å§‹ä¸Šè¯¾
    console.log(`${teacherName} å¼€å§‹ä¸Šè¯¾ï¼Œå­¦ç”Ÿ ${studentName}`);
  });

  return (
    <div>
      è¯¾ç¨‹ï¼š{couseName}ï¼Œ è®²å¸ˆï¼š{teacherName}ï¼Œ å­¦ç”Ÿï¼š{studentName}
    </div>
  );
}

export default Teach;
```

ä¸Šé¢çš„ä»£ç æ¼”ç¤ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ç»„ä»¶ã€‚é‚£å¯¹äºå‡½æ•°ç»„ä»¶æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸€èˆ¬æ‰§è¡Œå®Œå°±ä¼šé”€æ¯ã€‚å› æ­¤ï¼Œæ— è®ºæ˜¯ç»„ä»¶åˆå§‹åŒ–ï¼ˆrenderï¼‰è¿˜æ˜¯ç»„ä»¶æ›´æ–°ï¼ˆre-renderï¼‰ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€æ¬¡è¿™ä¸ªå‡½æ•°ï¼Œ**è·å–æœ€æ–°çš„ç»„ä»¶**ã€‚è¿™ä¸€ç‚¹å’Œ `class` ç»„ä»¶ä¸ä¸€æ ·ã€‚

å› æ­¤ï¼Œå‡è®¾æˆ‘ä»¬æŠŠä¸Šé¢çš„ `const [studentName, setStudentName] = useState('å¼ ä¸‰')` ç»™ç”¨ `if` è¯­å¥åŒ…è£¹èµ·æ¥ï¼Œé‚£ä¹ˆå®ƒåœ¨æ‰§è¡Œæ—¶ä¼šå—åˆ°é˜»ç¢ã€‚åŒæ—¶ï¼Œæ²¿ç€åº•ä¸‹çš„é¡ºåºèµ°ä¸‹å»ï¼Œæœ‰å¯èƒ½å°±ä¼šæŠŠ `å¼ ä¸‰` è¿™ä¸ªå€¼ï¼Œèµ‹å€¼ç»™ `teacherName` ã€‚å› æ­¤ï¼Œåœ¨ `react-hooks` ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½å°† `react-hooks` ç”¨åœ¨**å¾ªç¯**å’Œ**åˆ¤æ–­**é‡Œé¢ï¼Œä¸ç„¶ä¼šå¾ˆå®¹æ˜“å¯¼è‡´**è°ƒç”¨é¡ºåºé”™ä¹±**ã€‚

ä¾æ®ä»¥ä¸Šçš„è§£æï¼Œæˆ‘ä»¬æ¥**å¯¹è¿™ä¸ªè§„åˆ™åšä¸ªå°ç»“ï¼š**

- æ— è®ºæ˜¯ `render` è¿˜æ˜¯ `re-render` ï¼Œ `Hooks` è°ƒç”¨é¡ºåºå¿…é¡»æ˜¯ä¸€è‡´çš„ï¼›
- å¦‚æœ `Hooks` å‡ºç°åœ¨**å¾ªç¯**ã€**åˆ¤æ–­**é‡Œï¼Œåˆ™**æ— æ³•ä¿è¯é¡ºåºä¸€è‡´**ï¼›
- `Hooks` ä¸¥é‡ä¾èµ–äºè°ƒç”¨é¡ºåºï¼é‡è¦ï¼

# ä¸‰ã€âŒ¨ï¸React-Hooks ç»„ä»¶é€»è¾‘å¤ç”¨

## 1ã€class ç»„ä»¶çš„é€»è¾‘å¤ç”¨

`class` ç»„ä»¶æœ‰ä¸‰ç§é€»è¾‘å¤ç”¨å½¢å¼ã€‚**åˆ†åˆ«æ˜¯ï¼š**

- Mixin
- é«˜é˜¶ç»„ä»¶ `HOC`
- Render Prop

ä¸‹é¢è¯´ä¸‹å®ƒä»¬ä¸‰è€…å„è‡ªçš„ç¼ºç‚¹ã€‚

### ï¼ˆ1ï¼‰Mixin

- å˜é‡ä½œç”¨åŸŸæ¥æºä¸æ¸…
- å±æ€§**é‡å**
- `mixins` å¼•å…¥è¿‡å¤šä¼šå¯¼è‡´é¡ºåºå†²çª

### ï¼ˆ2ï¼‰é«˜é˜¶ç»„ä»¶ HOC

- ç»„ä»¶å±‚çº§**åµŒå¥—è¿‡å¤š**ï¼Œä¸æ˜“æ¸²æŸ“ï¼Œä¸æ˜“è°ƒè¯•
- `HOC` ä¼šåŠ«æŒ `props` ï¼Œå¿…é¡»ä¸¥æ ¼è§„èŒƒï¼Œ**å®¹æ˜“å‡ºç°ç–æ¼**

### ï¼ˆ3ï¼‰Render Prop

- å­¦ä¹ æˆæœ¬é«˜ï¼Œä¸æ˜“ç†è§£
- **åªèƒ½ä¼ é€’çº¯å‡½æ•°**ï¼Œè€Œé»˜è®¤æƒ…å†µä¸‹**çº¯å‡½æ•°åŠŸèƒ½æœ‰é™**

äº†è§£äº†ä¸‰ç§ `class` ç»„ä»¶çš„ç¼ºç‚¹ä¹‹åï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ `Hooks` åšç»„ä»¶é€»è¾‘å¤ç”¨ã€‚

## 2ã€ä½¿ç”¨ Hooks åšç»„ä»¶é€»è¾‘å¤ç”¨

ä½¿ç”¨ `hooks` æ¥ä½¿å¾—ç»„ä»¶å¯ä»¥è¿›è¡Œé€»è¾‘å¤ç”¨çš„æœ¬è´¨æ˜¯ï¼šè‡ªå®šä¹‰ `hooks` ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥å±•ç¤ºã€‚

### ï¼ˆ1ï¼‰ä¾‹å­é˜è¿°

é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `src|customHooks` æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `useMousePosition.js` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import { useState, useEffect } from 'react';

function useMousePosition() {
  const [x, setX] = useState(0);
  const [y, setY] = useState(0);

  useEffect(() => {
    function mouseMoveHandler(event) {
      // event.clientX å¯ä»¥æ‹¿åˆ°é¼ æ ‡æ¨ªåæ ‡å’Œçºµåæ ‡çš„ä½ç½®
      setX(event.clientX);
      setY(event.clientY);
    }

    // ç»‘å®šäº‹ä»¶
    document.body.addEventListener('mousemove', mouseMoveHandler);

    // è§£ç»‘äº‹ä»¶
    return () =>
      document.body.removeEventListener('mousemove', mouseMoveHandler);
  }, []);

  return [x, y];
}

export default useMousePosition;
```

ç»§ç»­ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `src|components` æ–‡ä»¶å¤¹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º `CustomHookUsage.js` ã€‚è¿™ä¸ªç»„ä»¶ä¸»è¦ç”¨æ¥ä½¿ç”¨ä¸Šé¢ `useMousePosition` ä¸­çš„é€»è¾‘ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React from 'react';
import useMousePosition from '../customHooks/useMousePosition';

function App() {
  const [x, y] = useMousePosition();
  return (
    <div style={{ height: '500px', backgroundColor: '#ccc' }}>
      <p>
        é¼ æ ‡ä½ç½® {x} {y}
      </p>
    </div>
  );
}

export default App;
```

æœ€åï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ `App.js` ä¸­æ¥ä½¿ç”¨å®ƒã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```js
import React, { useState } from 'react';
import CustomHookUsage from './components/CustomHookUsage';

function App() {
  return <div>{<CustomHookUsage />}</div>;
}

export default App;
```

æ­¤æ—¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹**æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœï¼š**

![useMousePosition](https://img-blog.csdnimg.cn/0eaff354c07749e79dfa6bced1b36eb4.gif#pic_center)

ä½¿ç”¨ `hooks` åšç»„ä»¶é€»è¾‘å¤ç”¨ï¼Œè¦æ¯” `class` ç»„ä»¶è¦ç®€ä¾¿å’Œçµæ´»è®¸å¤šã€‚ä¸‹é¢æˆ‘ä»¬æ¥æ¢³ç†ä¸‹ `hooks` åšç»„ä»¶é€»è¾‘å¤ç”¨çš„å¥½å¤„ã€‚

### ï¼ˆ2ï¼‰å¥½å¤„

`Hooks` åšç»„ä»¶é€»è¾‘å¤ç”¨çš„å¥½å¤„ï¼š

- å®Œå…¨ç¬¦åˆ `Hooks` åŸæœ‰çš„è§„åˆ™ï¼Œæ²¡æœ‰å…¶ä»–è¦æ±‚ï¼Œæ˜“ç†è§£å’Œè®°å¿†ï¼›
- å˜é‡ä½œç”¨åŸŸå¾ˆæ˜ç¡®ï¼›
- **ä¸ä¼šäº§ç”Ÿ**ç»„ä»¶åµŒå¥—ã€‚

# å››ã€ğŸ“€React Hooks æ³¨æ„äº‹é¡¹

## 1ã€useState åˆå§‹åŒ–å€¼ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æœ‰æ•ˆ

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œ**å…·ä½“å¦‚ä¸‹ï¼š**

```js
import React, { useState } from 'react';

// å­ç»„ä»¶
function Child({ userInfo }) {
  // render: åˆå§‹åŒ– state
  // re-render: åªæ¢å¤åˆå§‹åŒ–çš„ state å€¼ï¼Œä¸ä¼šå†é‡æ–°è®¾ç½®æ–°çš„å€¼
  //            åªèƒ½ç”¨ setName ä¿®æ”¹
  const [name, setName] = useState(userInfo.name);

  return (
    <div>
      <p>Child, props name: {userInfo.name}</p>
      <p>Child, state name: {name}</p>
    </div>
  );
}

function App() {
  const [name, setName] = useState('æ˜ŸæœŸä¸€');
  const userInfo = { name };

  return (
    <div>
      <div>
        Parent &nbsp;
        <button onClick={() => setName('æ˜ŸæœŸäºŒ')}>setName</button>
      </div>
      <Child userInfo={userInfo} />
    </div>
  );
}

export default App;
```

æ­¤æ—¶ï¼Œæµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

![useStateåˆå§‹åŒ–å€¼](https://img-blog.csdnimg.cn/ce108801e66a43b3b9aded0bf923f132.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»çš„æ—¶å€™ï¼Œåªæ”¹å˜äº† `useInfo.name` çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ª `Child` çš„å€¼ã€‚è€Œæ­¤æ—¶ï¼Œå¯èƒ½æœ‰çš„å°ä¼™ä¼´ä¼šäº§ç”Ÿç–‘æƒ‘è¯´ï¼Œ `useInfo.name` çš„å€¼æ˜¯èµ‹å€¼ç»™ `name` çš„ï¼Œé‚£ä¸ºä»€ä¹ˆç¬¬äºŒä¸ª `Child` ä¸ä¼šæ”¹å˜å‘¢ã€‚

åŸå› åœ¨äºï¼Œå¯¹äº `useState` æ¥è¯´ï¼Œåˆšå¼€å§‹æˆ‘ä»¬æ€»æ˜¯ä¼šç»™ `state` è®¾ç½®ä¸€ä¸ªåˆå§‹åŒ–çš„å€¼ï¼Œè€Œè¿™ä¸ªåˆå§‹åŒ–çš„å€¼ï¼Œå³ä½¿æ˜¯æ•°æ®æ›´æ–°äº†ï¼Œå®ƒåªæœ‰**ç¬¬ä¸€æ¬¡çš„å€¼æ˜¯æœ‰æ•ˆçš„**ï¼Œæ›´æ–°çš„å€¼ä¸ä¼šè¢«èµ‹å€¼åˆ°å…¶ä¸­ã€‚æ‰€ä»¥ä¸‹é¢ç¬¬äºŒä¸ª `Child` ä¸­ `name` å€¼å°±ä¸€ç›´æ˜¯**æ˜ŸæœŸä¸€**ã€‚

## 2ã€useEffect å†…éƒ¨ä¸èƒ½ä¿®æ”¹ state

å…ˆæ¥æ¨¡æ‹Ÿä¸€æ®µä»£ç ï¼š

```js
import React, { useState, useEffect } from 'react';

function UseEffectChangeState() {
  const [count, setCount] = useState(0);

  // æ¨¡æ‹Ÿ DidMount
  useEffect(() => {
    console.log('useEffect...', count);

    // å®šæ—¶ä»»åŠ¡
    const timer = setInterval(() => {
      console.log('setInterval...', count);
      setCount(count + 1);
    }, 1000);

    // æ¸…é™¤å®šæ—¶ä»»åŠ¡
    return () => clearTimeout(timer);
  }, []); // ä¾èµ–ä¸º []

  // ä¾èµ–ä¸º [] æ—¶ï¼š re-render ä¸ä¼šé‡æ–°æ‰§è¡Œ effect å‡½æ•°
  // æ²¡æœ‰ä¾èµ–æ—¶ï¼šre-render ä¼šé‡æ–°æ‰§è¡Œ effect å‡½æ•°

  return <div>count: {count}</div>;
}

export default UseEffectChangeState;
```

æ­¤æ—¶æˆ‘ä»¬æ¥çœ‹ä¸‹æµè§ˆå™¨çš„æ•ˆæœï¼š

![useEffectå†…éƒ¨ä¸èƒ½ä¿®æ”¹stateâ‘ ](https://img-blog.csdnimg.cn/92b8805dc7df4445b525c9e2afc9a134.gif#pic_center)

å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæŒ‰ç…§æˆ‘ä»¬é¢„æœŸæ‰€æƒ³çš„ï¼Œé‚£ä¹ˆåº”è¯¥ä¼šé€’å¢åœ°æ‰“å°å‡º `1234` ï¼Œä½†æ˜¯æœ€ç»ˆæ²¡æœ‰è¿™ä¹ˆæ˜¾ç¤ºï¼Œ`timer` é‡Œé¢æ‰“å°çš„ä¸€ç›´æ˜¯åˆå§‹å€¼ `0` ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ª `state` åœ¨ `useEffect` é‡Œé¢å¹¶ä¸èµ·ä½œç”¨ã€‚

å› æ­¤ï¼Œè¿™ä¸€ç‚¹åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­éœ€è¦å°¤ä¸ºæ³¨æ„ï¼Œæœ‰å¯èƒ½ä»£ç å†™ç€å†™ç€ `bug` å°±å‡ºç°åœ¨è¿™äº†ã€‚

---

é‚£æ—¢ç„¶é—®é¢˜å‡ºç°äº†ï¼Œæˆ‘ä»¬å°±éœ€è¦æ¥æƒ³ä¸€ä¸‹å®ƒçš„è§£å†³æ–¹æ¡ˆäº†ã€‚**æ”¹é€ å¦‚ä¸‹ï¼š**

```js
import React, { useState, useRef, useEffect } from 'react';

function UseEffectChangeState() {
  const [count, setCount] = useState(0);

  // æ¨¡æ‹Ÿ DidMount
  const countRef = useRef(0);
  useEffect(() => {
    console.log('useEffect...', count);

    // å®šæ—¶ä»»åŠ¡
    const timer = setInterval(() => {
      console.log('setInterval...', countRef.current);
      // setCount(count + 1)
      setCount(++countRef.current);
    }, 1000);

    // æ¸…é™¤å®šæ—¶ä»»åŠ¡
    return () => clearTimeout(timer);
  }, []); // ä¾èµ–ä¸º []

  // ä¾èµ–ä¸º [] æ—¶ï¼š re-render ä¸ä¼šé‡æ–°æ‰§è¡Œ effect å‡½æ•°
  // æ²¡æœ‰ä¾èµ–ï¼šre-render ä¼šé‡æ–°æ‰§è¡Œ effect å‡½æ•°

  return <div>count: {count}</div>;
}

export default UseEffectChangeState;
```

æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š

![useEffectå†…éƒ¨ä¸èƒ½ä¿®æ”¹stateâ‘¡](https://img-blog.csdnimg.cn/b89f6dd8550041408a8973b30b7975a7.gif#pic_center)

çœ‹ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé€šè¿‡æŠŠ `countRef` æ”¾åˆ° `useEffect` å¤–éƒ¨ï¼Œå¹¶ä½¿ç”¨ `useRef` ï¼Œä»¥æ­¤æ¥å¯¹ `state` çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¾¾åˆ°æˆ‘ä»¬æœ€ç»ˆçš„ç›®çš„ã€‚

## 3ã€useEffect å¯èƒ½å‡ºç°æ­»å¾ªç¯

å‡è®¾æˆ‘ä»¬è¦åˆ©ç”¨ `axios` å‘é€ç½‘ç»œè¯·æ±‚ï¼Œå¹¶ä¸”æœ‰æƒ³è¦ç»™ `url` åŠ ä¸€äº›é…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰å¯èƒ½è¿™ä¹ˆå¤„ç†ï¼š

```js
import { useState, useEffect } from 'react';
import axios from 'axios';

// å°è£… axios å‘é€ç½‘ç»œè¯·æ±‚çš„è‡ªå®šä¹‰ Hook
function useAxios(url, config = {}) {
  const [loading, setLoading] = useState(false);
  const [data, setData] = useState();
  const [error, setError] = useState();

  useEffect(() => {
    // åˆ©ç”¨ axios å‘é€ç½‘ç»œè¯·æ±‚
    setLoading(true);
    axios(url, config) // å‘é€ä¸€ä¸ª get è¯·æ±‚
      .then((res) => setData(res))
      .catch((err) => setError(err))
      .finally(() => setLoading(false));
  }, [url, config]);

  return [loading, data, error];
}

export default useAxios;
```

çœ‹ç€æ˜¯æŒºåˆç†ï¼Œä½†æ˜¯å‘¢ï¼Œå½“`config` ä½¿ç”¨çš„æ˜¯**å¼•ç”¨æ•°æ®ç±»å‹**æ—¶ï¼Œä¹Ÿå°±æ˜¯ `config={}` æˆ–è€… `confgi=[]` æ—¶ï¼Œ `useEffect` ä¼šå‡ºç°æ­»å¾ªç¯ï¼Œæ— é™çš„å‘é€è¯·æ±‚ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬æƒ³è¦ç»™ `axios` ä¼ å€¼æ—¶ï¼Œåªèƒ½ä¼ åŸºæœ¬æ•°æ®ç±»å‹çš„ã€‚**æ”¹é€ ä»£ç å¦‚ä¸‹ï¼š**

```js
import { useState, useEffect } from 'react'
import axios from 'axios'

// å°è£… axios å‘é€ç½‘ç»œè¯·æ±‚çš„è‡ªå®šä¹‰ Hook
function useAxios(url) {
    const [loading, setLoading] = useState(false
    const [data, setData] = useState()
    const [error, setError] = useState()

    useEffect(() => {
        // åˆ©ç”¨ axios å‘é€ç½‘ç»œè¯·æ±‚
        setLoading(true)
        axios.get(url) // å‘é€ä¸€ä¸ª get è¯·æ±‚
            .then(res => setData(res))
            .catch(err => setError(err))
            .finally(() => setLoading(false))
    }, [url])

    return [loading, data, error]
}

export default useAxios

```

è¿™æ ·ï¼Œæ‰ä¸ä¼šå‡ºç°æ­»å¾ªç¯åœ°ä¸€ç›´ç¿»æ»šçš„**å¯¹æ¥å£å‘é€æ•°æ®è¯·æ±‚**ã€‚

# äº”ã€ğŸ” ç»“æŸè¯­

åœ¨ä¸Šé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆè®¤è¯†äº† `hooks` çš„åŸºæœ¬æ¦‚å¿µï¼Œæ¥ç€ï¼Œæˆ‘ä»¬é‡ç‚¹é˜è¿°äº† `state hook` å’Œ `effect hook` ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿç®€å•åœ°äº†è§£äº†å…¶ä»–å‡ ç§ `hooks` ã€‚æœ€åï¼Œè°ˆåˆ°äº† react-hooks åœ¨ç»„ä»¶é€»è¾‘å¤ç”¨æ–¹é¢çš„è´¡çŒ®ï¼Œä»¥åŠ `react-hooks` éœ€è¦æ³¨æ„ä¸€äº›äº‹é¡¹ã€‚

åˆ°è¿™é‡Œï¼Œå…³äº `react-hooks` çš„ä»‹ç»å°±ç»“æŸå•¦ï¼ä¸çŸ¥é“å¤§å®¶å¯¹ `react-hooks` åˆæœ‰äº†ä¸€äº›æ–°çš„äº†è§£å‘¢ï¼Ÿ

# ğŸ£ å½©è›‹ One More Thing

## ï¼ˆï¼šå¾€æœŸæ¨è

react ä¸“æ æˆ³è¿™é‡Œ [https://juejin.cn/column/7018019097656950815](https://juejin.cn/column/7018019097656950815)

## ï¼ˆï¼šå®

- å…³æ³¨å…¬ä¼—å·**æ˜ŸæœŸä¸€ç ”ç©¶å®¤**ï¼Œç¬¬ä¸€æ—¶é—´å…³æ³¨ä¼˜è´¨æ–‡ç« ï¼Œ**æ›´æœ‰ã€Œoffer æ¥äº†ã€é¢è¯•ä¸“æ å¾…ä½ è§£é”**~
- å¦‚æœæ‚¨è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰å¸®åŠ©åˆ°æ‚¨çš„çš„è¯è®°å¾—**ç•™ä¸ªè„šå° jio**å†èµ°å“Ÿ~~ğŸ˜‰
- ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼æˆ‘ä»¬ä¸‹æœŸè§ï¼ğŸ‘‹ğŸ‘‹ğŸ‘‹

---
title: æ¨¡æ¿ç¼–è¯‘templateçš„èƒŒåï¼Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿå¸¦ä½ äº†è§£templateçš„çº¸çŸ­æƒ…é•¿
author: å‘¨ä¸€
date: '2021-12-12'
categories:
  - å‰ç«¯å¼€å‘
tags:
  - vue.jsåŸç†è§£æ
sidebar: 'auto'
---

![template cover](https://img-blog.csdnimg.cn/20210609111554481.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center)

@[toc](è§£ææ¨¡æ¿ç¼–è¯‘templateçš„èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆ)
ä¾ç¨€è®°å¾—æˆ‘ä»¬åœ¨ vue æ—¶ï¼Œæœ€ä¸Šæ–¹æ€»æ˜¯æœ‰ä¸€ä¸ª `template` åŒ…å›´ç€ã€‚è€Œå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿæ²¡æœ‰å¾ˆåœ¨æ„çš„å»æ„è¯†åˆ° `<template></template>` ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚

åœ¨ä»Šå¤©çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œå°±å¸¦å¤§å®¶ä¸€èµ·æ¥äº†è§£ï¼Œæ¨¡æ¿ç¼–è¯‘ `template` çš„èƒŒåï¼Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…ï¼Ÿ

ä¸€èµ·æ¥äº†è§£æ¨¡æ¿ç¼–è¯‘çš„çº¸çŸ­æƒ…é•¿ ğŸš‹ğŸš‹ğŸš‹

# ä¸€ã€ğŸ“‘ åˆè¯†æ¨¡æ¿ç¼–è¯‘

## 1ã€vue ç»„ä»¶ä¸­ä½¿ç”¨ render ä»£æ›¿ template

`template` ï¼Œå³æ¨¡æ¿ã€‚æ¨¡æ¿æ˜¯ `vue` å¼€å‘ä¸­æœ€å¸¸ç”¨çš„éƒ¨åˆ†ï¼Œå³ä¸ vue çš„ä½¿ç”¨å…³è”æœ€ç´§å¯†çš„åŸç†ã€‚å®ƒä¸æ˜¯ `html` ï¼Œå®ƒæœ‰æŒ‡ä»¤ã€æœ‰æ’å€¼ã€ä¹Ÿæœ‰ `JS` è¡¨è¾¾å¼ï¼Œé‚£å®ƒï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸ªä¾‹å­ã€‚

åœ¨ `vue` ä¸­å®šä¹‰ä¸€ä¸ªç»„ä»¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ `template` æ¨¡æ¿å­—ç¬¦ä¸²æ¥å®šä¹‰ä¸€ä¸ªç»„ä»¶ã€‚**æ¯”å¦‚ï¼š**

```js
Vue.component('heading', {
  template: `xxx`,
});
```

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨¡æ¿çš„å®šä¹‰æ˜¯ä¸Šé¢è¿™ç§æƒ…å†µã€‚åŒæ—¶ï¼Œåœ¨ç¨‹åºç¼–è¯‘æœŸé—´ï¼Œæ¨¡æ¿ä¼šå°† `template` çš„è¿™ç§**å­—ç¬¦ä¸²ç±»å‹**ï¼Œç¼–è¯‘æˆ `render` å‡½æ•°ã€‚

---

ä½†æ˜¯å‘¢ï¼Œåœ¨æœ‰äº›å¤æ‚çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½å°±ä¸èƒ½ç”¨ `template` å‡½æ•°äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè€ƒè™‘ç›´æ¥ç”¨ `render` å‡½æ•°æ¥å®šä¹‰ä¸€ä¸ªç»„ä»¶ã€‚**æ¯”å¦‚ï¼š**

```js
Vue.component('heading', {
  render: function (createElement) {
    return createElement(
      'h' + this.level, //tag props
      [
        //children
        createElement(
          'a',
          {
            attrs: {
              name: 'headerId',
              href: '#' + 'headerId',
            },
          },
          'this is a tag'
        ),
      ]
    );
  },
});
```

å°±åƒä¸Šé¢è¿™æ ·å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ª `render` å‡½æ•°æ¥å®šä¹‰ä¸€ä¸ªç»„ä»¶ã€‚

## 2ã€æ¨¡æ¿ç¼–è¯‘æ€»ç»“

çœ‹å®Œä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥åšä¸ªå°ç»“ âœ¨

- templateï¼Œå³æ¨¡æ¿ã€‚è¿™ä¸ªæ¨¡æ¿ä¼šç¼–è¯‘æˆ `render` å‡½æ•°ï¼Œå…¶ä¸­ `render` å‡½æ•°ç”¨çš„æ˜¯ `with` è¯­æ³•ã€‚
- è¿‡ç¨‹ï¼šæ¨¡æ¿ â†’ `render` å‡½æ•° â†’ `vnode` â†’ ç»„ä»¶æ¸²æŸ“å’Œæ›´æ–°è¿‡ç¨‹ã€‚
- `vue` ç»„ä»¶å¯ä»¥ç”¨ `render` å‡½æ•°ä»£æ›¿ `template` ã€‚
- `React` ä¸€ç›´éƒ½ç”¨ `render` ï¼Œæ²¡æœ‰æ¨¡æ¿ï¼ˆè¿™é‡Œä»…ä½œçŸ¥è¯†è¡¥å……ï¼Œä¸åšè®²è§£ï¼‰ã€‚

# äºŒã€âœï¸ æ„Ÿå—æ¨¡æ¿ç¼–è¯‘çš„ç¾

## 1ã€with è¯­æ³•

### ï¼ˆ1ï¼‰ä¾‹å­å±•ç¤º ğŸŒ°

å…ˆæ¥äº†è§£æ¨¡æ¿ç¼–è¯‘ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„çŸ¥è¯†ç‚¹ï¼Œ `with` è¯­æ³•ã€‚ä¸‹é¢å…ˆç”¨ä¸€ä¸ªä¾‹å­æ¥å±•ç¤º with è¯­æ³•ä¸æ™®é€šè¯­æ³•çš„ä¸åŒã€‚

**ä¸ä½¿ç”¨ with è¯­æ³•æ‰§è¡Œç¨‹åºæ—¶ï¼š**

```js
const obj = { a: 100, b: 200 };

console.log(obj.a);
console.log(obj.b);
console.log(obj.c); //undefined
```

**ä½¿ç”¨ with è¯­æ³•æ‰§è¡Œç¨‹åºæ—¶ï¼š**

```js
//ä½¿ç”¨withï¼Œèƒ½æ”¹å˜ {} å†…è‡ªç”±å˜é‡çš„æŸ¥æ‰¾æ–¹å¼
// å°† {} å†…è‡ªç”±å˜é‡ï¼Œå½“ä½œ obj çš„å±æ€§æ¥æŸ¥æ‰¾
with (obj) {
  console.log(a);
  console.log(b);
  console.log(c); //ä¼šæŠ¥é”™ï¼ï¼ï¼
}
```

### ï¼ˆ2ï¼‰çŸ¥è¯†ç‚¹å½’çº³

çœ‹å®Œä¸Šé¢ with è¯­æ³•çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥å¯¹ `with` è¯­æ³•åšä¸€ä¸ªçŸ¥è¯†ç‚¹å½’çº³ã€‚

- `with` è¯­æ³•ä¼šæ”¹å˜ `{}` å†…**è‡ªç”±å˜é‡çš„æŸ¥æ‰¾è§„åˆ™**ï¼Œå½“ä½œ `obj` å±æ€§æ¥æŸ¥æ‰¾ï¼›
- å¦‚æœåœ¨å½“å‰ `{}` å†…æ‰¾ä¸åˆ°åŒ¹é…çš„ `obj` å±æ€§ï¼Œå°±ä¼šæŠ¥é”™ï¼›
- `with` è¦è°¨æ…ä½¿ç”¨ï¼Œå®ƒæ‰“ç ´äº†**ä½œç”¨åŸŸè§„åˆ™**ï¼Œä¼šè®©å…¶**æ˜“è¯»æ€§å˜å·®**ã€‚

# ä¸‰ã€ğŸ“ˆ ç¼–è¯‘æ¨¡æ¿

## 1ã€ç¼–è¯‘æ¨¡æ¿ç¢ç¢å¿µ

åœ¨å‰é¢ä¸­æˆ‘ä»¬è®²è¿‡ï¼Œæ¨¡æ¿å®ƒä¸æ˜¯ `html` ï¼Œå®ƒæœ‰**æŒ‡ä»¤**ã€æœ‰**æ’å€¼**ã€ä¹Ÿæœ‰**JS è¡¨è¾¾å¼**ï¼Œå®ƒèƒ½å®ç°åˆ¤æ–­ã€ä¹Ÿèƒ½å®ç°å¾ªç¯ã€‚

è¯•æƒ³ä¸€ä¸‹æ¨¡æ¿ä¸ºä»€ä¹ˆä¸æ˜¯ `html` ï¼Ÿ

æ€è€ƒä¸€ä¸‹ï¼Œå‡å¦‚ä½ åœ¨å†™ç¨‹åºæ—¶ï¼Œèƒ½ç”¨ `html` å†™å‡ºä¸€ä¸ªåˆ¤æ–­æˆ–è€…å¾ªç¯å‡ºæ¥å—ï¼Ÿç­”æ¡ˆè‡ªç„¶æ—¶ä¸è¡Œçš„ã€‚

æ‰€ä»¥è¯´ï¼Œ `html` åªæ˜¯ä¸€ä¸ª**é™æ€çš„æ ‡ç­¾è¯­è¨€**ï¼Œä½ å†™ä»€ä¹ˆå®ƒå°±æ˜¾ç¤ºä»€ä¹ˆï¼Œå®ƒæ²¡æœ‰åŠæ³•å®ç°ä¸€ä¸ªé€»è¾‘ï¼Œæˆ–è€…åšå¾ªç¯å’Œåˆ¤æ–­ã€‚

å› æ­¤ï¼Œå¯¹äºå‰ç«¯æµè§ˆå™¨è€Œè¨€ï¼Œåªæœ‰ `JS` æ‰èƒ½å®ç°åˆ¤æ–­å’Œå¾ªç¯ç­‰å„ç§é€»è¾‘åŠŸèƒ½ã€‚

æ‰€ä»¥ï¼Œ**æ¨¡æ¿**ä¸€å®šæ˜¯**è½¬æ¢ä¸ºæŸç§ `JS` ä»£ç **ä¹‹åæ‰è¿›è¡Œè¿è¡Œçš„ã€‚è€Œè¿™ä¸ªæ¨¡æ¿æ€ä¹ˆè½¬æ¢æˆ `js` ä»£ç çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±ç§°ä¸º**ç¼–è¯‘æ¨¡æ¿**ã€‚

é‚£è¿™ä¸ªæ¨¡æ¿æ˜¯æ€ä¹ˆè½¬çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ä¸‹ç¼–è¯‘æ¨¡æ¿çš„è¿‡ç¨‹ã€‚

## 2ã€ç¼–è¯‘æ¨¡æ¿è¿‡ç¨‹

### ï¼ˆ1ï¼‰åˆå§‹åŒ–ä¸€ä¸ª npm ç¯å¢ƒ

é¦–å…ˆå…ˆå»ºç«‹ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå¯ä»¥å‘½åä¸º `vue-template-complier-demo` ã€‚ä¹‹åç”¨ä»¥ä¸‹å‘½ä»¤è¡Œåˆå§‹åŒ–ä¸€ä¸ª npm çš„ç¯å¢ƒï¼š

```bash
npm init -y
```

### ï¼ˆ2ï¼‰å®‰è£…ç¼–è¯‘å™¨

`npm` å®‰è£…æ¨¡æ¿ç¼–è¯‘å™¨ã€‚**å‘½ä»¤è¡Œå¦‚ä¸‹ï¼š**

```bash
npm install vue-template-compiler --save
```

### ï¼ˆ3ï¼‰æ–°å»ºæ–°æ–‡ä»¶

åœ¨æ ¹ç›®å½•ä¸‹åˆå§‹åŒ–æ–°å»ºä¸€ä¸ª `index.js` æ–‡ä»¶ï¼Œå¹¶å¼•å…¥ `vue-template-compiler` ã€‚ä»£ç å¦‚ä¸‹ï¼š

```js
//å¼•å…¥vue-template-compiler
const compiler = require('vue-template-compiler');

// ç¼–è¯‘
const res = compiler.compile(template);
console.log(res.render);
```

æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹ä¸‹ï¼Œæ¨¡æ¿ä¸­çš„æ’å€¼ã€è¡¨è¾¾å¼ã€å±æ€§å’ŒåŠ¨æ€å±æ€§ç­‰ç­‰ç±»å‹çš„ç¼–è¯‘ï¼Œåˆ°åº•æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ

### ï¼ˆ4ï¼‰äº†è§£ç¼©å†™å‡½æ•°

ä»¥ä¸‹ vue æºç ä¸­çš„ç¼©å†™å‡½æ•°å…ˆäº†è§£ï¼Œå°†åœ¨ä¸‹é¢çš„è®²è§£ä¸­ç”¨åˆ°ã€‚

```js
// ä» vue æºç ä¸­æ‰¾åˆ°ç¼©å†™å‡½æ•°çš„å«ä¹‰
function installRenderHelpers(target) {
  target._c = createElement;
  target._o = markOnce;
  target._n = toNumber;
  target._s = toString;
  target._l = renderList;
  target._t = renderSlot;
  target._q = looseEqual;
  target._i = looseIndexOf;
  target._m = renderStatic;
  target._f = resolveFilter;
  target._k = checkKeyCodes;
  target._b = bindObjectProps;
  target._v = createTextVNode;
  target._e = createEmptyVNode;
  target._u = resolveScopedSlots;
  target._g = bindObjectListeners;
  target._d = bindDynamicKeys;
  target._p = prependModifier;
}
```

### ï¼ˆ5ï¼‰ç¼–è¯‘æ’å€¼

```js
//å¼•å…¥vue-template-compiler
const compiler = require('vue-template-compiler');

// æ’å€¼
const template = `<p>{{message}}</p>`;
// with(this){return createElement('p',[createTextVNode(toString(message))])}
// h -> vnode
// createElement -> vnode

// ç¼–è¯‘
const res = compiler.compile(template);
console.log(res.render);
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![ç¼–è¯‘æ’å€¼](https://img-blog.csdnimg.cn/20210609111638271.png#pic_)

ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ**æ’å€¼**ç±»å‹çš„æ¨¡æ¿æœ€ç»ˆè¢«ç¼–è¯‘æˆä¸€ä¸ª `with` è¯­å¥ï¼Œå¹¶ä¸”è¿™ä¸ª `with` è¯­å¥çš„å‚æ•°éƒ½æŒ‡å‘äº† `this` ã€‚

åŒæ—¶ï¼Œå¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢æœ‰ä¸€ä¸ª `_c` ï¼Œ `_v` ï¼Œ `_s`ã€‚é‚£è¿™å‡ ä¸ªå…ƒç´ æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

è¿™ä¸ªå°±æ˜¯ä¸Šé¢ç¬¬å››ç‚¹ä¸­æåˆ°çš„ `vue` æºç ä¸­çš„ç¼©å†™å‡½æ•°ã€‚ `_c` å¯¹åº”çš„å°±æ˜¯æºç ä¸­çš„ `createElement`ï¼Œ `_v` å¯¹åº”çš„å°±æ˜¯æºç ä¸­çš„ `createTextVNode` ï¼Œ`_s` å¯¹åº”çš„å°±æ˜¯æºç ä¸­çš„ `toString` ã€‚

æ‰€ä»¥ï¼Œä»¥ä¸Šç¼–è¯‘åçš„ `with` è¯­å¥ `with(this){return _c('p',[_v(_s(message))])} ` ï¼Œäº‹å®ä¸Šå°±æ˜¯ `with(this){return createElement('p',[createTextVNode(toString(message))])}` ã€‚

ä»¥ä¸Šè¿™ä¸ªè¯­å¥çš„æ„æ€ä¸ºï¼Œç¼–è¯‘åˆ›å»ºä¸€ä¸ª `p` å…ƒç´ ï¼Œä¹‹åå‘¢ï¼Œ `p` å…ƒç´ å°±æ²¡æœ‰å­å…ƒç´ äº†ï¼Œäºæ˜¯å°±åˆ›å»ºå®ƒçš„æ–‡æœ¬èŠ‚ç‚¹ `message` ï¼ŒåŒæ—¶ `message` æ˜¯å­—ç¬¦ä¸²çš„å½¢å¼å­˜åœ¨ï¼Œå› æ­¤è¦è¿›è¡Œ `toString` ã€‚

é¢å¤–å†è¡¥å……ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œ `createElement` å…¶å®å°±ç­‰äºæˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ `h` å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ª `è™šæ‹ŸDOM` èŠ‚ç‚¹ã€‚

ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ª**æ’å€¼æ¨¡æ¿**ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œä¸‹é¢å†ç”¨å‡ ä¸ªä¾‹å­è®©å¤§å®¶ç†Ÿæ‚‰ã€‚

### ï¼ˆ6ï¼‰ç¼–è¯‘è¡¨è¾¾å¼

```js
//å¼•å…¥vue-template-compiler
const compiler = require('vue-template-compiler');

// è¡¨è¾¾å¼
const template = `<p>{{flag ? message : 'no message found'}}</p>`;
// with(this){return _c('p',[_v(_s(flag ? message : 'no message found'))])}

// ç¼–è¯‘
const res = compiler.compile(template);
console.log(res.render);
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![è¡¨è¾¾å¼](https://img-blog.csdnimg.cn/20210609111652962.png#)

ä¾æ®ä¸Šé¢æ’å€¼çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**è¡¨è¾¾å¼**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

**è¡¨è¾¾å¼**ç¼–è¯‘åçš„ç»“æœè¿”å›äº†ä¸€ä¸ªè™šæ‹Ÿ `DOM` èŠ‚ç‚¹ï¼ŒåŒæ ·åœ°ï¼ŒæŸ¥è¯¢ `vue` æºç ä¸­çš„ç¼©å†™å‡½æ•°æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ `with(this){return _c('p',[_v(_s(flag ? message : 'no message found'))])}` æœ€ç»ˆçš„ç»“æœç­‰äº `with(this){return createElement('p',[createTextVnode(toString(flag ? message : 'no message found'))])}` ã€‚

å…ˆåˆ›å»ºäº†ä¸€ä¸ª `p` å…ƒç´ ï¼Œä¹‹å `p` å…ƒç´ **æ²¡æœ‰å­å…ƒç´ **äº†ï¼Œäºæ˜¯**åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹**ï¼Œæœ€ç»ˆ `toString` ä¸‰ç›®è¡¨è¾¾å¼é‡Œé¢çš„å†…å®¹ã€‚

### ï¼ˆ7ï¼‰ç¼–è¯‘å±æ€§å’ŒåŠ¨æ€å±æ€§

```js
//å¼•å…¥vue-template-compiler
const compiler = require('vue-template-compiler');

// å±æ€§å’ŒåŠ¨æ€å±æ€§
const template = `
    <div id="div1" class="container">
        <img :src="imgUrl"/>
    </div>
`;
// with(this){return _c('div',
//      {staticClass:"container",attrs:{"id":"div1"}},
//      [
//          _c('img',{attrs:{"src":imgUrl}})])}

// ç¼–è¯‘
const res = compiler.compile(template);
console.log(res.render);
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![å±æ€§å’ŒåŠ¨æ€å±æ€§](https://img-blog.csdnimg.cn/20210609111716251.png#)

ä¾æ®ä¸Šé¢çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**å±æ€§å’ŒåŠ¨æ€å±æ€§**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

**å±æ€§å’ŒåŠ¨æ€å±æ€§**ç¼–è¯‘åçš„ç»“æœè¿”å›äº†ä¸€ä¸ªè™šæ‹Ÿ `DOM` èŠ‚ç‚¹ï¼ŒåŒæ ·åœ°ï¼ŒæŸ¥è¯¢ `vue` æºç ä¸­çš„**ç¼©å†™å‡½æ•°**æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œ `with(this){return _c('div',{staticClass:"container",attrs:{"id":"div1"}},[_c('img',{attrs:{"src":imgUrl}})])}` æœ€ç»ˆçš„ç»“æœç­‰äº `with(this){return createElement('div',{staticClass:"container",attrs:{"id":"div1"}},[createElement('img',{attrs:{"src":imgUrl}})])}` ã€‚

æ­¤æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„ `vnode` èŠ‚ç‚¹ä¸­ï¼ŒåŒ…å« `class` åå­—ï¼Œ `container` ã€‚æ­¤æ—¶ `div` æœ‰ä¸€ä¸ª `id` é€‰æ‹©å™¨ï¼Œè¿™ä¸ª `id` é€‰æ‹©å™¨æ˜¯è¯¥ `div` çš„ä¸€ä¸ªå±æ€§ï¼Œäºæ˜¯å°±é€šè¿‡ attrs æ¥è¡¨ç¤ºã€‚

æœ€å¤–å±‚ç»“æŸåï¼Œé‡Œé¢è¿˜æœ‰ä¸€å±‚ï¼Œ `img` ã€‚ `img` å¯ä»¥è§†å…¶ä¸ºè·Ÿ `div` ä¸€æ ·çš„æ ‡ç­¾ï¼Œäºæ˜¯å…ˆåˆ›å»º `img` å…ƒç´ ï¼Œåˆå› ä¸º `img` ç»‘å®šäº†ä¸€ä¸ªå…·ä½“çš„å€¼ï¼Œå°±åƒæ˜¯ ` div` é‡Œé¢ç»‘å®šäº† `id` é€‰æ‹©å™¨ã€‚æ‰€ä»¥åœ¨åˆ›å»ºå®Œ `img` çš„å€¼ä¹‹åï¼Œç»§ç»­ç”¨ `attrs` æ¥ä¼ é€’ `img` æ‰€ç»‘å®šçš„å€¼ã€‚

### ï¼ˆ8ï¼‰ç¼–è¯‘æ¡ä»¶

```js
// æ¡ä»¶
const template = `
    <div>
        <p v-if="flag === 'a'">A</p>
        <p v-else>B</p>
    </div>
`;
// with(this){return _c('div',[(flag === 'a')?_c('p',[_v("A")]):_c('p',[_v("B")])])}
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![æ¡ä»¶](https://img-blog.csdnimg.cn/20210609111730979.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#)

ä¾æ®ä¸Šé¢çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**æ¡ä»¶**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

å¯¹äº**æ¡ä»¶**æ¥è¯´ï¼Œé¦–å…ˆæ˜¯å…ˆåˆ›å»ºä¸€ä¸ª `div` å…ƒç´ ï¼Œä¹‹åå‘¢ï¼Œæ¨¡æ¿ç¼–è¯‘æŠŠ `v-if` å’Œ `v-else` åˆ†å‰²æˆä¸€ä¸ªä¸‰ç›®è¡¨è¾¾å¼çš„æ–¹å¼æ¥è¿›è¡Œç¼–è¯‘ã€‚

### ï¼ˆ9ï¼‰ç¼–è¯‘å¾ªç¯

```js
// å¾ªç¯
const template = `
    <ul>
        <li v-for="item in list" :key="item.id">{{item.title}}</li>
    </ul>
`;
// with(this){return _c('ul',_l((list),function(item){return _c('li',{key:item.id},[_v(_s(item.title))])}),0)}
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![å¾ªç¯](https://img-blog.csdnimg.cn/20210609111742344.png#)

ä¾æ®ä¸Šé¢çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**å¾ªç¯**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

å¯¹äºä»¥ä¸Š**å¾ªç¯**æ¥è¯´ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª `ul` å…ƒç´ ï¼Œä¹‹åæŸ¥è¯¢ `_l` çš„ç¼©å†™å‡½æ•°æˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ `renderlist` ï¼Œ æ‰€ä»¥ `list` åˆ—è¡¨ä¼šè¢« `renderList` å‡½æ•°è¿›è¡Œç¼–è¯‘ã€‚

æœ€åæ¸²æŸ“åçš„ `item` è¢«å½“ä½œ**å‡½æ•°çš„å‚æ•°**è¿›è¡Œä¼ é€’ï¼Œå¹¶åˆ—è¿”å›å¯¹åº” `item` çš„ `li` åˆ—è¡¨å…ƒç´ ã€‚

### ï¼ˆ10ï¼‰ç¼–è¯‘äº‹ä»¶

```js
// äº‹ä»¶
const template = `
    <button @click="clickHandler">submit</button>
`;
// with(this){return _c('button',{on:{"click":clickHandler}},[_v("submit")])}
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![äº‹ä»¶](https://img-blog.csdnimg.cn/20210609111754309.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#)

ä¾æ®ä¸Šé¢çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**äº‹ä»¶**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

å¯¹äº**äº‹ä»¶**æ¥è¯´ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª `button` å…ƒç´ ï¼Œä¹‹å `@click` å³ `v-on:click` ä¼šè¢«ç¼–è¯‘æˆ `on:{"click":clickHandler}` ã€‚æœ€åæ˜¯ `_v` ï¼Œå³ `createTextVNode` ã€‚åˆ›å»ºä¸€ä¸ª `submit` çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œå°† `click` çš„å†…å®¹æäº¤ä¸Šå»ã€‚

### ï¼ˆ11ï¼‰ç¼–è¯‘ v-model

```js
// v-model
const template = `<input type="text" v-model="name">`;
// ä¸»è¦çœ‹ input äº‹ä»¶
// with(this){return _c('input',{directives:[{name:"model",rawName:"v-model",value:(name),expression:"name"}],attrs:{"type":"text"},domProps:{"value":(name)},on:{"input":function($event){if($event.target.composing)return;name=$event.target.value}}})}
```

**ç¼–è¯‘ä»¥ä¸Šå†…å®¹ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š**

![v-model](https://img-blog.csdnimg.cn/20210609111805662.png#)

ä¾æ®ä¸Šé¢çš„åˆ†ææ–¹æ³•ï¼Œæˆ‘ä»¬æ¥åˆ†æ**åŒå‘ç»‘å®š v-model**çš„æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ã€‚

å¯¹äº `v-model` æ¥è¯´ï¼Œä¸»è¦çœ‹çš„æ˜¯ `input` äº‹ä»¶ã€‚ `v-model` çš„èƒŒåï¼Œç»‘å®šçš„æ˜¯ `name` å’Œ `value` è¿™ä¸¤ä¸ªè¯­æ³•ç³–ã€‚ä¹‹åé€šè¿‡ `attrs` å»åˆ›å»º `ç±»å‹type` ä¸º `text` çš„å±æ€§ã€‚

æœ€ç»ˆæ˜¯ `input` äº‹ä»¶ï¼Œ `input` äº‹ä»¶ç»‘å®š `$event` ï¼Œæœ€åï¼Œ `name` çš„å€¼å°±ç­‰åŒäº `$event.target.value` ï¼Œè¿™æ ·ï¼Œ**æ•°æ®å°±å®ç°äº†åŒå‘ç»‘å®š**ã€‚

## 3ã€æ¨¡æ¿ç¼–è¯‘æ€»ç»“

çœ‹å®Œä¸Šè¿°çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥å¯¹**æ¨¡æ¿ç¼–è¯‘åšä¸ªå°ç»“ï¼š**

**ï¼ˆ1ï¼‰ä» render å‡½æ•°åˆ° vnode**

æ¨¡æ¿ç¼–è¯‘åæ˜¯ä¸€ä¸ª `render` å‡½æ•°ï¼Œæ‰§è¡Œ `render` å‡½æ•°åè¿”å›ä¸€ä¸ª `vnode` ï¼›

**ï¼ˆ2ï¼‰vnode åˆ° patch å’Œ diff**

åŸºäº `vnode` çš„åŸºç¡€ä¸Šï¼Œå†æ‰§è¡Œ `patch` å’Œ `diff` ï¼›

**ï¼ˆ3ï¼‰æ¨¡æ¿ç¼–è¯‘å·¥å…·**

åœ¨å¹³å¸¸çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `webpack` ã€ `vue-loader` ç­‰æ„å»ºå·¥å…·ï¼Œåœ¨å¼€å‘ç¯å¢ƒä¸‹**ç¼–è¯‘æ¨¡æ¿**ã€‚

# å››ã€ğŸ”‘ ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹

## 1ã€åˆè¯†ç»„ä»¶æ¸²æŸ“/æ›´æ–°

è®²å®Œä¸Šå®Œçš„å†…å®¹ï¼Œæˆ‘ä»¬å†æ¥è®²ä¸€ä¸ªä¸ç¼–è¯‘æ¨¡æ¿å…³è”æ€§å¾ˆå¼ºçš„çŸ¥è¯†ç‚¹ï¼š**ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹**ã€‚

ä¸€ä¸ªç»„ä»¶ï¼Œä»**æ¸²æŸ“åˆ°é¡µé¢ä¸Š**å¼€å§‹ï¼Œå†åˆ°ä¿®æ”¹ `data` å»è§¦å‘æ›´æ–°ï¼ˆæ•°æ®é©±åŠ¨è§†å›¾ï¼‰ï¼Œå…¶èƒŒåçš„åŸç†æ˜¯ä»€ä¹ˆï¼Œåˆéœ€è¦æŒæ¡å“ªäº›è¦ç‚¹å‘¢ï¼Ÿ

äº‹å®ä¸Šï¼Œç»„ä»¶åœ¨æ¸²æŸ“ä¹‹å‰ï¼Œä¼šå…ˆè¿›è¡Œ**æ¨¡æ¿ç¼–è¯‘**ï¼Œæ¨¡æ¿ `template` ä¼šç¼–è¯‘æˆ `render` å‡½æ•°ã€‚

ä¹‹åå°±æ˜¯æ•°æ®çš„ç›‘å¬äº†ï¼Œè¿™å°±è¦è°ˆåˆ°**å“åº”å¼æ•°æ®**ã€‚vue çš„**å“åº”å¼**é€šè¿‡æ“ä½œ `Object.defineProperty()` ï¼Œå»ç›‘å¬ `getter` å’Œ `setter` æ–¹æ³•ï¼Œæ¥ä½¿å¾—æ•°æ®å®æ—¶æ›´æ–°ã€‚

ç›‘å¬å®Œæ•°æ®ä¹‹åï¼Œå°±æ˜¯æ‰§è¡Œ `render` å‡½æ•°ï¼Œç”Ÿæˆ `vnode` ã€‚

åˆ°äº† `vnode` ï¼ˆå³ `vdom` ï¼‰è¿™ä¸€æ­¥ä¹‹åï¼Œä¼šè¿›è¡Œ `patch(elem,vnode)` å’Œ `patch(vnode,newVnode)` çš„æ¯”è¾ƒã€‚

å…³äº[å“åº”å¼åŸç†](https://blog.csdn.net/weixin_44803753/article/details/117535265)å’Œ[vdom çš„è§£è¯»](https://blog.csdn.net/weixin_44803753/article/details/117594534)ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥æŸ¥çœ‹æˆ‘çš„å‰ä¸¤ç¯‡æ–‡ç« è¿›è¡Œå­¦ä¹ ï¼Œè¿™é‡Œä¸å†å±•å¼€ç»†è¿°~

## 2ã€ç»„ä»¶æ¸²æŸ“/æ›´æ–°è¿‡ç¨‹

ç»„ä»¶æ¸²æŸ“å’Œæ›´æ–°è¿‡ç¨‹ä¸»è¦ç»è¿‡ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š**åˆæ¬¡æ¸²æŸ“è¿‡ç¨‹ â†’ æ›´æ–°è¿‡ç¨‹ â†’ å¼‚æ­¥æ¸²æŸ“**ã€‚

æ¥ä¸‹æ¥å°±è¿™ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œä¸€ä¸€è®²è§£ã€‚

### ï¼ˆ1ï¼‰åˆæ¬¡æ¸²æŸ“è¿‡ç¨‹

åˆæ¬¡æ¸²æŸ“è¿‡ç¨‹ï¼Œå³ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ˜¯æ€ä¹ˆæ ·çš„ï¼Œæ€ä¹ˆæŠŠæ¨¡æ¿æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚**å…·ä½“æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š**

- è§£ææ¨¡æ¿ä¸º `render` å‡½æ•°ï¼›
- è§¦å‘å“åº”å¼ï¼Œç›‘å¬ `data` å±æ€§ `getter` å’Œ `setter` ï¼›
- æ‰§è¡Œ `render` å‡½æ•°ï¼Œç”Ÿæˆ `vnode` ï¼Œè¿›è¡Œ `patch(elem,vnode)` ã€‚

ä¸‹é¢å°±è¿™ä¸‰ä¸ªæ­¥éª¤æ¥è¿›è¡Œä¸€ä¸€è®²è§£ã€‚

#### 1ï¼‰è§£ææ¨¡æ¿ä¸º render å‡½æ•°

åœ¨**å¼€å‘ç¯å¢ƒ**ä¸‹ï¼Œè§£ææ¨¡æ¿ä¸º `render` å‡½æ•°ä¸€èˆ¬æ˜¯ç”± `vue-loader` è¿™ä¸ªæ’ä»¶æ¥å¤„ç†çš„ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯ï¼Œç”¨æˆ·ç›´æ¥ç”¨ `cdn` çš„æ–¹å¼å¼•å…¥ `vuejs` çš„æ–‡ä»¶è¿›è¡Œæœ¬åœ°ä»£ç ç»ƒä¹ ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè§£ææ¨¡æ¿ä¸º `render` å‡½æ•°å°±æ˜¯åœ¨**æµè§ˆå™¨ç¯å¢ƒ**è¿è¡Œçš„ã€‚

å°çŸ¥è¯†äº†è§£å®Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹è¿™ä¸ªæ­¥éª¤ã€‚

è§£ææ¨¡æ¿ä¸º `render` å‡½æ•°ï¼Œå³è§£æ `template` ä¸º `render` å‡½æ•°ï¼Œè¿™ä¸ªå°±æ˜¯ä¸Šè¿°æ–‡ç« ä¸­è¯´çš„**ç¼–è¯‘æ¨¡æ¿**ã€‚

#### 2ï¼‰è§¦å‘å“åº”å¼

åœ¨ç¼–è¯‘å®Œæ¨¡æ¿ä¹‹åï¼Œ `render` å‡½æ•°æœ‰äº†ï¼Œæˆ‘ä»¬æ¥å¼€å§‹ç›‘å¬ `data` å±æ€§ã€‚

ç›‘å¬ `data` å±æ€§ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è§¦å‘å“åº”å¼ï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“æ•°æ®ã€‚

é‚£åœ¨è¿™ä¸ªé˜¶æ®µæ€ä¹ˆæ¸²æŸ“æ•°æ®å‘¢ï¼Ÿ

è¿™ä¸ªé˜¶æ®µæˆ‘ä»¬éœ€è¦æ‰§è¡Œ `render` å‡½æ•°ï¼Œ `render` å‡½æ•°ä¼šè§¦å‘ `getter` æ–¹æ³•ï¼Œå› ä¸ºæ•°æ®æ²¡æœ‰è¿›è¡Œæ›´æ–°ï¼Œåªæ˜¯è¿›è¡Œæ¸²æŸ“ã€‚åªæœ‰åœ¨è¿›è¡Œæ¸²æŸ“çš„æ—¶å€™æ‰ä¼šæ“ä½œ `setter` æ–¹æ³•ã€‚

#### 3ï¼‰æ‰§è¡Œ render å‡½æ•°ï¼Œç”Ÿæˆ vnode

æœ€åï¼Œå½“æ•°æ®æ¸²æŸ“å®Œæ¯•åï¼Œå°±ä¼šæ‰§è¡Œç¬¬ä¸€æ­¥ç”Ÿæˆçš„ `render` å‡½æ•°ï¼Œç„¶åç”Ÿæˆè™šæ‹Ÿ `DOM` èŠ‚ç‚¹ `vnode` ï¼Œä¹‹åè¿›è¡Œ `patch(elem,vnode)` ã€‚

### ï¼ˆ2ï¼‰æ›´æ–°è¿‡ç¨‹

#### 1ï¼‰æ›´æ–°è¿‡ç¨‹ç»†è¿°

æ›´æ–°è¿‡ç¨‹ï¼Œå³ `data` ä¿®æ”¹ä¹‹åï¼Œç»„ä»¶æ˜¯æ€ä¹ˆæ›´æ–°çš„ã€‚

åœ¨è¿™ä¸ªé˜¶æ®µå‘¢ï¼Œå°†ä¼šä¿®æ”¹ `data` ï¼Œå¹¶ä¸”è§¦å‘ `setter` ï¼ˆæ³¨æ„ï¼šåœ¨æ­¤ä¹‹å‰ `data` åœ¨ `getter` ä¸­å·²ç»è¢«ç›‘å¬ï¼‰ã€‚

è§¦å‘å®Œ `setter` ä¹‹åï¼Œé‡æ–°æ‰§è¡Œ `render` å‡½æ•°ï¼Œå¹¶ç”Ÿæˆ `newVnode` ï¼Œæœ€åè¿›è¡Œ `patch(vnode, newVnode)` çš„ diff æ¯”è¾ƒã€‚

#### 2ï¼‰å®Œæˆæµç¨‹å›¾

æ¥ä¸‹æ¥æˆ‘ä»¬ç”¨ä¸€å¼ æµç¨‹å›¾æ¥å®Œæ•´çš„å›é¡¾æ¸²æŸ“å’Œæ›´æ–°çš„è¿‡ç¨‹ã€‚

![æ¨¡æ¿ç¼–è¯‘æµç¨‹å›¾](https://img-blog.csdnimg.cn/20210609111845989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#)

### ï¼ˆ3ï¼‰å¼‚æ­¥æ¸²æŸ“

åœ¨æ¸²æŸ“å’Œæ›´æ–°ç»“æŸä¹‹åï¼Œæˆ‘ä»¬çš„ç¨‹åºå¯èƒ½è¿˜æœ‰å¯èƒ½ä¼šå‘ç”Ÿå¤šä¸ªç¨‹åºåŒæ—¶åŠ è½½ï¼Œè¿™å°±æ¶‰åŠåˆ°ä¸€ä¸ª**å¼‚æ­¥æ¸²æŸ“**é—®é¢˜ã€‚

å¼‚æ­¥æ¸²æŸ“é—®é¢˜ï¼Œæˆ‘ä»¬ç”¨ `$nextTick` æ¥ä½œä¸ºä¾‹å­è®²è§£ã€‚

å‡è®¾æˆ‘ä»¬ç°åœ¨è¦å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæ‰“å°å‡ºåˆ—è¡¨çš„é¡¹æ•°ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¤§å¤šäººå¯èƒ½ä¼šè¿™ä¹ˆæ“ä½œã€‚

```html
<template>
  <div id="app">
    <!-- refçš„è®¾ç½®æ—¶ä¸ºäº†æ–¹ä¾¿åç»­å¯ä»¥ç”¨æ¥ï¼šå–èŠ‚ç‚¹çš„DOMå…ƒç´  -->
    <ul ref="ul1">
      <li v-for="(item, index) in list" :key="index">{{item}}</li>
    </ul>
    <button @click="addItem">æ·»åŠ ä¸€é¡¹</button>
  </div>
</template>

<script>
  export default {
    name: 'app',
    data() {
      return {
        list: ['a', 'b', 'c'],
      };
    },
    methods: {
      addItem() {
        this.list.push(`${Date.now()}`);
        this.list.push(`${Date.now()}`);
        this.list.push(`${Date.now()}`);

        // è·å– DOM å…ƒç´ 
        const ulElem = this.$refs.ul1;
        console.log(ulElem.childNodes.length);
      },
    },
  };
</script>
```

**æ­¤æ—¶æµè§ˆå™¨çš„æ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š**

![nextTick](https://img-blog.csdnimg.cn/20210602081408685.gif#pic_center)

ç»†å¿ƒçš„å°ä¼™ä¼´å·²ç»å‘ç°ï¼Œæµè§ˆå™¨å¹¶æ²¡æœ‰æŒ‰ç…§æˆ‘ä»¬æ‰€æƒ³çš„æ‰“å°ã€‚å½“é¡µé¢ä¸Šçš„åˆ—è¡¨æ˜¾ç¤º `6é¡¹` å†…å®¹æ—¶ï¼Œæ­¤æ—¶æ§åˆ¶å°åªæ‰“å° `3é¡¹` ï¼›å½“æ˜¾ç¤º `9é¡¹` æ—¶ï¼Œæ­¤æ—¶æ§åˆ¶å°ç›´æ¥åªæ‰“å° `6é¡¹` ã€‚

**é‚£è¿™ç©¶ç«Ÿæ—¶ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ**

å…¶å®ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»çš„é‚£ä¸€åˆ»ï¼Œ `data` å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯ `DOM` å¹¶ä¸ä¼šç«‹åˆ»è¿›è¡Œæ¸²æŸ“ã€‚æ‰€ä»¥ç­‰åˆ°æˆ‘ä»¬ç‚¹å‡»å®Œæˆçš„æ—¶å€™ï¼Œè·å–çš„å…ƒç´ è¿˜æ˜¯åŸæ¥è§¦å‘çš„å†…å®¹ï¼Œè€Œä¸ä¼šå¢æ·»ä¸Šæ–°çš„å†…å®¹ã€‚

é‚£æˆ‘ä»¬æ‰€æœŸæœ›çš„æ˜¯ï¼Œå½“ç‚¹å‡»ä¹‹åç«‹åˆ»è§¦å‘ `DOM` æ¸²æŸ“å¹¶æ‹¿åˆ°æœ€æ–°çš„å€¼ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ° `nextTick` ã€‚**å…·ä½“ä»£ç å¦‚ä¸‹ï¼š**

```html
<script>
  export default {
    name: 'app',
    data() {
      return {
        list: ['a', 'b', 'c'],
      };
    },
    methods: {
      addItem() {
        this.list.push(`${Date.now()}`);
        this.list.push(`${Date.now()}`);
        this.list.push(`${Date.now()}`);

        // 1. å¼‚æ­¥æ¸²æŸ“ï¼Œ$nextTick å¾… DOM æ¸²æŸ“å®Œå†å›è°ƒï¼Œ
        //    å³NextTickå‡½æ•°ä¼šåœ¨å¤šæ¬¡dataä¿®æ”¹å®Œå¹¶ä¸”å…¨éƒ¨DOMæ¸²æŸ“å®Œå†è§¦å‘ï¼Œä»…åœ¨æœ€åè§¦å‘ä¸€æ¬¡
        // 2. é¡µé¢æ¸²æŸ“æ—¶ä¼šå°† data çš„ä¿®æ”¹åšæ•´åˆ
        this.$nextTick(() => {
          // è·å– DOM å…ƒç´ 
          const ulElem = this.$refs.ul1;
          console.log(ulElem.childNodes.length);
        });
      },
    },
  };
</script>
```

æˆ‘ä»¬é€šè¿‡ç»™è·å– `DOM` å…ƒç´ çš„ä»£ç å¤–é¢å†åµŒå¥—ä¸€å±‚ `$nextTick` å‡½æ•°ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ç»“æŸåï¼Œ `data` çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶ `$nextTick` ä¼šç­‰å¾…**DOM å…¨éƒ¨æ¸²æŸ“å®Œæˆä¹‹å**å†è¿›è¡Œå›è°ƒã€‚

**æœ€ç»ˆæµè§ˆå™¨çš„æ‰“å°æ•ˆæœå¦‚ä¸‹ï¼š**

![nextTick2](https://img-blog.csdnimg.cn/20210602081420169.gif#pic_center)

æ‰€ä»¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ `$nextTick` é€šè¿‡æ±‡æ€» `data` çš„ä¿®æ”¹ï¼Œæœ€åå†**ä¸€æ¬¡æ€§æ›´æ–°è§†å›¾**ã€‚

è¿™æ ·å¯ä»¥å‡å°‘ `DOM` çš„æ“ä½œæ¬¡æ•°ï¼Œå¤§å¤§çš„æé«˜äº†æ€§èƒ½ã€‚

## 3ã€å°ç»“

ç»è¿‡ä¸Šè¿°ä¸€ç³»åˆ—çš„è®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå†…å®¹åˆ†å‰²æˆä»¥ä¸‹**ä¸¤ä¸ªè¦ç‚¹ï¼š**

- è¦ç†è§£æ¸…æ¥š**æ¸²æŸ“å’Œå“åº”å¼**ã€**æ¸²æŸ“å’Œæ¨¡æ¿ç¼–è¯‘**ã€**æ¸²æŸ“å’Œ vdom**çš„å…³ç³»ã€‚
- è¦ç†è§£ç»„ä»¶æ¸²æŸ“/æ›´æ–°çš„è¿‡ç¨‹ï¼š**åˆæ¬¡æ¸²æŸ“è¿‡ç¨‹ â†’ æ›´æ–°è¿‡ç¨‹ â†’ å¼‚æ­¥æ¸²æŸ“**ã€‚

# äº”ã€âœ”ï¸ ç»“æŸè¯­

ä»æ¨¡æ¿ç¼–è¯‘ï¼Œåˆ°ç»„ä»¶æ¸²æŸ“æ›´æ–°è¿‡ç¨‹ï¼Œæˆ‘ä»¬äº†è§£äº†æ•´ä¸ª `template` èƒŒåçš„å…¨è¿‡ç¨‹ã€‚ç›¸ä¿¡é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œå¤§å®¶å¯¹æ¨¡æ¿ç¼–è¯‘æœ‰äº†ä¸€ä¸ªæ›´æ·±çš„è®¤è¯†ã€‚

å…³äºæ¨¡æ¿ç¼–è¯‘çš„å†…å®¹å°±è®²åˆ°è¿™é‡Œå•¦ï¼å¦‚æœ‰ä¸ç†è§£æˆ–æ–‡ç« æœ‰è¯¯ï¼Œæ¬¢è¿è¯„è®ºåŒºç•™è¨€æˆ–ç§ä¿¡æˆ‘äº¤æµ~

> - å…³æ³¨å…¬ä¼—å· **æ˜ŸæœŸä¸€ç ”ç©¶å®¤** ï¼Œä¸å®šæœŸåˆ†äº«å­¦ä¹ å¹²è´§ï¼Œ**æ›´å¤šæœ‰è¶£çš„ä¸“æ å¾…ä½ è§£é”**~
> - å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè®°å¾— **ç‚¹ä¸ªèµåŠ ä¸ªå…³æ³¨** å†èµ°å“¦~
> - æˆ‘ä»¬ä¸‹æœŸè§ï¼ğŸ¥‚ğŸ¥‚ğŸ¥‚

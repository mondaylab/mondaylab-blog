import{_ as s,c as n,o as a,N as l}from"./chunks/framework.6510d215.js";const C=JSON.parse('{"title":"è¶…ä¿å§†çº§æ•™ç¨‹å¸¦ä½ å®ç°Promiseçš„æ ¸å¿ƒåŠŸèƒ½","description":"","frontmatter":{"title":"è¶…ä¿å§†çº§æ•™ç¨‹å¸¦ä½ å®ç°Promiseçš„æ ¸å¿ƒåŠŸèƒ½","author":"å‘¨ä¸€","date":"2021-08-17","categories":["å‰ç«¯å¼€å‘"],"tags":["JavaScript"],"sidebar":"auto"},"headers":[{"level":1,"title":"ğŸ“š åºè¨€","slug":"ğŸ“š-åºè¨€","link":"#ğŸ“š-åºè¨€","children":[]},{"level":1,"title":"ğŸ“‹ æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹","slug":"ğŸ“‹-æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹","link":"#ğŸ“‹-æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹","children":[]},{"level":1,"title":"ğŸ“° ä¸€ã€js çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼","slug":"ğŸ“°-ä¸€ã€js-çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼","link":"#ğŸ“°-ä¸€ã€js-çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼","children":[{"level":2,"title":"1. å•çº¿ç¨‹ ğŸ’¡","slug":"_1-å•çº¿ç¨‹-ğŸ’¡","link":"#_1-å•çº¿ç¨‹-ğŸ’¡","children":[]},{"level":2,"title":"2. åŒæ­¥æ¨¡å¼ ğŸ’¡","slug":"_2-åŒæ­¥æ¨¡å¼-ğŸ’¡","link":"#_2-åŒæ­¥æ¨¡å¼-ğŸ’¡","children":[{"level":3,"title":"ï¼ˆ1ï¼‰å®šä¹‰","slug":"_1-å®šä¹‰","link":"#_1-å®šä¹‰","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰å›¾ä¾‹","slug":"_2-å›¾ä¾‹","link":"#_2-å›¾ä¾‹","children":[]}]},{"level":2,"title":"3. å¼‚æ­¥æ¨¡å¼ ğŸ’¡","slug":"_3-å¼‚æ­¥æ¨¡å¼-ğŸ’¡","link":"#_3-å¼‚æ­¥æ¨¡å¼-ğŸ’¡","children":[{"level":3,"title":"ï¼ˆ1ï¼‰ä¸¾ä¾‹","slug":"_1-ä¸¾ä¾‹","link":"#_1-ä¸¾ä¾‹","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰å®šä¹‰","slug":"_2-å®šä¹‰","link":"#_2-å®šä¹‰","children":[]},{"level":3,"title":"ï¼ˆ3ï¼‰js å¦‚ä½•å®ç°å¼‚æ­¥","slug":"_3-js-å¦‚ä½•å®ç°å¼‚æ­¥","link":"#_3-js-å¦‚ä½•å®ç°å¼‚æ­¥","children":[]},{"level":3,"title":"ï¼ˆ4ï¼‰event loop è¿‡ç¨‹","slug":"_4-event-loop-è¿‡ç¨‹","link":"#_4-event-loop-è¿‡ç¨‹","children":[]}]},{"level":2,"title":"4. å›è°ƒå‡½æ•° ğŸ’¡","slug":"_4-å›è°ƒå‡½æ•°-ğŸ’¡","link":"#_4-å›è°ƒå‡½æ•°-ğŸ’¡","children":[]}]},{"level":1,"title":"ğŸ“ƒ äºŒã€Promise å¼‚æ­¥æ–¹æ¡ˆ","slug":"ğŸ“ƒ-äºŒã€promise-å¼‚æ­¥æ–¹æ¡ˆ","link":"#ğŸ“ƒ-äºŒã€promise-å¼‚æ­¥æ–¹æ¡ˆ","children":[{"level":2,"title":"1. Promise çš„ä¸‰ç§çŠ¶æ€ ğŸ“‚","slug":"_1-promise-çš„ä¸‰ç§çŠ¶æ€-ğŸ“‚","link":"#_1-promise-çš„ä¸‰ç§çŠ¶æ€-ğŸ“‚","children":[{"level":3,"title":"ï¼ˆ1ï¼‰Promise çš„ä¸‰ç§çŠ¶æ€","slug":"_1-promise-çš„ä¸‰ç§çŠ¶æ€","link":"#_1-promise-çš„ä¸‰ç§çŠ¶æ€","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰çŠ¶æ€è§£é‡Š","slug":"_2-çŠ¶æ€è§£é‡Š","link":"#_2-çŠ¶æ€è§£é‡Š","children":[]}]},{"level":2,"title":"2. ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç° ğŸ“‚","slug":"_2-ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç°-ğŸ“‚","link":"#_2-ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç°-ğŸ“‚","children":[{"level":3,"title":"ï¼ˆ1ï¼‰çŠ¶æ€çš„å˜åŒ–","slug":"_1-çŠ¶æ€çš„å˜åŒ–","link":"#_1-çŠ¶æ€çš„å˜åŒ–","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰çŠ¶æ€çš„è¡¨ç°","slug":"_2-çŠ¶æ€çš„è¡¨ç°","link":"#_2-çŠ¶æ€çš„è¡¨ç°","children":[]}]},{"level":2,"title":"3. Promise çš„ä½¿ç”¨æ¡ˆä¾‹ ğŸ“‚","slug":"_3-promise-çš„ä½¿ç”¨æ¡ˆä¾‹-ğŸ“‚","link":"#_3-promise-çš„ä½¿ç”¨æ¡ˆä¾‹-ğŸ“‚","children":[]},{"level":2,"title":"4. then å’Œ catch å¯¹çŠ¶æ€çš„å½±å“ ğŸ“‚","slug":"_4-then-å’Œ-catch-å¯¹çŠ¶æ€çš„å½±å“-ğŸ“‚","link":"#_4-then-å’Œ-catch-å¯¹çŠ¶æ€çš„å½±å“-ğŸ“‚","children":[]},{"level":2,"title":"5. Promise çš„å¹¶è¡Œæ‰§è¡Œ ğŸ“‚","slug":"_5-promise-çš„å¹¶è¡Œæ‰§è¡Œ-ğŸ“‚","link":"#_5-promise-çš„å¹¶è¡Œæ‰§è¡Œ-ğŸ“‚","children":[{"level":3,"title":"ï¼ˆ1ï¼‰Promise.all","slug":"_1-promise-all","link":"#_1-promise-all","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰Promise.race","slug":"_2-promise-race","link":"#_2-promise-race","children":[]}]},{"level":2,"title":"6. ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³• ğŸ“‚","slug":"_6-ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³•-ğŸ“‚","link":"#_6-ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³•-ğŸ“‚","children":[{"level":3,"title":"ï¼ˆ1ï¼‰done()","slug":"_1-done","link":"#_1-done","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰finally()","slug":"_2-finally","link":"#_2-finally","children":[]}]}]},{"level":1,"title":"ğŸ“‘ ä¸‰ã€å®ç° Promise çš„æ ¸å¿ƒåŠŸèƒ½","slug":"ğŸ“‘-ä¸‰ã€å®ç°-promise-çš„æ ¸å¿ƒåŠŸèƒ½","link":"#ğŸ“‘-ä¸‰ã€å®ç°-promise-çš„æ ¸å¿ƒåŠŸèƒ½","children":[{"level":2,"title":"1. åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç° ğŸ·ï¸","slug":"_1-åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç°-ğŸ·ï¸","link":"#_1-åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç°-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰ç¢ç¢å¿µ","slug":"_1-ç¢ç¢å¿µ","link":"#_1-ç¢ç¢å¿µ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„åˆ†æ","slug":"_2-promise-åŸºç¡€åŠŸèƒ½çš„åˆ†æ","link":"#_2-promise-åŸºç¡€åŠŸèƒ½çš„åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ3ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„å®ç°","slug":"_3-promise-åŸºç¡€åŠŸèƒ½çš„å®ç°","link":"#_3-promise-åŸºç¡€åŠŸèƒ½çš„å®ç°","children":[]},{"level":3,"title":"ï¼ˆ4ï¼‰thenable åŠŸèƒ½çš„åˆ†æ","slug":"_4-thenable-åŠŸèƒ½çš„åˆ†æ","link":"#_4-thenable-åŠŸèƒ½çš„åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ5ï¼‰thenable åŠŸèƒ½çš„å®ç°","slug":"_5-thenable-åŠŸèƒ½çš„å®ç°","link":"#_5-thenable-åŠŸèƒ½çš„å®ç°","children":[]}]},{"level":2,"title":"2. æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç° ğŸ·ï¸","slug":"_2-æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç°-ğŸ·ï¸","link":"#_2-æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç°-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ","slug":"_1-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ","link":"#_1-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°","slug":"_2-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°","link":"#_2-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°","children":[]}]},{"level":2,"title":"3. å®ç° then æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨ ğŸ·ï¸","slug":"_3-å®ç°-then-æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨-ğŸ·ï¸","link":"#_3-å®ç°-then-æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½åˆ†æ","slug":"_1-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½åˆ†æ","link":"#_1-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½å®ç°","slug":"_2-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½å®ç°","link":"#_2-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½å®ç°","children":[]}]},{"level":2,"title":"4. å®ç° then æ–¹æ³•çš„é“¾å¼è°ƒç”¨ ğŸ·ï¸","slug":"_4-å®ç°-then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨-ğŸ·ï¸","link":"#_4-å®ç°-then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ","slug":"_1-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ","link":"#_1-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°","slug":"_2-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°","link":"#_2-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°","children":[]},{"level":3,"title":"ï¼ˆ3ï¼‰é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹","slug":"_3-é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹","link":"#_3-é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹","children":[]}]},{"level":2,"title":"5. promise çš„é”™è¯¯å¤„ç† ğŸ·ï¸","slug":"_5-promise-çš„é”™è¯¯å¤„ç†-ğŸ·ï¸","link":"#_5-promise-çš„é”™è¯¯å¤„ç†-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰é”™è¯¯å¤„ç†åœºæ™¯","slug":"_1-é”™è¯¯å¤„ç†åœºæ™¯","link":"#_1-é”™è¯¯å¤„ç†åœºæ™¯","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°","slug":"_2-é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°","link":"#_2-é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°","children":[]}]},{"level":2,"title":"6. å®ç° then æ–¹æ³•çš„å‚æ•°å¯é€‰ ğŸ·ï¸","slug":"_6-å®ç°-then-æ–¹æ³•çš„å‚æ•°å¯é€‰-ğŸ·ï¸","link":"#_6-å®ç°-then-æ–¹æ³•çš„å‚æ•°å¯é€‰-ğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰å‚æ•°å¯é€‰å®ç°æ€è·¯","slug":"_1-å‚æ•°å¯é€‰å®ç°æ€è·¯","link":"#_1-å‚æ•°å¯é€‰å®ç°æ€è·¯","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰å‚æ•°å¯é€‰åŠŸèƒ½å®ç°","slug":"_2-å‚æ•°å¯é€‰åŠŸèƒ½å®ç°","link":"#_2-å‚æ•°å¯é€‰åŠŸèƒ½å®ç°","children":[]}]},{"level":2,"title":"7. å®ç° Promise.allğŸ·ï¸","slug":"_7-å®ç°-promise-allğŸ·ï¸","link":"#_7-å®ç°-promise-allğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰Promise.all åŠŸèƒ½åˆ†æ","slug":"_1-promise-all-åŠŸèƒ½åˆ†æ","link":"#_1-promise-all-åŠŸèƒ½åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰Promise.all åŠŸèƒ½å®ç°","slug":"_2-promise-all-åŠŸèƒ½å®ç°","link":"#_2-promise-all-åŠŸèƒ½å®ç°","children":[]}]},{"level":2,"title":"8. å®ç° Promise.resolveğŸ·ï¸","slug":"_8-å®ç°-promise-resolveğŸ·ï¸","link":"#_8-å®ç°-promise-resolveğŸ·ï¸","children":[{"level":3,"title":"ï¼ˆ1ï¼‰Promise.resolve åŠŸèƒ½åˆ†æ","slug":"_1-promise-resolve-åŠŸèƒ½åˆ†æ","link":"#_1-promise-resolve-åŠŸèƒ½åˆ†æ","children":[]},{"level":3,"title":"ï¼ˆ2ï¼‰Promise.resolve åŠŸèƒ½å®ç°","slug":"_2-promise-resolve-åŠŸèƒ½å®ç°","link":"#_2-promise-resolve-åŠŸèƒ½å®ç°","children":[]}]}]},{"level":1,"title":"ğŸ“ å››ã€ç»“æŸè¯­","slug":"ğŸ“-å››ã€ç»“æŸè¯­","link":"#ğŸ“-å››ã€ç»“æŸè¯­","children":[]},{"level":1,"title":"ğŸ£ å½©è›‹ One More Thing","slug":"ğŸ£-å½©è›‹-one-more-thing","link":"#ğŸ£-å½©è›‹-one-more-thing","children":[{"level":2,"title":"ï¼ˆï¼šè¯¾ä»£è¡¨è®°å½•","slug":"è¯¾ä»£è¡¨è®°å½•","link":"#è¯¾ä»£è¡¨è®°å½•","children":[]},{"level":2,"title":"ï¼ˆï¼šå‚è€ƒèµ„æ–™","slug":"å‚è€ƒèµ„æ–™","link":"#å‚è€ƒèµ„æ–™","children":[]},{"level":2,"title":"ï¼ˆï¼šç•ªå¤–ç¯‡","slug":"ç•ªå¤–ç¯‡","link":"#ç•ªå¤–ç¯‡","children":[]}]}],"relativePath":"column/FrontEnd/JavaScript/009.md","lastUpdated":1644826256000}'),p={name:"column/FrontEnd/JavaScript/009.md"},o=l(`<h1 id="ğŸ“š-åºè¨€" tabindex="-1">ğŸ“š åºè¨€ <a class="header-anchor" href="#ğŸ“š-åºè¨€" aria-label="Permalink to &quot;ğŸ“š åºè¨€&quot;">â€‹</a></h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ <code>promise</code> æ˜¯å‰ç«¯é¢è¯•ä¸­é›·æ‰“ä¸åŠ¨çš„é¢è¯•é¢˜äº†ï¼Œé¢è¯•å®˜éƒ½å¾ˆçˆ±è€ƒã€‚å‘¨ä¸€ä¹‹å‰ä¹Ÿæ˜¯çŸ¥è¯†æ¯”è¾ƒæµ®äºè¡¨é¢ï¼Œåœ¨ä¸€äº›é¢ç»ä¸Šçœ‹åˆ°äº† <code>promise</code> çš„å®ç°æ–¹å¼ï¼Œå°±åªåœç•™åœ¨é‚£ä¸ªå±‚é¢ä¸Šã€‚ä½†å®é™…ä¸Šæˆ‘å‘ç°ï¼Œå¦‚æœæ²¡æœ‰æ·±å…¥å…¶åŸç†å»ç†è§£ï¼Œé¢è¯•å®˜ç¨å¾®å˜ä¸ªæ³•å­æ¥è€ƒï¼Œè¿™é“é¢˜å¾ˆå®¹æ˜“å°±æŠŠæˆ‘ç»™é—®å€’äº†ã€‚æ‰€ä»¥å‘€ï¼Œè¿˜æ˜¯è€è€å®å®ä»å¤´åˆ°å°¾ç ”ç©¶ä¸€éï¼Œè¿™æ ·ç­‰é‡åˆ°äº†ï¼Œä¸ç®¡æ€ä¹ˆè€ƒï¼Œä¸‡å®—ä¸å˜å…¶ä¸€ï¼ŒæŠŠåŸç†ç†è§£äº†ï¼Œå°±æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“è¢«é—®å€’äº†ã€‚</p><p>ä¸‹é¢å¼€å§‹è¿›å…¥æœ¬æ–‡çš„è®²è§£~ğŸ·ï¸</p><h1 id="ğŸ“‹-æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹" tabindex="-1">ğŸ“‹ æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹ <a class="header-anchor" href="#ğŸ“‹-æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹" aria-label="Permalink to &quot;ğŸ“‹ æ–‡ç« å†…å®¹æŠ¢å…ˆçœ‹&quot;">â€‹</a></h1><p><img src="https://img-blog.csdnimg.cn/932fb7c844584486b7752a0cabcd723f.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center" alt="promiseå®ç°æ€ç»´å¯¼å›¾"></p><h1 id="ğŸ“°-ä¸€ã€js-çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼" tabindex="-1">ğŸ“° ä¸€ã€js çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼ <a class="header-anchor" href="#ğŸ“°-ä¸€ã€js-çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼" aria-label="Permalink to &quot;ğŸ“° ä¸€ã€js çš„åŒæ­¥æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼&quot;">â€‹</a></h1><h2 id="_1-å•çº¿ç¨‹-ğŸ’¡" tabindex="-1">1. å•çº¿ç¨‹ ğŸ’¡ <a class="header-anchor" href="#_1-å•çº¿ç¨‹-ğŸ’¡" aria-label="Permalink to &quot;1. å•çº¿ç¨‹ ğŸ’¡&quot;">â€‹</a></h2><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œ <code>js</code> çš„è®¾è®¡æ˜¯åŸºäº<strong>å•çº¿ç¨‹</strong>è¿›è¡Œå¼€å‘çš„ï¼Œå®ƒåŸå…ˆçš„ç›®çš„åœ¨äºåªå‚ä¸æµè§ˆå™¨ä¸­<strong>DOM èŠ‚ç‚¹</strong>çš„æ“ä½œã€‚</p><p>è€Œå¯¹äºå•çº¿ç¨‹æ¥è¯´ï¼Œå…¶æ„å‘³ç€<strong>åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡</strong>ï¼Œä¸”æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼š<strong>æŒ‰ç…§é˜Ÿåˆ—çš„æ¨¡å¼</strong>è¿›è¡Œæ’é˜Ÿã€‚</p><p>æ‰€ä»¥ï¼Œå•çº¿ç¨‹çš„ç¼ºç‚¹å°±åœ¨äºï¼Œå½“ <code>js</code> è¿è¡Œçš„æ—¶å€™ï¼Œ <code>html</code> æ˜¯ä¸ä¼šè¿›è¡Œæ¸²æŸ“çš„ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ç‰¹åˆ«è€—æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šå¾ˆå®¹æ˜“é€ æˆ<strong>é¡µé¢é˜»å¡</strong>çš„å±€é¢ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ <code>js</code> æå‡ºäº†<strong>åŒæ­¥æ¨¡å¼</strong>å’Œ<strong>å¼‚æ­¥æ¨¡å¼</strong>çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="_2-åŒæ­¥æ¨¡å¼-ğŸ’¡" tabindex="-1">2. åŒæ­¥æ¨¡å¼ ğŸ’¡ <a class="header-anchor" href="#_2-åŒæ­¥æ¨¡å¼-ğŸ’¡" aria-label="Permalink to &quot;2. åŒæ­¥æ¨¡å¼ ğŸ’¡&quot;">â€‹</a></h2><h3 id="_1-å®šä¹‰" tabindex="-1">ï¼ˆ1ï¼‰å®šä¹‰ <a class="header-anchor" href="#_1-å®šä¹‰" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰å®šä¹‰&quot;">â€‹</a></h3><p>æ‰€è°“åŒæ­¥æ¨¡å¼ï¼ŒæŒ‡çš„å°±æ˜¯å‡½æ•°ä¸­çš„è°ƒç”¨å †æ ˆï¼ŒæŒ‰ç…§ä»£ç å®ç°çš„é¡ºåºï¼Œä¸€æ­¥æ­¥è¿›è¡Œã€‚</p><h3 id="_2-å›¾ä¾‹" tabindex="-1">ï¼ˆ2ï¼‰å›¾ä¾‹ <a class="header-anchor" href="#_2-å›¾ä¾‹" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰å›¾ä¾‹&quot;">â€‹</a></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç”¨ä¸€æ®µä»£ç ï¼Œæ¼”ç¤º <code>js</code> ä¸­<strong>å‡½æ•°è°ƒç”¨å †æ ˆ</strong>çš„æ‰§è¡Œæƒ…å†µã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">func2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">func3</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">4</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> func3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">5</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">func1</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//5 4 3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>çœ‹åˆ°è¿™é‡Œï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´å·²ç»åœ¨æ„æ€å…¶å…·ä½“çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥<strong>å±•ç¤ºæ‰§è¡Œæ•ˆæœï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210514123235249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center" alt="è°ƒç”¨å †æ ˆ"></p><p>å¯¹äº<strong>æ ˆ</strong>è¿™ä¸ªæ•°æ®ç»“æ„æ¥è¯´ï¼Œå®ƒéµå¾ª<strong>åè¿›å…ˆå‡º</strong>çš„åŸåˆ™ã€‚å› æ­¤ï¼Œå½“ <code>func1</code> ï¼Œ <code>func2</code> ï¼Œ <code>func3</code> ä¾æ¬¡æ”¾è¿›è°ƒç”¨æ ˆåï¼Œ <strong>éµå¾ªåè¿›å…ˆå‡ºåŸåˆ™</strong> ï¼Œé‚£ä¹ˆ <code>func3</code> å‡½æ•°çš„å†…å®¹ä¼šå…ˆè¢«æ‰§è¡Œï¼Œä¹‹åæ˜¯ <code>func2</code> ï¼Œæœ€åæ˜¯ <code>func1</code> ã€‚</p><p>å› æ­¤ï¼Œå¯¹äº <code>js</code> çš„<strong>åŒæ­¥æ¨¡å¼</strong>æ¥è¯´ï¼Œå°±æ˜¯ç±»ä¼¼äºä¸Šè¿°çš„å‡½æ•°è°ƒç”¨å †æ ˆã€‚</p><h2 id="_3-å¼‚æ­¥æ¨¡å¼-ğŸ’¡" tabindex="-1">3. å¼‚æ­¥æ¨¡å¼ ğŸ’¡ <a class="header-anchor" href="#_3-å¼‚æ­¥æ¨¡å¼-ğŸ’¡" aria-label="Permalink to &quot;3. å¼‚æ­¥æ¨¡å¼ ğŸ’¡&quot;">â€‹</a></h2><h3 id="_1-ä¸¾ä¾‹" tabindex="-1">ï¼ˆ1ï¼‰ä¸¾ä¾‹ <a class="header-anchor" href="#_1-ä¸¾ä¾‹" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰ä¸¾ä¾‹&quot;">â€‹</a></h3><p>å½“ç¨‹åºé‡åˆ°ç½‘ç»œè¯·æ±‚æˆ–å®šæ—¶ä»»åŠ¡ç­‰é—®é¢˜æ—¶ï¼Œè¿™ä¸ªæ—¶å€™ä¼šæœ‰ä¸€ä¸ªç­‰å¾…æ—¶é—´ã€‚</p><p>å‡è®¾ä¸€ä¸ªå®šæ—¶å™¨è®¾ç½® <code>10s</code> ï¼Œå¦‚æœæ”¾åœ¨åŒæ­¥ä»»åŠ¡é‡Œï¼ŒåŒæ­¥ä»»åŠ¡ä¼šé˜»å¡ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬ä¼šç­‰å¾… <code>10s</code> åæ‰èƒ½çœ‹åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœã€‚<strong>1 ä¸ª</strong>å®šæ—¶å™¨çš„ç­‰å¾…æ—¶é—´å¯èƒ½è¿˜å¥½ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æ˜¯<strong>100 ä¸ª</strong>å®šæ—¶å™¨å‘¢ï¼Ÿæˆ‘ä»¬æ€»ä¸èƒ½ç­‰å¾…ç€ <code>1000s</code> çš„æ—¶é—´å°±ä¸ºäº†çœ‹åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœå§ï¼Œè¿™å‡ ä¹ä¸å¤ªç°å®ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦å¼‚æ­¥ï¼Œé€šè¿‡å¼‚æ­¥æ¥<strong>è®©ç¨‹åºä¸é˜»å¡ä»£ç æ‰§è¡Œ</strong>ï¼Œ<strong>çµæ´»æ‰§è¡Œç¨‹åº</strong>ã€‚</p><h3 id="_2-å®šä¹‰" tabindex="-1">ï¼ˆ2ï¼‰å®šä¹‰ <a class="header-anchor" href="#_2-å®šä¹‰" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰å®šä¹‰&quot;">â€‹</a></h3><p>å¯¹äºåŒæ­¥æ¨¡å¼æ¥è¯´ï¼Œå®ƒåªèƒ½è‡ªä¸Šè€Œä¸‹åœ°ä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼Œä¸€è¡Œä¸€è¡Œè¿›è¡Œè§£æã€‚é‚£ä¸åŒæ­¥æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œå¼‚æ­¥æ¨¡å¼æ˜¯<strong>æŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„ç»“æœ</strong>è¿›è¡Œè¾“å‡ºï¼Œä¸ä¼šåƒåŒæ­¥æ¨¡å¼ä¸€æ ·äº§ç”Ÿé˜»å¡ï¼Œä»¥è¾¾åˆ°è®©ç¨‹åºå¯æ§çš„æ•ˆæœã€‚</p><h3 id="_3-js-å¦‚ä½•å®ç°å¼‚æ­¥" tabindex="-1">ï¼ˆ3ï¼‰js å¦‚ä½•å®ç°å¼‚æ­¥ <a class="header-anchor" href="#_3-js-å¦‚ä½•å®ç°å¼‚æ­¥" aria-label="Permalink to &quot;ï¼ˆ3ï¼‰js å¦‚ä½•å®ç°å¼‚æ­¥&quot;">â€‹</a></h3><p>ç›¸å¯¹äºåŒæ­¥æ¨¡å¼æ¥è¯´ï¼Œå¼‚æ­¥æ¨¡å¼çš„ç»“æ„æ›´ä¸ºå¤æ‚ã€‚é™¤äº†<strong>è°ƒç”¨æ ˆ</strong>ä¹‹å¤–ï¼Œ å®ƒè¿˜æœ‰<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>å’Œ<strong>äº‹ä»¶å¾ªç¯</strong>è¿™ä¸¤ä¸ªé¢å¤–çš„æœºåˆ¶ã€‚æ‰€è°“<strong>äº‹ä»¶å¾ªç¯</strong>ï¼Œä¹Ÿç§°ä¸º <code>event loop</code> æˆ–<strong>äº‹ä»¶è½®è¯¢</strong>ã€‚å› ä¸º <code>js</code> æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸”å¼‚æ­¥éœ€è¦<strong>åŸºäºå›è°ƒ</strong>æ¥å®ç°ï¼Œæ‰€ä»¥ï¼Œ <code>event loop</code> å°±æ˜¯<strong>å¼‚æ­¥å›è°ƒ</strong>çš„å®ç°åŸç†ã€‚</p><p><strong>JS åœ¨ç¨‹åºä¸­çš„æ‰§è¡Œéµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</strong></p><ul><li>ä»å‰åˆ°åï¼Œä¸€è¡Œä¸€è¡Œæ‰§è¡Œï¼›</li><li>å¦‚æœæŸä¸€è¡Œæ‰§è¡ŒæŠ¥é”™ï¼Œåˆ™åœæ­¢ä¸‹é¢ä»£ç çš„æ‰§è¡Œï¼›</li><li>å…ˆæŠŠåŒæ­¥ä»£ç æ‰§è¡Œå®Œï¼Œå†æ‰§è¡Œå¼‚æ­¥ã€‚</li></ul><p><strong>ä¸€èµ·æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Hi</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">cb1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cb1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//cb1 å³callbackå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5000</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Bye</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//æ‰“å°é¡ºåºï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Hi</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Bye</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//cb1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>ä»ä¸Šä¾‹ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ <code>JS</code> æ˜¯å…ˆæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œæ‰€ä»¥å…ˆæ‰“å° <code>Hi</code> å’Œ <code>Bye</code> ï¼Œä¹‹åæ‰§è¡Œå¼‚æ­¥ä»£ç ï¼Œæ‰“å°å‡º <code>cb1</code> ã€‚</p><p>ä»¥æ­¤ä»£ç ä¸ºä¾‹ï¼Œä¸‹é¢å¼€å§‹è®²è§£ <code>event loop</code> çš„è¿‡ç¨‹ã€‚</p><h3 id="_4-event-loop-è¿‡ç¨‹" tabindex="-1">ï¼ˆ4ï¼‰event loop è¿‡ç¨‹ <a class="header-anchor" href="#_4-event-loop-è¿‡ç¨‹" aria-label="Permalink to &quot;ï¼ˆ4ï¼‰event loop è¿‡ç¨‹&quot;">â€‹</a></h3><p>å¯¹äºä¸Šé¢è¿™æ®µä»£ç ï¼Œæ‰§è¡Œè¿‡ç¨‹<strong>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210520163909621.gif#pic_center" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p><p>ä»ä¸Šå›¾ä¸­å¯ä»¥åˆ†æå‡ºè¿™æ®µä»£ç çš„è¿è¡Œè½¨è¿¹ã€‚é¦–å…ˆ <code>console.log(&#39;Hi&#39;)</code> æ˜¯åŒæ­¥ä»£ç ï¼Œç›´æ¥æ‰§è¡Œå¹¶æ‰“å°å‡º <code>Hi</code> ã€‚æ¥ä¸‹æ¥ç»§ç»­æ‰§è¡Œå®šæ—¶å™¨ <code>setTimeout</code> ï¼Œ<strong>å®šæ—¶å™¨æ˜¯å¼‚æ­¥ä»£ç </strong>ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æµè§ˆå™¨ä¼šå°†å®ƒäº¤ç»™ <code>Web APIs</code> æ¥å¤„ç†è¿™ä»¶äº‹æƒ…ï¼Œå› æ­¤å…ˆæŠŠå®ƒæ”¾åˆ° <code>Web APIs</code> ä¸­ï¼Œä¹‹åç»§ç»­æ‰§è¡Œ <code>console.log(&#39;Bye&#39;)</code> ï¼Œ <code>console.log(&#39;Bye&#39;)</code> æ˜¯åŒæ­¥ä»£ç ï¼Œåœ¨è°ƒç”¨å †æ ˆ <code>Call Stack</code> ä¸­æ‰§è¡Œï¼Œæ‰“å°å‡º <code>Bye</code> ã€‚</p><p>åˆ°è¿™é‡Œï¼Œè°ƒç”¨å †æ ˆ <code>Call Stack</code> é‡Œé¢çš„å†…å®¹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå½“è°ƒç”¨å †æ ˆçš„å†…å®¹ä¸ºç©ºæ—¶ï¼Œæµè§ˆå™¨å°±ä¼šå¼€å§‹å» <strong>æ¶ˆæ¯é˜Ÿåˆ— Callback Queue</strong> å¯»æ‰¾ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼Œæ­¤æ—¶æ¶ˆæ¯é˜Ÿåˆ—å°±ä¼šå» <code>Web API</code> é‡Œé¢å¯»æ‰¾ä»»åŠ¡ï¼Œéµå¾ª<strong>å…ˆè¿›å…ˆå‡º</strong>åŸåˆ™ï¼Œæ‰¾åˆ°äº†å®šæ—¶å™¨ï¼Œä¸”å®šæ—¶å™¨é‡Œé¢æ˜¯å›è°ƒå‡½æ•° <code>cb1</code> ï¼Œäºæ˜¯æŠŠå›è°ƒå‡½æ•° <code>cb1</code> ä¼ å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶ <code>Web API</code> ä¹Ÿç©ºäº†ï¼Œä»»åŠ¡é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡å°±ä¼šä¼ å…¥åˆ°è°ƒç”¨å †æ ˆé‡Œ<code>Call Stack</code> é‡Œæ‰§è¡Œï¼Œæœ€ç»ˆæ‰“å°å‡º <code>cb1</code> ã€‚</p><h2 id="_4-å›è°ƒå‡½æ•°-ğŸ’¡" tabindex="-1">4. å›è°ƒå‡½æ•° ğŸ’¡ <a class="header-anchor" href="#_4-å›è°ƒå‡½æ•°-ğŸ’¡" aria-label="Permalink to &quot;4. å›è°ƒå‡½æ•° ğŸ’¡&quot;">â€‹</a></h2><p>æ—©æœŸæˆ‘ä»¬åœ¨è§£å†³å¼‚æ­¥é—®é¢˜çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä½¿ç”¨<strong>callback å›è°ƒå‡½æ•°çš„å½¢å¼</strong> æ¥è°ƒç”¨çš„ã€‚<strong>å½¢å¼å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//è·å–ç¬¬ä¸€ä»½æ•°æ®</span></span>
<span class="line"><span style="color:#A6ACCD;">$</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#A6ACCD;">(url1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data1</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data1</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//è·å–ç¬¬äºŒä»½æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">$</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url2</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data2</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data2</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//è·å–ç¬¬ä¸‰ä»½æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">$</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">url3</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data3</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data3</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">//è¿˜å¯ä»¥è·å–æ›´å¤šæ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ—©æœŸåœ¨è°ƒç”¨æ•°æ®çš„æ—¶å€™ï¼Œéƒ½æ˜¯ä¸€å±‚å¥—ä¸€å±‚ï¼Œ <code>callback</code> è°ƒç”¨ <code>callback</code> ï¼Œä»¿ä½›æ·±é™·è°ƒç”¨åœ°ç‹±ä¸€æ ·ï¼Œæ•°æ®ä¹Ÿè¢«è°ƒç”¨çš„éå¸¸ä¹±ä¸ƒå…«ç³Ÿçš„ã€‚æ‰€ä»¥ï¼Œå› ä¸º <code>callback</code> å¯¹å¼€å‘å¦‚æ­¤ä¸å‹å¥½ï¼Œä¹Ÿå°±æœ‰äº†åæ¥çš„ <code>promise</code> äº§ç”Ÿã€‚</p><p><code>promise</code> ç”± <code>CommonJS</code> ç¤¾åŒºæœ€æ—©æå‡ºï¼Œä¹‹ååœ¨<strong>2015 å¹´</strong>çš„æ—¶å€™ï¼Œ <code>ES6</code> å°†å…¶å†™è¿›<strong>è¯­è¨€æ ‡å‡†</strong>ä¸­ï¼Œç»Ÿä¸€äº†å®ƒçš„ç”¨æ³•ï¼ŒåŸç”Ÿæä¾›äº† <code>Promise</code> å¯¹è±¡ã€‚ <code>promise</code> çš„å‡ºç°ï¼Œå‘Šåˆ«äº†å›è°ƒåœ°ç‹±æ—¶ä»£ï¼Œè§£å†³äº†<strong>å›è°ƒåœ°ç‹±</strong> <code>callback hell</code> çš„é—®é¢˜ã€‚</p><p>é‚£ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ <code>Promise</code> çš„å„ç§ç¥å¥‡ç”¨æ³•~</p><h1 id="ğŸ“ƒ-äºŒã€promise-å¼‚æ­¥æ–¹æ¡ˆ" tabindex="-1">ğŸ“ƒ äºŒã€Promise å¼‚æ­¥æ–¹æ¡ˆ <a class="header-anchor" href="#ğŸ“ƒ-äºŒã€promise-å¼‚æ­¥æ–¹æ¡ˆ" aria-label="Permalink to &quot;ğŸ“ƒ äºŒã€Promise å¼‚æ­¥æ–¹æ¡ˆ&quot;">â€‹</a></h1><h2 id="_1-promise-çš„ä¸‰ç§çŠ¶æ€-ğŸ“‚" tabindex="-1">1. Promise çš„ä¸‰ç§çŠ¶æ€ ğŸ“‚ <a class="header-anchor" href="#_1-promise-çš„ä¸‰ç§çŠ¶æ€-ğŸ“‚" aria-label="Permalink to &quot;1. Promise çš„ä¸‰ç§çŠ¶æ€ ğŸ“‚&quot;">â€‹</a></h2><h3 id="_1-promise-çš„ä¸‰ç§çŠ¶æ€" tabindex="-1">ï¼ˆ1ï¼‰Promise çš„ä¸‰ç§çŠ¶æ€ <a class="header-anchor" href="#_1-promise-çš„ä¸‰ç§çŠ¶æ€" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰Promise çš„ä¸‰ç§çŠ¶æ€&quot;">â€‹</a></h3><table><thead><tr><th style="text-align:center;">çŠ¶æ€</th><th style="text-align:center;">å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:center;"><strong>pending</strong></td><td style="text-align:center;">ç­‰å¾…çŠ¶æ€ï¼Œå³åœ¨è¿‡ç¨‹ä¸­ï¼Œè¿˜æ²¡æœ‰ç»“æœã€‚æ¯”å¦‚æ­£åœ¨ç½‘ç»œè¯·æ±‚ï¼Œæˆ–å®šæ—¶å™¨æ²¡æœ‰åˆ°æ—¶é—´ã€‚</td></tr><tr><td style="text-align:center;"><strong>fulfilled</strong></td><td style="text-align:center;">æ»¡è¶³çŠ¶æ€ï¼Œå³äº‹ä»¶å·²ç»è§£å†³äº†ï¼Œå¹¶ä¸”æˆåŠŸäº†ï¼›å½“æˆ‘ä»¬ä¸»åŠ¨å›è°ƒäº† <strong>fulfilled</strong> æ—¶ï¼Œå°±å¤„äºè¯¥çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šå›è°ƒ <strong>then</strong> å‡½æ•°ã€‚</td></tr><tr><td style="text-align:center;"><strong>rejected</strong></td><td style="text-align:center;">æ‹’ç»çŠ¶æ€ï¼Œå³äº‹ä»¶å·²ç»è¢«æ‹’ç»äº†ï¼Œä¹Ÿå°±æ˜¯å¤±è´¥äº†ï¼›å½“æˆ‘ä»¬ä¸»åŠ¨å›è°ƒäº† <strong>reject</strong> æ—¶ï¼Œå°±å¤„äºè¯¥çŠ¶æ€ï¼Œå¹¶ä¸”ä¼šå›è°ƒ <strong>catch</strong> å‡½æ•°ã€‚</td></tr></tbody></table><h3 id="_2-çŠ¶æ€è§£é‡Š" tabindex="-1">ï¼ˆ2ï¼‰çŠ¶æ€è§£é‡Š <a class="header-anchor" href="#_2-çŠ¶æ€è§£é‡Š" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰çŠ¶æ€è§£é‡Š&quot;">â€‹</a></h3><p>å¯¹äº <code>Promise</code> æ¥è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ª<strong>å¯¹è±¡</strong>ï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡<strong>åœ¨æ‰§è¡Œç»“æŸä¹‹å</strong>è¿”å›çš„ç»“æœï¼Œå®ƒæœ‰ <strong>3 ç§çŠ¶æ€</strong>ï¼š <code>pending</code> ï¼Œ <code>fulfilled</code> ï¼Œ <code>rejected</code> ã€‚<strong>å…¶æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/cc1e376dbb8844908538b1cf09c2917c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#pic_center" alt="Promiseçš„æ‰§è¡Œæµç¨‹"></p><p>å¦‚æœä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å¤„äº <code>pending</code> çŠ¶æ€æ—¶ï¼Œé‚£ä¹ˆè¡¨ç¤ºè¿™ä¸ª <code>promise</code> ä¸­çš„<strong>å¼‚æ­¥å‡½æ•°è¿˜æœªæ‰§è¡Œå®Œæ¯•</strong>ï¼Œæ­¤æ—¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ç›¸åï¼Œå¦‚æœ <code>promise</code> ä¸­çš„å¼‚æ­¥å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œé‚£ä¹ˆå®ƒ<strong>åªä¼šèµ°å‘ä¸¤ä¸ªç»“æœï¼š</strong></p><ul><li><code>fulfilled</code> ï¼Œè¡¨ç¤º<strong>æˆåŠŸ</strong>ï¼›</li><li><code>rejected</code> ï¼Œè¡¨ç¤º<strong>å¤±è´¥</strong>ã€‚</li></ul><p>ä¸€æ—¦æœ€ç»ˆçŠ¶æ€ä» <code>pending</code> å˜åŒ–ä¸º <code>fulfilled</code> æˆ–è€… <code>rejected</code> åï¼Œ<strong>çŠ¶æ€å°±å†ä¹Ÿä¸å¯é€†</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œæ€»ç»“æ¥è®²ï¼Œ<code>Promise</code> å¯¹è±¡æœ‰<strong>ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š</strong></p><ul><li><code>promise</code> å¯¹è±¡çš„çŠ¶æ€<strong>ä¸å—å¤–ç•Œå½±å“</strong>ï¼Œä¸€æ—¦çŠ¶æ€è¢«å”¤èµ·ä¹‹åï¼Œå‡½æ•°å°±äº¤ç”± <code>web API</code> å»å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™åœ¨å‡½æ•°ä¸»ä½“ä¸­<strong>å†æ‰§è¡Œä»»ä½•æ“ä½œéƒ½æ˜¯æ²¡æœ‰ç”¨çš„</strong>ï¼›</li><li>åªä¼šå‡ºç° <code>pending</code> â†’ <code>fulfilled</code>ï¼Œæˆ–è€… <code>pending</code> â†’ <code>rejected</code> çŠ¶æ€ï¼Œå³è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ã€‚å³ä½¿å†å¯¹ <code>promise</code> å¯¹è±¡æ·»åŠ å›è°ƒå‡½æ•°ï¼Œä¹Ÿ<strong>åªä¼šå¾—åˆ°åŒæ ·çš„ç»“æœ</strong>ï¼Œå³å®ƒçš„çŠ¶æ€éƒ½<strong>ä¸ä¼šå†å‘ç”Ÿè¢«æ”¹å˜</strong>ã€‚</li></ul><h2 id="_2-ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç°-ğŸ“‚" tabindex="-1">2. ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç° ğŸ“‚ <a class="header-anchor" href="#_2-ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç°-ğŸ“‚" aria-label="Permalink to &quot;2. ä¸‰ç§çŠ¶æ€çš„å˜åŒ–å’Œè¡¨ç° ğŸ“‚&quot;">â€‹</a></h2><h3 id="_1-çŠ¶æ€çš„å˜åŒ–" tabindex="-1">ï¼ˆ1ï¼‰çŠ¶æ€çš„å˜åŒ– <a class="header-anchor" href="#_1-çŠ¶æ€çš„å˜åŒ–" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰çŠ¶æ€çš„å˜åŒ–&quot;">â€‹</a></h3><p><code>promise</code> ä¸»è¦æœ‰ä»¥ä¸Šä¸‰ç§çŠ¶æ€ï¼Œ <code>pending</code> ã€ <code>fulfilled</code> å’Œ <code>rejected</code> ã€‚å½“è¿”å›ä¸€ä¸ª <code>pending</code> çŠ¶æ€çš„ <code>promise</code> æ—¶ï¼Œä¸ä¼šè§¦å‘ <code>then</code> å’Œ <code>catch</code> ã€‚å½“è¿”å›ä¸€ä¸ª <code>fulfilled</code> çŠ¶æ€æ—¶ï¼Œä¼šè§¦å‘ <code>then</code> å›è°ƒå‡½æ•°ã€‚å½“è¿”å›ä¸€ä¸ª <code>rejected</code> çŠ¶æ€æ—¶ï¼Œä¼šè§¦å‘ <code>catch</code> å›è°ƒå‡½æ•°ã€‚é‚£åœ¨è¿™å‡ ä¸ªçŠ¶æ€ä¹‹é—´ï¼Œä»–ä»¬æ˜¯æ€ä¹ˆå˜åŒ–çš„å‘¢ï¼Ÿ</p><p><strong>1ï¼‰æ¼”ç¤º 1</strong></p><p><strong>å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolved</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">rejected</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p1)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//pending</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œ<strong>æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210520171144297.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="çŠ¶æ€å˜åŒ–æ¼”ç¤º1"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p1</code> å‡½æ•°é‡Œé¢æ²¡æœ‰å†…å®¹å¯ä»¥æ‰§è¡Œï¼Œæ‰€ä»¥ä¸€ç›´åœ¨ç­‰å¾…çŠ¶æ€ï¼Œå› æ­¤æ˜¯ <code>pending</code> ã€‚</p><p><strong>2ï¼‰æ¼”ç¤º 2</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolved</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">rejected</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolved</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//pending ä¸€å¼€å§‹æ‰“å°æ—¶</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p2-setTimeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//fulfilled</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œ<strong>æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210520171211537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="çŠ¶æ€å˜åŒ–æ¼”ç¤º2"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p2</code> ä¸€å¼€å§‹æ‰“å°çš„æ˜¯ <code>pending</code> çŠ¶æ€ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ‰§è¡Œåˆ° <code>setTimeout</code> é‡Œé¢ã€‚ç­‰åˆ°åç»­æ‰§è¡Œ <code>setTimeout</code> æ—¶ï¼Œæ‰ä¼šè§¦å‘åˆ° <code>resolved</code> å‡½æ•°ï¼Œè§¦å‘åè¿”å›ä¸€ä¸ª <code>fulfilled</code> çŠ¶æ€ <code>promise</code> ã€‚</p><p><strong>3ï¼‰æ¼”ç¤º 3</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolved</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">rejected</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">rejected</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p3)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p3-setTimeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p3))</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//rejected</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210520171225285.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="çŠ¶æ€å˜åŒ–æ¼”ç¤º3"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p3</code> ä¸€å¼€å§‹æ‰“å°çš„æ˜¯ <code>pending</code> çŠ¶æ€ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ‰§è¡Œåˆ° <code>setTimeout</code> é‡Œé¢ã€‚ç­‰åˆ°åç»­æ‰§è¡Œ <code>setTimeout</code> æ—¶ï¼ŒåŒæ ·åœ°ï¼Œä¼šè§¦å‘åˆ° <code>rejected</code> å‡½æ•°ï¼Œè§¦å‘åè¿”å›ä¸€ä¸ª <code>rejected</code> çŠ¶æ€çš„ <code>promise</code> ã€‚</p><p>çœ‹å®Œ <code>promise</code> çŠ¶æ€çš„å˜åŒ–åï¼Œç›¸ä¿¡å¤§å®¶å¯¹ <code>promise</code> çš„ä¸‰ç§çŠ¶æ€åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™è§¦å‘ä¼šæœ‰ä¸€å®šçš„äº†è§£ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ç»§ç»­çœ‹ <code>promise</code> çŠ¶æ€çš„è¡¨ç°ã€‚</p><h3 id="_2-çŠ¶æ€çš„è¡¨ç°" tabindex="-1">ï¼ˆ2ï¼‰çŠ¶æ€çš„è¡¨ç° <a class="header-anchor" href="#_2-çŠ¶æ€çš„è¡¨ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰çŠ¶æ€çš„è¡¨ç°&quot;">â€‹</a></h3><ul><li><code>pending</code> çŠ¶æ€ï¼Œä¸ä¼šè§¦å‘ <code>then</code> å’Œ <code>catch</code> ã€‚</li><li><code>fulfilled</code> çŠ¶æ€ï¼Œä¼šè§¦å‘åç»­çš„ <code>then</code> å›è°ƒå‡½æ•°ã€‚</li><li><code>rejected</code> çŠ¶æ€ï¼Œä¼šè§¦å‘åç»­çš„ <code>catch</code> å›è°ƒå‡½æ•°ã€‚</li></ul><p>æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸‹ã€‚</p><p><strong>1ï¼‰æ¼”ç¤º 1</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//fulfilled</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p1)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">p1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">err</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œ<strong>æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210520171240910.png#" alt="çŠ¶æ€çš„è¡¨ç°æ¼”ç¤º1"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p1</code> è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>resolved</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p1</code> å±äº <code>fulfilled</code> çŠ¶æ€ï¼Œ <code>fulfilled</code> çŠ¶æ€ä¸‹ï¼Œåªä¼šè§¦å‘ <code>.then</code> å›è°ƒå‡½æ•°ï¼Œä¸ä¼šè§¦å‘ <code>.catch</code> ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰“å°å‡º <code>data 100</code> ã€‚</p><p><strong>2ï¼‰æ¼”ç¤º 2</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reject</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">404</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//rejected</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">p2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">err2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œ<strong>æ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://img-blog.csdnimg.cn/20210520171254138.png#" alt="çŠ¶æ€çš„è¡¨ç°æ¼”ç¤º2"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p2</code> è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>reject</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p1</code> å±äº <code>reject</code> çŠ¶æ€ï¼Œ <code>reject</code> çŠ¶æ€ä¸‹ï¼Œåªä¼šè§¦å‘ <code>.catch</code> å›è°ƒå‡½æ•°ï¼Œä¸ä¼šè§¦å‘ <code>.then</code> ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰“å°å‡º <code>err2 404</code> ã€‚</p><h2 id="_3-promise-çš„ä½¿ç”¨æ¡ˆä¾‹-ğŸ“‚" tabindex="-1">3. Promise çš„ä½¿ç”¨æ¡ˆä¾‹ ğŸ“‚ <a class="header-anchor" href="#_3-promise-çš„ä½¿ç”¨æ¡ˆä¾‹-ğŸ“‚" aria-label="Permalink to &quot;3. Promise çš„ä½¿ç”¨æ¡ˆä¾‹ ğŸ“‚&quot;">â€‹</a></h2><p>å¯¹ä¸‰ç§çŠ¶æ€æœ‰äº†åŸºç¡€äº†è§£ä¹‹åï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ¡ˆä¾‹æ¥ç²¾è¿›å¯¹ <code>Promise</code> çš„ä½¿ç”¨ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è¦å®ç°çš„åŠŸèƒ½æ˜¯ï¼Œé€šè¿‡ <code>fs</code> æ¨¡å—ï¼Œå¼‚æ­¥åœ°è°ƒç”¨æœ¬åœ°çš„æ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨æ§åˆ¶å°ä¸Šè¾“å‡ºæ–‡ä»¶çš„å†…å®¹ï¼›å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™å°†æŠ›å‡ºå¼‚å¸¸ã€‚<strong>å®ç°ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> readFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// è¿”å›ä¸€ä¸ª promise å®ä¾‹ï¼Œä»¥ä¾› then è°ƒç”¨</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ readFile å»å¼‚æ­¥åœ°è¯»å–æ–‡ä»¶ï¼Œå¼‚æ­¥è°ƒç”¨ä¹Ÿæ˜¯ promise å‡½æ•°çš„æ„ä¹‰</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// æ³¨æ„ï¼šä¸‹é¢è¿™ä¸ªå‡½æ•°çš„é€»è¾‘æ˜¯é”™è¯¯ä¼˜å…ˆï¼Œä¹Ÿå°±æ˜¯å…ˆerrï¼Œå†data</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å¦‚æœæ–‡ä»¶è¯»å–å¤±è´¥ï¼Œå°±è°ƒå– reject ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å¦‚æœæˆåŠŸï¼Œå°±è°ƒå– resolve ï¼Œå¹¶è¿”å›è°ƒç”¨æˆåŠŸçš„æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ä»£ç </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ–‡ä»¶å­˜åœ¨é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> existedFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">readFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./test.txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">existedFile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Buffer.from()æ–¹æ³•ç”¨äºåˆ›å»ºåŒ…å«æŒ‡å®šå­—ç¬¦ä¸²ï¼Œæ•°ç»„æˆ–ç¼“å†²åŒºçš„æ–°ç¼“å†²åŒºã€‚</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// Buffer.from(data).toString()è¯»å‡ºæ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚æ–‡ä»¶é‡Œé¢è®°å¾—å†™å†…å®¹ï¼ï¼</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">content: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">error</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ–‡ä»¶ä¸å­˜åœ¨é€»è¾‘</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> failFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">readFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./fail.txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">failFile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><strong>æœ€ç»ˆæ§åˆ¶å°çš„æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">[Error: ENOENT: no such file or directory</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> open </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">C:</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">promise</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">fail.txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">errno</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">4058</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">code</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ENOENT</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">syscall</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">open</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">C:</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">promise</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">fail.txt</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">content</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">  è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå½“ <code>./test.txt</code> æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œé‚£ä¹ˆ <code>existedFile</code> ä¼šå»è°ƒç”¨åç»­çš„ <code>.then</code> å›è°ƒå‡½æ•°ï¼Œå› æ­¤æœ€ç»ˆè¿”å›è°ƒç”¨æˆåŠŸçš„ç»“æœã€‚æ³¨æ„ï¼Œ<code>è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼</code> è¿™è¡Œå­—å°±æ˜¯ <code>test</code> æ–‡ä»¶é‡Œé¢çš„å†…å®¹ã€‚</p><p>åŒæ—¶ï¼Œ <code>./fail.txt</code> æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå› æ­¤ <code>failFile</code> ä¼šè°ƒç”¨åç»­çš„ <code>.catch</code> æ–‡ä»¶ï¼ŒåŒæ—¶å°†å¼‚å¸¸æŠ›å‡ºã€‚</p><p>ç°åœ¨ï¼Œå¤§å®¶åº”è¯¥å¯¹ <code>promise</code> çš„ä½¿ç”¨æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­çœ‹ <code>promise</code> ä¸­ <code>then</code> å’Œ <code>catch</code> å¯¹çŠ¶æ€çš„å½±å“ã€‚</p><h2 id="_4-then-å’Œ-catch-å¯¹çŠ¶æ€çš„å½±å“-ğŸ“‚" tabindex="-1">4. then å’Œ catch å¯¹çŠ¶æ€çš„å½±å“ ğŸ“‚ <a class="header-anchor" href="#_4-then-å’Œ-catch-å¯¹çŠ¶æ€çš„å½±å“-ğŸ“‚" aria-label="Permalink to &quot;4. then å’Œ catch å¯¹çŠ¶æ€çš„å½±å“ ğŸ“‚&quot;">â€‹</a></h2><ul><li><code>then</code> æ­£å¸¸è¿”å› <code>fulfilled</code> ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> ï¼›</li><li><code>catch</code> æ­£å¸¸è¿”å› <code>fulfilled</code> ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> ã€‚</li></ul><p><strong>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€æ¡è§„åˆ™ï¼š</strong> <code>then</code> æ­£å¸¸è¿”å› <code>fulfilled</code> ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> ã€‚</p><p><strong>1ï¼‰æ¼”ç¤º 1</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p1)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//fulfilledçŠ¶æ€ï¼Œä¼šè§¦å‘åç»­çš„.thenå›è°ƒ</span></span>
<span class="line"><span style="color:#A6ACCD;">p1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210520171325908.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="thenå’Œcatchå¯¹çŠ¶æ€çš„å½±å“æ¼”ç¤º1"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p1</code> è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>resolve</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p1</code> æ­£å¸¸è¿”å› <code>fulfilled</code> ï¼Œ ä¸æŠ¥é”™ï¼Œæ‰€ä»¥æœ€ç»ˆæ‰“å°å‡º <code>123</code> ã€‚</p><p><strong>2ï¼‰æ¼”ç¤º 2</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">then error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//rejectedçŠ¶æ€ï¼Œè§¦å‘åç»­.catchå›è°ƒ</span></span>
<span class="line"><span style="color:#A6ACCD;">p2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">456</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">err404</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210520171346993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="thenå’Œcatchå¯¹çŠ¶æ€çš„å½±å“æ¼”ç¤º2"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p2</code> è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>resolve</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p2</code> åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ª <code>Error</code> ï¼Œæ‰€ä»¥ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> çŠ¶æ€ ï¼Œ æ‰€ä»¥æœ€ç»ˆæ‰“å°å‡º <code>err404 Error: then error</code> çš„ç»“æœã€‚</p><p><strong>æˆ‘ä»¬å†æ¥çœ‹ç¬¬äºŒæ¡è§„åˆ™</strong>ï¼š <code>catch</code> æ­£å¸¸è¿”å› <code>fulfilled</code> ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> ã€‚</p><p><strong>1ï¼‰æ¼”ç¤º 1ï¼ˆéœ€ç‰¹åˆ«è°¨æ…! !ï¼‰</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p3 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reject</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">error</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p3)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//fulfilledçŠ¶æ€ï¼Œæ³¨æ„ï¼è§¦å‘åç»­.thenå›è°ƒ</span></span>
<span class="line"><span style="color:#A6ACCD;">p3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210520171451933.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="thenå’Œcatchå¯¹çŠ¶æ€çš„å½±å“æ¼”ç¤º3"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p3</code> è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>rejected</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p3</code> åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ­£å¸¸è¿”å›äº†ä¸€ä¸ª <code>Error</code> ï¼Œ<strong>è¿™ä¸ªç‚¹éœ€è¦ç‰¹åˆ«è°¨æ…</strong>ï¼ï¼è¿™çœ‹èµ·æ¥ä¼¼ä¹æœ‰ç‚¹è¿èƒŒå¸¸ç†ï¼Œä½†å¯¹äº <code>promise</code> æ¥è¯´ï¼Œä¸ç®¡æ—¶è°ƒç”¨ <code>resolved</code> è¿˜æ˜¯ <code>rejected</code> ï¼Œåªè¦æ˜¯æ­£å¸¸è¿”å›è€Œæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½æ˜¯è¿”å› <code>fulfilled</code> çŠ¶æ€ã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆ <code>p3</code> çš„çŠ¶æ€æ˜¯ <code>fulfilled</code> çŠ¶æ€ï¼Œä¸”å› ä¸ºæ˜¯ <code>fulfilled</code> çŠ¶æ€ï¼Œä¹‹åè¿˜å¯ä»¥ç»§ç»­è°ƒç”¨ <code>.then</code> å‡½æ•°ã€‚</p><p><strong>2ï¼‰æ¼”ç¤º 2</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p4 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">reject</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">catch err</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">p4</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p4)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//rejectedçŠ¶æ€ï¼Œè§¦å‘.catchå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">p4</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">some err</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>åœ¨ä»¥ä¸Šçš„è¿™æ®µä»£ç ä¸­ï¼Œæ§åˆ¶å°æ‰“å°ç»“æœå¦‚ä¸‹ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20210520171512781.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDgwMzc1Mw==,size_16,color_FFFFFF,t_70#" alt="thenå’Œcatchå¯¹çŠ¶æ€çš„å½±å“æ¼”ç¤º4"></p><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ <code>p4</code> ä¾ç„¶è°ƒç”¨ <code>promise</code> ä¸­çš„ <code>reject</code> å›è°ƒå‡½æ•°ï¼Œæ­¤æ—¶æ‰§è¡Œæ—¶ï¼Œ <code>p4</code> åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒæŠ›å‡ºäº†ä¸€ä¸ª <code>Error</code> ï¼Œæ‰€ä»¥ï¼Œé‡Œé¢æœ‰æŠ¥é”™åˆ™è¿”å› <code>rejected</code> çŠ¶æ€ ï¼Œ æ­¤æ—¶ <code>p4</code> çš„çŠ¶æ€ä¸º <code>rejected</code> ï¼Œä¹‹åè§¦å‘åç»­çš„ <code>.catch</code> å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥æœ€ç»ˆæ‰“å°å‡º <code>some err</code> çš„ç»“æœã€‚</p><h2 id="_5-promise-çš„å¹¶è¡Œæ‰§è¡Œ-ğŸ“‚" tabindex="-1">5. Promise çš„å¹¶è¡Œæ‰§è¡Œ ğŸ“‚ <a class="header-anchor" href="#_5-promise-çš„å¹¶è¡Œæ‰§è¡Œ-ğŸ“‚" aria-label="Permalink to &quot;5. Promise çš„å¹¶è¡Œæ‰§è¡Œ ğŸ“‚&quot;">â€‹</a></h2><h3 id="_1-promise-all" tabindex="-1">ï¼ˆ1ï¼‰Promise.all <a class="header-anchor" href="#_1-promise-all" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰Promise.all&quot;">â€‹</a></h3><p><code>Promise.all</code> æ–¹æ³•ç”¨äºå°†å¤šä¸ª <code>Promise</code> å®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚<strong>æ¯”å¦‚ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">([p1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p3])</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>p çš„çŠ¶æ€ç”± <code>p1</code> ã€ <code>p2</code> ã€ <code>p3</code> å†³å®šï¼Œ<strong>åˆ†æˆä¸¤ç§æƒ…å†µï¼š</strong></p><ul><li>åªæœ‰ <code>p1</code> ã€ <code>p2</code> ã€ <code>p3</code> çš„çŠ¶æ€éƒ½å˜ä¸º <code>fulfilled</code> ï¼Œæœ€ç»ˆ <code>p</code> çš„çŠ¶æ€æ‰ä¼šå˜ä¸º <code>fulfilled</code> ã€‚æ­¤æ—¶ <code>p1</code> ã€ <code>p2</code> ã€ <code>p3</code> çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è¿”å›ç»™ <code>p</code> å›è°ƒå‡½æ•°ã€‚</li><li>åªè¦ <code>p1</code> ã€ <code>p2</code> ã€ <code>p3</code> è¿™ä¸‰ä¸ªå‚æ•°ä¸­æœ‰ä»»ä½•ä¸€ä¸ªè¢« <code>rejected</code> ï¼Œ é‚£ä¹ˆ <code>p</code> çš„çŠ¶æ€å°±ä¼šå˜æˆ <code>rejected</code> ã€‚æ­¤æ—¶ç¬¬ä¸€ä¸ªè¢« <code>rejected</code> çš„å®ä¾‹çš„è¿”å›å€¼å°†ä¼šè¿”å›ç»™ <code>p</code> çš„å›è°ƒå‡½æ•°ã€‚</li></ul><p>ä¸‹é¢ç”¨ä¸€ä¸ªå®ä¾‹æ¥å±•ç¤º <code>Promise.all</code> çš„ä½¿ç”¨æ–¹å¼ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//ç”Ÿæˆä¸€ä¸ªPromiseå¯¹è±¡çš„æ•°ç»„</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> promises </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">74</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">25</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getJSON</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/post/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(promises)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#82AAFF;">fucntion</span><span style="color:#A6ACCD;"> (posts) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºä»¥ä¸Šä»£ç æ¥è¯´ï¼Œ <code>promises</code> æ˜¯åŒ…å« 5 ä¸ª Promise å®ä¾‹çš„æ•°ç»„ï¼Œåªæœ‰è¿™<strong>5 ä¸ªå®ä¾‹çš„çŠ¶æ€éƒ½å˜æˆ fulfilled</strong> ï¼Œæˆ–è€…<strong>å…¶ä¸­æœ‰ä¸€ä¸ªå˜ä¸º rejected</strong> ï¼Œé‚£ä¹ˆæ‰ä¼šè°ƒç”¨ <code>Promise.all</code> æ–¹æ³•åé¢çš„å›è°ƒå‡½æ•°ã€‚</p><hr><p>è¿™é‡Œæœ‰ä¸€ç§å€¼å¾—æ³¨æ„çš„ç‰¹æ®Šæƒ…å†µæ˜¯ï¼Œå¦‚æœä½œä¸ºå‚æ•°çš„ <code>Promise</code> å®ä¾‹è‡ªèº«å®šä¹‰äº† <code>catch</code> æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒè¢« <code>rejected</code> æ—¶å¹¶ä¸ä¼šè§¦å‘ <code>Promise.all()</code> çš„ <code>catch</code> æ–¹æ³•ã€‚è¿™æ ·è¯´å¯èƒ½æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå®ä¾‹æ¥å±•ç¤ºä¸€ä¸‹ï¼Œ<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> p2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æŠ¥é”™äº†</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">([p1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2])</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">result</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ <code>p1</code> ä¼š <code>resolve</code> ï¼Œä¹‹åè°ƒç”¨åç»­çš„ <code>.then</code> å›è°ƒå‡½æ•°ã€‚è€Œ <code>p2</code> ä¼š <code>reject</code> ï¼Œå› æ­¤ä¹‹åä¼šè°ƒç”¨åç»­çš„ <code>.catch</code> å›è°ƒå‡½æ•°ã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„ <code>p2</code> æœ‰è‡ªå·±çš„ <code>catch</code> æ–¹æ³•ï¼Œä¸”è¯¥æ–¹æ³•è¿”å›çš„æ—¶ä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ï¼Œè€Œ <code>p2</code> å®é™…ä¸ŠæŒ‡å‘çš„å°±æ˜¯è¿™ä¸ªå®ä¾‹ã€‚</p><p>æ‰€ä»¥å‘¢ï¼Œè¿™ä¸ªå®ä¾‹æ‰§è¡Œå®Œ <code>catch</code> æ–¹æ³•åä¹Ÿä¼šå˜æˆ <code>resolved</code> ã€‚å› æ­¤ï¼Œ åœ¨ <code>Promise.all()</code> è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œå…¶å‚æ•°é‡Œé¢çš„ä¸¤ä¸ªå®ä¾‹å°±éƒ½ä¼š <code>resolved</code> ï¼Œæ‰€ä»¥ä¹‹åä¼šè°ƒç”¨ <code>then</code> æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ï¼Œè€Œä¸ä¼šè°ƒç”¨ <code>catch</code> æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p><h3 id="_2-promise-race" tabindex="-1">ï¼ˆ2ï¼‰Promise.race <a class="header-anchor" href="#_2-promise-race" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰Promise.race&quot;">â€‹</a></h3><p><code>Promise.race</code> æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª <code>Promise</code> å®ä¾‹åŒ…è£…æˆä¸€ä¸ªæ–°çš„ <code>Promise</code> å®ä¾‹ã€‚<strong>æ¯”å¦‚ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">race</span><span style="color:#A6ACCD;">([p1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> p3])</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>æˆ‘ä»¬åŒæ ·ç”¨ä»¥ä¸Šè¿™æ®µä»£ç æ¥è¿›è¡Œåˆ†æã€‚ä¸ <code>Promise.all()</code> ä¸åŒçš„æ˜¯ï¼Œ<strong>åªè¦ <code>p1</code> ã€ <code>p2</code> ã€ <code>p3</code> ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€</strong>ï¼Œé‚£ä¹ˆ** <code>p</code> çš„çŠ¶æ€å°±ä¼šè·Ÿç€æ”¹å˜**ï¼Œä¸”é‚£ä¸ª<strong>ç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼</strong>å°±ä¼šä¼ é€’ç»™ <code>p</code> çš„å›è°ƒå‡½æ•°ã€‚</p><p>æ‰€ä»¥å‘€ï¼Œä¸ºä»€ä¹ˆå®ƒå« <code>race</code> ï¼Ÿ <code>race</code> ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯<strong>ç«èµ›</strong>çš„æ„æ€ã€‚åœ¨èµ›åœºä¸Šï¼Œç¬¬ä¸€åæ°¸è¿œåªæœ‰ä¸€ä¸ªã€‚è€Œæˆ‘ä»¬å¯ä»¥æŠŠç¬¬ä¸€åè§†ä¸ºç¬¬ä¸€ä¸ª <code>resolve</code> çŠ¶æ€çš„ <code>promise</code> ï¼Œåªè¦ç¬¬ä¸€åå‡ºç°äº†ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯ç¬¬ä¸€åèµ¢äº†ï¼Œæ‰€ä»¥è¿”å›çš„å€¼å°±æ˜¯ç¬¬ä¸€ä¸ªä¸º <code>resolve</code> çš„å€¼ã€‚å…¶ä»–äººå†æ€ä¹ˆèµ›è·‘éƒ½é€ƒä¸è¿‡æ‹¿ä¸åˆ°ç¬¬ä¸€çš„ç°å®ã€‚</p><h2 id="_6-ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³•-ğŸ“‚" tabindex="-1">6. ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³• ğŸ“‚ <a class="header-anchor" href="#_6-ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³•-ğŸ“‚" aria-label="Permalink to &quot;6. ä¸¤ä¸ªæœ‰ç”¨çš„é™„åŠ æ–¹æ³• ğŸ“‚&quot;">â€‹</a></h2><p><code>ES6</code> ä¸­ <code>Promise API</code> å¹¶æ²¡æœ‰æä¾›å¾ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥éƒ¨ç½²ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ¥éƒ¨ç½²ä¸¤ä¸ªä¸åœ¨ <code>ES6</code> ä¸­ä½†æ˜¯å´å¾ˆæœ‰ç”¨çš„æ–¹æ³•ã€‚</p><h3 id="_1-done" tabindex="-1">ï¼ˆ1ï¼‰done() <a class="header-anchor" href="#_1-done" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰done()&quot;">â€‹</a></h3><p>æ— è®º <code>Promise</code> å¯¹è±¡çš„å›è°ƒé“¾ä»¥ <code>then</code> æ–¹æ³•è¿˜æ˜¯ <code>catch</code> æ–¹æ³•ç»“å°¾ï¼Œåªè¦æœ€åä¸€ä¸ªæ–¹æ³•æŠ›å‡ºé”™è¯¯ï¼Œé‚£ä¹ˆéƒ½æœ‰å¯èƒ½å‡ºç°æ— æ³•æ•æ‰åˆ°çš„æƒ…å†µã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼ŸåŸå› åœ¨äº <code>promise</code> å†…éƒ¨çš„é”™è¯¯<strong>å¹¶ä¸ä¼šå†’æ³¡åˆ°å…¨å±€</strong>ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <code>done</code> æ–¹æ³•ã€‚<code>done</code> æ–¹æ³•æ€»æ˜¯å¤„äºå›è°ƒé“¾çš„å°¾ç«¯ï¼Œä¿è¯æŠ›å‡º<strong>ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯</strong>ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒçš„ä½¿ç”¨æ–¹å¼ï¼Œ<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">asyncFunc</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(f1)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#A6ACCD;">(r1)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(f2)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">done</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>åŒæ—¶å‘¢ï¼Œå®ƒçš„å®ç°ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">done</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">onFulfilled</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">onRejected</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">onFulfilled</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">onRejected</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//æŠ›å‡ºä¸€ä¸ªå…¨å±€é”™è¯¯</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>ç”±ä»¥ä¸Šä»£ç å¯çŸ¥ï¼Œ <code>done</code> æ–¹æ³•å¯ä»¥åƒ <code>then</code> æ–¹æ³•é‚£æ ·ä½¿ç”¨ï¼Œæä¾› <code>fulfilled</code> å’Œ <code>rejected</code> çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ä¸æä¾›ä»»ä½•å‚æ•°ã€‚ä½†æ˜¯ä¸ç®¡å¦‚ä½•ï¼Œ <code>done</code> æ–¹æ³•éƒ½ä¼šæ•æ‰åˆ°ä»»ä½•å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå¹¶å‘å…¨å±€æŠ›å‡ºã€‚</p><h3 id="_2-finally" tabindex="-1">ï¼ˆ2ï¼‰finally() <a class="header-anchor" href="#_2-finally" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰finally()&quot;">â€‹</a></h3><p><code>finally</code> æ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ <code>Promise</code> å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œçš„æ“ä½œã€‚å®ƒä¸ <code>done</code> æ–¹æ³•æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œå®ƒæ¥å—ä¸€ä¸ªæ™®é€šçš„<strong>å›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°</strong>ï¼Œè¯¥å‡½æ•°ä¸ç®¡æ€æ ·éƒ½å¿…é¡»æ‰§è¡Œã€‚</p><p>ä¸‹é¢æ¥å±•ç¤ºä¸€ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰ä¸€å°æœåŠ¡å™¨ï¼Œç°åœ¨è®©è¿™å°æœåŠ¡å™¨ä½¿ç”¨ <code>Promise</code> æ¥å¤„ç†è¯·æ±‚ï¼Œç„¶åä½¿ç”¨ <code>finally</code> æ–¹æ³•å…³æ‰æœåŠ¡å™¨ã€‚<strong>å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">server</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">listen</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// run test</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;">(server</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">stop)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>åŒæ ·åœ°ï¼Œå®ƒçš„å®ç°ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">callback</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">constructor</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">callback</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>é€šè¿‡ä»¥ä¸Šä»£ç æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼Œä¸ç®¡å‰é¢çš„ <code>promise</code> æ˜¯ <code>fulfilled</code> è¿˜æ˜¯ <code>rejected</code> ï¼Œæœ€ç»ˆéƒ½ä¼šæ‰§è¡Œå›è°ƒå‡½æ•° <code>callback</code> ã€‚</p><h1 id="ğŸ“‘-ä¸‰ã€å®ç°-promise-çš„æ ¸å¿ƒåŠŸèƒ½" tabindex="-1">ğŸ“‘ ä¸‰ã€å®ç° Promise çš„æ ¸å¿ƒåŠŸèƒ½ <a class="header-anchor" href="#ğŸ“‘-ä¸‰ã€å®ç°-promise-çš„æ ¸å¿ƒåŠŸèƒ½" aria-label="Permalink to &quot;ğŸ“‘ ä¸‰ã€å®ç° Promise çš„æ ¸å¿ƒåŠŸèƒ½&quot;">â€‹</a></h1><h2 id="_1-åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç°-ğŸ·ï¸" tabindex="-1">1. åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç° ğŸ·ï¸ <a class="header-anchor" href="#_1-åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç°-ğŸ·ï¸" aria-label="Permalink to &quot;1. åŸºç¡€æ ¸å¿ƒåŠŸèƒ½å®ç° ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-ç¢ç¢å¿µ" tabindex="-1">ï¼ˆ1ï¼‰ç¢ç¢å¿µ <a class="header-anchor" href="#_1-ç¢ç¢å¿µ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰ç¢ç¢å¿µ&quot;">â€‹</a></h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ¥å®ç° <code>promise</code> æœ€åŸºç¡€çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯ <code>promise.resolve()</code> å’Œ <code>promise.reject()</code> è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p><p>æ³¨æ„ï¼šåŸºç¡€åŠŸèƒ½é™¤äº†æ„é€ å™¨ <code>constructor</code> æ„ä»¥å¤–ï¼Œå…¶ä½™çš„å®ç°éƒ½<strong>ä¸æ˜¯ç»‘å®šåœ¨åŸå‹é“¾ä¸Šçš„å‡½æ•°</strong>ï¼Œå°†ä¼šä½¿ç”¨<strong>ç®­å¤´å‡½æ•°</strong>æ¥è¿›è¡Œå®ç°ã€‚</p><h3 id="_2-promise-åŸºç¡€åŠŸèƒ½çš„åˆ†æ" tabindex="-1">ï¼ˆ2ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„åˆ†æ <a class="header-anchor" href="#_2-promise-åŸºç¡€åŠŸèƒ½çš„åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„åˆ†æ&quot;">â€‹</a></h3><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ <code>promise</code> çš„åŸºæœ¬ä½¿ç”¨æ˜¯æ€ä¹ˆæ ·çš„ï¼Œ<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 01_promiseçš„åŸºæœ¬ä½¿ç”¨</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">success</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>æ ¹æ®ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡º <code>promise</code> æœ‰<strong>ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š</strong></p><ul><li><code>promise</code> æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼›</li><li>å½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ª <code>promise</code> å¯¹è±¡çš„åŒæ—¶ï¼Œéœ€è¦ä¼ è¿›å»ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼›</li><li>è¿™ä¸ªå›è°ƒå‡½æ•°åˆéœ€è¦æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•° <code>resolve</code> å’Œ <code>reject</code> ï¼Œä¸”ç”¨è¿™<strong>ä¸¤ä¸ªå›è°ƒå‡½æ•°æ¥ä½œä¸ºå‚æ•°</strong>ï¼Œä¹‹åå‘¢ï¼Œ å½“è°ƒç”¨æˆåŠŸæ—¶ï¼Œä½¿ç”¨ <code>resolve</code> å›è°ƒå‡½æ•°ï¼Œè€Œå½“è°ƒç”¨å¤±è´¥æ—¶ï¼Œä½¿ç”¨ <code>reject</code> å›è°ƒå‡½æ•°ã€‚</li><li><code>resolve</code> å’Œ <code>reject</code> è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°éƒ½å°†ä¼šè¢«ç”¨æ¥ä¿®æ”¹ <code>promise</code> çš„çŠ¶æ€ï¼Œ <code>resolve</code> ä¼šæŠŠ <code>pending</code> çŠ¶æ€ä¿®æ”¹ä¸º <code>fulfilled</code> ï¼Œè€Œ <code>reject</code> å°†ä¼šæŠŠ <code>pending</code> çŠ¶æ€ä¿®æ”¹ä¸º <code>rejected</code> ã€‚åŒæ—¶ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä¸€æ—¦çŠ¶æ€ç¡®å®šåï¼Œåç»­æ‰€æœ‰æ“ä½œçš„çŠ¶æ€å°†ä¸ä¼šå†è¢«æ›´æ”¹ï¼Œå³ä¸å¯é€†</strong>ã€‚</li></ul><h3 id="_3-promise-åŸºç¡€åŠŸèƒ½çš„å®ç°" tabindex="-1">ï¼ˆ3ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„å®ç° <a class="header-anchor" href="#_3-promise-åŸºç¡€åŠŸèƒ½çš„å®ç°" aria-label="Permalink to &quot;ï¼ˆ3ï¼‰Promise åŸºç¡€åŠŸèƒ½çš„å®ç°&quot;">â€‹</a></h3><p>æˆ‘ä»¬ç°åœ¨æ¥å®ç° <code>promise</code> çš„åŸºæœ¬åŠŸèƒ½ï¼Œ<strong>è¯¥åŠŸèƒ½å«æœ‰ä»¥ä¸‹å‡ ä¸ªç»„æˆè¦ç´ ï¼š</strong></p><ul><li>å®ç° <code>PromiseMon</code> çš„åŸºç¡€ç»“æ„ï¼Œå…¶ä¸­åŒ…å«æ„é€ å‡½æ•°å’ŒçŠ¶æ€ï¼›</li><li>å®ç° <code>resolve</code> å’Œ <code>reject</code> åŠŸèƒ½ï¼Œè¿™é‡Œå…ˆå®ç°çŠ¶æ€ä» <code>pending</code> åˆ° <code>fulfilled</code> æˆ– <code>rejected</code> çš„æ”¹å˜ï¼Œå…¶ä½™çŠ¶æ€é—´çš„æ”¹å˜æš‚æœªå®ç°ã€‚</li></ul><p><strong>å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 02_promiseåŸºç¡€åŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å®šä¹‰pendingã€fulfilledå’Œrejectedä¸‰ä¸ªå¸¸é‡</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰Promiseä¸­çš„çŠ¶æ€ï¼Œé»˜è®¤çŠ¶æ€ä¸ºpending</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// cbå³callback,æ˜¯ä¼ ç»™promiseçš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// cbè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œä½œç”¨æ˜¯åˆ¤æ–­çŠ¶æ€æ˜¯å¦åº”è¯¥è¿›è¡Œæ›´æ”¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ç®­å¤´å‡½æ•°çš„åŸå› ï¼šç®­å¤´å‡½æ•°å¯ä»¥å‡å°‘thisæŒ‡å‘é€ æˆçš„é—®é¢˜ï¼Œå°†å…¶ç»‘å®šåœ¨promiseçš„å®ä¾‹å¯¹è±¡</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// resolveå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// åªæœ‰å½“çŠ¶æ€ä¸ºpendingæ—¶æ‰èƒ½ä¿®æ”¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// rejectå›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reject</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">åªæœ‰å½“çŠ¶æ€ä¸ºpendingæ—¶æ‰èƒ½ä¿®æ”¹</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// è°ƒç”¨resolveå’Œrejectæ¥éªŒè¯çŠ¶æ€åœ¨ç¡®å®šä¹‹åä¸å¯é€†</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolved</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">resolved</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(promise1</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// fulfilled</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(promise2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// rejected</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h3 id="_4-thenable-åŠŸèƒ½çš„åˆ†æ" tabindex="-1">ï¼ˆ4ï¼‰thenable åŠŸèƒ½çš„åˆ†æ <a class="header-anchor" href="#_4-thenable-åŠŸèƒ½çš„åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ4ï¼‰thenable åŠŸèƒ½çš„åˆ†æ&quot;">â€‹</a></h3><p>ä¸Šé¢æˆ‘ä»¬ç®€å•å°è£…äº† <code>PromiseMon</code> è¿™ä¸ªå‡½æ•°ï¼Œé‚£ç°åœ¨å‘¢ï¼Œæˆ‘ä»¬ç»§ç»­ç”¨å®ƒæ¥å®ç° <code>thenable</code> çš„åŠŸèƒ½ã€‚</p><p>å¤§å®¶éƒ½çŸ¥é“ï¼Œ <code>promise</code> åœ¨è°ƒç”¨äº† <code>resolve</code> å’Œ <code>reject</code> æ–¹æ³•ä¹‹åï¼Œå°±è¯¥æ¥è§¦å‘åç»­çš„ <code>.then</code> æˆ–è€… <code>.catch</code> æ–¹æ³•äº†ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆ <code>promise</code> è¿”å›çš„æ•°æ®éƒ½æ²¡å•¥ä½¿ç”¨çš„åœ°å„¿ï¼Œé‚£è¿˜è¿”å›è¿™ä¸ªæ•°æ®æ¥å¹²å˜›å¯¹å§ã€‚</p><p>æˆ‘ä»¬ç°åœ¨å…ˆæ¥çœ‹å…³äº <code>then</code> çš„åŸºæœ¬ä½¿ç”¨æ“ä½œã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> fs </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> readFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filename</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">err</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> existedFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">readFile</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./test.txt</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">existedFile</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">content: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Buffer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">from</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">data</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">error</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">error</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ç»¼ä¸Šä»£ç ï¼Œæˆ‘ä»¬æ¥åˆ†æ <code>then</code> å‡½æ•°çš„<strong>å‡ ä¸ªç‰¹ç‚¹ï¼š</strong></p><ul><li><code>then</code> å‡½æ•°<strong>æ¥æ”¶ä¸¤ä¸ªå‚æ•°</strong>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°åœ¨<strong>å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶</strong>è¿›è¡Œè°ƒç”¨ï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯åœ¨<strong>æ“ä½œå¤±è´¥æ—¶</strong>è°ƒç”¨ã€‚</li><li><code>then</code> å‡½æ•°éœ€è¦èƒ½å¤Ÿåˆ†æ <code>promise</code> çš„çŠ¶æ€ï¼Œåˆ†æå®Œ <code>promise</code> çš„çŠ¶æ€åå†å†³å®šå»è°ƒç”¨<strong>æˆåŠŸæˆ–å¤±è´¥çš„å›è°ƒå‡½æ•°</strong>ã€‚</li><li><code>then</code> æ–¹æ³•è¢«å®šä¹‰åœ¨<strong>åŸå‹å¯¹è±¡</strong>ä¸Šï¼š <code>Promise.prototype.then()</code> ã€‚</li><li><code>then</code> è°ƒç”¨<strong>æˆåŠŸçš„å›è°ƒå‡½æ•°</strong>æ—¶ä¼šæ¥æ”¶ä¸€ä¸ª<strong>æˆåŠŸçš„æ•°æ®</strong>ä½œä¸ºå‚æ•°ï¼ŒåŒæ ·åœ°ï¼Œå½“ä»–è°ƒç”¨å¤±è´¥çš„å›è°ƒå‡½æ•°æ—¶ï¼Œåœ¨æ­¤ä¹‹å‰å®ƒä¹Ÿä¼šæ¥æ”¶åˆ°ä¸€ä¸ªå¤±è´¥çš„åŸå› æ¥ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’ã€‚</li><li><code>then</code> ä¼šå…ˆæ¥æ”¶åˆ°ä¸€ä¸ª<strong>æˆåŠŸçŠ¶æ€çš„æ•°æ®</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å°±ç”¨æ¥<strong>ä½œä¸ºå‚æ•°</strong>ï¼Œè¿™ä¸ªå‚æ•°ä¾›ç»™<strong>å¤„ç†æˆåŠŸçŠ¶æ€çš„å›è°ƒå‡½æ•°</strong>è¿›è¡Œè°ƒç”¨ï¼›åŒæ ·åœ°ï¼Œå½“å¤„ç†å¤±è´¥çŠ¶æ€æ—¶ï¼Œ <code>then</code> ä¼šå…ˆæ¥æ”¶åˆ°ä¸€ä¸ª<strong>å¤±è´¥çŠ¶æ€çš„æ•°æ®</strong>ï¼Œä¹‹åè¿™ä¸ªæ•°æ®ç”¨æ¥<strong>ä½œä¸ºå‚æ•°</strong>ï¼Œè¿™ä¸ªå‚æ•°ä¾›ç»™<strong>å¤„ç†å¤±è´¥çŠ¶æ€çš„å›è°ƒå‡½æ•°</strong>è¿›è¡Œè°ƒç”¨ã€‚è¯´çš„è¿™ä¹ˆç»•ï¼Œæ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š<strong>æ¥æ”¶å½“å‰çŠ¶æ€æ•°æ®</strong>â†’<strong>æ•°æ®ä½œä¸ºå‚æ•°</strong>â†’<strong>æ‹¿æ¥ç»™å›è°ƒå‡½æ•°è°ƒç”¨</strong>ã€‚</li></ul><h3 id="_5-thenable-åŠŸèƒ½çš„å®ç°" tabindex="-1">ï¼ˆ5ï¼‰thenable åŠŸèƒ½çš„å®ç° <a class="header-anchor" href="#_5-thenable-åŠŸèƒ½çš„å®ç°" aria-label="Permalink to &quot;ï¼ˆ5ï¼‰thenable åŠŸèƒ½çš„å®ç°&quot;">â€‹</a></h3><p>æˆ‘ä»¬ç°åœ¨æ¥å®ç° <code>thenable</code> çš„åŸºæœ¬åŠŸèƒ½ï¼Œ<strong>è¯¥åŠŸèƒ½å«æœ‰ä»¥ä¸‹å‡ ä¸ªç»„æˆè¦ç´ ï¼š</strong></p><ul><li>å°†åœ¨åŸå‹ä¸Šå®ç° <code>then</code> æ–¹æ³•ï¼›</li><li>ä¿®æ”¹åŸå…ˆçš„ <code>resolve</code> å‡½æ•°ï¼Œå®ç°å¯¹<strong>æˆåŠŸçŠ¶æ€çš„æ•°æ®</strong>è¿›è¡Œç»‘å®šï¼›</li><li>ä¿®æ”¹åŸå…ˆçš„ <code>reject</code> å‡½æ•°ï¼Œå®ç°å¯¹<strong>å¤±è´¥çŠ¶æ€çš„åŸå› </strong>è¿›è¡Œç»‘å®šã€‚</li></ul><p><strong>å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 03_thenableåŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰æˆåŠŸå’Œå¤±è´¥æ—¶çš„å€¼ï¼Œé»˜è®¤éƒ½æ˜¯æœªå®šä¹‰</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// cbè¿™ä¸ªå›è°ƒå‡½æ•°ä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œä½œç”¨æ˜¯åˆ¤æ–­çŠ¶æ€æ˜¯å¦åº”è¯¥è¿›è¡Œæ›´æ”¹</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹å‚æ•°ï¼Œè®©resolveæ¥æ”¶æˆåŠŸåä¼ æ¥çš„å€¼</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å°†æˆåŠŸçš„å€¼èµ‹äºˆç»™value</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ä¿®æ”¹å‚æ•°ï¼Œè®©rejectæ¥æ”¶å¤±è´¥åä¼ æ¥çš„åŸå› </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reject</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å°†å¤±è´¥çš„åŸå› èµ‹äºˆç»™reason</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">/** thenè¦æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼ŒsuccessCBè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨çŠ¶æ€ä¸ºfulfilledæ—¶ä½¿ç”¨ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * è€ŒfailCBè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨çŠ¶æ€ä¸ºrejectedæ—¶è¿›è¡Œä½¿ç”¨</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//æˆåŠŸçŠ¶æ€æµ‹è¯•</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> successPromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">successData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">failData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æˆåŠŸçŠ¶æ€ï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> successPromise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// æˆåŠŸçŠ¶æ€ï¼šsuccessData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">successPromise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// success:successData</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ²¡æœ‰è¾“å‡º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//å¤±è´¥çŠ¶æ€æµ‹è¯•</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> failPromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">failData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">successData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¤±è´¥çŠ¶æ€ï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> failPromise</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">status)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// å¤±è´¥çŠ¶æ€ï¼šfailData</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">failPromise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æ²¡æœ‰è¾“å‡º</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// error:failData</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªæœ€åŸºç¡€çš„ã€ä¸”åŒæ­¥æ‰§è¡Œçš„ <code>Promise</code> ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸ºè¿™ä¸ªåŒæ­¥çš„ <code>Promise</code> æ·»åŠ å¼‚æ­¥é€»è¾‘ã€‚</p><h2 id="_2-æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç°-ğŸ·ï¸" tabindex="-1">2. æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç° ğŸ·ï¸ <a class="header-anchor" href="#_2-æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç°-ğŸ·ï¸" aria-label="Permalink to &quot;2. æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½å®ç° ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ" tabindex="-1">ï¼ˆ1ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ <a class="header-anchor" href="#_1-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„åˆ†æ&quot;">â€‹</a></h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨ <code>promise</code> ä¸­è¢«è°ƒç”¨çš„å¤§éƒ¨åˆ†éƒ½æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œæ¯”å¦‚ <code>setTimeout</code> ã€ <code>setInterval</code> ç­‰ç­‰ã€‚æ‰€ä»¥å‘¢ï¼Œæˆ‘ä»¬ç°åœ¨è¦åœ¨ <code>then</code> ä¸­æ·»åŠ å¼‚æ­¥çš„åŠŸèƒ½ï¼Œæ¥å®ç°å¯¹<strong>å¼‚æ­¥é€»è¾‘</strong>è¿›è¡Œæ“ä½œã€‚</p><p>åœ¨ä¸Šé¢çš„ <code>then</code> æ–¹æ³•ä¸­ï¼Œå¤§å®¶å®šä½åˆ° <code>ifâ€¦â€¦else ifâ€¦â€¦</code> éƒ¨åˆ†ï¼Œä¸Šé¢æ‰€å†™çš„é€»è¾‘åªæœ‰å¯¹çŠ¶æ€ä¸º <code>fulfilled</code> å’Œ <code>rejected</code> æ—¶æ‰è¿›è¡Œåˆ¤æ–­ï¼Œè€Œæ²¡æœ‰å¯¹çŠ¶æ€ä¸º <code>pending</code> æ—¶è¿›è¡Œåˆ¤æ–­ã€‚</p><p>æ‰€ä»¥ï¼Œå½“çŠ¶æ€ä¸º <code>pending</code> æ—¶ï¼Œæ„å‘³ç€ <code>PromiseMon</code> ä¸­çš„å¼‚æ­¥å‡½æ•°è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å°† <code>succesCB</code> å’Œ <code>failCB</code> è¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°ç»™å…ˆå­˜åˆ°ä¸€ä¸ªå˜é‡ä¸­å»ï¼Œç­‰åˆ°åç»­å¼‚æ­¥å†…å®¹ç»“æŸåå†è¿›è¡Œè°ƒç”¨ã€‚</p><h3 id="_2-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°" tabindex="-1">ï¼ˆ2ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç° <a class="header-anchor" href="#_2-then-ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰then ä¸­æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬æ¥å®ç°è¿™ä¸ªå¼‚æ­¥åŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 04_æ·»åŠ å¼‚æ­¥é€»è¾‘åŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ä¸¤ä¸ªå˜é‡ï¼Œæ¥å­˜æ”¾æˆåŠŸå’Œå¤±è´¥æ—¶çš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * è¡¨è¾¾å¼a &amp;&amp; è¡¨è¾¾å¼bï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * è®¡ç®—è¡¨è¾¾å¼açš„è¿ç®—ç»“æœï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * å¦‚æœä¸ºtrueï¼Œæ‰§è¡Œè¡¨è¾¾å¼bï¼Œå¹¶è¿”å›bçš„ç»“æœï¼›</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * å¦‚æœä¸ºfalseï¼Œè¿”å›açš„ç»“æœã€‚</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * å½“successCBé‡Œé¢æœ‰å­˜æ”¾æˆåŠŸçš„å›è°ƒå‡½æ•°æ—¶ï¼Œåˆ™è¡¨æ˜this.successCBä¸ºtrueï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * ç»§ç»­åˆ¤æ–­æ–°ä¼ æ¥çš„å€¼çš„çŠ¶æ€æ˜¯å¦ä¸ºæˆåŠŸçŠ¶æ€çš„å€¼ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * å¦‚æœæ˜¯ï¼Œåˆ™å°†æ–°çš„å€¼ä¼ ç»™this.successCBå›è°ƒå‡½æ•°ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * å¦‚æœå¦ï¼Œåˆ™è¿”å›åŸæ¥å­˜æ”¾ç€çš„this.successçš„ç»“æœ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">successCB(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reject</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å­˜æ”¾è°ƒç”¨å¤±è´¥çš„å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#F07178;">failCB(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">/** thenè¦æ¥æ”¶ä¸¤ä¸ªå›è°ƒå‡½æ•°ï¼ŒsuccessCBè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨çŠ¶æ€ä¸ºfulfilledæ—¶ä½¿ç”¨ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   * è€ŒfailCBè¿™ä¸ªå›è°ƒå‡½æ•°åœ¨çŠ¶æ€ä¸ºrejectedæ—¶è¿›è¡Œä½¿ç”¨</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">   */</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å½“å‡½æ•°è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œåªèƒ½ç­‰å¾…</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å°†ä¸¤ä¸ªå›è°ƒå‡½æ•°çš„å€¼å­˜æ”¾èµ·æ¥</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•å¼‚æ­¥æˆåŠŸçŠ¶æ€</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> asyncPromise1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">asyncSuccessData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">asyncPromise1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼‚æ­¥æˆåŠŸçŠ¶æ€ï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼‚æ­¥å¤±è´¥çŠ¶æ€:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•å¼‚æ­¥å¤±è´¥çŠ¶æ€</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> asyncPromise2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">asyncErrorData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">asyncPromise2</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼‚æ­¥æˆåŠŸçŠ¶æ€ï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å¼‚æ­¥å¤±è´¥çŠ¶æ€:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * å¼‚æ­¥å¤±è´¥çŠ¶æ€: asyncErrorData</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * å¼‚æ­¥æˆåŠŸçŠ¶æ€ï¼š asyncSuccessData</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br></div></div><p>åˆ°è¿™é‡Œï¼Œå¼‚æ­¥çš„åŠŸèƒ½æˆ‘ä»¬ä¹Ÿå°±å®ç°å•¦ï¼ä½†æ˜¯ä¸Šé¢çš„ <code>then</code> æˆ‘ä»¬è¿˜åªæ˜¯å®ç° <code>then</code> æ–¹æ³•çš„ä¸€æ¬¡è°ƒç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç° <code>then</code> æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨ã€‚</p><h2 id="_3-å®ç°-then-æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨-ğŸ·ï¸" tabindex="-1">3. å®ç° then æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨ ğŸ·ï¸ <a class="header-anchor" href="#_3-å®ç°-then-æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨-ğŸ·ï¸" aria-label="Permalink to &quot;3. å®ç° then æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨ ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½åˆ†æ" tabindex="-1">ï¼ˆ1ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½åˆ†æ <a class="header-anchor" href="#_1-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½åˆ†æ&quot;">â€‹</a></h3><p>å¤šæ¬¡è°ƒç”¨ <code>then</code> æ–¹æ³•åˆ†ä¸º<strong>ä¸¤ç§æƒ…å†µï¼š</strong></p><ul><li>åŒæ­¥è°ƒç”¨ <code>then</code> æ–¹æ³•ã€‚åŒæ­¥è°ƒç”¨ <code>then</code> æ–¹æ³•ç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œåªè¦ç›´æ¥è°ƒç”¨ <code>successCB</code> æˆ– <code>failCB</code> å›è°ƒå‡½æ•°å³å¯ã€‚</li><li>å¼‚æ­¥è°ƒç”¨ <code>then</code> æ–¹æ³•ã€‚ä¹‹å‰çš„å±æ€§ <code>successCB</code> å’Œ <code>failCB</code> ä¸¤ä¸ªå›è°ƒå‡½æ•°æ˜¯å­˜æ”¾ä¸ºå¯¹è±¡å½¢å¼ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆä¼˜åŒ–æˆ‘ä»¬çš„å­˜å‚¨å½¢å¼ã€‚ä¼˜åŒ–å®Œæˆä¹‹åï¼Œå°†æ‰€æœ‰çš„å›è°ƒå‡½æ•°å…¨éƒ¨å­˜æ”¾åœ¨ä¸€èµ·ï¼Œç­‰åˆ°æ‰§è¡Œå®Œæ¯•ä¹‹åå†ä¾æ¬¡è°ƒç”¨ã€‚</li></ul><h3 id="_2-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-å¤šæ¬¡è°ƒç”¨-then-æ–¹æ³•çš„åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰å¤šæ¬¡è°ƒç”¨ then æ–¹æ³•çš„åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä¸Šè¿°çš„åˆ†æï¼Œæˆ‘ä»¬æ¥å®ç°å¤šæ¬¡è°ƒç”¨ <code>then</code> æ–¹æ³•çš„åŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 05_å¤šæ¬¡è°ƒç”¨thenæ–¹æ³•åŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ä¸¤ä¸ªæ•°ç»„å˜é‡ï¼Œæ¥å„è‡ªå­˜æ”¾æˆåŠŸå’Œå¤±è´¥æ—¶çš„æ‰€æœ‰å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ shift()æ–¹æ³•ï¼Œæ¥å¼¹å‡ºå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shift()(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reject</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// ä½¿ç”¨ shift()æ–¹æ³•ï¼Œæ¥å¼¹å‡ºå¹¶è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´ </span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shift()(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// é€šè¿‡pushæ–¹æ³•å°†å›è°ƒå‡½æ•°çš„å€¼å­˜æ”¾åˆ°æ•°ç»„ä¸­</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> multiplePromise1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">multiSuccessData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">multiplePromise1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬ä¸€æ¬¡è°ƒç”¨æˆåŠŸï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬ä¸€æ¬¡è°ƒç”¨æˆåŠŸï¼š multiSuccessData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">multiplePromise1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬äºŒæ¬¡è°ƒç”¨æˆåŠŸï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬äºŒæ¬¡è°ƒç”¨æˆåŠŸï¼š multiSuccessData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * ç¬¬ä¸€æ¬¡è°ƒç”¨æˆåŠŸï¼š multiSuccessData</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * ç¬¬äºŒæ¬¡è°ƒç”¨æˆåŠŸï¼š multiSuccessData</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><p>è®²åˆ°è¿™é‡Œï¼Œå…³äºå¯¹æ­¤è°ƒç”¨ <code>then</code> æ–¹æ³•çš„åŠŸèƒ½å°±å®ç°å®Œæˆäº†ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­æ¥å®ç°å…³äº <code>then</code> æ–¹æ³•çš„é“¾å¼è°ƒç”¨ã€‚</p><h2 id="_4-å®ç°-then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨-ğŸ·ï¸" tabindex="-1">4. å®ç° then æ–¹æ³•çš„é“¾å¼è°ƒç”¨ ğŸ·ï¸ <a class="header-anchor" href="#_4-å®ç°-then-æ–¹æ³•çš„é“¾å¼è°ƒç”¨-ğŸ·ï¸" aria-label="Permalink to &quot;4. å®ç° then æ–¹æ³•çš„é“¾å¼è°ƒç”¨ ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ" tabindex="-1">ï¼ˆ1ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ <a class="header-anchor" href="#_1-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½åˆ†æ&quot;">â€‹</a></h3><p>æˆ‘ä»¬å…ˆæ¥å¯¹ <code>then</code> æ–¹æ³•çš„é“¾å¼è°ƒç”¨è¿›è¡Œ<strong>åŠŸèƒ½åˆ†æ</strong>ï¼Œ<strong>å…·ä½“å¦‚ä¸‹ï¼š</strong></p><ul><li>ä¸è€ƒè™‘å…¶ä»–åŠŸèƒ½çš„å‰æä¸‹ï¼Œå…ˆå®Œæˆ<strong>é“¾å¼è°ƒç”¨çš„åµŒå¥—</strong>ï¼›</li><li>å®ç°é“¾å¼è°ƒç”¨çš„<strong>å¤§å‰æ</strong>æ˜¯ï¼Œæ¯ä¸€ä¸ª <code>then</code> å‡½æ•°è¿”å›çš„éƒ½å¿…é¡»æ˜¯ä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œå¦åˆ™å°±æ— æ³•è¡”æ¥åœ°å»ä½¿ç”¨ <code>then</code> å‡½æ•°ã€‚</li><li>å› æ­¤ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨ <code>then</code> å‡½æ•°ä¸­æ–°å»ºä¸€ä¸ª <code>Promise</code> å¯¹è±¡ï¼Œä¹‹åå‘¢ï¼Œåœ¨æ–°å»ºçš„ <code>promise</code> å¯¹è±¡é‡Œé¢ï¼Œå»å¤„ç†å†…éƒ¨ä½¿ç”¨çš„ <code>resolve</code> å’Œ <code>reject</code> æ‰€è¿”å›çš„å€¼ï¼Œæœ€ç»ˆ <code>then</code> å‡½æ•°ä¹Ÿå°±è¿”å›äº† <code>promise</code> å¯¹è±¡ã€‚</li></ul><h3 id="_2-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-then-æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰then æ–¹æ³•é“¾å¼è°ƒç”¨çš„åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä¸Šé¢çš„åŠŸèƒ½åˆ†æï¼Œæˆ‘ä»¬æ¥å®ç° <code>then</code> çš„é“¾å¼è°ƒç”¨åŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 06_thençš„é“¾å¼è°ƒç”¨åŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// å®šä¹‰ä¸¤ä¸ªæ•°ç»„å˜é‡ï¼Œæ¥å„è‡ªå­˜æ”¾æˆåŠŸå’Œå¤±è´¥æ—¶çš„æ‰€æœ‰å›è°ƒå‡½æ•°</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shift()(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reject</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">PENDING</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shift()(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">//</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * æ–°å»ºä¸€ä¸ªpromiseå¯¹è±¡ï¼Œæ¥ç»™ä¸‹ä¸€ä¸ªthenä½¿ç”¨ã€‚</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * ä¸‰ç§çŠ¶æ€ï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * â‘ promiseå¯¹è±¡æ‰§è¡ŒæˆåŠŸï¼Œè°ƒç”¨resolveï¼›</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * â‘¡promiseå¯¹è±¡æ‰§è¡Œå¤±è´¥ï¼Œåˆ™è°ƒç”¨rejectï¼›</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * â‘¢promiseå¯¹è±¡è¿˜æœªæ‰§è¡Œï¼Œå°†å›è°ƒå‡½æ•°æ¨å…¥å‡†å¤‡å¥½çš„æ•°ç»„ä¸­ã€‚</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­è¿”å›çš„å€¼æ˜¯å¦æ˜¯promiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­è¿”å›çš„å€¼æ˜¯å¦æ˜¯promiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// é€šè¿‡ç®­å¤´å‡½æ•°çš„æ–¹å¼å°†å›è°ƒå‡½æ•°çš„å€¼å­˜æ”¾è¿›æ•°ç»„ä¸­</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * åˆ¤æ–­ä¼ è¿›æ¥çš„thenablePromiseæ˜¯å¦æ˜¯promiseå¯¹è±¡ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * å¦‚æœæ˜¯ï¼Œåˆ™è°ƒç”¨thenå‡½æ•°æ¥å¤„ç†ï¼›å¦‚æœå¦ï¼Œåˆ™ç›´æ¥è¿”å›å€¼ã€‚</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolvePromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// å¦‚æœä¸æ˜¯promiseå¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿”å›å€¼</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•é“¾å¼è°ƒç”¨æˆåŠŸçŠ¶æ€</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> thenablePromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">thenableSuccessData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> otherPromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">otherPromise</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">2000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> anotherPromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">anotherPromise</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">thenablePromise</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬ä¸€æ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬ä¸€æ¬¡è°ƒç”¨æˆåŠŸï¼š thenableSuccessData</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// returnçš„ç»“æœæ˜¯ä¸ºäº†ç»™ä¸‹ä¸€ä¸ªthenä½¿ç”¨</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">otherPromise</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬äºŒæ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬äºŒæ¬¡è°ƒç”¨æˆåŠŸï¼š otherPromise</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">anotherPromise</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ç¬¬ä¸‰æ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// ç¬¬ä¸‰æ¬¡è°ƒç”¨æˆåŠŸï¼š anotherPromise</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * ç¬¬ä¸€æ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š thenableSuccessData 2021-08-04T11:13:25.868Z</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * ç¬¬äºŒæ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š otherPromise 2021-08-04T11:13:25.877Z</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * ç¬¬ä¸‰æ¬¡é“¾å¼è°ƒç”¨æˆåŠŸï¼š anotherPromise 2021-08-04T11:13:25.878Z</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br></div></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº† <code>promise</code> çš„é“¾å¼è°ƒç”¨ã€‚</p><h3 id="_3-é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹" tabindex="-1">ï¼ˆ3ï¼‰é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹ <a class="header-anchor" href="#_3-é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹" aria-label="Permalink to &quot;ï¼ˆ3ï¼‰é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹&quot;">â€‹</a></h3><p>æœ‰æ—¶å€™æˆ‘ä»¬æœ‰å¯èƒ½åœ¨è°ƒç”¨ <code>promise</code> æ—¶ï¼Œä¼šé™·å…¥è‡ªæˆ‘è°ƒç”¨çš„å¢ƒåœ°ã€‚ä¹Ÿå°±æ˜¯<strong>æ— é™çš„å¾ªç¯åµŒå¥—</strong>å’Œ<strong>æ— é™çš„è‡ªæˆ‘è°ƒç”¨</strong>ã€‚<strong>æ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise1 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">success</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ— é™å¾ªç¯åµŒå¥—ï¼Œæ— é™è‡ªæˆ‘è°ƒç”¨</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å½“è¿è¡Œæ—¶æ§åˆ¶å°ä¼šæŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> promise1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">promise2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//  TypeError: Chaining cycle detected for promise #&lt;Promise&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>å› æ­¤ï¼Œç°åœ¨æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œåœ¨ <code>resolvePromise</code> å‡½æ•°ä¸­<strong>æ–°å¢ä¸€ä¸ªå‚æ•°</strong>ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å½“å‰æ‰€åˆ›é€ çš„ <code>promise</code> å¯¹è±¡ã€‚ä¹‹ååˆ¤æ–­ä¸¤ä¸ª <code>promise</code> å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå°±æŠ›å‡ºå¼‚å¸¸ã€‚ä¾æ®è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢é“¾å¼è°ƒç”¨çš„åŠŸèƒ½ä»£ç ï¼Œè¾¾åˆ°ç¦æ­¢è‡ªæˆ‘è°ƒç”¨çš„é—­ç¯ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 07_é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//æ­¤å¤„çœç•¥constructorä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//æ­¤å¤„çœç•¥resolveä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//æ­¤å¤„çœç•¥rejectä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         * åˆ©ç”¨setTimeoutæ˜¯å¼‚æ­¥å‡½æ•°çš„ç‰¹æ€§ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         * è¿™æ ·setTimeouté‡Œé¢çš„å†…å®¹ä¼šåœ¨åŒæ­¥å‡½æ•°æ‰§è¡Œå®Œä¹‹åæ‰ä¼šè¿›è¡Œï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         * æ‰€ä»¥ï¼Œå½“resolvePromiseåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼ŒthenablePromiseå°±å·²ç»è¢«å®ä¾‹åŒ–äº†ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         * ä½¿å¾—resolvePromiseé¡ºåˆ©çš„è°ƒç”¨thenablePromise</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">         */</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">const </span><span style="color:#F07178;">resolvePromise</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">createPromise</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">createPromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> reject(</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> TypeError(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">å‡ºç°å¾ªç¯è°ƒç”¨çš„æƒ…å†µ Chaning cycle detected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">then(</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      resolve(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•è‡ªæˆ‘è°ƒç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">const </span><span style="color:#F07178;">thenablePromise</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  resolve(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">chainningData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">const </span><span style="color:#F07178;">chainingPromise</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> thenablePromise</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">log(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ•°æ®è°ƒç”¨æˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> Date())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">chainingPromise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//ä¼šæŠ¥é”™ï¼Œå‡ºç°å¾ªç¯è°ƒç”¨</span></span>
<span class="line"><span style="color:#F07178;">chainingPromise</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‰§è¡Œæ“ä½œæˆåŠŸ</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">æ‰§è¡Œæ“ä½œå¤±è´¥</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">æ•°æ®è°ƒç”¨æˆåŠŸ chainningData 2021-08-04T11:28:39.984Z</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">æ‰§è¡Œæ“ä½œå¤±è´¥ TypeError: å‡ºç°å¾ªç¯è°ƒç”¨çš„æƒ…å†µ Chaning cycle detected</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å®Œæˆäº†é“¾å¼è°ƒç”¨çš„è‡ªæˆ‘æ£€æµ‹ã€‚</p><h2 id="_5-promise-çš„é”™è¯¯å¤„ç†-ğŸ·ï¸" tabindex="-1">5. promise çš„é”™è¯¯å¤„ç† ğŸ·ï¸ <a class="header-anchor" href="#_5-promise-çš„é”™è¯¯å¤„ç†-ğŸ·ï¸" aria-label="Permalink to &quot;5. promise çš„é”™è¯¯å¤„ç† ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-é”™è¯¯å¤„ç†åœºæ™¯" tabindex="-1">ï¼ˆ1ï¼‰é”™è¯¯å¤„ç†åœºæ™¯ <a class="header-anchor" href="#_1-é”™è¯¯å¤„ç†åœºæ™¯" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰é”™è¯¯å¤„ç†åœºæ™¯&quot;">â€‹</a></h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯¹ <code>pormise</code> çš„ <code>then</code> æ–¹æ³•åŸºæœ¬å®ç°çš„å·®ä¸å¤šã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦ä½†æ˜¯åˆå¾ˆå®¹æ˜“è¢«æˆ‘ä»¬ç–å¿½çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>é”™è¯¯å¤„ç†</strong>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å¯èƒ½<strong>ä¼šå‡ºç°å¼‚å¸¸çš„å¸¸è§åœºæ™¯ï¼š</strong></p><ul><li>æ„é€ å™¨ä¸­çš„å›è°ƒå‡½æ•° <code>cb</code> ï¼Œéœ€è¿›è¡Œ <code>try/catch</code> å¤„ç†ï¼›</li><li><code>then</code> å‡½æ•°ä¸­çš„é”™è¯¯å¤„ç†ï¼Œéœ€è¦å¯¹<strong>åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°</strong>è¿›è¡Œ <code>try/catch</code> å¤„ç†ã€‚</li></ul><h3 id="_2-é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰é”™è¯¯å¤„ç†åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰é”™è¯¯å¤„ç†åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä¸Šé¢çš„åœºæ™¯åˆ†æï¼Œæˆ‘ä»¬æ¥å®ç° <code>promise</code> çš„é”™è¯¯å¤„ç†åŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 08_promiseçš„é”™è¯¯å¤„ç†</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">constructor</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cb</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">cb</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">err in cb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//æ­¤å¤„çœç•¥resolveä»£ç </span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//æ­¤å¤„çœç•¥rejectä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">then</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">failCB</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">//   ç»™setTimeoutè¿™ä¸ªå¼‚æ­¥å‡½æ•°æ·»åŠ try/catch</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">FULFILLED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">status</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">REJECTED</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">              </span><span style="color:#676E95;font-style:italic;">// resolvePromise åŒæ—¶è¦åŠ åˆ°successCBå’ŒfailCBä¸­è¿›è¡Œå¤„ç†</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">successCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">successCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableValue</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                          </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">failCB</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">push</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">failCB</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">resolvePromise</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenableReason</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">                        </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">err</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">                    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">                  </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">              </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">thenablePromise</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// æ­¤å¤„çœç•¥resolvePromiseä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#A6ACCD;">const </span><span style="color:#F07178;">promise</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    setTimeout(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        resolve(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">successData</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">promise</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// (1) æ‰“å° &#39;successData&#39;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// (2) æŠ›å‡ºå¼‚å¸¸</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fail in then</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">callback fail</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// æŠ›å‡ºå¼‚å¸¸åè¿”å› &#39;callback fail&#39; ç»™ä¸‹é¢çš„thenæ–¹é¢è°ƒç”¨</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// (3)ä¸Šé¢ä¼ æ¥callback failï¼Œå› æ­¤æ‰“å° &#39;callback fail&#39;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">successData</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">Error: error</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">callback fail</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">*/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ <code>try/catch</code> çš„æ–¹å¼ï¼Œå¯¹é‡åˆ°çš„é”™è¯¯è¿›è¡Œå¤„ç†ï¼Œå¹¶ä¸”æœ€ç»ˆæŠ›å‡ºå¼‚å¸¸ä»¥åŠè¿”å› <code>reason</code> çš„å€¼ã€‚</p><h2 id="_6-å®ç°-then-æ–¹æ³•çš„å‚æ•°å¯é€‰-ğŸ·ï¸" tabindex="-1">6. å®ç° then æ–¹æ³•çš„å‚æ•°å¯é€‰ ğŸ·ï¸ <a class="header-anchor" href="#_6-å®ç°-then-æ–¹æ³•çš„å‚æ•°å¯é€‰-ğŸ·ï¸" aria-label="Permalink to &quot;6. å®ç° then æ–¹æ³•çš„å‚æ•°å¯é€‰ ğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-å‚æ•°å¯é€‰å®ç°æ€è·¯" tabindex="-1">ï¼ˆ1ï¼‰å‚æ•°å¯é€‰å®ç°æ€è·¯ <a class="header-anchor" href="#_1-å‚æ•°å¯é€‰å®ç°æ€è·¯" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰å‚æ•°å¯é€‰å®ç°æ€è·¯&quot;">â€‹</a></h3><p>å¤§å®¶å¯ä»¥å‘ç°ï¼Œä¸Šé¢æˆ‘ä»¬åœ¨è°ƒç”¨ <code>then</code> æ–¹æ³•çš„æ—¶å€™ï¼Œä¸€ç›´éƒ½æ˜¯éœ€è¦è¿›è¡Œå‚æ•°ä¼ é€’çš„ï¼Œè¿™æ ·çœ‹èµ·æ¥å¥½åƒè¿˜ä¸æ˜¯ç‰¹åˆ«å‹å¥½ã€‚å› æ­¤å‘¢ï¼Œæˆ‘ä»¬ç°åœ¨æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè®© <code>then</code> æ–¹æ³•çš„å‚æ•°å¯ä»¥æœ‰<strong>ä¼ æˆ–è€…ä¸ä¼ </strong>è¿™ <code>2</code> ç§æ“ä½œã€‚å®ç°æ€è·¯ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ <code>then</code> å‡½æ•°ä¸­åˆ¤æ–­æ˜¯å¦ä¼ å…¥å‚æ•°ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåˆ™è¿”å›åŸæ¥çš„ <code>value</code> å°±å¥½äº†ã€‚<strong>ç±»ä¼¼äºä¸‹é¢è¿™ç§å½¢å¼ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">promise</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> val) </span><span style="color:#676E95;font-style:italic;">// è¿™æ ·ä½¿ç”¨ç®­å¤´å‡½æ•°è¡¨æ˜ç›´æ¥è¿”å› value</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> val)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> val)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 200</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_2-å‚æ•°å¯é€‰åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰å‚æ•°å¯é€‰åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-å‚æ•°å¯é€‰åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰å‚æ•°å¯é€‰åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä¸Šé¢çš„æ˜¯å®ç°æ€è·¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><p>ä¸‹é¢æˆ‘ä»¬å¯¹ <code>then</code> å‡½æ•°è¿›è¡Œæ”¹é€ ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(successCB</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> failCB) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">successCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">failCB</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reason</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>æ¥ç”¨ä¸¤ç»„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œæµ‹è¯•ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æˆåŠŸçŠ¶æ€ä¸‹çš„ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> successpromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">successpromise</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">val</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 100</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// å¤±è´¥çŠ¶æ€ä¸‹çš„ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> failPromise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">failPromise</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 200</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * æ‰“å°ç»“æœï¼š</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 100</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 200</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œä¸ç®¡æ˜¯ <code>resolve</code> è¿˜æ˜¯ <code>reject</code> çŠ¶æ€ï¼Œéƒ½ä¸€ä¸€å®Œæˆäº†å¯¹<strong>å‚æ•°å¯é€‰åŠŸèƒ½</strong>çš„å®ç°ã€‚</p><h2 id="_7-å®ç°-promise-allğŸ·ï¸" tabindex="-1">7. å®ç° Promise.allğŸ·ï¸ <a class="header-anchor" href="#_7-å®ç°-promise-allğŸ·ï¸" aria-label="Permalink to &quot;7. å®ç° Promise.allğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-promise-all-åŠŸèƒ½åˆ†æ" tabindex="-1">ï¼ˆ1ï¼‰Promise.all åŠŸèƒ½åˆ†æ <a class="header-anchor" href="#_1-promise-all-åŠŸèƒ½åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰Promise.all åŠŸèƒ½åˆ†æ&quot;">â€‹</a></h3><p>ä¸Šé¢åœ¨è®² <code>Promise</code> å¼‚æ­¥æ–¹æ¡ˆçš„æ—¶å€™å°±å·²ç»è®²è¿‡ <code>promise.all</code> å’Œ <code>promise.race</code> æ–¹æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥æ¢³ç†ä¸‹<strong>å®ç°æ€è·¯ï¼š</strong></p><ul><li><code>Promise.all</code> æ˜¯ä¸€ä¸ª<strong>é™æ€æ–¹æ³•</strong>ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª <strong>Promise æ•°ç»„</strong> ä½œä¸ºå‚æ•°ã€‚</li><li><code>Promise.all</code> çš„ç‰¹ç‚¹åœ¨äºï¼Œå®ƒå¯ä»¥<strong>æŒ‰ç…§é¡ºåº</strong>å»è·å–æ‰€æœ‰è°ƒç”¨çš„å¼‚æ­¥å‡½æ•°ã€‚</li><li><code>js</code> çš„<strong>å…³é”®å­— <code>static</code></strong> å°†ä¼šæŠŠå¯¹åº”çš„<strong>å˜é‡æˆ–å‡½æ•°</strong>ç»‘å®šåˆ°<strong>class ç±»</strong>ä¸Šï¼Œè€Œä¸æ˜¯ç»‘å®šåœ¨ ** <code>prototype</code> åŸå‹**ä¸Šã€‚</li></ul><h3 id="_2-promise-all-åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰Promise.all åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-promise-all-åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰Promise.all åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®å®ç°çš„è¿™ä¸ªé€»è¾‘ï¼Œæ¥å®ç° <code>promise.all</code> è¿™ä¸ªåŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 10_promise.allåŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//çœç•¥constructorã€resolveã€rejectå’Œthenæ–¹æ³•çš„ä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">all</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">arr</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">results</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// æ·»åŠ æ•°æ®çš„é€»è¾‘ï¼ŒæŠŠæŒ‡å®šçš„æ•°æ®æ·»åŠ åˆ°æ•°ç»„çš„å¯¹åº”ä½ç½®ä¸Š</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">addData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">idx</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">val</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">results</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">idx</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">val</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">++;</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// è¿›è¡Œè¿™ä¸€æ­¥åˆ¤æ–­çš„ç›®çš„ï¼šä¸ºäº†ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">results</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// å¯¹æ•°ç»„è¿›è¡Œå¾ªç¯ï¼Œè·å–æ‰€æœ‰çš„æ•°æ®</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">arr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">forEach</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">cur</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">index</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å¦‚æœä¼ è¿›æ¥çš„å€¼æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">cur</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">cur</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">addData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">reason</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">reject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">reason</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">          )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// å¦‚æœä¼ è¿›æ¥çš„æ˜¯æ™®é€šå€¼,è€Œépromiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#82AAFF;">addData</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">index</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">cur</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ­¤å¤„çœç•¥resolvePromiseä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">200</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//å› ä¸ºä½¿ç”¨staticå…³é”®å­—ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨ç±»ä¸Šé¢è¿›è¡Œè°ƒç”¨</span></span>
<span class="line"><span style="color:#A6ACCD;">PromiseMon</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">promise</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">promise2</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">c</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">])</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// [ &#39;a&#39;, &#39;b&#39;, 100, 200, &#39;c&#39; ]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿ <code>promise2</code> æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œä½†æœ€ç»ˆä¹Ÿæ­£å¸¸çš„æ˜¾ç¤ºåœ¨æ•°ç»„å½“ä¸­ï¼Œä¸”æŒ‰åºçš„ä¸€ä¸€è¿›è¡Œæ‰“å°ã€‚åˆ°æ­¤ï¼Œä¹Ÿå°±è¯´æ˜ <code>promise.all</code> æˆåŠŸå®ç°å•¦ï¼</p><p>åŒæ—¶ï¼Œ <code>promise.race</code> ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ¨¡å¼å»å®ç°ï¼Œè¿™é‡Œä¸å†è¿›è¡Œè®²è§£~</p><h2 id="_8-å®ç°-promise-resolveğŸ·ï¸" tabindex="-1">8. å®ç° Promise.resolveğŸ·ï¸ <a class="header-anchor" href="#_8-å®ç°-promise-resolveğŸ·ï¸" aria-label="Permalink to &quot;8. å®ç° Promise.resolveğŸ·ï¸&quot;">â€‹</a></h2><h3 id="_1-promise-resolve-åŠŸèƒ½åˆ†æ" tabindex="-1">ï¼ˆ1ï¼‰Promise.resolve åŠŸèƒ½åˆ†æ <a class="header-anchor" href="#_1-promise-resolve-åŠŸèƒ½åˆ†æ" aria-label="Permalink to &quot;ï¼ˆ1ï¼‰Promise.resolve åŠŸèƒ½åˆ†æ&quot;">â€‹</a></h3><p>æˆ‘ä»¬å…ˆæ¥æ¢³ç†ä¸‹ <code>promise.resolve</code> çš„<strong>å®ç°æ€è·¯ï¼š</strong></p><ul><li>å¦‚æœå‚æ•°æ˜¯ä¸€ä¸ª <code>promise</code> å®ä¾‹ï¼Œé‚£ä¹ˆ <code>promise.resolve()</code> å°†ä¸åšä»»ä½•ä¿®æ”¹ï¼ŒåŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹ã€‚</li><li>å‚æ•°ä¸æ˜¯ <code>promise</code> å®ä¾‹ï¼Œæˆ–æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ <code>Promise.resolve()</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ <code>promise</code> å¯¹è±¡ï¼Œæ­¤æ—¶çŠ¶æ€ä¸º <code>fulfilled</code> ã€‚</li><li>ä¸å¸¦æœ‰ä»»ä½•å‚æ•°ï¼Œåˆ™ç›´æ¥è¿”å›ä¸€ä¸ª <code>fulfilled</code> çŠ¶æ€çš„ <code>promise</code> å¯¹è±¡ã€‚</li></ul><h3 id="_2-promise-resolve-åŠŸèƒ½å®ç°" tabindex="-1">ï¼ˆ2ï¼‰Promise.resolve åŠŸèƒ½å®ç° <a class="header-anchor" href="#_2-promise-resolve-åŠŸèƒ½å®ç°" aria-label="Permalink to &quot;ï¼ˆ2ï¼‰Promise.resolve åŠŸèƒ½å®ç°&quot;">â€‹</a></h3><p>ä¾æ®ä»¥ä¸Šçš„åŠŸèƒ½åˆ†æï¼Œæ¥å®ç° <code>promise.resolve</code> è¿™ä¸ªåŠŸèƒ½ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 11_promise.resolveåŠŸèƒ½çš„å®ç°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PENDING </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">pending</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> FULFILLED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fulfilled</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> REJECTED </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rejected</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">status</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> PENDING</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">value</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">reason</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">successCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">failCB</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">//çœç•¥constructorã€resolveã€rejectå’Œthenæ–¹æ³•çš„ä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">resolve</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">value</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä¼ è¿›æ¥çš„æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼ŒåŸå°ä¸åŠ¨è¿”å›</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">PromiseMon</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ä¼ è¿›æ¥çš„ä¸æ˜¯promiseå¯¹è±¡ï¼Œå°†å…¶ä½œä¸ºå‚æ•°è¿”å›ä¸€ä¸ªpromise</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æ­¤å¤„çœç•¥resolvePromiseä»£ç </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// æµ‹è¯•ç”¨ä¾‹</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> promise </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">PromiseMon</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">100</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 1.å‚æ•°æ˜¯ä¸€ä¸ªpromiseå®ä¾‹ï¼Œé‚£ä¹ˆä¸åšä»»ä½•ä¿®æ”¹ï¼ŒåŸå°ä¸åŠ¨åœ°è¿”å›è¿™ä¸ªå®ä¾‹</span></span>
<span class="line"><span style="color:#A6ACCD;">PromiseMon</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(promise)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 100</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 2.å‚æ•°ä¸æ˜¯å…·æœ‰thenæ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ–æ ¹æœ¬å°±ä¸æ˜¯å¯¹è±¡ï¼Œ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * åˆ™Promise.resolve()æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„promiseå¯¹è±¡ï¼ŒçŠ¶æ€ä¸ºfulfilled</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">PromiseMon</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">res</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 200</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 3.ä¸å¸¦æœ‰ä»»ä½•å‚æ•°ï¼Œåˆ™ç›´æ¥è¿”å›ä¸€ä¸ªresolvedçŠ¶æ€çš„promiseå¯¹è±¡</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#A6ACCD;">PromiseMon</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">two</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// two</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œä¾æ®æˆ‘ä»¬æ‰€ç½—åˆ—çš„ä¸‰ç§æƒ…å†µï¼Œ <code>promise.resolve</code> çš„åŠŸèƒ½ä¹Ÿä¸€ä¸€å®ç°å•¦ï¼</p><p>åŒæ—¶ï¼Œ <code>promise.reject</code> ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ¨¡å¼å»å®ç°ï¼Œè¿™é‡Œä¸å†è¿›è¡Œè®²è§£~</p><h1 id="ğŸ“-å››ã€ç»“æŸè¯­" tabindex="-1">ğŸ“ å››ã€ç»“æŸè¯­ <a class="header-anchor" href="#ğŸ“-å››ã€ç»“æŸè¯­" aria-label="Permalink to &quot;ğŸ“ å››ã€ç»“æŸè¯­&quot;">â€‹</a></h1><p>å†™åˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œå‘ç°æˆ‘å·²ç»èŠ±äº†æ•´æ•´ä¸‰å¤©çš„æ—¶é—´ï¼Œå¤§çº¦æ¥è¿‘ 34h+åœ¨ <code>promise</code> è¿™ä¸ªçŸ¥è¯†ä¸Šï¼Œå¥½åœ¨æœ€ç»ˆç®—æ˜¯å¯¹ <code>promise</code> æ ¸å¿ƒåŠŸèƒ½çš„çš„å®ç°æœ‰ä¸€ä¸ªè¾ƒä¸ºæ»¡æ„çš„ç»“æœã€‚</p><p>å¯èƒ½ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è¿™ä¹ˆç»†è‡´çš„å»å•ƒä¸€ä¸ªçŸ¥è¯†ï¼Œæ‰€ä»¥åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°å¾ˆå¤šä»¥å‰æ²¡è¸©è¿‡çš„å‘ï¼Œä¸­é—´è¿‡ç¨‹ä¸­å¯¹é—®é¢˜è¿›è¡Œè¯¦ç»†è®°å½•å¹¶å°è¯•è§£å†³ï¼Œæ…¢æ…¢çš„å°±å®Œå–„äº†ä¸€ä¸ªæ–°çš„çŸ¥è¯†ä½“ç³»ã€‚</p><p>æœ€åï¼Œæœ¬æ–‡è®²è§£åˆ°è¿™é‡Œå°±ç»“æŸå•¦ï¼å¸Œæœ›å¤§å®¶èƒ½å¯¹ <code>promise</code> æœ‰ä¸€ä¸ªæ›´å¥½çš„äº†è§£~</p><h1 id="ğŸ£-å½©è›‹-one-more-thing" tabindex="-1">ğŸ£ å½©è›‹ One More Thing <a class="header-anchor" href="#ğŸ£-å½©è›‹-one-more-thing" aria-label="Permalink to &quot;ğŸ£ å½©è›‹ One More Thing&quot;">â€‹</a></h1><h2 id="è¯¾ä»£è¡¨è®°å½•" tabindex="-1">ï¼ˆï¼šè¯¾ä»£è¡¨è®°å½• <a class="header-anchor" href="#è¯¾ä»£è¡¨è®°å½•" aria-label="Permalink to &quot;ï¼ˆï¼šè¯¾ä»£è¡¨è®°å½•&quot;">â€‹</a></h2><p>âœ…ã€Šä¸‰ 7.ã€‹çš„ <code>Promise.race</code> æ–¹æ³•æœªç”¨ä»£ç åœ¨åŸæ–‡ä¸­å®ç°ã€‚</p><p>âœ…ã€Šä¸‰ 8.ã€‹ä¸­ï¼Œæ®èµ„æ–™è°ƒæŸ¥ï¼Œ <code>promise.resolve</code> è¿˜æœ‰ç¬¬ 4 ç§ä¼ å‚æ–¹å¼ï¼Œå½“å‚æ•°æ˜¯ä¸€ä¸ª <code>thenable</code> ï¼Œå³å‚æ•°æ˜¯ä¸€ä¸ªå¸¦æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡æ—¶ï¼Œåˆ™ç»“æœè¿”å›å…·æœ‰ <code>then</code> æ–¹æ³•çš„å¯¹è±¡ï¼ˆæœ¬åŠŸèƒ½æš‚æœªå®ç°ï¼‰ã€‚</p><p>âœ…ã€Šä¸‰ 8.ã€‹çš„ <code>Promise.reject</code> æ–¹æ³•æœªç”¨ä»£ç åœ¨åŸæ–‡ä¸­å®ç°ã€‚</p><h2 id="å‚è€ƒèµ„æ–™" tabindex="-1">ï¼ˆï¼šå‚è€ƒèµ„æ–™ <a class="header-anchor" href="#å‚è€ƒèµ„æ–™" aria-label="Permalink to &quot;ï¼ˆï¼šå‚è€ƒèµ„æ–™&quot;">â€‹</a></h2><p>ğŸ‘‰ <a href="https://blog.csdn.net/weixin_42938619/article/details/118172320?spm=1001.2014.3001.5502" target="_blank" rel="noreferrer">[ä¸‡å­—è¯¦è§£]JavaScript ä¸­çš„å¼‚æ­¥æ¨¡å¼åŠ Promise ä½¿ç”¨</a></p><p>ğŸ‘‰ <a href="https://blog.csdn.net/weixin_42938619/article/details/118240727" target="_blank" rel="noreferrer">[1w6k å­—è¯¦ç»†è®²è§£] ä¿å§†çº§ä¸€æ­¥ä¸€æ­¥å¸¦ä½ å®ç° Promise çš„æ ¸å¿ƒåŠŸèƒ½</a></p><p>ğŸ‘‰ <a href="https://es6.ruanyifeng.com/#docs/promise" target="_blank" rel="noreferrer">ES6 å¿«é€Ÿå…¥é—¨</a></p><h2 id="ç•ªå¤–ç¯‡" tabindex="-1">ï¼ˆï¼šç•ªå¤–ç¯‡ <a class="header-anchor" href="#ç•ªå¤–ç¯‡" aria-label="Permalink to &quot;ï¼ˆï¼šç•ªå¤–ç¯‡&quot;">â€‹</a></h2><blockquote><ul><li>å…³æ³¨å…¬ä¼—å·<strong>æ˜ŸæœŸä¸€ç ”ç©¶å®¤</strong>ï¼Œç¬¬ä¸€æ—¶é—´å…³æ³¨ä¼˜è´¨æ–‡ç« ï¼Œ<strong>æ›´å¤šç²¾é€‰ä¸“æ å¾…ä½ è§£é”</strong>~</li><li>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼Œè®°å¾—<strong>ç•™ä¸ªè„šå° jio</strong>å†èµ°å“¦~</li><li>ä»¥ä¸Šå°±æ˜¯æœ¬æ–‡çš„å…¨éƒ¨å†…å®¹ï¼æˆ‘ä»¬ä¸‹æœŸè§ï¼ğŸ‘‹ğŸ‘‹ğŸ‘‹</li></ul></blockquote>`,269),e=[o];function c(r,t,y,F,D,i){return a(),n("div",null,e)}const b=s(p,[["render",c]]);export{C as __pageData,b as default};

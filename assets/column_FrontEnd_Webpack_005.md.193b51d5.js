import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.98c15f2e.js";const b=JSON.parse('{"title":"æ‰‹å†™ä¸€ä¸ªç®€æ˜“bundleræ‰“åŒ…å·¥å…·å¸¦ä½ äº†è§£WebpackåŸç†","description":"","frontmatter":{"title":"æ‰‹å†™ä¸€ä¸ªç®€æ˜“bundleræ‰“åŒ…å·¥å…·å¸¦ä½ äº†è§£WebpackåŸç†","author":"å‘¨ä¸€","date":"2021-08-06","categories":["å‰ç«¯å¼€å‘"],"tags":["Webpack"],"sidebar":"auto"},"headers":[{"level":1,"title":"ğŸ¥ åºè¨€","slug":"ğŸ¥-åºè¨€","link":"#ğŸ¥-åºè¨€","children":[]},{"level":1,"title":"ğŸ‰ ä¸€ã€æ¨¡å—åˆ†æ(å…¥å£æ–‡ä»¶ä»£ç åˆ†æ)","slug":"ğŸ‰-ä¸€ã€æ¨¡å—åˆ†æ-å…¥å£æ–‡ä»¶ä»£ç åˆ†æ","link":"#ğŸ‰-ä¸€ã€æ¨¡å—åˆ†æ-å…¥å£æ–‡ä»¶ä»£ç åˆ†æ","children":[{"level":2,"title":"1. é¡¹ç›®ç»“æ„","slug":"_1-é¡¹ç›®ç»“æ„","link":"#_1-é¡¹ç›®ç»“æ„","children":[]},{"level":2,"title":"2. å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–","slug":"_2-å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–","link":"#_2-å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–","children":[]},{"level":2,"title":"3. ä¸šåŠ¡ä»£ç ","slug":"_3-ä¸šåŠ¡ä»£ç ","link":"#_3-ä¸šåŠ¡ä»£ç ","children":[]},{"level":2,"title":"4. å¼€å§‹æ‰“åŒ…","slug":"_4-å¼€å§‹æ‰“åŒ…","link":"#_4-å¼€å§‹æ‰“åŒ…","children":[]}]},{"level":1,"title":"ğŸ¥‘ äºŒã€ä¾èµ–å›¾è°± Dependencies Graph","slug":"ğŸ¥‘-äºŒã€ä¾èµ–å›¾è°±-dependencies-graph","link":"#ğŸ¥‘-äºŒã€ä¾èµ–å›¾è°±-dependencies-graph","children":[{"level":2,"title":"1. ç»“æœåˆ†æ","slug":"_1-ç»“æœåˆ†æ","link":"#_1-ç»“æœåˆ†æ","children":[]},{"level":2,"title":"2. åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»","slug":"_2-åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»","link":"#_2-åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»","children":[]}]},{"level":1,"title":"ğŸ ä¸‰ã€ç”Ÿæˆä»£ç ","slug":"ğŸ-ä¸‰ã€ç”Ÿæˆä»£ç ","link":"#ğŸ-ä¸‰ã€ç”Ÿæˆä»£ç ","children":[{"level":2,"title":"1. é€»è¾‘ç¼–å†™","slug":"_1-é€»è¾‘ç¼–å†™","link":"#_1-é€»è¾‘ç¼–å†™","children":[]},{"level":2,"title":"2. ç»“æœåˆ†æ","slug":"_2-ç»“æœåˆ†æ","link":"#_2-ç»“æœåˆ†æ","children":[]}]},{"level":1,"title":"ğŸ“ å››ã€ç»“æŸè¯­","slug":"ğŸ“-å››ã€ç»“æŸè¯­","link":"#ğŸ“-å››ã€ç»“æŸè¯­","children":[]},{"level":1,"title":"ğŸ£ å½©è›‹ One More Thing","slug":"ğŸ£-å½©è›‹-one-more-thing","link":"#ğŸ£-å½©è›‹-one-more-thing","children":[{"level":2,"title":"ï¼ˆï¼šå¾€æœŸæ¨è","slug":"å¾€æœŸæ¨è","link":"#å¾€æœŸæ¨è","children":[]}]}],"relativePath":"column/FrontEnd/Webpack/005.md","filePath":"column/FrontEnd/Webpack/005.md","lastUpdated":1685151998000}'),p={name:"column/FrontEnd/Webpack/005.md"},o=l(`<h1 id="ğŸ¥-åºè¨€" tabindex="-1">ğŸ¥ åºè¨€ <a class="header-anchor" href="#ğŸ¥-åºè¨€" aria-label="Permalink to &quot;ğŸ¥ åºè¨€&quot;">â€‹</a></h1><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ <code>webpack</code> æ˜¯ä¸€ä¸ª<strong>æ‰“åŒ…å·¥å…·</strong>ã€‚åœ¨æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œé…ç½®ä¹‹å‰ï¼Œå®ƒä¹Ÿæ˜¯ç»è¿‡ä¸€ç³»åˆ—çš„ä»£ç ç¼–å†™ï¼Œæ‰ç”Ÿæˆçš„æ‰“åŒ…å·¥å…·ã€‚é‚£è¿™èƒŒåï¼Œåˆåšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿ</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥åŸç”Ÿ <code>js</code> ï¼Œæ¥æ‰‹å†™ä¸€ä¸ªç®€æ˜“çš„æ‰“åŒ…å·¥å…· <code>bundler</code> ï¼Œå®ç°å¯¹é¡¹ç›®ä»£ç çš„æ‰“åŒ…ã€‚</p><p>ä¸‹é¢å¼€å§‹è¿›è¡Œæœ¬æ–‡çš„è®²è§£~</p><h1 id="ğŸ‰-ä¸€ã€æ¨¡å—åˆ†æ-å…¥å£æ–‡ä»¶ä»£ç åˆ†æ" tabindex="-1">ğŸ‰ ä¸€ã€æ¨¡å—åˆ†æ(å…¥å£æ–‡ä»¶ä»£ç åˆ†æ) <a class="header-anchor" href="#ğŸ‰-ä¸€ã€æ¨¡å—åˆ†æ-å…¥å£æ–‡ä»¶ä»£ç åˆ†æ" aria-label="Permalink to &quot;ğŸ‰ ä¸€ã€æ¨¡å—åˆ†æ(å…¥å£æ–‡ä»¶ä»£ç åˆ†æ)&quot;">â€‹</a></h1><h2 id="_1-é¡¹ç›®ç»“æ„" tabindex="-1">1. é¡¹ç›®ç»“æ„ <a class="header-anchor" href="#_1-é¡¹ç›®ç»“æ„" aria-label="Permalink to &quot;1. é¡¹ç›®ç»“æ„&quot;">â€‹</a></h2><p>ä¸‹é¢å…ˆæ¥çœ‹ä¸‹æˆ‘ä»¬çš„é¡¹ç›®æ–‡ä»¶ç»“æ„ã€‚<strong>è¯·çœ‹ä¸‹å›¾ ğŸ‘‡</strong></p><p><img src="https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270745757.png" alt="bundleré¡¹ç›®ç»“æ„"></p><h2 id="_2-å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–" tabindex="-1">2. å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ– <a class="header-anchor" href="#_2-å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–" aria-label="Permalink to &quot;2. å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–&quot;">â€‹</a></h2><p>æˆ‘ä»¬éœ€è¦ç”¨åˆ° <code>4</code> ä¸ªç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œ<strong>åˆ†åˆ«æ˜¯ï¼š</strong></p><ul><li>@babel/parser â€”â€” å¸®åŠ©æˆ‘ä»¬åˆ†ææºä»£ç å¹¶ç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ <strong>(AST)</strong> ï¼›</li><li>@babel/traverse â€”â€” å¸®åŠ©æˆ‘ä»¬<strong>å¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œéå†</strong>ï¼Œå¹¶åˆ†æé‡Œè¯­æ³•æ ‘é‡Œé¢çš„è¯­å¥ï¼›</li><li>@babel/core â€”â€” å°†åŸå§‹ä»£ç æ‰“åŒ…ç¼–è¯‘æˆæµè§ˆå™¨èƒ½å¤Ÿè¿è¡Œçš„ä»£ç ï¼›</li><li>@babel/preset-env â€”â€” ç”¨äºåœ¨è§£ææŠ½è±¡è¯­æ³•æ ‘æ—¶è¿›è¡Œé…ç½®ã€‚</li></ul><p>ä¸‹é¢ä¾æ¬¡ç»™å‡ºå®‰è£…è¿™å››ä¸ªåº“çš„å‘½ä»¤ï¼Œ<strong>åˆ†åˆ«æ˜¯ï¼š</strong></p><p><strong>ï¼ˆ1ï¼‰@babel/parser</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@babel/parser</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@babel/parser</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ï¼ˆ2ï¼‰@babel/traverse</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@babel/traverse</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@babel/traverse</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ï¼ˆ3ï¼‰@babel/core</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@balbel/core</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@balbel/core</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ï¼ˆ4ï¼‰@babel/preset-env</strong></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@babel/preset-env</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@babel/preset-env</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_3-ä¸šåŠ¡ä»£ç " tabindex="-1">3. ä¸šåŠ¡ä»£ç  <a class="header-anchor" href="#_3-ä¸šåŠ¡ä»£ç " aria-label="Permalink to &quot;3. ä¸šåŠ¡ä»£ç &quot;">â€‹</a></h2><p>å½“æˆ‘ä»¬å»åšä¸€ä¸ªé¡¹ç›®æ‰“åŒ…æ—¶ï¼Œé¦–å…ˆéœ€è¦å…ˆå¯¹é¡¹ç›®ä¸­çš„æ¨¡å—è¿›è¡Œåˆ†æï¼Œç°åœ¨æˆ‘ä»¬å…ˆå¯¹<strong>å…¥å£æ–‡ä»¶</strong>è¿›è¡Œåˆ†æã€‚å‡è®¾æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªä¸šåŠ¡ï¼Œè¾“å‡ºçš„æ˜¯ <code>hello monday</code> ã€‚é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥ç¼–å†™æˆ‘ä»¬çš„ä¸šåŠ¡ä»£ç ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼š</strong> ç¼–å†™ <code>word.js</code> æ–‡ä»¶ä»£ç ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">word</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;monday&#39;</span><span style="color:#E1E4E8;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">word</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;monday&#39;</span><span style="color:#24292E;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><strong>ç¬¬äºŒæ­¥ï¼š</strong> ç¼–å†™ <code>message.js</code> æ–‡ä»¶ä»£ç ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { word } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./word.js&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">message</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`hello \${</span><span style="color:#E1E4E8;">word</span><span style="color:#9ECBFF;">}\`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> message;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { word } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./word.js&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">message</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`hello \${</span><span style="color:#24292E;">word</span><span style="color:#032F62;">}\`</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> message;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>ç¬¬ä¸‰æ­¥ï¼š</strong> ç¼–å†™ <code>index.js</code> æ–‡ä»¶ä»£ç ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> message </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./message.js&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(message);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> message </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./message.js&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(message);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_4-å¼€å§‹æ‰“åŒ…" tabindex="-1">4. å¼€å§‹æ‰“åŒ… <a class="header-anchor" href="#_4-å¼€å§‹æ‰“åŒ…" aria-label="Permalink to &quot;4. å¼€å§‹æ‰“åŒ…&quot;">â€‹</a></h2><p>ç¼–å†™å®Œä¸šåŠ¡ä»£ç ä¹‹åï¼Œç°åœ¨ï¼Œæˆ‘ä»¬è¦å…ˆæ¥å¯¹å…¥å£æ–‡ä»¶ <code>index.js</code> è¿›è¡Œæ‰“åŒ…ã€‚æ³¨æ„ï¼Œè¿™é‡Œé™¤äº† <code>babel</code> å¤–ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ä»»ä½•å·¥å…·ï¼Œæ²¡æœ‰ <code>webpack</code> ã€ä¹Ÿæ²¡æœ‰ <code>webpack-cli</code> ç­‰å·¥å…·ã€‚</p><p>æˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸º <code>bundler.js</code> ï¼Œç”¨è¿™ä¸ªæ–‡ä»¶æ¥ç¼–å†™æˆ‘ä»¬çš„æ‰“åŒ…é€»è¾‘ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/parser&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">traverse</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/traverse&#39;</span><span style="color:#E1E4E8;">).default;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">babel</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/core&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">filename</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">content</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ast</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> parser.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(content, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#E1E4E8;">    sourceType: </span><span style="color:#9ECBFF;">&#39;module&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">traverse</span><span style="color:#E1E4E8;">(ast, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ImportDeclaration</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dirname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">dirname</span><span style="color:#E1E4E8;">(filename);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">newFile</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">      dependencies[node.source.value] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> newFile;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> babel.</span><span style="color:#B392F0;">transformFromAst</span><span style="color:#E1E4E8;">(ast, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    presets: [</span><span style="color:#9ECBFF;">&#39;@babel/preset-env&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#E1E4E8;">    filename,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">    dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//è¿”å›æµè§ˆå™¨ä¸Šå¯ä»¥è¿è¡Œçš„ä»£ç </span></span>
<span class="line"><span style="color:#E1E4E8;">    code,</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">moduleInfo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./src/index.js&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(moduleInfo);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;fs&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/parser&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">traverse</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/traverse&#39;</span><span style="color:#24292E;">).default;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">babel</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/core&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">filename</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">content</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ast</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> parser.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(content, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#24292E;">    sourceType: </span><span style="color:#032F62;">&#39;module&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">traverse</span><span style="color:#24292E;">(ast, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ImportDeclaration</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">node</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dirname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">dirname</span><span style="color:#24292E;">(filename);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">newFile</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">      dependencies[node.source.value] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> newFile;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> babel.</span><span style="color:#6F42C1;">transformFromAst</span><span style="color:#24292E;">(ast, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">    presets: [</span><span style="color:#032F62;">&#39;@babel/preset-env&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#24292E;">    filename,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">    dependencies,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//è¿”å›æµè§ˆå™¨ä¸Šå¯ä»¥è¿è¡Œçš„ä»£ç </span></span>
<span class="line"><span style="color:#24292E;">    code,</span></span>
<span class="line"><span style="color:#24292E;">  };</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">moduleInfo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./src/index.js&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(moduleInfo);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œç›¸ä¿¡å¤§å®¶å¯¹æ‰“åŒ…å…¥å£æ–‡ä»¶æœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£ã€‚ä¹‹åå‘¢ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œ <code>node bundler.js</code> å‘½ä»¤ï¼Œå¯ä»¥å¯¹æ‰“åŒ…è¿‡ç¨‹ä¸­çš„å„ç§åˆ†æè¿›è¡ŒæŸ¥çœ‹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­ç¬¬äºŒå—çš„å†…å®¹~</p><h1 id="ğŸ¥‘-äºŒã€ä¾èµ–å›¾è°±-dependencies-graph" tabindex="-1">ğŸ¥‘ äºŒã€ä¾èµ–å›¾è°± Dependencies Graph <a class="header-anchor" href="#ğŸ¥‘-äºŒã€ä¾èµ–å›¾è°±-dependencies-graph" aria-label="Permalink to &quot;ğŸ¥‘ äºŒã€ä¾èµ–å›¾è°± Dependencies Graph&quot;">â€‹</a></h1><p>å¯¹äºä¸Šè¿°æ‰€è®²çš„å†…å®¹ï¼Œæˆ‘ä»¬è°ˆåˆ°çš„ï¼Œåªæ˜¯å¯¹ä¸€ä¸ªå…¥å£æ–‡ä»¶è¿›è¡Œåˆ†æã€‚ä½†æ˜¯å‘¢ï¼Œè¿™è¿˜è¿œè¿œä¸å¤Ÿã€‚æ‰€ä»¥ï¼Œç°åœ¨æˆ‘ä»¬è¦æ¥å¯¹æ•´ä¸ªå·¥ç¨‹æ–‡ä»¶è¿›è¡Œåˆ†æã€‚</p><h2 id="_1-ç»“æœåˆ†æ" tabindex="-1">1. ç»“æœåˆ†æ <a class="header-anchor" href="#_1-ç»“æœåˆ†æ" aria-label="Permalink to &quot;1. ç»“æœåˆ†æ&quot;">â€‹</a></h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸Šè¿°ä»£ç ä¸­ï¼Œåªåˆ†æå…¥å£æ–‡ä»¶æ—¶çš„æ‰“å°æƒ…å†µã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">filename</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src/index.js&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">dependencies</span><span style="color:#E1E4E8;">: { </span><span style="color:#FDAEB7;font-style:italic;">&#39;./message.js&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">code</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#FDAEB7;font-style:italic;">;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;var</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_message</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_interopRequireDefault(require(</span><span style="color:#9ECBFF;">&quot;./message.js&quot;</span><span style="color:#FDAEB7;font-style:italic;">));\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;function</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_interopRequireDefault(obj)</span><span style="color:#E1E4E8;"> { </span><span style="color:#FDAEB7;font-style:italic;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj.__esModule</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> : { </span><span style="color:#79B8FF;">&quot;default&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> }</span><span style="color:#FDAEB7;font-style:italic;">;</span><span style="color:#E1E4E8;"> }</span><span style="color:#FDAEB7;font-style:italic;">\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">&#39;console.log(_message</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;font-style:italic;">);&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">filename</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;./src/index.js&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">dependencies</span><span style="color:#24292E;">: { </span><span style="color:#B31D28;font-style:italic;">&#39;./message.js&#39;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">code</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#B31D28;font-style:italic;">;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;var</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_message</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_interopRequireDefault(require(</span><span style="color:#032F62;">&quot;./message.js&quot;</span><span style="color:#B31D28;font-style:italic;">));\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;function</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_interopRequireDefault(obj)</span><span style="color:#24292E;"> { </span><span style="color:#B31D28;font-style:italic;">return</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj.__esModule</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">?</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> : { </span><span style="color:#005CC5;">&quot;default&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> }</span><span style="color:#B31D28;font-style:italic;">;</span><span style="color:#24292E;"> }</span><span style="color:#B31D28;font-style:italic;">\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">&#39;console.log(_message</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">]</span><span style="color:#B31D28;font-style:italic;">);&#39;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œå…¥å£æ–‡ä»¶åˆ†æå®Œäº†ä»¥åï¼Œè¿˜æœ‰ä¸€å±‚ä¸€å±‚çš„ä¾èµ–å’Œ codeã€‚ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å»é¡ºç€è¿™äº›ä¾èµ–ï¼Œæ¥æŠŠæ•´ä¸ªé¡¹ç›®çš„å†…å®¹åˆ†æå‡ºæ¥ã€‚</p><h2 id="_2-åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»" tabindex="-1">2. åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³» <a class="header-anchor" href="#_2-åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»" aria-label="Permalink to &quot;2. åˆ†ææ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»&quot;">â€‹</a></h2><p>æˆ‘ä»¬ç°åœ¨æ¥å¯¹ <code>bundler.js</code> è¿›è¡Œå‡çº§æ”¹é€ ï¼ŒæŠŠæ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»ç»™æç»˜å‡ºæ¥ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/parser&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">traverse</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/traverse&#39;</span><span style="color:#E1E4E8;">).default;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">babel</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/core&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">filename</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">content</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ast</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> parser.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(content, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#E1E4E8;">    sourceType: </span><span style="color:#9ECBFF;">&#39;module&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">traverse</span><span style="color:#E1E4E8;">(ast, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ImportDeclaration</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dirname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">dirname</span><span style="color:#E1E4E8;">(filename);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">newFile</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">      dependencies[node.source.value] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> newFile;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> babel.</span><span style="color:#B392F0;">transformFromAst</span><span style="color:#E1E4E8;">(ast, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    presets: [</span><span style="color:#9ECBFF;">&#39;@babel/preset-env&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#E1E4E8;">    filename,</span></span>
<span class="line"><span style="color:#E1E4E8;">    dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">    code,</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">makeDependenciesGraph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">entry</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. å¯¹å…¥å£æ¨¡å—è¿›è¡Œä¸€æ¬¡åˆ†æ</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">entryModule</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;">(entry);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(entryModule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//2. å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å…¥å£æ–‡ä»¶å’Œä¾èµ–</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graphArray</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [entryModule];</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//3. å¯¹graphArrayè¿›è¡Œéå†</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> graphArray.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//4. å–å‡ºgraphArrayä¸­çš„æ¯ä¸€é¡¹</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> graphArray[i];</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//5. å–å‡ºæ¯ä¸€é¡¹ä¸­çš„ä¾èµ–dependencies</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> item;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//6. å¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œå°±å¯¹ä¾èµ–è¿›è¡Œå¾ªç¯</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (dependencies) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">/*7. é€šè¿‡ä¸æ–­çš„å¾ªç¯ï¼Œæœ€ç»ˆï¼Œå¯ä»¥æŠŠå®ƒçš„å…¥å£æ–‡ä»¶ï¼Œä»¥åŠå®ƒçš„ä¾èµ–ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">            è¿˜æœ‰å®ƒçš„ä¾èµ–çš„ä¾èµ–ï¼Œä¸€å±‚ä¸€å±‚çš„éå†å‡ºæ¥ï¼Œå¹¶æ¨åˆ°graphArrayå½“ä¸­*/</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> dependencies) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">/*8. é€šè¿‡é˜Ÿåˆ—(å…ˆè¿›å…ˆå‡º)çš„æ–¹å¼å®ç°é€’å½’çš„æ•ˆæœï¼›</span></span>
<span class="line"><span style="color:#6A737D;">                ä¸ºä»€ä¹ˆç”¨é€’å½’ï¼Ÿé€’å½’åœ°è¿›è¡Œåˆ†æï¼Œæ˜¯å› ä¸ºæ¯ä¸ªä¾èµ–ä¸‹é¢æœ‰å¯èƒ½è¿˜æœ‰ä¾èµ–*/</span></span>
<span class="line"><span style="color:#E1E4E8;">        graphArray.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;">(dependencies[j]));</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//9. å¤„ç†åçš„graphArrayæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç°åœ¨éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼ä¸Šçš„è½¬æ¢</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#E1E4E8;">  graphArray.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    graph[item.filename] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      dependencies: item.dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">      code: item.code,</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> graph;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// &#39;./src/index.js&#39; ä¸ºå…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graphInfo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">makeDependenciesGraph</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./src/index.js&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(graphInfo);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;fs&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/parser&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">traverse</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/traverse&#39;</span><span style="color:#24292E;">).default;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">babel</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/core&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">filename</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">content</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ast</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> parser.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(content, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#24292E;">    sourceType: </span><span style="color:#032F62;">&#39;module&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">traverse</span><span style="color:#24292E;">(ast, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ImportDeclaration</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">node</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dirname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">dirname</span><span style="color:#24292E;">(filename);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">newFile</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">      dependencies[node.source.value] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> newFile;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> babel.</span><span style="color:#6F42C1;">transformFromAst</span><span style="color:#24292E;">(ast, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">    presets: [</span><span style="color:#032F62;">&#39;@babel/preset-env&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#24292E;">    filename,</span></span>
<span class="line"><span style="color:#24292E;">    dependencies,</span></span>
<span class="line"><span style="color:#24292E;">    code,</span></span>
<span class="line"><span style="color:#24292E;">  };</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">makeDependenciesGraph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">entry</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. å¯¹å…¥å£æ¨¡å—è¿›è¡Œä¸€æ¬¡åˆ†æ</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">entryModule</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;">(entry);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(entryModule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//2. å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å…¥å£æ–‡ä»¶å’Œä¾èµ–</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graphArray</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [entryModule];</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//3. å¯¹graphArrayè¿›è¡Œéå†</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> graphArray.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//4. å–å‡ºgraphArrayä¸­çš„æ¯ä¸€é¡¹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> graphArray[i];</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//5. å–å‡ºæ¯ä¸€é¡¹ä¸­çš„ä¾èµ–dependencies</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> item;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//6. å¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œå°±å¯¹ä¾èµ–è¿›è¡Œå¾ªç¯</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (dependencies) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">/*7. é€šè¿‡ä¸æ–­çš„å¾ªç¯ï¼Œæœ€ç»ˆï¼Œå¯ä»¥æŠŠå®ƒçš„å…¥å£æ–‡ä»¶ï¼Œä»¥åŠå®ƒçš„ä¾èµ–ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">            è¿˜æœ‰å®ƒçš„ä¾èµ–çš„ä¾èµ–ï¼Œä¸€å±‚ä¸€å±‚çš„éå†å‡ºæ¥ï¼Œå¹¶æ¨åˆ°graphArrayå½“ä¸­*/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> j </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> dependencies) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">/*8. é€šè¿‡é˜Ÿåˆ—(å…ˆè¿›å…ˆå‡º)çš„æ–¹å¼å®ç°é€’å½’çš„æ•ˆæœï¼›</span></span>
<span class="line"><span style="color:#6A737D;">                ä¸ºä»€ä¹ˆç”¨é€’å½’ï¼Ÿé€’å½’åœ°è¿›è¡Œåˆ†æï¼Œæ˜¯å› ä¸ºæ¯ä¸ªä¾èµ–ä¸‹é¢æœ‰å¯èƒ½è¿˜æœ‰ä¾èµ–*/</span></span>
<span class="line"><span style="color:#24292E;">        graphArray.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;">(dependencies[j]));</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//9. å¤„ç†åçš„graphArrayæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç°åœ¨éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼ä¸Šçš„è½¬æ¢</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#24292E;">  graphArray.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">item</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    graph[item.filename] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      dependencies: item.dependencies,</span></span>
<span class="line"><span style="color:#24292E;">      code: item.code,</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> graph;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// &#39;./src/index.js&#39; ä¸ºå…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graphInfo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">makeDependenciesGraph</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./src/index.js&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(graphInfo);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ¶é€ äº†ä¸€ä¸ªæ–°çš„å‡½æ•° <code>makeDependenciesGraph</code> ï¼Œæ¥æè¿°æ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨æœ€ç»ˆå¯¹å®ƒè¿›è¡Œæ ¼å¼ä¸Šçš„è½¬æ¢ï¼Œè½¬æ¢æˆæˆ‘ä»¬ç†æƒ³ä¸­çš„ <code>js</code> å¯¹è±¡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¾èµ–å…³ç³»çš„æ‰“å°ç»“æœã€‚<strong>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src/index.js&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">dependencies</span><span style="color:#E1E4E8;">: { </span><span style="color:#FDAEB7;font-style:italic;">&#39;./message.js&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">code</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#FDAEB7;font-style:italic;">;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;var</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_message</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_interopRequireDefault(require(</span><span style="color:#9ECBFF;">&quot;./message.js&quot;</span><span style="color:#FDAEB7;font-style:italic;">));\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;function</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_interopRequireDefault(obj)</span><span style="color:#E1E4E8;"> { </span><span style="color:#FDAEB7;font-style:italic;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">&amp;&amp;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj.__esModule</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> : { </span><span style="color:#79B8FF;">&quot;default&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">obj</span><span style="color:#E1E4E8;"> }</span><span style="color:#FDAEB7;font-style:italic;">;</span><span style="color:#E1E4E8;"> }</span><span style="color:#FDAEB7;font-style:italic;">\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;console.log(_message</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;font-style:italic;">);&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">dependencies</span><span style="color:#E1E4E8;">: { </span><span style="color:#FDAEB7;font-style:italic;">&#39;./word.js&#39;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;./src\\\\word.js&#39;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">code</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#FDAEB7;font-style:italic;">;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;Object.defineProperty(exports</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">&quot;__esModule&quot;</span><span style="color:#FDAEB7;font-style:italic;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">{\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;font-style:italic;">\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;font-style:italic;">);\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;exports</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;font-style:italic;">;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;var</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_word</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">require(</span><span style="color:#9ECBFF;">&quot;./word.js&quot;</span><span style="color:#FDAEB7;font-style:italic;">);\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;var</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">message</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;hello &quot;</span><span style="color:#FDAEB7;font-style:italic;">.concat(_word.word);\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;var</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_default</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">message;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;exports</span><span style="color:#E1E4E8;">[</span><span style="color:#9ECBFF;">&quot;default&quot;</span><span style="color:#E1E4E8;">] </span><span style="color:#FDAEB7;font-style:italic;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">_default;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  &#39;./src\\\\word.js&#39;: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">dependencies</span><span style="color:#E1E4E8;">: {},</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;font-style:italic;">code</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#9ECBFF;">&quot;use strict&quot;</span><span style="color:#FDAEB7;font-style:italic;">;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;Object.defineProperty(exports</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">&quot;__esModule&quot;</span><span style="color:#FDAEB7;font-style:italic;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">{\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;font-style:italic;">value</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;font-style:italic;">\\n&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">+</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;font-style:italic;">&#39;</span><span style="color:#E1E4E8;">});\\n&#39; +</span></span>
<span class="line"><span style="color:#E1E4E8;">      &#39;exports.word = void </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">;\\n&#39; +</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;var word = &#39;monday&#39;;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#E1E4E8;"> +</span></span>
<span class="line"><span style="color:#E1E4E8;">      &#39;exports.word = word;&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">&#39;./src/index.js&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">dependencies</span><span style="color:#24292E;">: { </span><span style="color:#B31D28;font-style:italic;">&#39;./message.js&#39;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">code</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#B31D28;font-style:italic;">;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;var</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_message</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_interopRequireDefault(require(</span><span style="color:#032F62;">&quot;./message.js&quot;</span><span style="color:#B31D28;font-style:italic;">));\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;function</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_interopRequireDefault(obj)</span><span style="color:#24292E;"> { </span><span style="color:#B31D28;font-style:italic;">return</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">&amp;&amp;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj.__esModule</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">?</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> : { </span><span style="color:#005CC5;">&quot;default&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">obj</span><span style="color:#24292E;"> }</span><span style="color:#B31D28;font-style:italic;">;</span><span style="color:#24292E;"> }</span><span style="color:#B31D28;font-style:italic;">\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;console.log(_message</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">]</span><span style="color:#B31D28;font-style:italic;">);&#39;</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">&#39;./src\\\\message.js&#39;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">dependencies</span><span style="color:#24292E;">: { </span><span style="color:#B31D28;font-style:italic;">&#39;./word.js&#39;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;./src\\\\word.js&#39;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">code</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#B31D28;font-style:italic;">;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;Object.defineProperty(exports</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">&quot;__esModule&quot;</span><span style="color:#B31D28;font-style:italic;">,</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">{\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">value</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;font-style:italic;">\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#24292E;">}</span><span style="color:#B31D28;font-style:italic;">);\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;exports</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">] </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">void</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;font-style:italic;">;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;var</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_word</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">require(</span><span style="color:#032F62;">&quot;./word.js&quot;</span><span style="color:#B31D28;font-style:italic;">);\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;var</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">message</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;hello &quot;</span><span style="color:#B31D28;font-style:italic;">.concat(_word.word);\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;var</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_default</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">message;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;exports</span><span style="color:#24292E;">[</span><span style="color:#032F62;">&quot;default&quot;</span><span style="color:#24292E;">] </span><span style="color:#B31D28;font-style:italic;">=</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">_default;&#39;</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  &#39;./src\\\\word.js&#39;: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">dependencies</span><span style="color:#24292E;">: {},</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;font-style:italic;">code</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#032F62;">&quot;use strict&quot;</span><span style="color:#B31D28;font-style:italic;">;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;Object.defineProperty(exports</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">&quot;__esModule&quot;</span><span style="color:#B31D28;font-style:italic;">,</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">{\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#24292E;">  </span><span style="color:#B31D28;font-style:italic;">value</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;font-style:italic;">\\n&#39;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">+</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;font-style:italic;">&#39;</span><span style="color:#24292E;">});\\n&#39; +</span></span>
<span class="line"><span style="color:#24292E;">      &#39;exports.word = void </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">;\\n&#39; +</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;var word = &#39;monday&#39;;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">&quot;</span><span style="color:#24292E;"> +</span></span>
<span class="line"><span style="color:#24292E;">      &#39;exports.word = word;&#39;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»éƒ½ç»™éå†å‡ºæ¥äº†ã€‚è¿™ä¹Ÿå°±è¯´æ˜äº†ï¼Œæˆ‘ä»¬æˆåŠŸè¿›è¡Œäº†è¿™ä¸€æ­¥çš„åˆ†æã€‚</p><h1 id="ğŸ-ä¸‰ã€ç”Ÿæˆä»£ç " tabindex="-1">ğŸ ä¸‰ã€ç”Ÿæˆä»£ç  <a class="header-anchor" href="#ğŸ-ä¸‰ã€ç”Ÿæˆä»£ç " aria-label="Permalink to &quot;ğŸ ä¸‰ã€ç”Ÿæˆä»£ç &quot;">â€‹</a></h1><h2 id="_1-é€»è¾‘ç¼–å†™" tabindex="-1">1. é€»è¾‘ç¼–å†™ <a class="header-anchor" href="#_1-é€»è¾‘ç¼–å†™" aria-label="Permalink to &quot;1. é€»è¾‘ç¼–å†™&quot;">â€‹</a></h2><p>ä¸Šé¢æˆ‘ä»¬å·²ç»æˆåŠŸç”Ÿæˆäº†ä¾èµ–å›¾è°±ï¼Œé‚£ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥æŠŠè¿™ä¸ªä¾èµ–å›¾è°±ï¼Œç”Ÿæˆèƒ½å¤ŸçœŸæ­£åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç ã€‚æˆ‘ä»¬ç»§ç»­åœ¨ <code>bundle.js</code> ä¸Šï¼Œç¼–å†™ä¸€ä¸ªç”Ÿæˆä»£ç çš„é€»è¾‘ã€‚<strong>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</strong></p><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;fs&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">path</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/parser&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">traverse</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/traverse&#39;</span><span style="color:#E1E4E8;">).default;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">babel</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">require</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;@babel/core&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">filename</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">content</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fs.</span><span style="color:#B392F0;">readFileSync</span><span style="color:#E1E4E8;">(filename, </span><span style="color:#9ECBFF;">&#39;utf-8&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ast</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> parser.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(content, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#E1E4E8;">    sourceType: </span><span style="color:#9ECBFF;">&#39;module&#39;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">traverse</span><span style="color:#E1E4E8;">(ast, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ImportDeclaration</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">node</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dirname</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">dirname</span><span style="color:#E1E4E8;">(filename);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">newFile</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./&#39;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> path.</span><span style="color:#B392F0;">join</span><span style="color:#E1E4E8;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#E1E4E8;">      dependencies[node.source.value] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> newFile;</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> babel.</span><span style="color:#B392F0;">transformFromAst</span><span style="color:#E1E4E8;">(ast, </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;">, {</span></span>
<span class="line"><span style="color:#E1E4E8;">    presets: [</span><span style="color:#9ECBFF;">&#39;@babel/preset-env&#39;</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#E1E4E8;">    filename,</span></span>
<span class="line"><span style="color:#E1E4E8;">    dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">    code,</span></span>
<span class="line"><span style="color:#E1E4E8;">  };</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">makeDependenciesGraph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">entry</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. å¯¹å…¥å£æ¨¡å—è¿›è¡Œä¸€æ¬¡åˆ†æ</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">entryModule</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;">(entry);</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// console.log(entryModule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//2. å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å…¥å£æ–‡ä»¶å’Œä¾èµ–</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graphArray</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [entryModule];</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//3. å¯¹graphArrayè¿›è¡Œéå†</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> graphArray.</span><span style="color:#79B8FF;">length</span><span style="color:#E1E4E8;">; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//4. å–å‡ºgraphArrayä¸­çš„æ¯ä¸€é¡¹</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> graphArray[i];</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//5. å–å‡ºæ¯ä¸€é¡¹ä¸­çš„ä¾èµ–dependencies</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">dependencies</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> item;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">//6. å¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œå°±å¯¹ä¾èµ–è¿›è¡Œå¾ªç¯</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (dependencies) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#6A737D;">/*7. é€šè¿‡ä¸æ–­çš„å¾ªç¯ï¼Œæœ€ç»ˆï¼Œå¯ä»¥æŠŠå®ƒçš„å…¥å£æ–‡ä»¶ï¼Œä»¥åŠå®ƒçš„ä¾èµ–ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">            è¿˜æœ‰å®ƒçš„ä¾èµ–çš„ä¾èµ–ï¼Œä¸€å±‚ä¸€å±‚çš„éå†å‡ºæ¥ï¼Œå¹¶æ¨åˆ°graphArrayå½“ä¸­*/</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> j </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> dependencies) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">/*8. é€šè¿‡é˜Ÿåˆ—(å…ˆè¿›å…ˆå‡º)çš„æ–¹å¼å®ç°é€’å½’çš„æ•ˆæœï¼›</span></span>
<span class="line"><span style="color:#6A737D;">                ä¸ºä»€ä¹ˆç”¨é€’å½’ï¼Ÿé€’å½’åœ°è¿›è¡Œåˆ†æï¼Œæ˜¯å› ä¸ºæ¯ä¸ªä¾èµ–ä¸‹é¢æœ‰å¯èƒ½è¿˜æœ‰ä¾èµ–*/</span></span>
<span class="line"><span style="color:#E1E4E8;">        graphArray.</span><span style="color:#B392F0;">push</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">moduleAnalyser</span><span style="color:#E1E4E8;">(dependencies[j]));</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//9. å¤„ç†åçš„graphArrayæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç°åœ¨éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼ä¸Šçš„è½¬æ¢</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {};</span></span>
<span class="line"><span style="color:#E1E4E8;">  graphArray.</span><span style="color:#B392F0;">forEach</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">item</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    graph[item.filename] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      dependencies: item.dependencies,</span></span>
<span class="line"><span style="color:#E1E4E8;">      code: item.code,</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> graph;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">generateCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">entry</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">//1. å°†ç”Ÿæˆçš„ä¾èµ–å›¾è°±è¿›è¡Œæ ¼å¼è½¬æ¢</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">graph</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">makeDependenciesGraph</span><span style="color:#E1E4E8;">(entry));</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">/** 2. æ„é€ requireå‡½æ•°å’Œexportså¯¹è±¡ï¼Œè½¬åŒ–æˆæµè§ˆå™¨è®¤è¯†çš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#6A737D;">   * return require(graph[module].dependencies[relative]) ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°çœŸå®çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#6A737D;">   */</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\`</span></span>
<span class="line"><span style="color:#9ECBFF;">        (function(graph){</span></span>
<span class="line"><span style="color:#9ECBFF;">            function require(module){</span></span>
<span class="line"><span style="color:#9ECBFF;">                function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#9ECBFF;">                    return require(graph[module].dependencies[relativePath])</span></span>
<span class="line"><span style="color:#9ECBFF;">                }</span></span>
<span class="line"><span style="color:#9ECBFF;">                var exports = {};</span></span>
<span class="line"><span style="color:#9ECBFF;">                (function(require, exports, code){</span></span>
<span class="line"><span style="color:#9ECBFF;">                    eval(code)</span></span>
<span class="line"><span style="color:#9ECBFF;">                })(localRequire, exports, graph[module].code);</span></span>
<span class="line"><span style="color:#9ECBFF;">                return exports;</span></span>
<span class="line"><span style="color:#9ECBFF;">            };</span></span>
<span class="line"><span style="color:#9ECBFF;">            require(&#39;\${</span><span style="color:#E1E4E8;">entry</span><span style="color:#9ECBFF;">}&#39;)</span></span>
<span class="line"><span style="color:#9ECBFF;">        })(\${</span><span style="color:#E1E4E8;">graph</span><span style="color:#9ECBFF;">});</span></span>
<span class="line"><span style="color:#9ECBFF;">    \`</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// &#39;./src/index.js&#39; ä¸ºå…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">generateCode</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;./src/index.js&#39;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(code);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;fs&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">path</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/parser&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">traverse</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/traverse&#39;</span><span style="color:#24292E;">).default;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">babel</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">require</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;@babel/core&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">filename</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. é¦–å…ˆæ‹¿åˆ°æ–‡ä»¶åï¼Œæ‹¿åˆ°æ–‡ä»¶åä¹‹åæˆ‘ä»¬å»è¯»å–æ–‡ä»¶é‡Œé¢çš„å†…å®¹</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">content</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fs.</span><span style="color:#6F42C1;">readFileSync</span><span style="color:#24292E;">(filename, </span><span style="color:#032F62;">&#39;utf-8&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//2. å€ŸåŠ©Babel-parserï¼Œå°†æ–‡ä»¶é‡Œjsçš„å­—ç¬¦ä¸²ï¼Œè½¬åŒ–æˆä¸€ä¸ªjsçš„å¯¹è±¡-&gt;è¿™ä¸ªjså¯¹è±¡å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æŠ½è±¡è¯­æ³•æ ‘</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ast</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> parser.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(content, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 3. å¦‚æœä½ ä¼ å…¥çš„ES6çš„è¯­æ³•ï¼Œé‚£ä¹ˆéœ€è¦è®¾ç½®sourceTypeä¸ºmodule</span></span>
<span class="line"><span style="color:#24292E;">    sourceType: </span><span style="color:#032F62;">&#39;module&#39;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//æ”¶é›†å…¥å£æ–‡ä»¶ä¸­çš„ä¾èµ–æ–‡ä»¶</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">traverse</span><span style="color:#24292E;">(ast, {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/*4. æœ‰äº†æŠ½è±¡è¯­æ³•æ ‘ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å»åˆ†æï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒé‡Œé¢çš„å£°æ˜éƒ½åœ¨å“ªäº›åœ°æ–¹ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å»æ‰¾åˆ°importè¿™äº›è¯­å¥å¯¹åº”çš„å†…å®¹</span></span>
<span class="line"><span style="color:#6A737D;">        5. éœ€è¦å€ŸåŠ©@babel/traverseè¿™ä¸ªå·¥å…·ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        è¿™ä¸ªå·¥å…·è¡¨æ˜å½“æŠ½è±¡è¯­æ³•æ ‘æœ‰ImportDeclarationè¿™æ ·çš„è¯­å¥æ—¶ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">        å®ƒå°±ä¼šç»§ç»­ä¸‹é¢çš„å‡½æ•°*/</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ImportDeclaration</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">node</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(node);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dirname</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">dirname</span><span style="color:#24292E;">(filename);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">newFile</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./&#39;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> path.</span><span style="color:#6F42C1;">join</span><span style="color:#24292E;">(dirname, node.source.value);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">// console.log(newFile);</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">//6. æ‰¾åˆ°importè¯­å¥ä¹‹åï¼Œå°†è¿™äº›è¯­å¥æ‹¼è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œæ”¾åœ¨dependenciesè¿™ä¸ªå˜é‡ä¸­ï¼ˆä»¥é”®å€¼å¯¹çš„æ–¹å¼æ¥è¿›è¡Œå­˜å‚¨ï¼‰</span></span>
<span class="line"><span style="color:#24292E;">      dependencies[node.source.value] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> newFile;</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/*</span></span>
<span class="line"><span style="color:#6A737D;">    7. åˆ†æå¥½äº†ä¹‹åï¼Œå¯¹æ¨¡å—çš„æºä»£ç è¿›è¡Œä¸€æ¬¡ç¼–è¯‘ã€‚é€šè¿‡ä½¿ç”¨transformFromAstï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    æŠŠå®ƒä»ä¸€ä¸ªES moduleï¼Œè½¬æ¢æˆæµè§ˆå™¨å¯ä»¥æ‰§è¡Œçš„è¯­æ³•ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨codeé‡Œé¢ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">    codeç”Ÿæˆçš„ä»£ç å°±æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œçš„ä»£ç */</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> babel.</span><span style="color:#6F42C1;">transformFromAst</span><span style="color:#24292E;">(ast, </span><span style="color:#005CC5;">null</span><span style="color:#24292E;">, {</span></span>
<span class="line"><span style="color:#24292E;">    presets: [</span><span style="color:#032F62;">&#39;@babel/preset-env&#39;</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//è¿”å›å…¥å£æ–‡ä»¶çš„åå­—</span></span>
<span class="line"><span style="color:#24292E;">    filename,</span></span>
<span class="line"><span style="color:#24292E;">    dependencies,</span></span>
<span class="line"><span style="color:#24292E;">    code,</span></span>
<span class="line"><span style="color:#24292E;">  };</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(dependencies);</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">makeDependenciesGraph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">entry</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. å¯¹å…¥å£æ¨¡å—è¿›è¡Œä¸€æ¬¡åˆ†æ</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">entryModule</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;">(entry);</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// console.log(entryModule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//2. å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾å…¥å£æ–‡ä»¶å’Œä¾èµ–</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graphArray</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [entryModule];</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//3. å¯¹graphArrayè¿›è¡Œéå†</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> graphArray.</span><span style="color:#005CC5;">length</span><span style="color:#24292E;">; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//4. å–å‡ºgraphArrayä¸­çš„æ¯ä¸€é¡¹</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> graphArray[i];</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//5. å–å‡ºæ¯ä¸€é¡¹ä¸­çš„ä¾èµ–dependencies</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">dependencies</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> item;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">//6. å¦‚æœå…¥å£æ–‡ä»¶æœ‰ä¾èµ–æ—¶ï¼Œå°±å¯¹ä¾èµ–è¿›è¡Œå¾ªç¯</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (dependencies) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6A737D;">/*7. é€šè¿‡ä¸æ–­çš„å¾ªç¯ï¼Œæœ€ç»ˆï¼Œå¯ä»¥æŠŠå®ƒçš„å…¥å£æ–‡ä»¶ï¼Œä»¥åŠå®ƒçš„ä¾èµ–ï¼Œ</span></span>
<span class="line"><span style="color:#6A737D;">            è¿˜æœ‰å®ƒçš„ä¾èµ–çš„ä¾èµ–ï¼Œä¸€å±‚ä¸€å±‚çš„éå†å‡ºæ¥ï¼Œå¹¶æ¨åˆ°graphArrayå½“ä¸­*/</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> j </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> dependencies) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">/*8. é€šè¿‡é˜Ÿåˆ—(å…ˆè¿›å…ˆå‡º)çš„æ–¹å¼å®ç°é€’å½’çš„æ•ˆæœï¼›</span></span>
<span class="line"><span style="color:#6A737D;">                ä¸ºä»€ä¹ˆç”¨é€’å½’ï¼Ÿé€’å½’åœ°è¿›è¡Œåˆ†æï¼Œæ˜¯å› ä¸ºæ¯ä¸ªä¾èµ–ä¸‹é¢æœ‰å¯èƒ½è¿˜æœ‰ä¾èµ–*/</span></span>
<span class="line"><span style="color:#24292E;">        graphArray.</span><span style="color:#6F42C1;">push</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">moduleAnalyser</span><span style="color:#24292E;">(dependencies[j]));</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//9. å¤„ç†åçš„graphArrayæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç°åœ¨éœ€è¦å¯¹å®ƒè¿›è¡Œæ ¼å¼ä¸Šçš„è½¬æ¢</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {};</span></span>
<span class="line"><span style="color:#24292E;">  graphArray.</span><span style="color:#6F42C1;">forEach</span><span style="color:#24292E;">((</span><span style="color:#E36209;">item</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    graph[item.filename] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      dependencies: item.dependencies,</span></span>
<span class="line"><span style="color:#24292E;">      code: item.code,</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> graph;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">generateCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">entry</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">//1. å°†ç”Ÿæˆçš„ä¾èµ–å›¾è°±è¿›è¡Œæ ¼å¼è½¬æ¢</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">graph</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">makeDependenciesGraph</span><span style="color:#24292E;">(entry));</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">/** 2. æ„é€ requireå‡½æ•°å’Œexportså¯¹è±¡ï¼Œè½¬åŒ–æˆæµè§ˆå™¨è®¤è¯†çš„å­—ç¬¦ä¸²</span></span>
<span class="line"><span style="color:#6A737D;">   * return require(graph[module].dependencies[relative]) ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°çœŸå®çš„è·¯å¾„</span></span>
<span class="line"><span style="color:#6A737D;">   */</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\`</span></span>
<span class="line"><span style="color:#032F62;">        (function(graph){</span></span>
<span class="line"><span style="color:#032F62;">            function require(module){</span></span>
<span class="line"><span style="color:#032F62;">                function localRequire(relativePath) {</span></span>
<span class="line"><span style="color:#032F62;">                    return require(graph[module].dependencies[relativePath])</span></span>
<span class="line"><span style="color:#032F62;">                }</span></span>
<span class="line"><span style="color:#032F62;">                var exports = {};</span></span>
<span class="line"><span style="color:#032F62;">                (function(require, exports, code){</span></span>
<span class="line"><span style="color:#032F62;">                    eval(code)</span></span>
<span class="line"><span style="color:#032F62;">                })(localRequire, exports, graph[module].code);</span></span>
<span class="line"><span style="color:#032F62;">                return exports;</span></span>
<span class="line"><span style="color:#032F62;">            };</span></span>
<span class="line"><span style="color:#032F62;">            require(&#39;\${</span><span style="color:#24292E;">entry</span><span style="color:#032F62;">}&#39;)</span></span>
<span class="line"><span style="color:#032F62;">        })(\${</span><span style="color:#24292E;">graph</span><span style="color:#032F62;">});</span></span>
<span class="line"><span style="color:#032F62;">    \`</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// &#39;./src/index.js&#39; ä¸ºå…¥å£æ–‡ä»¶</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">code</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">generateCode</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;./src/index.js&#39;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(code);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br></div></div><p>é€šè¿‡ä¸Šé¢çš„ä»£ç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å…ˆå°†ç”Ÿæˆçš„ä¾èµ–å›¾è°±è¿›è¡Œæ ¼å¼è½¬æ¢ï¼Œä¹‹åå‘¢ï¼Œæ„é€  <code>require</code> å‡½æ•°å’Œ <code>exports</code> å¯¹è±¡ï¼Œæœ€ç»ˆè½¬æ¢æˆæµè§ˆå™¨è®¤è¯†çš„å­—ç¬¦ä¸²ã€‚</p><h2 id="_2-ç»“æœåˆ†æ" tabindex="-1">2. ç»“æœåˆ†æ <a class="header-anchor" href="#_2-ç»“æœåˆ†æ" aria-label="Permalink to &quot;2. ç»“æœåˆ†æ&quot;">â€‹</a></h2><p>é€šè¿‡ä¸Šé¢çš„ä¸šåŠ¡ç¼–å†™ï¼Œæˆ‘ä»¬å®Œæˆäº†å¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œæ‰“åŒ…çš„è¿‡ç¨‹ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<strong>æ‰“å°ç»“æœï¼š</strong></p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">(function(graph){</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#FDAEB7;font-style:italic;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">require(module){</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#FDAEB7;font-style:italic;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">localRequire(relativePath)</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FDAEB7;font-style:italic;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">require(graph[module].dependencies[relativePath])</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">                var exports = {};</span></span>
<span class="line"><span style="color:#E1E4E8;">                (function(require, exports, code){</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#FDAEB7;font-style:italic;">eval(code)</span></span>
<span class="line"><span style="color:#E1E4E8;">                })(localRequire, exports, graph[</span><span style="color:#FDAEB7;font-style:italic;">module</span><span style="color:#E1E4E8;">].code);</span></span>
<span class="line"><span style="color:#E1E4E8;">                return exports;</span></span>
<span class="line"><span style="color:#E1E4E8;">            };</span></span>
<span class="line"><span style="color:#E1E4E8;">            require(&#39;./src/index.js&#39;)</span></span>
<span class="line"><span style="color:#E1E4E8;">        })({</span><span style="color:#79B8FF;">&quot;./src/index.js&quot;</span><span style="color:#E1E4E8;">:{</span><span style="color:#79B8FF;">&quot;dependencies&quot;</span><span style="color:#E1E4E8;">:{</span><span style="color:#79B8FF;">&quot;./message.js&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;./src</span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">message.js&quot;</span><span style="color:#E1E4E8;">},</span><span style="color:#79B8FF;">&quot;code&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">use strict</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">;</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">var _message = _interopRequireDefault(require(</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">./message.js</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">));</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">default</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">: obj }; }</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">console.log(_message[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">default</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">]);&quot;</span><span style="color:#E1E4E8;">},</span><span style="color:#79B8FF;">&quot;./src\\\\message.js&quot;</span><span style="color:#E1E4E8;">:{</span><span style="color:#79B8FF;">&quot;dependencies&quot;</span><span style="color:#E1E4E8;">:{</span><span style="color:#79B8FF;">&quot;./word.js&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;./src</span><span style="color:#79B8FF;">\\\\</span><span style="color:#9ECBFF;">word.js&quot;</span><span style="color:#E1E4E8;">},</span><span style="color:#79B8FF;">&quot;code&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">use strict</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">;</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">Object.defineProperty(exports, </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">__esModule</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">, {</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">  value: true</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">});</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">exports[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">default</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">] = void 0;</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">var _word = require(</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">./word.js</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">);</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">var message = </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">hello </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">.concat(_word.word);</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">var _default = message;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">exports[</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">default</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">] = _default;&quot;</span><span style="color:#E1E4E8;">},</span><span style="color:#79B8FF;">&quot;./src\\\\word.js&quot;</span><span style="color:#E1E4E8;">:{</span><span style="color:#79B8FF;">&quot;dependencies&quot;</span><span style="color:#E1E4E8;">:{},</span><span style="color:#79B8FF;">&quot;code&quot;</span><span style="color:#E1E4E8;">:</span><span style="color:#9ECBFF;">&quot;</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">use strict</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">;</span><span style="color:#79B8FF;">\\n\\n</span><span style="color:#9ECBFF;">Object.defineProperty(exports, </span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">__esModule</span><span style="color:#79B8FF;">\\&quot;</span><span style="color:#9ECBFF;">, {</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">  value: true</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">});</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">exports.word = void 0;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">var word = &#39;monday&#39;;</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">exports.word = word;&quot;</span><span style="color:#E1E4E8;">}});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">(function(graph){</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#B31D28;font-style:italic;">function</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">require(module){</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#B31D28;font-style:italic;">function</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">localRequire(relativePath)</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">{</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#B31D28;font-style:italic;">return</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">require(graph[module].dependencies[relativePath])</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">                var exports = {};</span></span>
<span class="line"><span style="color:#24292E;">                (function(require, exports, code){</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#B31D28;font-style:italic;">eval(code)</span></span>
<span class="line"><span style="color:#24292E;">                })(localRequire, exports, graph[</span><span style="color:#B31D28;font-style:italic;">module</span><span style="color:#24292E;">].code);</span></span>
<span class="line"><span style="color:#24292E;">                return exports;</span></span>
<span class="line"><span style="color:#24292E;">            };</span></span>
<span class="line"><span style="color:#24292E;">            require(&#39;./src/index.js&#39;)</span></span>
<span class="line"><span style="color:#24292E;">        })({</span><span style="color:#005CC5;">&quot;./src/index.js&quot;</span><span style="color:#24292E;">:{</span><span style="color:#005CC5;">&quot;dependencies&quot;</span><span style="color:#24292E;">:{</span><span style="color:#005CC5;">&quot;./message.js&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;./src</span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">message.js&quot;</span><span style="color:#24292E;">},</span><span style="color:#005CC5;">&quot;code&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">use strict</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">;</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">var _message = _interopRequireDefault(require(</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">./message.js</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">));</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">function _interopRequireDefault(obj) { return obj &amp;&amp; obj.__esModule ? obj : { </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">default</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">: obj }; }</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">console.log(_message[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">default</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">]);&quot;</span><span style="color:#24292E;">},</span><span style="color:#005CC5;">&quot;./src\\\\message.js&quot;</span><span style="color:#24292E;">:{</span><span style="color:#005CC5;">&quot;dependencies&quot;</span><span style="color:#24292E;">:{</span><span style="color:#005CC5;">&quot;./word.js&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;./src</span><span style="color:#005CC5;">\\\\</span><span style="color:#032F62;">word.js&quot;</span><span style="color:#24292E;">},</span><span style="color:#005CC5;">&quot;code&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">use strict</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">;</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">Object.defineProperty(exports, </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">__esModule</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">, {</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">  value: true</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">});</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">exports[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">default</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">] = void 0;</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">var _word = require(</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">./word.js</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">);</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">var message = </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">hello </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">.concat(_word.word);</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">var _default = message;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">exports[</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">default</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">] = _default;&quot;</span><span style="color:#24292E;">},</span><span style="color:#005CC5;">&quot;./src\\\\word.js&quot;</span><span style="color:#24292E;">:{</span><span style="color:#005CC5;">&quot;dependencies&quot;</span><span style="color:#24292E;">:{},</span><span style="color:#005CC5;">&quot;code&quot;</span><span style="color:#24292E;">:</span><span style="color:#032F62;">&quot;</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">use strict</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">;</span><span style="color:#005CC5;">\\n\\n</span><span style="color:#032F62;">Object.defineProperty(exports, </span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">__esModule</span><span style="color:#005CC5;">\\&quot;</span><span style="color:#032F62;">, {</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">  value: true</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">});</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">exports.word = void 0;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">var word = &#39;monday&#39;;</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">exports.word = word;&quot;</span><span style="color:#24292E;">}});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªæ‰“å°ç»“æœï¼Œæ”¾åˆ°æµè§ˆå™¨ä¸Šè¿›è¡Œæ£€éªŒã€‚<strong>æ£€éªŒç»“æœå¦‚ä¸‹ï¼š</strong></p><p><img src="https://mondaylab-1309616765.cos.ap-shanghai.myqcloud.com/images/202305270745219.png" alt="æ£€éªŒç»“æœ"></p><p>å¤§å®¶å¯ä»¥çœ‹åˆ°ï¼Œæ‰“åŒ…åçš„ç»“æœï¼Œåœ¨æµè§ˆå™¨ä¸ŠæˆåŠŸè¿è¡Œäº†ï¼Œå¹¶æ˜¾ç¤ºé™¤äº† <code>hello monday</code> ï¼Œè‡³æ­¤ï¼Œè¯´æ˜æˆ‘ä»¬çš„é¡¹ç›®æ‰“åŒ…æˆåŠŸã€‚</p><h1 id="ğŸ“-å››ã€ç»“æŸè¯­" tabindex="-1">ğŸ“ å››ã€ç»“æŸè¯­ <a class="header-anchor" href="#ğŸ“-å››ã€ç»“æŸè¯­" aria-label="Permalink to &quot;ğŸ“ å››ã€ç»“æŸè¯­&quot;">â€‹</a></h1><p>åœ¨ä¸Šé¢çš„è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»æ¨¡å—çš„å…¥å£æ–‡ä»¶åˆ†æï¼Œå†åˆ°ä¾èµ–å›¾è°±çš„è§£æï¼Œæœ€ååˆ°ç”Ÿæˆæµè§ˆå™¨æ‰€è®¤è¯†çš„ä»£ç ï¼Œæˆ‘ä»¬äº†è§£äº†æ‰“åŒ…å·¥å…·çš„æ•´ä¸ªæ“ä½œæµç¨‹ã€‚</p><p>åˆ°è¿™é‡Œï¼Œå…³äºæœ¬æ–‡çš„è®²è§£å°±ç»“æŸå•¦ï¼å¸Œæœ›å¯¹å¤§å®¶æœ‰å¸®åŠ©~</p><p>å¦‚æ–‡ç« æœ‰è¯¯æˆ–æœ‰ä¸ç†è§£çš„åœ°æ–¹ï¼Œæ¬¢è¿å°ä¼™ä¼´ä»¬è¯„è®ºåŒºç•™è¨€æ’’~ğŸ’¬</p><p>æœ¬æ–‡ä»£ç å·²ä¸Šä¼ è‡³å…¬ä¼—å·ï¼Œåå°å›å¤å…³é”®è¯ <code>webpack</code> å³å¯è·å–~</p><h1 id="ğŸ£-å½©è›‹-one-more-thing" tabindex="-1">ğŸ£ å½©è›‹ One More Thing <a class="header-anchor" href="#ğŸ£-å½©è›‹-one-more-thing" aria-label="Permalink to &quot;ğŸ£ å½©è›‹ One More Thing&quot;">â€‹</a></h1><h2 id="å¾€æœŸæ¨è" tabindex="-1">ï¼ˆï¼šå¾€æœŸæ¨è <a class="header-anchor" href="#å¾€æœŸæ¨è" aria-label="Permalink to &quot;ï¼ˆï¼šå¾€æœŸæ¨è&quot;">â€‹</a></h2><p>webpack å…¥é—¨æ ¸å¿ƒçŸ¥è¯† ğŸ‘‰<a href="https://blog.csdn.net/weixin_44803753/article/details/118728201" target="_blank" rel="noreferrer">ä¸ä¼š webpack çš„å‰ç«¯å¯èƒ½æ˜¯æ¡æ¥çš„ï¼Œä¸‡å­—æ€»ç»“ webpack çš„è¶…å…¥é—¨æ ¸å¿ƒçŸ¥è¯†</a></p><p>webpack å…¥é—¨è¿›é˜¶çŸ¥è¯† ğŸ‘‰<a href="https://blog.csdn.net/weixin_44803753/article/details/118885391" target="_blank" rel="noreferrer">webpack å…¥é—¨æ ¸å¿ƒçŸ¥è¯†è¿˜çœ‹ä¸è¿‡ç˜¾ï¼Ÿé€Ÿæ¥å›´è§‚ä¸‡å­—è¿›é˜¶çŸ¥è¯†</a></p><p>webpack å®æˆ˜æ¡ˆä¾‹é…ç½® ğŸ‘‰<a href="https://blog.csdn.net/weixin_44803753/article/details/118977647" target="_blank" rel="noreferrer">[ä¸‡å­—æ€»ç»“]webpack åªä¼šåŸºç¡€é…ç½®å¯ä¸è¡Œï¼å¿«æ¥æŠŠå®æˆ˜æ¡ˆä¾‹é…ç½®ä¸€èµ·æ‰“åŒ…å¸¦èµ°</a></p><p>æ‰‹å†™ loader å’Œ pluginğŸ‘‰<a href="https://blog.csdn.net/weixin_44803753/article/details/119022964" target="_blank" rel="noreferrer">webpack å®æˆ˜ä¹‹æ‰‹å†™ä¸€ä¸ª loader å’Œ plugin</a></p>`,68),e=[o];function c(t,r,y,E,i,F){return n(),a("div",null,e)}const d=s(p,[["render",c]]);export{b as __pageData,d as default};
